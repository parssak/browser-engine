{"version":3,"sources":["engine/core/EngineContext.ts","engine/core/Entity.ts","engine/core/SceneManager.ts","utils/index.ts","engine/controls/FlyControls.js","engine/controls/OrbitControls.js","engine/controls/TransformControls.js","engine/core/ControlsManager.ts","engine/core/Transform.ts","engine/core/ComponentManager.ts","engine/core/MaterialManager.ts","engine/core/CameraManager.ts","utils/script.utils.ts","engine/core/utils.ts","engine/core/GeometryManager.ts","utils/entity.utils.ts","utils/ScriptCompiler.ts","engine/core/Component.ts","state/editor/EditorContext.tsx","state/scene/SceneContext.tsx","state/scripts/ScriptContext.tsx","state/scene/useScene.tsx","utils/ProjectExporter.ts","state/scripts/useScripts.tsx","state/editor/useEditor.tsx","ui/panels/Panel.tsx","ui/panels/inspector/entity/useControlPanel.tsx","ui/panels/inspector/entity/CameraNode.tsx","ui/panels/inspector/entity/ComponentNode.tsx","ui/panels/inspector/entity/LightNode.tsx","ui/panels/inspector/entity/MeshNode.tsx","ui/panels/inspector/EntityInspector.tsx","ui/panels/inspector/MaterialInspector.tsx","ui/panels/inspector/InspectorPanel.tsx","ui/panels/nav/Nav.tsx","ui/panels/editor/EditorPanel.tsx","ui/panels/scene/ScenePanel.tsx","ui/panels/hierarchy/HierarchyNode.tsx","ui/panels/hierarchy/HierarchyPanel.tsx","ui/panels/project/ProjectNodeWrapper.tsx","ui/panels/project/ScriptNode.tsx","ui/panels/project/ProjectPanel.tsx","ui/base/BrowserEngine.tsx","App.tsx","index.tsx"],"names":["context","sceneManager","cameraManager","componentManager","materialManager","geometryManager","controlsManager","time","THREE","_renderElement","isInitialized","this","SceneManager","CameraManager","ComponentManager","MaterialManager","GeometryManager","ControlsManager","renderElement","payload","updateScenePayload","runEditMode","elapsedTime","start","runPlayScene","sceneCam","getScene","getObjectByName","useSceneCamera","setup","stop","runEditScene","useEditCamera","forInitialization","setScenePayload","materials","setSceneMaterials","entityID","entityProps","updateEntityPayload","entity","buildEntity","destroyEntity","isPlaying","mouseX","mouseY","handleClick","selectByID","deselect","getSelectedEntity","getSelectedEntityPayload","newComponentName","oldComponentName","renameComponent","renameComponentInEntities","scripts","ScriptCompiler","CompileScripts","Object","values","Entity","props","id","name","type","components","mesh","light","camera","init","_initObject","_appendIdentifiers","_initComponents","_startComponents","deltaTime","_updateComponents","mat","material","uniforms","value","componentName","forEach","component","update","entries","instance","setComponent","geometry","_initMesh","lightProps","_initLight","cameraProps","_initCamera","obj","getObject","visible","castShadow","receiveShadow","materialType","geometryType","getMaterial","getGeometry","cam","fov","aspect","getAspect","near","far","color","intensity","color2","createLight","downcastedLight","Color","groundColor","skyColor","object","uuid","_scene","_entities","_scenePayload","_scenePayloadInitialized","_selectedEntityID","_axes","_gridHelper","_cameraHelper","_selectionHelper","_lightHelpers","recursiveSetHelper","add","load","texture","rt","image","height","fromEquirectangularTexture","renderer","background","transformControls","forInit","_compileMaterials","sceneConfig","entities","find","e","updateIndex","findIndex","setFromObject","helper","_resetScene","_hideHelpers","_buildScene","_startEntities","error","console","_showHelpers","undefined","lookAt","position","select","addObjectControls","removeObjectControls","push","entityObject","target","some","pointLightHelper","remove","destroy","newMaterial","componentProps","entityComponentProps","keys","propName","input","localPayloadCopy","JSON","parse","stringify","_buildEntities","associatedVertexShader","script","vertexShaderID","associatedFragmentShader","fragmentShaderID","materialPayload","vertexShader","content","fragmentShader","addCustomMaterial","dispose","_changeEvent","FlyControls","domElement","warn","document","movementSpeed","rollSpeed","dragToLook","autoForward","scope","EPS","lastQuaternion","Quaternion","lastPosition","Vector3","tmpQuaternion","mouseStatus","moveState","up","down","left","right","forward","back","pitchUp","pitchDown","yawLeft","yawRight","rollLeft","rollRight","moveVector","rotationVector","keydown","event","altKey","code","movementSpeedMultiplier","updateMovementVector","updateRotationVector","keyup","mousedown","button","mousemove","container","getContainerDimensions","halfWidth","size","halfHeight","pageX","offset","pageY","mouseup","delta","moveMult","rotMult","translateX","x","translateY","y","translateZ","z","set","normalize","quaternion","multiply","distanceToSquared","dot","dispatchEvent","copy","offsetWidth","offsetHeight","offsetLeft","offsetTop","window","innerWidth","innerHeight","removeEventListener","contextmenu","_mousedown","_mousemove","_mouseup","_keydown","_keyup","bind","addEventListener","EventDispatcher","preventDefault","_startEvent","_endEvent","OrbitControls","style","touchAction","enabled","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","Math","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","clone","position0","zoom0","zoom","_domElementKeyEvents","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","getDistance","distanceTo","listenToKeyEvents","onKeyDown","saveState","reset","updateProjectionMatrix","state","STATE","NONE","quat","setFromUnitVectors","quatInverse","invert","twoPI","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","min","max","isFinite","makeSafe","radius","scale","addScaledVector","panOffset","setFromSpherical","multiplyScalar","zoomChanged","onContextMenu","onPointerDown","onPointerCancel","onMouseWheel","onPointerMove","onPointerUp","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","pointers","pointerPositions","getZoomScale","pow","angle","rotateUp","panLeft","v","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","length","tan","clientHeight","matrix","isOrthographicCamera","clientWidth","top","bottom","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchMoveRotate","getSecondPointerPosition","subVectors","handleTouchMovePan","handleTouchMoveDolly","setPointerCapture","pointerId","addPointer","pointerType","trackPointer","DOLLY_ROTATE","onTouchStart","mouseAction","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","onMouseDown","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","onTouchMove","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","onMouseMove","removePointer","releasePointerCapture","handleMouseWheel","needsUpdate","activeElement","handleKeyDown","i","splice","pointer","passive","_raycaster","Raycaster","_tempVector","_tempVector2","_tempQuaternion","_unit","X","Y","Z","_mouseDownEvent","_mouseUpEvent","mode","_objectChangeEvent","TransformControls","_gizmo","TransformControlsGizmo","_plane","TransformControlsPlane","defineProperty","defaultValue","propValue","get","worldPosition","worldPositionStart","worldQuaternion","worldQuaternionStart","cameraPosition","cameraQuaternion","pointStart","pointEnd","rotationAxis","eye","_offset","_startNorm","_endNorm","_cameraScale","_parentPosition","_parentQuaternion","_parentQuaternionInv","_parentScale","_worldScaleStart","_worldQuaternionInv","_worldScale","_positionStart","_quaternionStart","_scaleStart","_getPointer","getPointer","_onPointerDown","_onPointerHover","onPointerHover","_onPointerMove","_onPointerUp","updateMatrixWorld","parent","matrixWorld","decompose","dragging","setFromCamera","intersect","intersectObjectWithRay","picker","axis","planeIntersect","space","snap","rotationSnap","rotation","round","point","indexOf","divide","translationSnap","search","setFromMatrixPosition","d","scaleSnap","ROTATION_SPEED","rotationAngle","angleTo","cross","setFromAxisAngle","traverse","child","Object3D","ownerDocument","pointerLockElement","rect","getBoundingClientRect","width","pointerHover","pointerDown","pointerMove","pointerUp","raycaster","includeInvisible","allIntersections","intersectObject","prototype","isTransformControls","_tempEuler","Euler","_alignVector","_zeroVector","_lookAtMatrix","Matrix4","_tempQuaternion2","_identityQuaternion","_dirVector","_tempMatrix","_unitX","_unitY","_unitZ","_v1","_v2","_v3","gizmoMaterial","MeshBasicMaterial","depthTest","depthWrite","fog","toneMapped","transparent","gizmoLineMaterial","LineBasicMaterial","matInvisible","opacity","matHelper","matRed","setHex","matGreen","matBlue","matRedTransparent","matGreenTransparent","matBlueTransparent","matWhiteTransparent","matYellowTransparent","matGray","arrowGeometry","CylinderGeometry","translate","scaleHandleGeometry","BoxGeometry","lineGeometry","BufferGeometry","setAttribute","Float32BufferAttribute","lineGeometry2","CircleGeometry","arc","TorusGeometry","rotateY","rotateX","gizmoTranslate","Mesh","XYZ","OctahedronGeometry","XY","YZ","XZ","pickerTranslate","helperTranslate","START","END","DELTA","Line","TranslateHelperGeometry","gizmoRotate","XYZE","E","helperRotate","AXIS","pickerRotate","SphereGeometry","gizmoScale","pickerScale","helperScale","setupGizmo","gizmoMap","gizmo","tag","updateMatrix","tempGeometry","applyMatrix4","renderOrder","force","handles","concat","children","handle","factor","setFromEuler","abs","setFromRotationMatrix","AXIS_HIDE_TRESHOLD","atan2","multiplyQuaternions","showX","showY","showZ","_color","_opacity","split","a","isTransformControlsGizmo","PlaneGeometry","wireframe","side","DoubleSide","isTransformControlsPlane","controls","_setFlyControls","_setOrbitControls","_initTransformControls","addTransformControlsToScene","objectID","updatedTransformComponent","Transform","tControls","key","toLowerCase","setMode","setTranslationSnap","setRotationSnap","degToRad","setScaleSnap","attach","detach","_object","applyMatrix","setRotationFromEuler","applyPosition","applyRotation","applyScale","Component","registerComponent","constructor","componentType","getComponent","prop","Array","isArray","componentInstance","normal","basic","phong","lambert","mustRefreshEntities","matchingMaterial","m","refreshEntitiesMaterial","antialias","alpha","editCamera","sceneCamera","currentControls","clock","_setCamera","handleResize","scene","appendChild","_setRenderer","_setControls","_setRaycaster","_runSceneLoop","intersects","intersectObjects","withoutHelpers","filter","objectSelect","setAnimationLoop","setControls","setSize","toneMapping","toneMappingExposure","shadowMap","dimensions","w","offsetParent","h","setPixelRatio","devicePixelRatio","render","getDelta","getElapsedTime","updateScene","updateControls","COMPONENT_DEF","BASE_COMPONENT_SCRIPT_CONTENT","generateNewScript","language","uuidv4","initPropPlaceholder","formatScriptString","replace","injectInitSection","scriptBody","actualInitSection","map","join","generateNewMaterial","planeBufferGeometry","geometries","box","sphere","cylinder","torus","plane","tetrahedron","octahedron","dodecahedron","icosahedron","generateNewEntity","generateNewLight","CompileComponentScript","err","three","Instantiate","CreateEntity","Time","scriptCopy","removePrefix","substring","pureProps","replaceAll","eval","formattedScript","NewComponent","setPrototypeOf","updateEntitiesComponentProps","initialValue","localScenePayload","EditorContext","createContext","EditorProvider","contextValue","useRef","useMemo","fromLocalStorage","localStorage","getItem","Provider","selectedEntityID","selectedMaterialID","setEntities","setSelectedEntityID","setSelectedMaterialID","materialID","setCameraProps","setMaterials","SceneContext","SceneProvider","useState","useEffect","deselectEntity","updateSpecificEntity","selectedScript","setScriptBody","setScripts","setSelectedScript","compileScripts","ScriptContext","val","ScriptProvider","useScene","useContext","selectedEntity","selectedMaterial","createEntity","addNewEntity","selectEntity","updateEntity","index","removeEntity","updateEntityParent","newParent","createMaterial","materialName","updatedMaterialsObject","updateSceneMaterials","selectMaterial","_setEntities","_setMaterials","ProjectExporter","project","zip","JSZip","folder","file","generateHtmlFile","generateJsFile","generateAsync","then","saveAs","useScripts","_setScripts","loadScript","scriptName","foundScript","method","debug","saveScript","createScript","scriptsPayload","newScripts","updatedScriptsObject","scriptPayload","newScript","updateScriptName","includes","oldName","_compileScripts","useEditor","rootHook","isRunning","setIsRunning","fromEntries","s","materialsPayload","scenePayload","current","toggleRun","runPlayMode","handleClickScene","canvas","focus","domRect","saveScene","setItem","exportScene","Export","forceUpdateScenePayload","Panel","label","bodyClass","className","changingField","useControlPanel","folderName","changeProps","customActions","useControls","asEntries","fieldName","fieldValue","onEditStart","onChange","onEditEnd","actualControls","CameraNode","updateCameraProps","updatedCameraProps","ComponentNode","updateComponent","removeComponent","LightNode","updateLightProps","updatedLightProps","MeshNode","setMaterialType","setGeometryType","materialOptions","geometryOptions","option","newGeometry","EntityInspector","propFields","updateComponentFields","field","newControls","componentOptions","getComponents","currentComponents","c","getComponentOptions","onBlur","newName","disabled","blur","onClick","checked","updatedProps","componentScriptID","handleRemoveComponent","fill","flat","titleBar","log","getComponentProps","addComponent","MaterialInspector","InspectorPanel","Nav","newEntity","newLight","vShader","fShader","EditorPanel","defaultLanguage","getLanguage","theme","newValue","defaultPath","ScenePanel","ref","tabIndex","HierarchyNode","isSelected","isHidden","stopPropagation","HierarchyPanel","ProjectNodeWrapper","title","ScriptNode","ProjectPanel","BrowserEngine","selectedSomething","gridTemplateColumns","App","ReactDOM","StrictMode","getElementById"],"mappings":"wMA2GMA,EAAU,I,WAvFd,aAAe,yBAVfC,kBAUc,OATdC,mBASc,OARdC,sBAQc,OAPdC,qBAOc,OANdC,qBAMc,OALdC,qBAKc,OAJdC,KAAO,IAAIC,QAIG,KAHNC,oBAGM,OAFNC,eAAgB,EAGtBC,KAAKV,aAAe,IAAIW,IACxBD,KAAKT,cAAgB,IAAIW,IACzBF,KAAKR,iBAAmB,IAAIW,IAC5BH,KAAKP,gBAAkB,IAAIW,IAC3BJ,KAAKN,gBAAkB,IAAIW,IAC3BL,KAAKL,gBAAkB,IAAIW,I,wCAG7B,SAAKC,EAA4BC,GAC3BR,KAAKD,gBACTC,KAAKF,eAAiBS,EAClBC,GAASR,KAAKS,mBAAmBD,GAAS,GAC9CR,KAAKU,cACLV,KAAKD,eAAgB,K,yBAGvB,WACEC,KAAKJ,KAAKe,YAAc,EACxBX,KAAKJ,KAAKgB,QACVZ,KAAKV,aAAauB,eAClB,IAAMC,EAAWd,KAAKV,aAAayB,WAAWC,gBAAgB,eAC9DhB,KAAKT,cAAc0B,eAAeH,GAClCd,KAAKT,cAAc2B,MAAMlB,KAAKF,eAAgBE,KAAKV,aAAayB,c,yBAGlE,WACEf,KAAKJ,KAAKuB,OACVnB,KAAKV,aAAa8B,eAClBpB,KAAKT,cAAc8B,gBACnBrB,KAAKT,cAAc2B,MAAMlB,KAAKF,eAAgBE,KAAKV,aAAayB,c,gCAGlE,SAAmBP,GAA0D,IAA5Bc,EAA2B,wDAC1EtB,KAAKV,aAAaiC,gBAAgBf,EAASc,K,kCAG7C,SAAqBE,GACnBxB,KAAKV,aAAamC,kBAAkBD,K,kCAGtC,SAAqBE,EAA2BC,GAC9C3B,KAAKV,aAAasC,oBAAoBF,EAAUC,K,0BAGlD,SAAaE,GACX7B,KAAKV,aAAawC,YAAYD,K,0BAGhC,SAAaH,GACX1B,KAAKV,aAAayC,cAAcL,K,uBAGlC,WAAsB,IAAD,EACnB,iBAAOzB,IAAa+B,mBAApB,W,yBAGF,SAAYC,EAAgBC,GAC1BlC,KAAKT,cAAc4C,YAAYF,EAAQC,K,0BAGzC,SAAaR,GACX1B,KAAKV,aAAa8C,WAAWV,K,4BAG/B,WACE1B,KAAKV,aAAa+C,a,+BAGpB,WACE,OAAOrC,KAAKV,aAAagD,sB,oCAG3B,WACE,OAAOtC,KAAKV,aAAaiD,6B,6BAG3B,SAAgBC,EAA0BC,GACxCzC,KAAKR,iBAAiBkD,gBAAgBF,EAAkBC,GACxDzC,KAAKV,aAAaqD,0BAA0BH,EAAkBC,K,4BAGhE,SAAeG,GACbC,IAAeC,eAAeC,OAAOC,OAAOJ,Q,MAMjCvD,O,0ICpGM4D,E,WAWnB,WAAYC,GAA4B,yBAVxBC,QAUuB,OAThCC,KAAe,GASiB,KARhCC,UAQgC,OAPhCC,WAAsD,GAOtB,KAJ/BC,UAI+B,OAH/BC,WAG+B,OAF/BC,YAE+B,EACrCzD,KAAKmD,GAAKD,EAAMC,GAChBnD,KAAKoD,KAAOF,EAAME,KAClBpD,KAAKqD,KAAOH,EAAMG,KAClBrD,KAAK0D,KAAKR,G,wCAGZ,SAAYA,GACVlD,KAAK2D,YAAYT,GACjBlD,KAAK4D,mBAAmBV,EAAMC,GAAID,EAAME,MACxCpD,KAAK6D,gBAAgBX,EAAMI,c,mBAG7B,WACMrD,EAAa+B,aACfhC,KAAK8D,qB,oBAIT,SAAcC,EAAmBpD,GAAsB,IAAD,EAChDV,EAAa+B,aACfhC,KAAKgE,oBAGP,IAAMC,EAAG,OAAGjE,WAAH,IAAGA,MAAH,UAAGA,KAAMuD,YAAT,aAAG,EAAYW,UACxB,OAAID,QAAJ,IAAIA,OAAJ,EAAIA,EAAKE,YACPF,EAAIE,SAASvE,KAAKwE,MAAQzD,K,qBAI9B,c,0BAIA,SAAoB0D,GAClB,OAAOrE,KAAKsD,WAAWe,K,uBAGzB,WACE,OAAOrE,KAAKuD,MAAQvD,KAAKwD,OAASxD,KAAKyD,S,8BAGzC,WACEV,OAAOC,OAAOhD,KAAKsD,YAAYgB,SAAQ,SAACC,GAAD,OAAeA,EAAU3D,a,+BAGlE,WACEmC,OAAOC,OAAOhD,KAAKsD,YAAYgB,SAAQ,SAACC,GAAD,OAAeA,EAAUC,c,6BAGlE,SACElB,GACC,IAAD,OACAtD,KAAKsD,WAAa,GAClBP,OAAO0B,QAAQnB,GAAYgB,SAAQ,YAAoB,IAAD,mBAAjBjB,EAAiB,KAAXH,EAAW,KACpD/C,IAAiBuE,SAASC,aAAa,EAAMtB,EAAMH,Q,yBAIvD,SAAoBA,GACC,UAAfA,EAAMG,MAAoBH,EAAM0B,UAAY1B,EAAMgB,SACpDlE,KAAK6E,UAAU3B,EAAMgB,SAAUhB,EAAM0B,UACb,UAAf1B,EAAMG,MAAoBH,EAAM4B,WACzC9E,KAAK+E,WAAW7B,EAAM4B,YACE,WAAf5B,EAAMG,MAAqBH,EAAM8B,aAC1ChF,KAAKiF,YAAY/B,EAAM8B,aAGzB,IAAME,EAAMlF,KAAKmF,YACbD,IACFA,EAAIE,QAAUlC,EAAMkC,QACpBF,EAAIG,WAAanC,EAAMmC,WACvBH,EAAII,cAAgBpC,EAAMoC,iB,uBAI9B,SAAkBC,EAAsBC,GACtC,IAAMvB,EAAM7D,IAAgBsE,SAASe,YAAYF,GAC3CX,EAAWvE,IAAgBqE,SAASgB,YAAYF,GACjDxF,KAAKuD,MAGRvD,KAAKuD,KAAKqB,SAAWA,EACrB5E,KAAKuD,KAAKW,SAAWD,GAHrBjE,KAAKuD,KAAO,IAAI1D,OAAW+E,EAAUX,K,yBAOzC,SAAoBe,GAClB,GAAKhF,KAAKyD,OAOH,CACL,IAAMkC,EAAM3F,KAAKyD,OACjBkC,EAAIC,IAAMZ,EAAYY,IACtBD,EAAIE,OAAS3F,IAAcwE,SAASoB,YACpCH,EAAII,KAAOf,EAAYe,KACvBJ,EAAIK,IAAMhB,EAAYgB,SAXtBhG,KAAKyD,OAAS,IAAI5D,oBAChBmF,EAAYY,IACZ1F,IAAcwE,SAASoB,YACvBd,EAAYe,KACZf,EAAYgB,O,wBAWlB,SAAmBlB,GAgBZ9E,KAAKwD,QACRxD,KAAKwD,MAhBa,SAACN,GACnB,OAAQA,EAAMG,MACZ,IAAK,UACH,OAAO,IAAIxD,eAAmBqD,EAAM+C,MAAO/C,EAAMgD,WACnD,IAAK,cACH,OAAO,IAAIrG,mBAAuBqD,EAAM+C,MAAO/C,EAAMgD,WACvD,IAAK,aACH,OAAO,IAAIrG,kBAAsBqD,EAAM+C,MAAO/C,EAAMiD,OAAQjD,EAAMgD,WACpE,IAAK,QACH,OAAO,IAAIrG,aAAiBqD,EAAM+C,MAAO/C,EAAMgD,WACjD,QACE,OAAO,IAAIrG,eAAmBqD,EAAM+C,MAAO/C,EAAMgD,YAKxCE,CAAYtB,IAG3B9E,KAAKwD,MAAM0C,UAAYpB,EAAWoB,UAClC,IAAMG,EAAkBrG,KAAKwD,MAEzB6C,EAAgBJ,MAClBI,EAAgBJ,MAAQ,IAAIK,QAAMxB,EAAWmB,OAGtCI,EAAgBE,cACvBF,EAAgBE,YAAc,IAAID,QAAMxB,EAAWmB,QAGjDI,EAAgBG,UAAY1B,EAAWqB,SACzCE,EAAgBG,SAAW,IAAIF,QAAMxB,EAAWqB,W,gCAIpD,SAA2BhD,EAAYC,GACrC,IAAMqD,EAAqCzG,KAAKmF,YAC3CsB,IACLA,EAAOC,KAAOvD,EACdsD,EAAOrD,KAAOA,O,aC7JGnD,E,WAkBnB,aAAe,IAAD,OACZ,GADY,yBAhBN+B,WAAqB,EAgBf,KAfN2E,YAeM,OAdNC,UAAsB,GAchB,KAbNC,mBAaM,OAZNC,0BAA2B,EAYrB,KATNC,uBASM,OANNC,MAAQ,IAAInH,aAAiB,GAMvB,KALNoH,YAAc,IAAIpH,aAAiB,IAAM,KAKnC,KAJNqH,cAAgB,IAAIrH,eAAmB,IAAIA,qBAIrC,KAHNsH,sBAGM,OAFNC,cAA0C,GAG5CnH,EAAayE,SACf,OAAOzE,EAAayE,SAEtBzE,EAAayE,SAAW1E,KACxBA,KAAK2G,OAAS,IAAI9G,QAElBwH,YAAmBrH,KAAKgH,OACxBhH,KAAK2G,OAAOW,IAAItH,KAAKgH,OAErBK,YAAmBrH,KAAKiH,aACxBjH,KAAK2G,OAAOW,IAAItH,KAAKiH,aAErBI,YAAmBrH,KAAKmH,kBACxBnH,KAAKmH,iBAAmB,IAAItH,YAAgBG,KAAKiH,YAAa,UAC9DjH,KAAKmH,iBAAiB/B,SAAU,EAChCpF,KAAK2G,OAAOW,IAAItH,KAAKmH,mBAEN,IAAItH,iBACZ0H,KAAK,wCAAwC,SAACC,GACnD,IAAMC,EAAK,IAAI5H,wBAA4B2H,EAAQE,MAAMC,QACzDF,EAAGG,2BAA2B1H,IAAcwE,SAASmD,SAAUL,GAC/D,EAAKb,OAAOmB,WAAaL,EAAGD,W,+DAShC,SAA4BO,GAC1B/H,KAAK2G,OAAOW,IAAIS,K,sBAGlB,WACE,OAAO/H,KAAK2G,S,6BAGd,SAAgBnG,EAA8BwH,GACxCA,GAAWhI,KAAK8G,2BACpB9G,KAAK6G,cAAgBrG,EACrBR,KAAKiI,oBACDD,IACFhI,KAAK8G,0BAA2B,M,+BAIpC,SAAkBtG,GACXR,KAAK6G,gBACV7G,KAAK6G,cAAcqB,YAAY1G,UAAYhB,K,sCAI7C,WAA4D,IAAD,SACzD,iBAAOR,KAAK6G,qBAAZ,aAAO,EAAoBqB,YAAYC,SAASC,MAC9C,SAACC,GAAD,OAAOA,EAAElF,KAAO,EAAK4D,uB,iCAIzB,SAAoBrF,EAA2BC,GAC7C,IAAM2G,EAActI,KAAK4G,UAAU2B,WAAU,SAACF,GAAD,OAAOA,EAAElF,KAAOzB,KAC7D,IAAqB,IAAjB4G,EAAJ,CACAtI,KAAK4G,UAAU0B,GAAa5E,KAAK/B,GACjC,IAE8B,EAFxB8E,EAASzG,KAAK4G,UAAU0B,GAAanD,YAC3C,GAAIsB,EACF,GAAoB,SAAhBA,EAAOpD,KACT,UAAArD,KAAKmH,wBAAL,SAAuBqB,cAAc/B,QAErCzG,KAAKoH,cAAc9C,SAAQ,SAACmE,GAC1BA,EAAOjE,e,yBAMf,SAAYT,EAAmBpD,GAC7BX,KAAK4G,UAAUtC,SAAQ,SAACzC,GACtBA,EAAO2C,OAAOT,EAAWpD,Q,0BAS7B,WACEX,KAAKgC,WAAY,EACjBhC,KAAK0I,cACL1I,KAAK2I,eACL,IACE3I,KAAK4I,cACL5I,KAAK6I,iBACL,MAAOC,GACPC,QAAQD,MAAM,yC,0BAUlB,WACE9I,KAAKgC,WAAY,EACjBhC,KAAK0I,cACL1I,KAAKgJ,eACLhJ,KAAK4I,gB,wBAIP,SAAWlH,GAA4B,IAAD,IAC9B+E,EAAM,oBAAGzG,KAAK4G,UAAUwB,MAAK,SAACC,GAAD,OAAOA,EAAElF,KAAOzB,YAAvC,aAAG,EAA+CyD,mBAAlD,aAAiE8D,EACzExC,IACFnG,IAAgBoE,SAASwE,OAAOzC,EAAO0C,UACvCnJ,KAAKoJ,OAAO3C,M,oBAOhB,SAAOA,GACL,IAAIzG,KAAKgC,UAET,OAAIyE,GACFnG,IAAgBoE,SAAS2E,kBAAkB5C,GAC3CzG,KAAK+G,kBAAoBN,EAAOC,KAChC1G,KAAKmH,iBAAiBqB,cAAc/B,QAChB,SAAhBA,EAAOpD,KACTrD,KAAKmH,iBAAiB/B,SAAU,EACP,sBAAhBqB,EAAOpD,OAChBrD,KAAKkH,cAAc9B,SAAU,UAIjCpF,KAAKkH,cAAc9B,SAAU,K,sBAG/B,WACEpF,KAAKmH,iBAAiB/B,SAAU,EAChCpF,KAAK+G,uBAAoBkC,EACzBjJ,KAAKkH,cAAc9B,SAAU,EAC7B9E,IAAgBoE,SAAS4E,yB,+BAG3B,WACE,OAAOtJ,KAAK+G,oB,yBAGd,SAAY7D,GACV,IAAMrB,EAAS,IAAIoB,EAAOC,GAC1BlD,KAAK4G,UAAU2C,KAAK1H,GACpB,IAAM2H,EAAe3H,EAAOsD,YAC5B,GAAIqE,EAEF,GADAxJ,KAAK2G,OAAOW,IAAIkC,GACU,eAAtBA,EAAanG,MAA0BrD,KAAKgC,UAczC,GAA0B,qBAAtBwH,EAAanG,KAA6B,CACnD,IAAMG,EAAQgG,EACdxJ,KAAK2G,OAAOW,IAAI9D,EAAMiG,YACS,sBAAtBD,EAAanG,OACtBrD,KAAKkH,cAAgB,IAAIrH,eAAmB2J,GAC5CnC,YAAmBrH,KAAKkH,eACxBlH,KAAKkH,cAAcR,KAAO8C,EAAa9C,KACvC1G,KAAKkH,cAAc9B,SAAU,EAC7BpF,KAAK2G,OAAOW,IAAItH,KAAKkH,qBAlBrB,IAH6BlH,KAAKoH,cAAcsC,MAC9C,SAACjB,GAAD,OAAYA,EAAO/B,OAASxD,EAAMC,MAET,CACzB,IACMwG,EAAmB,IAAI9J,mBAC3B2J,EAFiB,GAKnBG,EAAiBjD,KAAO8C,EAAa9C,KACrC1G,KAAK2G,OAAOW,IAAIqC,GAChB3J,KAAKoH,cAAcmC,KAAKI,GAa9B,OAAO9H,I,2BAGT,SAAcH,GACRA,IAAa1B,KAAK+G,mBACpB/G,KAAKqC,WAEP,IAAMR,EAAS7B,KAAK4G,UAAUwB,MAAK,SAACC,GAAD,OAAOA,EAAElF,KAAOzB,KACnD,GAAIG,EAAQ,CACV,IAAM4E,EAAS5E,EAAOsD,YAClBsB,GACFzG,KAAK2G,OAAOiD,OAAOnD,GAErB5E,EAAOgI,a,uCAIX,SAA0BrH,EAA0BC,GAA2B,IAAD,EAC5E,UAAAzC,KAAK6G,qBAAL,SAAoBqB,YAAYC,SAAS7D,SAAQ,SAACzC,GAChD,IAAM0C,EAAY1C,EAAOyB,WAAWb,GAChC8B,IACF1C,EAAOyB,WAAWd,GAAoB+B,SAC/B1C,EAAOyB,WAAWb,S,qCAK/B,SAAwBqH,GACtB9J,KAAK4G,UAAUtC,SAAQ,SAACzC,GACtB,IAAM4E,EAAS5E,EAAOsD,YAClBsB,GAAUA,EAAOvC,UAAYuC,EAAOvC,SAASwC,OAASoD,EAAYpD,OACpED,EAAOvC,SAAW4F,Q,0CAOxB,SACEzF,EACA0F,GACC,IAAD,EACA,UAAA/J,KAAK6G,qBAAL,SAAoBqB,YAAYC,SAAS7D,SAAQ,SAACzC,GAChD,IAAMmI,EAAuBnI,EAAOyB,WAAWe,GAC3C2F,IACFjH,OAAOkH,KAAKF,GAAgBzF,SAAQ,SAAC4F,GAC9BF,EAAqBE,KACxBF,EAAqBE,GAAYH,EAAeG,OAIpDnH,OAAOkH,KAAKD,GAAsB1F,SAAQ,SAAC4F,GACpCH,EAAeG,WACXF,EAAqBE,Y,4BAOtC,WACElK,KAAK4G,UAAUtC,SAAQ,SAACzC,GACtBA,EAAOjB,a,yBAIX,WAAuB,IAAD,OACpBZ,KAAK4G,UAAUtC,SAAQ,SAACzC,GACtB,IAAM4E,EAAS5E,EAAOsD,YAClBsB,GACF,EAAKE,OAAOiD,OAAOnD,GAErB5E,EAAOgI,aAET7J,KAAK4G,UAAY,K,yBAGnB,WACE,GAAK5G,KAAK6G,cAAV,CACA,IC/RyBsD,ED+RnBC,GC/RmBD,ED+R+BnK,KAAK6G,cC9RxDwD,KAAKC,MAAMD,KAAKE,UAAUJ,KD+R/BnK,KAAKwK,eAAeJ,EAAiBlC,YAAYC,a,4BAGnD,SAAuBA,GAAiC,IAAD,OACrDA,EAAS7D,SAAQ,SAAC3C,GAChB,EAAKG,YAAYH,Q,+BAIrB,WAA6B,IAAD,OACrB3B,KAAK6G,eACV7G,KAAK6G,cAAcqB,YAAY1G,UAAU8C,SAAQ,SAACJ,GAAc,IAAD,IACvDuG,EAAsB,UAAG,EAAK5D,qBAAR,aAAG,EAAoBjE,QAAQwF,MACzD,SAACsC,GAAD,OAAYA,EAAOvH,KAAOe,EAASyG,kBAG/BC,EAAwB,UAAG,EAAK/D,qBAAR,aAAG,EAAoBjE,QAAQwF,MAC3D,SAACsC,GAAD,OAAYA,EAAOvH,KAAOe,EAAS2G,oBAGrC,GAAKJ,GAA2BG,EAAhC,CACA,IAAME,EAAmC,CACvC3H,GAAIe,EAASf,GACbe,WACA6G,aAAcN,EAAuBO,QACrCC,eAAgBL,EAAyBI,SAE3C5K,IAAgBsE,SAASwG,kBAAkBJ,S,0BAI/C,WAAwB,IAAD,OACrB9K,KAAKgH,MAAM5B,SAAU,EACrBpF,KAAKiH,YAAY7B,SAAU,EAC3BpF,KAAKkH,cAAc9B,SAAU,EAC7B9E,IAAgBoE,SAAS4E,uBAErBtJ,KAAKmH,mBACPnH,KAAKmH,iBAAiB/B,SAAU,GAGlCpF,KAAKoH,cAAc9C,SAAQ,SAACmE,GAC1BA,EAAO0C,UACP,EAAKxE,OAAOiD,OAAOnB,MAErBzI,KAAKoH,cAAgB,K,0BAGvB,WAAwB,IAAD,OAGrB,GAFApH,KAAKgH,MAAM5B,SAAU,EACrBpF,KAAKiH,YAAY7B,SAAU,EACvBpF,KAAKmH,mBACPnH,KAAKmH,iBAAiB/B,SAAU,EAC5BpF,KAAK+G,mBAAmB,CAAC,IAAD,IACpBN,EAAM,oBACVzG,KAAK4G,UAAUwB,MAAK,SAACC,GAAD,OAAOA,EAAElF,KAAO,EAAK4D,4BAD/B,aACV,EAA6D5B,mBADnD,aAEV8D,EACExC,GACFnG,IAAgBoE,SAAS2E,kBAAkB5C,O,wBAvSnD,WACE,OAAOxG,EAAayE,SAAS1C,c,KA7CZ/B,EACLyE,c,oHENV0G,EAAe,CAAE/H,KAAM,UAEvBgI,E,kDACJ,WAAY5E,EAAQ6E,GAAa,IAAD,sBAC9B,oBAEmBrC,IAAfqC,IACFvC,QAAQwC,KACN,0EAEFD,EAAaE,UAGf,EAAK/E,OAASA,EACd,EAAK6E,WAAaA,EAIlB,EAAKG,cAAgB,EACrB,EAAKC,UAAY,KAEjB,EAAKC,YAAa,EAClB,EAAKC,aAAc,EAMnB,IAAMC,EAAK,eAELC,EAAM,KAENC,EAAiB,IAAIC,aACrBC,EAAe,IAAIC,UAEzB,EAAKC,cAAgB,IAAIH,aAEzB,EAAKI,YAAc,EAEnB,EAAKC,UAAY,CACfC,GAAI,EACJC,KAAM,EACNC,KAAM,EACNC,MAAO,EACPC,QAAS,EACTC,KAAM,EACNC,QAAS,EACTC,UAAW,EACXC,QAAS,EACTC,SAAU,EACVC,SAAU,EACVC,UAAW,GAEb,EAAKC,WAAa,IAAIhB,UAAQ,EAAG,EAAG,GACpC,EAAKiB,eAAiB,IAAIjB,UAAQ,EAAG,EAAG,GAExC,EAAKkB,QAAU,SAAUC,GACvB,IAAIA,EAAMC,OAAV,CAIA,OAAQD,EAAME,MACZ,IAAK,YACL,IAAK,aACHvN,KAAKwN,wBAA0B,GAC/B,MAEF,IAAK,OACHxN,KAAKqM,UAAUK,QAAU,EACzB,MACF,IAAK,OACH1M,KAAKqM,UAAUM,KAAO,EACtB,MAEF,IAAK,OACH3M,KAAKqM,UAAUG,KAAO,EACtB,MACF,IAAK,OACHxM,KAAKqM,UAAUI,MAAQ,EACvB,MAEF,IAAK,OACHzM,KAAKqM,UAAUC,GAAK,EACpB,MACF,IAAK,OACHtM,KAAKqM,UAAUE,KAAO,EACtB,MAEF,IAAK,UACHvM,KAAKqM,UAAUO,QAAU,EACzB,MACF,IAAK,YACH5M,KAAKqM,UAAUQ,UAAY,EAC3B,MAEF,IAAK,YACH7M,KAAKqM,UAAUS,QAAU,EACzB,MACF,IAAK,aACH9M,KAAKqM,UAAUU,SAAW,EAC1B,MAEF,IAAK,OACH/M,KAAKqM,UAAUW,SAAW,EAC1B,MACF,IAAK,OACHhN,KAAKqM,UAAUY,UAAY,EAI/BjN,KAAKyN,uBACLzN,KAAK0N,yBAGP,EAAKC,MAAQ,SAAUN,GACrB,OAAQA,EAAME,MACZ,IAAK,YACL,IAAK,aACHvN,KAAKwN,wBAA0B,EAC/B,MAEF,IAAK,OACHxN,KAAKqM,UAAUK,QAAU,EACzB,MACF,IAAK,OACH1M,KAAKqM,UAAUM,KAAO,EACtB,MAEF,IAAK,OACH3M,KAAKqM,UAAUG,KAAO,EACtB,MACF,IAAK,OACHxM,KAAKqM,UAAUI,MAAQ,EACvB,MAEF,IAAK,OACHzM,KAAKqM,UAAUC,GAAK,EACpB,MACF,IAAK,OACHtM,KAAKqM,UAAUE,KAAO,EACtB,MAEF,IAAK,UACHvM,KAAKqM,UAAUO,QAAU,EACzB,MACF,IAAK,YACH5M,KAAKqM,UAAUQ,UAAY,EAC3B,MAEF,IAAK,YACH7M,KAAKqM,UAAUS,QAAU,EACzB,MACF,IAAK,aACH9M,KAAKqM,UAAUU,SAAW,EAC1B,MAEF,IAAK,OACH/M,KAAKqM,UAAUW,SAAW,EAC1B,MACF,IAAK,OACHhN,KAAKqM,UAAUY,UAAY,EAI/BjN,KAAKyN,uBACLzN,KAAK0N,wBAGP,EAAKE,UAAY,SAAUP,GACzB,GAAIrN,KAAK2L,WACP3L,KAAKoM,kBACA,CACL,OAAQiB,EAAMQ,QACZ,KAAK,EACH7N,KAAKqM,UAAUK,QAAU,EACzB,MACF,KAAK,EACH1M,KAAKqM,UAAUM,KAAO,EAI1B3M,KAAKyN,yBAIT,EAAKK,UAAY,SAAUT,GACzB,IAAKrN,KAAK2L,YAAc3L,KAAKoM,YAAc,EAAG,CAC5C,IAAM2B,EAAY/N,KAAKgO,yBACjBC,EAAYF,EAAUG,KAAK,GAAK,EAChCC,EAAaJ,EAAUG,KAAK,GAAK,EAEvClO,KAAKqM,UAAUS,UACXO,EAAMe,MAAQL,EAAUM,OAAO,GAAKJ,GAAaA,EACrDjO,KAAKqM,UAAUQ,WACZQ,EAAMiB,MAAQP,EAAUM,OAAO,GAAKF,GAAcA,EAErDnO,KAAK0N,yBAIT,EAAKa,QAAU,SAAUlB,GACvB,GAAIrN,KAAK2L,WACP3L,KAAKoM,cAELpM,KAAKqM,UAAUS,QAAU9M,KAAKqM,UAAUQ,UAAY,MAC/C,CACL,OAAQQ,EAAMQ,QACZ,KAAK,EACH7N,KAAKqM,UAAUK,QAAU,EACzB,MACF,KAAK,EACH1M,KAAKqM,UAAUM,KAAO,EAI1B3M,KAAKyN,uBAGPzN,KAAK0N,wBAGP,EAAKlJ,OAAS,SAAUgK,GACtB,IAAMC,EAAWD,EAAQ3C,EAAMJ,cACzBiD,EAAUF,EAAQ3C,EAAMH,UAE9BG,EAAMpF,OAAOkI,WAAW9C,EAAMqB,WAAW0B,EAAIH,GAC7C5C,EAAMpF,OAAOoI,WAAWhD,EAAMqB,WAAW4B,EAAIL,GAC7C5C,EAAMpF,OAAOsI,WAAWlD,EAAMqB,WAAW8B,EAAIP,GAE7C5C,EAAMM,cACH8C,IACCpD,EAAMsB,eAAeyB,EAAIF,EACzB7C,EAAMsB,eAAe2B,EAAIJ,EACzB7C,EAAMsB,eAAe6B,EAAIN,EACzB,GAEDQ,YACHrD,EAAMpF,OAAO0I,WAAWC,SAASvD,EAAMM,gBAGrCF,EAAaoD,kBAAkBxD,EAAMpF,OAAO0C,UAAY2C,GACxD,GAAK,EAAIC,EAAeuD,IAAIzD,EAAMpF,OAAO0I,aAAerD,KAExDD,EAAM0D,cAAcnE,GACpBW,EAAeyD,KAAK3D,EAAMpF,OAAO0I,YACjClD,EAAauD,KAAK3D,EAAMpF,OAAO0C,YAInC,EAAKsE,qBAAuB,WAC1B,IAAMf,EACJ1M,KAAKqM,UAAUK,SAAY1M,KAAK4L,cAAgB5L,KAAKqM,UAAUM,KAAQ,EAAI,EAE7E3M,KAAKkN,WAAW0B,GAAK5O,KAAKqM,UAAUG,KAAOxM,KAAKqM,UAAUI,MAC1DzM,KAAKkN,WAAW4B,GAAK9O,KAAKqM,UAAUE,KAAOvM,KAAKqM,UAAUC,GAC1DtM,KAAKkN,WAAW8B,GAAKtC,EAAU1M,KAAKqM,UAAUM,MAGhD,EAAKe,qBAAuB,WAC1B1N,KAAKmN,eAAeyB,GAAK5O,KAAKqM,UAAUQ,UAAY7M,KAAKqM,UAAUO,QACnE5M,KAAKmN,eAAe2B,GAAK9O,KAAKqM,UAAUU,SAAW/M,KAAKqM,UAAUS,QAClE9M,KAAKmN,eAAe6B,GAAKhP,KAAKqM,UAAUY,UAAYjN,KAAKqM,UAAUW,UAGrE,EAAKgB,uBAAyB,WAC5B,OAAIhO,KAAKsL,YAAcE,SACd,CACL0C,KAAM,CAAClO,KAAKsL,WAAWmE,YAAazP,KAAKsL,WAAWoE,cACpDrB,OAAQ,CAACrO,KAAKsL,WAAWqE,WAAY3P,KAAKsL,WAAWsE,YAGhD,CACL1B,KAAM,CAAC2B,OAAOC,WAAYD,OAAOE,aACjC1B,OAAQ,CAAC,EAAG,KAKlB,EAAKlD,QAAU,WACbnL,KAAKsL,WAAW0E,oBAAoB,cAAeC,GACnDjQ,KAAKsL,WAAW0E,oBAAoB,YAAaE,GACjDlQ,KAAKsL,WAAW0E,oBAAoB,YAAaG,GACjDnQ,KAAKsL,WAAW0E,oBAAoB,UAAWI,GAE/CP,OAAOG,oBAAoB,UAAWK,GACtCR,OAAOG,oBAAoB,QAASM,IAGtC,IAAMH,EAAa,EAAKrC,UAAUyC,KAAf,gBACbL,EAAa,EAAKtC,UAAU2C,KAAf,gBACbH,EAAW,EAAK7B,QAAQgC,KAAb,gBACXF,EAAW,EAAKjD,QAAQmD,KAAb,gBACXD,EAAS,EAAK3C,MAAM4C,KAAX,gBAjSe,OAmS9B,EAAKjF,WAAWkF,iBAAiB,cAAeP,GAEhD,EAAK3E,WAAWkF,iBAAiB,YAAaL,GAC9C,EAAK7E,WAAWkF,iBAAiB,YAAaN,GAC9C,EAAK5E,WAAWkF,iBAAiB,UAAWJ,GAE5CP,OAAOW,iBAAiB,UAAWH,GACnCR,OAAOW,iBAAiB,QAASF,GAEjC,EAAK7C,uBACL,EAAKC,uBA7SyB,E,UADR+C,mBAkT1B,SAASR,EAAY5C,GACnBA,EAAMqD,iBCtSR,IAAMtF,EAAe,CAAE/H,KAAM,UACvBsN,EAAc,CAAEtN,KAAM,SACtBuN,EAAY,CAAEvN,KAAM,OAEpBwN,E,kDACJ,WAAYpK,EAAQ6E,GAAa,IAAD,sBAC9B,oBAEmBrC,IAAfqC,GACFvC,QAAQwC,KACN,4EAEAD,IAAeE,UACjBzC,QAAQD,MACN,4HAGJ,EAAKrC,OAASA,EACd,EAAK6E,WAAaA,EAClB,EAAKA,WAAWwF,MAAMC,YAAc,OAGpC,EAAKC,SAAU,EAGf,EAAKvH,OAAS,IAAIyC,UAGlB,EAAK+E,YAAc,EACnB,EAAKC,YAAcC,IAGnB,EAAKC,QAAU,EACf,EAAKC,QAAUF,IAIf,EAAKG,cAAgB,EACrB,EAAKC,cAAgBC,KAAKC,GAI1B,EAAKC,iBAAmBP,IACxB,EAAKQ,gBAAkBR,IAIvB,EAAKS,eAAgB,EACrB,EAAKC,cAAgB,IAIrB,EAAKC,YAAa,EAClB,EAAKC,UAAY,EAGjB,EAAKC,cAAe,EACpB,EAAKC,YAAc,EAGnB,EAAKC,WAAY,EACjB,EAAKC,SAAW,EAChB,EAAKC,oBAAqB,EAC1B,EAAKC,YAAc,GAInB,EAAKC,YAAa,EAClB,EAAKC,gBAAkB,EAGvB,EAAKtI,KAAO,CACVuI,KAAM,YACNC,GAAI,UACJC,MAAO,aACPC,OAAQ,aAIV,EAAKC,aAAe,CAClBJ,KAAMK,QAAMC,OACZC,OAAQF,QAAMG,MACdN,MAAOG,QAAMI,KAIf,EAAKC,QAAU,CAAEC,IAAKC,QAAMN,OAAQO,IAAKD,QAAME,WAG/C,EAAKC,QAAU,EAAK9J,OAAO+J,QAC3B,EAAKC,UAAY,EAAKhN,OAAO0C,SAASqK,QACtC,EAAKE,MAAQ,EAAKjN,OAAOkN,KAGzB,EAAKC,qBAAuB,KAM5B,EAAKC,cAAgB,WACnB,OAAOC,EAAUC,KAGnB,EAAKC,kBAAoB,WACvB,OAAOF,EAAUG,OAGnB,EAAKC,YAAc,WACjB,OAAOlU,KAAKyG,OAAO0C,SAASgL,WAAWnU,KAAKyJ,SAG9C,EAAK2K,kBAAoB,SAAU9I,GACjCA,EAAWkF,iBAAiB,UAAW6D,GACvCrU,KAAK4T,qBAAuBtI,GAG9B,EAAKgJ,UAAY,WACfzI,EAAM0H,QAAQ/D,KAAK3D,EAAMpC,QACzBoC,EAAM4H,UAAUjE,KAAK3D,EAAMpF,OAAO0C,UAClC0C,EAAM6H,MAAQ7H,EAAMpF,OAAOkN,MAG7B,EAAKY,MAAQ,WACX1I,EAAMpC,OAAO+F,KAAK3D,EAAM0H,SACxB1H,EAAMpF,OAAO0C,SAASqG,KAAK3D,EAAM4H,WACjC5H,EAAMpF,OAAOkN,KAAO9H,EAAM6H,MAE1B7H,EAAMpF,OAAO+N,yBACb3I,EAAM0D,cAAcnE,GAEpBS,EAAMrH,SAENiQ,EAAQC,EAAMC,MAIhB,EAAKnQ,OAAU,WACb,IAAM6J,EAAS,IAAInC,UAGb0I,GAAO,IAAI5I,cAAa6I,mBAAmBpO,EAAO6F,GAAI,IAAIJ,UAAQ,EAAG,EAAG,IACxE4I,EAAcF,EAAKpB,QAAQuB,SAE3B9I,EAAe,IAAIC,UACnBH,EAAiB,IAAIC,aAErBgJ,EAAQ,EAAIxD,KAAKC,GAEvB,OAAO,WACL,IAAMtI,EAAW0C,EAAMpF,OAAO0C,SAE9BkF,EAAOmB,KAAKrG,GAAU8L,IAAIpJ,EAAMpC,QAGhC4E,EAAO6G,gBAAgBN,GAGvBd,EAAUqB,eAAe9G,GAErBxC,EAAMyG,YAAcmC,IAAUC,EAAMC,MACtCS,EAmKK,EAAI5D,KAAKC,GAAM,GAAK,GAAM5F,EAAM0G,iBAhKnC1G,EAAM+F,eACRkC,EAAUG,OAASoB,EAAepB,MAAQpI,EAAMgG,cAChDiC,EAAUC,KAAOsB,EAAetB,IAAMlI,EAAMgG,gBAE5CiC,EAAUG,OAASoB,EAAepB,MAClCH,EAAUC,KAAOsB,EAAetB,KAKlC,IAAIuB,EAAMzJ,EAAM6F,gBACZ6D,EAAM1J,EAAM8F,gBAqEhB,OAnEI6D,SAASF,IAAQE,SAASD,KACxBD,GAAO9D,KAAKC,GAAI6D,GAAON,EAClBM,EAAM9D,KAAKC,KAAI6D,GAAON,GAE3BO,GAAO/D,KAAKC,GAAI8D,GAAOP,EAClBO,EAAM/D,KAAKC,KAAI8D,GAAOP,GAG7BlB,EAAUG,MADRqB,GAAOC,EACS/D,KAAK+D,IAAID,EAAK9D,KAAK8D,IAAIC,EAAKzB,EAAUG,QAGtDH,EAAUG,OAASqB,EAAMC,GAAO,EAC5B/D,KAAK+D,IAAID,EAAKxB,EAAUG,OACxBzC,KAAK8D,IAAIC,EAAKzB,EAAUG,QAKlCH,EAAUC,IAAMvC,KAAK+D,IACnB1J,EAAMyF,cACNE,KAAK8D,IAAIzJ,EAAM0F,cAAeuC,EAAUC,MAG1CD,EAAU2B,WAEV3B,EAAU4B,QAAUC,EAGpB7B,EAAU4B,OAASlE,KAAK+D,IACtB1J,EAAMoF,YACNO,KAAK8D,IAAIzJ,EAAMqF,YAAa4C,EAAU4B,UAKZ,IAAxB7J,EAAM+F,cACR/F,EAAMpC,OAAOmM,gBAAgBC,EAAWhK,EAAMgG,eAE9ChG,EAAMpC,OAAOnC,IAAIuO,GAGnBxH,EAAOyH,iBAAiBhC,GAGxBzF,EAAO6G,gBAAgBJ,GAEvB3L,EAASqG,KAAK3D,EAAMpC,QAAQnC,IAAI+G,GAEhCxC,EAAMpF,OAAOyC,OAAO2C,EAAMpC,SAEE,IAAxBoC,EAAM+F,eACRyD,EAAepB,OAAS,EAAIpI,EAAMgG,cAClCwD,EAAetB,KAAO,EAAIlI,EAAMgG,cAEhCgE,EAAUE,eAAe,EAAIlK,EAAMgG,iBAEnCwD,EAAepG,IAAI,EAAG,EAAG,GAEzB4G,EAAU5G,IAAI,EAAG,EAAG,IAGtB0G,EAAQ,KAONK,GACA/J,EAAaoD,kBAAkBxD,EAAMpF,OAAO0C,UAAY2C,GACxD,GAAK,EAAIC,EAAeuD,IAAIzD,EAAMpF,OAAO0I,aAAerD,KAExDD,EAAM0D,cAAcnE,GAEpBa,EAAauD,KAAK3D,EAAMpF,OAAO0C,UAC/B4C,EAAeyD,KAAK3D,EAAMpF,OAAO0I,YACjC6G,GAAc,GAEP,IAtHE,GA6Hf,EAAK7K,QAAU,WACbU,EAAMP,WAAW0E,oBAAoB,cAAeiG,GAEpDpK,EAAMP,WAAW0E,oBAAoB,cAAekG,GACpDrK,EAAMP,WAAW0E,oBAAoB,gBAAiBmG,GACtDtK,EAAMP,WAAW0E,oBAAoB,QAASoG,GAE9CvK,EAAMP,WAAW0E,oBAAoB,cAAeqG,GACpDxK,EAAMP,WAAW0E,oBAAoB,YAAasG,GAEf,OAA/BzK,EAAM+H,sBACR/H,EAAM+H,qBAAqB5D,oBAAoB,UAAWqE,IAU9D,IAAMxI,EAAK,eAEL6I,EAAQ,CACZC,MAAO,EACP7B,OAAQ,EACRE,MAAO,EACPC,IAAK,EACLsD,aAAc,EACdC,UAAW,EACXC,gBAAiB,EACjBC,mBAAoB,GAGlBjC,EAAQC,EAAMC,KAEZ7I,EAAM,KAGNgI,EAAY,IAAI6C,YAChBtB,EAAiB,IAAIsB,YAEvBhB,EAAQ,EACNE,EAAY,IAAI3J,UAClB8J,GAAc,EAEZY,EAAc,IAAIC,UAClBC,EAAY,IAAID,UAChBE,EAAc,IAAIF,UAElBG,EAAW,IAAIH,UACfI,EAAS,IAAIJ,UACbK,EAAW,IAAIL,UAEfM,EAAa,IAAIN,UACjBO,EAAW,IAAIP,UACfQ,EAAa,IAAIR,UAEjBS,EAAW,GACXC,EAAmB,GAMzB,SAASC,IACP,OAAOhG,KAAKiG,IAAI,IAAM5L,EAAMkG,WAG9B,SAASqD,EAAWsC,GAClBrC,EAAepB,OAASyD,EAG1B,SAASC,EAASD,GAChBrC,EAAetB,KAAO2D,EAGxB,IAAME,EAAW,WACf,IAAMC,EAAI,IAAI3L,UAEd,OAAO,SAAiB4L,EAAUC,GAChCF,EAAEG,oBAAoBD,EAAc,GACpCF,EAAE9B,gBAAgB+B,GAElBjC,EAAUvO,IAAIuQ,IAPD,GAWXI,EAAS,WACb,IAAMJ,EAAI,IAAI3L,UAEd,OAAO,SAAe4L,EAAUC,IACG,IAA7BlM,EAAMuG,mBACRyF,EAAEG,oBAAoBD,EAAc,IAEpCF,EAAEG,oBAAoBD,EAAc,GACpCF,EAAEK,aAAarM,EAAMpF,OAAO6F,GAAIuL,IAGlCA,EAAE9B,eAAe+B,GAEjBjC,EAAUvO,IAAIuQ,IAbH,GAkBTM,EAAO,WACX,IAAM9J,EAAS,IAAInC,UAEnB,OAAO,SAAakM,EAAQC,GAC1B,IAAMC,EAAUzM,EAAMP,WAEtB,GAAIO,EAAMpF,OAAO8R,oBAAqB,CAEpC,IAAMpP,EAAW0C,EAAMpF,OAAO0C,SAC9BkF,EAAOmB,KAAKrG,GAAU8L,IAAIpJ,EAAMpC,QAChC,IAAI+O,EAAiBnK,EAAOoK,SAG5BD,GAAkBhH,KAAKkH,IAAM7M,EAAMpF,OAAOb,IAAM,EAAK4L,KAAKC,GAAM,KAGhEmG,EACG,EAAIQ,EAASI,EAAkBF,EAAQK,aACxC9M,EAAMpF,OAAOmS,QAEfX,EAAO,EAAII,EAASG,EAAkBF,EAAQK,aAAc9M,EAAMpF,OAAOmS,aAChE/M,EAAMpF,OAAOoS,sBAEtBjB,EACGQ,GAAUvM,EAAMpF,OAAOgG,MAAQZ,EAAMpF,OAAO+F,MAC3CX,EAAMpF,OAAOkN,KACb2E,EAAQQ,YACVjN,EAAMpF,OAAOmS,QAEfX,EACGI,GAAUxM,EAAMpF,OAAOsS,IAAMlN,EAAMpF,OAAOuS,QACzCnN,EAAMpF,OAAOkN,KACb2E,EAAQK,aACV9M,EAAMpF,OAAOmS,UAIf7P,QAAQwC,KACN,gFAEFM,EAAMqG,WAAY,IAxCX,GA6Cb,SAAS+G,EAASC,GACZrN,EAAMpF,OAAO8R,oBACf5C,GAASuD,EACArN,EAAMpF,OAAOoS,sBACtBhN,EAAMpF,OAAOkN,KAAOnC,KAAK+D,IACvB1J,EAAMuF,QACNI,KAAK8D,IAAIzJ,EAAMwF,QAASxF,EAAMpF,OAAOkN,KAAOuF,IAE9CrN,EAAMpF,OAAO+N,yBACbwB,GAAc,IAEdjN,QAAQwC,KACN,uFAEFM,EAAMiG,YAAa,GAIvB,SAASqH,EAAQD,GACXrN,EAAMpF,OAAO8R,oBACf5C,GAASuD,EACArN,EAAMpF,OAAOoS,sBACtBhN,EAAMpF,OAAOkN,KAAOnC,KAAK+D,IACvB1J,EAAMuF,QACNI,KAAK8D,IAAIzJ,EAAMwF,QAASxF,EAAMpF,OAAOkN,KAAOuF,IAE9CrN,EAAMpF,OAAO+N,yBACbwB,GAAc,IAEdjN,QAAQwC,KACN,uFAEFM,EAAMiG,YAAa,GAQvB,SAASsH,EAAsB/L,GAC7BuJ,EAAY3H,IAAI5B,EAAMgM,QAAShM,EAAMiM,SAOvC,SAASC,EAAmBlM,GAC1B2J,EAAS/H,IAAI5B,EAAMgM,QAAShM,EAAMiM,SA0GpC,SAASE,IACP,GAAwB,IAApBlC,EAASmB,OACX7B,EAAY3H,IAAIqI,EAAS,GAAGlJ,MAAOkJ,EAAS,GAAGhJ,WAC1C,CACL,IAAMM,EAAI,IAAO0I,EAAS,GAAGlJ,MAAQkJ,EAAS,GAAGlJ,OAC3CU,EAAI,IAAOwI,EAAS,GAAGhJ,MAAQgJ,EAAS,GAAGhJ,OAEjDsI,EAAY3H,IAAIL,EAAGE,IAIvB,SAAS2K,IACP,GAAwB,IAApBnC,EAASmB,OACXzB,EAAS/H,IAAIqI,EAAS,GAAGlJ,MAAOkJ,EAAS,GAAGhJ,WACvC,CACL,IAAMM,EAAI,IAAO0I,EAAS,GAAGlJ,MAAQkJ,EAAS,GAAGlJ,OAC3CU,EAAI,IAAOwI,EAAS,GAAGhJ,MAAQgJ,EAAS,GAAGhJ,OAEjD0I,EAAS/H,IAAIL,EAAGE,IAIpB,SAAS4K,IACP,IAAMC,EAAKrC,EAAS,GAAGlJ,MAAQkJ,EAAS,GAAGlJ,MACrCwL,EAAKtC,EAAS,GAAGhJ,MAAQgJ,EAAS,GAAGhJ,MAErCwJ,EAAWtG,KAAKqI,KAAKF,EAAKA,EAAKC,EAAKA,GAE1CzC,EAAWlI,IAAI,EAAG6I,GAepB,SAASgC,EAAsBzM,GAC7B,GAAuB,GAAnBiK,EAASmB,OACX3B,EAAU7H,IAAI5B,EAAMe,MAAOf,EAAMiB,WAC5B,CACL,IAAMnF,EAAW4Q,GAAyB1M,GAEpCuB,EAAI,IAAOvB,EAAMe,MAAQjF,EAASyF,GAClCE,EAAI,IAAOzB,EAAMiB,MAAQnF,EAAS2F,GAExCgI,EAAU7H,IAAIL,EAAGE,GAGnBiI,EAAYiD,WAAWlD,EAAWF,GAAab,eAAelK,EAAMoG,aAEpE,IAAMqG,EAAUzM,EAAMP,WAEtB8J,EAAY,EAAI5D,KAAKC,GAAKsF,EAAYnI,EAAK0J,EAAQK,cAEnDhB,EAAU,EAAInG,KAAKC,GAAKsF,EAAYjI,EAAKwJ,EAAQK,cAEjD/B,EAAYpH,KAAKsH,GAGnB,SAASmD,EAAmB5M,GAC1B,GAAwB,IAApBiK,EAASmB,OACXxB,EAAOhI,IAAI5B,EAAMe,MAAOf,EAAMiB,WACzB,CACL,IAAMnF,EAAW4Q,GAAyB1M,GAEpCuB,EAAI,IAAOvB,EAAMe,MAAQjF,EAASyF,GAClCE,EAAI,IAAOzB,EAAMiB,MAAQnF,EAAS2F,GAExCmI,EAAOhI,IAAIL,EAAGE,GAGhBoI,EAAS8C,WAAW/C,EAAQD,GAAUjB,eAAelK,EAAMsG,UAE3DgG,EAAIjB,EAAStI,EAAGsI,EAASpI,GAEzBkI,EAASxH,KAAKyH,GAGhB,SAASiD,EAAqB7M,GAC5B,IAAMlE,EAAW4Q,GAAyB1M,GAEpCsM,EAAKtM,EAAMe,MAAQjF,EAASyF,EAC5BgL,EAAKvM,EAAMiB,MAAQnF,EAAS2F,EAE5BgJ,EAAWtG,KAAKqI,KAAKF,EAAKA,EAAKC,EAAKA,GAE1CxC,EAASnI,IAAI,EAAG6I,GAEhBT,EAAWpI,IAAI,EAAGuC,KAAKiG,IAAIL,EAAStI,EAAIqI,EAAWrI,EAAGjD,EAAMkG,YAE5DkH,EAAS5B,EAAWvI,GAEpBqI,EAAW3H,KAAK4H,GAuBlB,SAASlB,EAAc7I,IACC,IAAlBxB,EAAMmF,UAEc,IAApBsG,EAASmB,SACX5M,EAAMP,WAAW6O,kBAAkB9M,EAAM+M,WAEzCvO,EAAMP,WAAWkF,iBAAiB,cAAe6F,GACjDxK,EAAMP,WAAWkF,iBAAiB,YAAa8F,IA+SnD,SAAoBjJ,GAClBiK,EAAS/N,KAAK8D,GA3SdgN,CAAWhN,GAEe,UAAtBA,EAAMiN,YA4KZ,SAAsBjN,GAGpB,OAFAkN,GAAalN,GAELiK,EAASmB,QACf,KAAK,EACH,OAAQ5M,EAAMqH,QAAQC,KACpB,KAAKC,QAAMN,OACT,IAA2B,IAAvBjH,EAAMmG,aAAwB,OAElCwH,IAEA/E,EAAQC,EAAM6B,aAEd,MAEF,KAAKnD,QAAMH,IACT,IAAwB,IAApBpH,EAAMqG,UAAqB,OAE/BuH,IAEAhF,EAAQC,EAAM8B,UAEd,MAEF,QACE/B,EAAQC,EAAMC,KAGlB,MAEF,KAAK,EACH,OAAQ9I,EAAMqH,QAAQG,KACpB,KAAKD,QAAME,UACT,IAAyB,IAArBzH,EAAMiG,aAA4C,IAApBjG,EAAMqG,UAAqB,OArTjErG,EAAMiG,YAAY4H,IAElB7N,EAAMqG,WAAWuH,IAuTbhF,EAAQC,EAAM+B,gBAEd,MAEF,KAAKrD,QAAMoH,aACT,IAAyB,IAArB3O,EAAMiG,aAA+C,IAAvBjG,EAAMmG,aAAwB,OAxTpEnG,EAAMiG,YAAY4H,IAElB7N,EAAMmG,cAAcwH,IA0ThB/E,EAAQC,EAAMgC,mBAEd,MAEF,QACEjC,EAAQC,EAAMC,KAGlB,MAEF,QACEF,EAAQC,EAAMC,KAGdF,IAAUC,EAAMC,MAClB9I,EAAM0D,cAAcoB,GAxOpB8J,CAAapN,GAyCjB,SAAqBA,GACnB,IAAIqN,EAEJ,OAAQrN,EAAMQ,QACZ,KAAK,EACH6M,EAAc7O,EAAM+G,aAAaJ,KACjC,MAEF,KAAK,EACHkI,EAAc7O,EAAM+G,aAAaG,OACjC,MAEF,KAAK,EACH2H,EAAc7O,EAAM+G,aAAaF,MACjC,MAEF,QACEgI,GAAe,EAGnB,OAAQA,GACN,KAAK7H,QAAMG,MACT,IAAyB,IAArBnH,EAAMiG,WAAsB,QAvTtC,SAA8BzE,GAC5B8J,EAAWlI,IAAI5B,EAAMgM,QAAShM,EAAMiM,SAwThCqB,CAAqBtN,GAErBoH,EAAQC,EAAM1B,MAEd,MAEF,KAAKH,QAAMC,OACT,GAAIzF,EAAMuN,SAAWvN,EAAMwN,SAAWxN,EAAMyN,SAAU,CACpD,IAAwB,IAApBjP,EAAMqG,UAAqB,OAE/BqH,EAAmBlM,GAEnBoH,EAAQC,EAAMzB,QACT,CACL,IAA2B,IAAvBpH,EAAMmG,aAAwB,OAElCoH,EAAsB/L,GAEtBoH,EAAQC,EAAM5B,OAGhB,MAEF,KAAKD,QAAMI,IACT,GAAI5F,EAAMuN,SAAWvN,EAAMwN,SAAWxN,EAAMyN,SAAU,CACpD,IAA2B,IAAvBjP,EAAMmG,aAAwB,OAElCoH,EAAsB/L,GAEtBoH,EAAQC,EAAM5B,WACT,CACL,IAAwB,IAApBjH,EAAMqG,UAAqB,OAE/BqH,EAAmBlM,GAEnBoH,EAAQC,EAAMzB,IAGhB,MAEF,QACEwB,EAAQC,EAAMC,KAGdF,IAAUC,EAAMC,MAClB9I,EAAM0D,cAAcoB,GA5GpBoK,CAAY1N,IAIhB,SAASgJ,EAAchJ,IACC,IAAlBxB,EAAMmF,UAEgB,UAAtB3D,EAAMiN,YAmOZ,SAAqBjN,GAGnB,OAFAkN,GAAalN,GAELoH,GACN,KAAKC,EAAM6B,aACT,IAA2B,IAAvB1K,EAAMmG,aAAwB,OAElC8H,EAAsBzM,GAEtBxB,EAAMrH,SAEN,MAEF,KAAKkQ,EAAM8B,UACT,IAAwB,IAApB3K,EAAMqG,UAAqB,OAE/B+H,EAAmB5M,GAEnBxB,EAAMrH,SAEN,MAEF,KAAKkQ,EAAM+B,gBACT,IAAyB,IAArB5K,EAAMiG,aAA4C,IAApBjG,EAAMqG,UAAqB,QAtSnE,SAAiC7E,GAC3BxB,EAAMiG,YAAYoI,EAAqB7M,GAEvCxB,EAAMqG,WAAW+H,EAAmB5M,GAqSpC2N,CAAwB3N,GAExBxB,EAAMrH,SAEN,MAEF,KAAKkQ,EAAMgC,mBACT,IAAyB,IAArB7K,EAAMiG,aAA+C,IAAvBjG,EAAMmG,aAAwB,QAzStE,SAAoC3E,GAC9BxB,EAAMiG,YAAYoI,EAAqB7M,GAEvCxB,EAAMmG,cAAc8H,EAAsBzM,GAwS1C4N,CAA2B5N,GAE3BxB,EAAMrH,SAEN,MAEF,QACEiQ,EAAQC,EAAMC,MA3QhBuG,CAAY7N,GAwGhB,SAAqBA,GACnB,IAAsB,IAAlBxB,EAAMmF,QAAmB,OAE7B,OAAQyD,GACN,KAAKC,EAAM5B,OACT,IAA2B,IAAvBjH,EAAMmG,aAAwB,QAvWxC,SAA+B3E,GAC7ByJ,EAAU7H,IAAI5B,EAAMgM,QAAShM,EAAMiM,SAEnCvC,EAAYiD,WAAWlD,EAAWF,GAAab,eAAelK,EAAMoG,aAEpE,IAAMqG,EAAUzM,EAAMP,WAEtB8J,EAAY,EAAI5D,KAAKC,GAAKsF,EAAYnI,EAAK0J,EAAQK,cAEnDhB,EAAU,EAAInG,KAAKC,GAAKsF,EAAYjI,EAAKwJ,EAAQK,cAEjD/B,EAAYpH,KAAKsH,GAEjBjL,EAAMrH,SA4VF2W,CAAsB9N,GAEtB,MAEF,KAAKqH,EAAM1B,MACT,IAAyB,IAArBnH,EAAMiG,WAAsB,QA9VtC,SAA8BzE,GAC5B+J,EAASnI,IAAI5B,EAAMgM,QAAShM,EAAMiM,SAElCjC,EAAW2C,WAAW5C,EAAUD,GAE5BE,EAAWvI,EAAI,EACjBmK,EAASzB,KACAH,EAAWvI,EAAI,GACxBqK,EAAQ3B,KAGVL,EAAW3H,KAAK4H,GAEhBvL,EAAMrH,SAmVF4W,CAAqB/N,GAErB,MAEF,KAAKqH,EAAMzB,IACT,IAAwB,IAApBpH,EAAMqG,UAAqB,QArVrC,SAA4B7E,GAC1B4J,EAAOhI,IAAI5B,EAAMgM,QAAShM,EAAMiM,SAEhCpC,EAAS8C,WAAW/C,EAAQD,GAAUjB,eAAelK,EAAMsG,UAE3DgG,EAAIjB,EAAStI,EAAGsI,EAASpI,GAEzBkI,EAASxH,KAAKyH,GAEdpL,EAAMrH,SA8UF6W,CAAmBhO,IA3HrBiO,CAAYjO,IAIhB,SAASiJ,EAAYjJ,IACG,IAAlBxB,EAAMmF,UAEN3D,EAAMiN,YAyQVzO,EAAM0D,cAAcqB,GAEpB6D,EAAQC,EAAMC,KArQd4G,GAAclO,GAIU,IAApBiK,EAASmB,SACX5M,EAAMP,WAAWkQ,sBAAsBnO,EAAM+M,WAE7CvO,EAAMP,WAAW0E,oBAAoB,cAAeqG,GACpDxK,EAAMP,WAAW0E,oBAAoB,YAAasG,KAItD,SAASH,EAAgB9I,GACvBkO,GAAclO,GA+GhB,SAAS+I,EAAa/I,IAEA,IAAlBxB,EAAMmF,UACe,IAArBnF,EAAMiG,YACL2C,IAAUC,EAAMC,MAAQF,IAAUC,EAAM5B,SAI3CzF,EAAMqD,iBAEN7E,EAAM0D,cAAcoB,GA/VtB,SAA0BtD,GACpBA,EAAMgL,OAAS,EACjBc,EAAQ3B,KACCnK,EAAMgL,OAAS,GACxBY,EAASzB,KAGX3L,EAAMrH,SA0VNiX,CAAiBpO,GAEjBxB,EAAM0D,cAAcqB,IAGtB,SAASyD,EAAUhH,IACK,IAAlBxB,EAAMmF,UAAyC,IAApBnF,EAAMqG,WA7VvC,SAAuB7E,GACrB,IAAIqO,GAAc,EAClB,GAAkC,UAA9BlQ,SAASmQ,cAAcxY,GAA3B,CACA,OAAQkK,EAAME,MAKZ,IAAK,OACH0L,EAAS,IACTyC,GAAc,EACd,MACF,KAAK7P,EAAM5B,KAAKwI,GAChB,IAAK,QACH0F,EAAI,EAAGtM,EAAMwG,aACbqJ,GAAc,EACd,MACF,KAAK7P,EAAM5B,KAAK0I,OACdwF,EAAI,GAAItM,EAAMwG,aACdqJ,GAAc,EACd,MAEF,KAAK7P,EAAM5B,KAAKuI,KAChB,IAAK,OACH2F,EAAItM,EAAMwG,YAAa,GACvBqJ,GAAc,EACd,MAEF,KAAK7P,EAAM5B,KAAKyI,OAAS,IACzB,IAAK,OACHyF,GAAKtM,EAAMwG,YAAa,GACxBqJ,GAAc,EAMdA,IAEFrO,EAAMqD,iBAEN7E,EAAMrH,WAqTRoX,CAAcvO,GAyHhB,SAAS4I,EAAc5I,IACC,IAAlBxB,EAAMmF,SAEV3D,EAAMqD,iBAOR,SAAS6K,GAAclO,UACdkK,EAAiBlK,EAAM+M,WAE9B,IAAK,IAAIyB,EAAI,EAAGA,EAAIvE,EAASmB,OAAQoD,IACnC,GAAIvE,EAASuE,GAAGzB,WAAa/M,EAAM+M,UAEjC,YADA9C,EAASwE,OAAOD,EAAG,GAMzB,SAAStB,GAAalN,GACpB,IAAIlE,EAAWoO,EAAiBlK,EAAM+M,gBAErBnR,IAAbE,IACFA,EAAW,IAAI0N,UACfU,EAAiBlK,EAAM+M,WAAajR,GAGtCA,EAAS8F,IAAI5B,EAAMe,MAAOf,EAAMiB,OAGlC,SAASyL,GAAyB1M,GAChC,IAAM0O,EACJ1O,EAAM+M,YAAc9C,EAAS,GAAG8C,UAAY9C,EAAS,GAAKA,EAAS,GAErE,OAAOC,EAAiBwE,EAAQ3B,WAjgCJ,OAsgC9BvO,EAAMP,WAAWkF,iBAAiB,cAAeyF,GACjDpK,EAAMP,WAAWkF,iBAAiB,cAAe0F,GACjDrK,EAAMP,WAAWkF,iBAAiB,gBAAiB2F,GACnDtK,EAAMP,WAAWkF,iBAAiB,QAAS4F,EAAc,CACvD4F,SAAS,IAKX,EAAKxX,SA/gCyB,E,UADNiM,mB,cCCtBwL,EAAa,IAAIC,YAEjBC,EAAc,IAAIjQ,UAClBkQ,EAAe,IAAIlQ,UACnBmQ,EAAkB,IAAIrQ,aACtBsQ,EAAQ,CACZC,EAAG,IAAIrQ,UAAQ,EAAG,EAAG,GACrBsQ,EAAG,IAAItQ,UAAQ,EAAG,EAAG,GACrBuQ,EAAG,IAAIvQ,UAAQ,EAAG,EAAG,IAGjBd,EAAe,CAAE/H,KAAM,UACvBqZ,EAAkB,CAAErZ,KAAM,aAC1BsZ,EAAgB,CAAEtZ,KAAM,UAAWuZ,KAAM,MACzCC,EAAqB,CAAExZ,KAAM,gBAE7ByZ,E,kDACJ,WAAYrZ,EAAQ6H,GAAa,IAAD,sBAC9B,oBACmBrC,IAAfqC,IACFvC,QAAQwC,KACN,gFAEFD,EAAaE,UAGf,EAAKpG,SAAU,EACf,EAAKkG,WAAaA,EAClB,EAAKA,WAAWwF,MAAMC,YAAc,OAEpC,IAAMgM,EAAS,IAAIC,EACnB,EAAKD,OAASA,EACd,EAAKzV,IAAIyV,GAET,IAAME,EAAS,IAAIC,EACnB,EAAKD,OAASA,EACd,EAAK3V,IAAI2V,GAET,IAAMpR,EAAK,eAGX,SAASsR,EAAejT,EAAUkT,GAChC,IAAIC,EAAYD,EAEhBra,OAAOoa,eAAetR,EAAO3B,EAAU,CACrCoT,IAAK,WACH,YAAqBrU,IAAdoU,EAA0BA,EAAYD,GAG/CnO,IAAK,SAAU7K,GACTiZ,IAAcjZ,IAChBiZ,EAAYjZ,EACZ6Y,EAAO/S,GAAY9F,EACnB2Y,EAAO7S,GAAY9F,EAEnByH,EAAM0D,cAAc,CAAElM,KAAM6G,EAAW,WAAY9F,MAAOA,IAC1DyH,EAAM0D,cAAcnE,OAK1BS,EAAM3B,GAAYkT,EAClBH,EAAO/S,GAAYkT,EACnBL,EAAO7S,GAAYkT,EAOrBD,EAAe,SAAU1Z,GACzB0Z,EAAe,cAAUlU,GACzBkU,EAAe,WAAW,GAC1BA,EAAe,OAAQ,MACvBA,EAAe,OAAQ,aACvBA,EAAe,kBAAmB,MAClCA,EAAe,eAAgB,MAC/BA,EAAe,YAAa,MAC5BA,EAAe,QAAS,SACxBA,EAAe,OAAQ,GACvBA,EAAe,YAAY,GAC3BA,EAAe,SAAS,GACxBA,EAAe,SAAS,GACxBA,EAAe,SAAS,GAIxB,IAAMI,EAAgB,IAAIrR,UACpBsR,EAAqB,IAAItR,UACzBuR,EAAkB,IAAIzR,aACtB0R,EAAuB,IAAI1R,aAC3B2R,EAAiB,IAAIzR,UACrB0R,EAAmB,IAAI5R,aACvB6R,EAAa,IAAI3R,UACjB4R,EAAW,IAAI5R,UACf6R,EAAe,IAAI7R,UAEnB8R,EAAM,IAAI9R,UAhFc,OAoF9BiR,EAAe,gBAAiBI,GAChCJ,EAAe,qBAAsBK,GACrCL,EAAe,kBAAmBM,GAClCN,EAAe,uBAAwBO,GACvCP,EAAe,iBAAkBQ,GACjCR,EAAe,mBAAoBS,GACnCT,EAAe,aAAcU,GAC7BV,EAAe,WAAYW,GAC3BX,EAAe,eAAgBY,GAC/BZ,EAAe,gBAdO,GAetBA,EAAe,MAAOa,GAEtB,EAAKC,QAAU,IAAI/R,UACnB,EAAKgS,WAAa,IAAIhS,UACtB,EAAKiS,SAAW,IAAIjS,UACpB,EAAKkS,aAAe,IAAIlS,UAExB,EAAKmS,gBAAkB,IAAInS,UAC3B,EAAKoS,kBAAoB,IAAItS,aAC7B,EAAKuS,qBAAuB,IAAIvS,aAChC,EAAKwS,aAAe,IAAItS,UAExB,EAAKuS,iBAAmB,IAAIvS,UAC5B,EAAKwS,oBAAsB,IAAI1S,aAC/B,EAAK2S,YAAc,IAAIzS,UAEvB,EAAK0S,eAAiB,IAAI1S,UAC1B,EAAK2S,iBAAmB,IAAI7S,aAC5B,EAAK8S,YAAc,IAAI5S,UAEvB,EAAK6S,YAAcC,EAAWzO,KAAX,gBACnB,EAAK0O,eAAiB/I,EAAc3F,KAAd,gBACtB,EAAK2O,gBAAkBC,EAAe5O,KAAf,gBACvB,EAAK6O,eAAiB/I,EAAc9F,KAAd,gBACtB,EAAK8O,aAAe/I,EAAY/F,KAAZ,gBAEpB,EAAKjF,WAAWkF,iBAAiB,cAAe,EAAKyO,gBACrD,EAAK3T,WAAWkF,iBAAiB,cAAe,EAAK0O,iBACrD,EAAK5T,WAAWkF,iBAAiB,YAAa,EAAK6O,cA1HrB,E,qDA8HhC,gBACsBpW,IAAhBjJ,KAAKyG,SACPzG,KAAKyG,OAAO6Y,oBAEe,OAAvBtf,KAAKyG,OAAO8Y,OACdxW,QAAQD,MACN,gFAGF9I,KAAKyG,OAAO8Y,OAAOC,YAAYC,UAC7Bzf,KAAKqe,gBACLre,KAAKse,kBACLte,KAAKwe,cAITxe,KAAKyG,OAAO+Y,YAAYC,UACtBzf,KAAKud,cACLvd,KAAKyd,gBACLzd,KAAK2e,aAGP3e,KAAKue,qBAAqB/O,KAAKxP,KAAKse,mBAAmBvJ,SACvD/U,KAAK0e,oBAAoBlP,KAAKxP,KAAKyd,iBAAiB1I,UAGtD/U,KAAKyD,OAAO6b,oBACZtf,KAAKyD,OAAO+b,YAAYC,UACtBzf,KAAK2d,eACL3d,KAAK4d,iBACL5d,KAAKoe,cAGPpe,KAAKge,IAAIxO,KAAKxP,KAAK2d,gBAAgB1I,IAAIjV,KAAKud,eAAerO,YAE3D,yEAAwBlP,Q,0BAG1B,SAAa+b,GACX,QAAoB9S,IAAhBjJ,KAAKyG,SAA0C,IAAlBzG,KAAK0f,SAAtC,CAEAzD,EAAW0D,cAAc5D,EAAS/b,KAAKyD,QAEvC,IAAMmc,EAAYC,EAAuB7f,KAAK+c,OAAO+C,OAAO9f,KAAK4c,MAAOX,GAGtEjc,KAAK+f,KADHH,EACUA,EAAUnZ,OAAOrD,KAEjB,Q,yBAIhB,SAAY2Y,GACV,QAAoB9S,IAAhBjJ,KAAKyG,SAA0C,IAAlBzG,KAAK0f,UAAwC,IAAnB3D,EAAQlO,QAGjD,OAAd7N,KAAK+f,KAAe,CACtB9D,EAAW0D,cAAc5D,EAAS/b,KAAKyD,QAEvC,IAAMuc,EAAiBH,EAAuB7f,KAAKid,OAAQhB,GAAY,GAEvE,GAAI+D,EAAgB,CAClB,IAAIC,EAAQjgB,KAAKigB,MAQjB,GANkB,UAAdjgB,KAAK4c,KACPqD,EAAQ,QACe,MAAdjgB,KAAK+f,MAA8B,SAAd/f,KAAK+f,MAAiC,QAAd/f,KAAK+f,OAC3DE,EAAQ,SAGI,UAAVA,GAAmC,WAAdjgB,KAAK4c,KAAmB,CAC/C,IAAMsD,EAAOlgB,KAAKmgB,aAEA,MAAdngB,KAAK+f,MAAgBG,IACvBlgB,KAAKyG,OAAO2Z,SAASxR,EAAI4C,KAAK6O,MAAMrgB,KAAKyG,OAAO2Z,SAASxR,EAAIsR,GAAQA,GACrD,MAAdlgB,KAAK+f,MAAgBG,IACvBlgB,KAAKyG,OAAO2Z,SAAStR,EAAI0C,KAAK6O,MAAMrgB,KAAKyG,OAAO2Z,SAAStR,EAAIoR,GAAQA,GACrD,MAAdlgB,KAAK+f,MAAgBG,IACvBlgB,KAAKyG,OAAO2Z,SAASpR,EAAIwC,KAAK6O,MAAMrgB,KAAKyG,OAAO2Z,SAASpR,EAAIkR,GAAQA,GAGzElgB,KAAKyG,OAAO6Y,oBACZtf,KAAKyG,OAAO8Y,OAAOD,oBAEnBtf,KAAK4e,eAAepP,KAAKxP,KAAKyG,OAAO0C,UACrCnJ,KAAK6e,iBAAiBrP,KAAKxP,KAAKyG,OAAO0I,YACvCnP,KAAK8e,YAAYtP,KAAKxP,KAAKyG,OAAOkP,OAElC3V,KAAKyG,OAAO+Y,YAAYC,UACtBzf,KAAKwd,mBACLxd,KAAK0d,qBACL1d,KAAKye,kBAGPze,KAAK6d,WAAWrO,KAAKwQ,EAAeM,OAAOrL,IAAIjV,KAAKwd,oBAGtDxd,KAAK0f,UAAW,EAChBhD,EAAgBE,KAAO5c,KAAK4c,KAC5B5c,KAAKuP,cAAcmN,M,yBAIvB,SAAYX,GACV,IAAMgE,EAAO/f,KAAK+f,KACZnD,EAAO5c,KAAK4c,KACZnW,EAASzG,KAAKyG,OAChBwZ,EAAQjgB,KAAKigB,MAQjB,GANa,UAATrD,EACFqD,EAAQ,QACU,MAATF,GAAyB,SAATA,GAA4B,QAATA,IAC5CE,EAAQ,cAIGhX,IAAXxC,GACS,OAATsZ,IACkB,IAAlB/f,KAAK0f,WACe,IAApB3D,EAAQlO,OAJV,CAQAoO,EAAW0D,cAAc5D,EAAS/b,KAAKyD,QAEvC,IAAMuc,EAAiBH,EAAuB7f,KAAKid,OAAQhB,GAAY,GAEvE,GAAK+D,EAAL,CAIA,GAFAhgB,KAAK8d,SAAStO,KAAKwQ,EAAeM,OAAOrL,IAAIjV,KAAKwd,oBAErC,cAATZ,EAGF5c,KAAKie,QAAQzO,KAAKxP,KAAK8d,UAAU7I,IAAIjV,KAAK6d,YAE5B,UAAVoC,GAA8B,QAATF,GACvB/f,KAAKie,QAAQ/I,gBAAgBlV,KAAK0e,sBAGT,IAAvBqB,EAAKQ,QAAQ,OAAavgB,KAAKie,QAAQrP,EAAI,IACpB,IAAvBmR,EAAKQ,QAAQ,OAAavgB,KAAKie,QAAQnP,EAAI,IACpB,IAAvBiR,EAAKQ,QAAQ,OAAavgB,KAAKie,QAAQjP,EAAI,GAEjC,UAAViR,GAA8B,QAATF,EACvB/f,KAAKie,QAAQ/I,gBAAgBlV,KAAK6e,kBAAkB2B,OAAOxgB,KAAKwe,cAEhExe,KAAKie,QAAQ/I,gBAAgBlV,KAAKue,sBAAsBiC,OAAOxgB,KAAKwe,cAGtE/X,EAAO0C,SAASqG,KAAKxP,KAAKie,SAAS3W,IAAItH,KAAK4e,gBAIxC5e,KAAKygB,kBACO,UAAVR,IACFxZ,EAAO0C,SAAS+L,gBACdmH,EAAgB7M,KAAKxP,KAAK6e,kBAAkB9J,WAGpB,IAAtBgL,EAAKW,OAAO,OACdja,EAAO0C,SAASyF,EACd4C,KAAK6O,MAAM5Z,EAAO0C,SAASyF,EAAI5O,KAAKygB,iBAAmBzgB,KAAKygB,kBAGtC,IAAtBV,EAAKW,OAAO,OACdja,EAAO0C,SAAS2F,EACd0C,KAAK6O,MAAM5Z,EAAO0C,SAAS2F,EAAI9O,KAAKygB,iBAAmBzgB,KAAKygB,kBAGtC,IAAtBV,EAAKW,OAAO,OACdja,EAAO0C,SAAS6F,EACdwC,KAAK6O,MAAM5Z,EAAO0C,SAAS6F,EAAIhP,KAAKygB,iBAAmBzgB,KAAKygB,iBAGhEha,EAAO0C,SAAS+L,gBAAgBlV,KAAK6e,mBAGzB,UAAVoB,IACExZ,EAAO8Y,QACT9Y,EAAO0C,SAAS7B,IACd6U,EAAYwE,sBAAsBla,EAAO8Y,OAAOC,eAI1B,IAAtBO,EAAKW,OAAO,OACdja,EAAO0C,SAASyF,EACd4C,KAAK6O,MAAM5Z,EAAO0C,SAASyF,EAAI5O,KAAKygB,iBAAmBzgB,KAAKygB,kBAGtC,IAAtBV,EAAKW,OAAO,OACdja,EAAO0C,SAAS2F,EACd0C,KAAK6O,MAAM5Z,EAAO0C,SAAS2F,EAAI9O,KAAKygB,iBAAmBzgB,KAAKygB,kBAGtC,IAAtBV,EAAKW,OAAO,OACdja,EAAO0C,SAAS6F,EACdwC,KAAK6O,MAAM5Z,EAAO0C,SAAS6F,EAAIhP,KAAKygB,iBAAmBzgB,KAAKygB,iBAG5Dha,EAAO8Y,QACT9Y,EAAO0C,SAAS8L,IACdkH,EAAYwE,sBAAsBla,EAAO8Y,OAAOC,qBAKnD,GAAa,UAAT5C,EAAkB,CAC3B,IAA4B,IAAxBmD,EAAKW,OAAO,OAAe,CAC7B,IAAIE,EAAI5gB,KAAK8d,SAASrF,SAAWzY,KAAK6d,WAAWpF,SAE7CzY,KAAK8d,SAASxO,IAAItP,KAAK6d,YAAc,IAAG+C,IAAM,GAElDxE,EAAanN,IAAI2R,EAAGA,EAAGA,QAEvBzE,EAAY3M,KAAKxP,KAAK6d,YACtBzB,EAAa5M,KAAKxP,KAAK8d,UAEvB3B,EAAYjH,gBAAgBlV,KAAK0e,qBACjCtC,EAAalH,gBAAgBlV,KAAK0e,qBAElCtC,EAAaoE,OAAOrE,IAEM,IAAtB4D,EAAKW,OAAO,OACdtE,EAAaxN,EAAI,IAGO,IAAtBmR,EAAKW,OAAO,OACdtE,EAAatN,EAAI,IAGO,IAAtBiR,EAAKW,OAAO,OACdtE,EAAapN,EAAI,GAMrBvI,EAAOkP,MAAMnG,KAAKxP,KAAK8e,aAAa1P,SAASgN,GAEzCpc,KAAK6gB,aACmB,IAAtBd,EAAKW,OAAO,OACdja,EAAOkP,MAAM/G,EACX4C,KAAK6O,MAAM5Z,EAAOkP,MAAM/G,EAAI5O,KAAK6gB,WAAa7gB,KAAK6gB,WAAa7gB,KAAK6gB,YAG/C,IAAtBd,EAAKW,OAAO,OACdja,EAAOkP,MAAM7G,EACX0C,KAAK6O,MAAM5Z,EAAOkP,MAAM7G,EAAI9O,KAAK6gB,WAAa7gB,KAAK6gB,WAAa7gB,KAAK6gB,YAG/C,IAAtBd,EAAKW,OAAO,OACdja,EAAOkP,MAAM3G,EACXwC,KAAK6O,MAAM5Z,EAAOkP,MAAM3G,EAAIhP,KAAK6gB,WAAa7gB,KAAK6gB,WAAa7gB,KAAK6gB,iBAGtE,GAAa,WAATjE,EAAmB,CAC5B5c,KAAKie,QAAQzO,KAAKxP,KAAK8d,UAAU7I,IAAIjV,KAAK6d,YAE1C,IAAMiD,EACJ,GACA9gB,KAAKud,cAAcpJ,WACjBgI,EAAYwE,sBAAsB3gB,KAAKyD,OAAO+b,cAGrC,MAATO,GACF/f,KAAK+d,aAAavO,KAAKxP,KAAKge,KAC5Bhe,KAAK+gB,cAAgB/gB,KAAK8d,SAASkD,QAAQhhB,KAAK6d,YAEhD7d,KAAKke,WAAW1O,KAAKxP,KAAK6d,YAAY3O,YACtClP,KAAKme,SAAS3O,KAAKxP,KAAK8d,UAAU5O,YAElClP,KAAK+gB,eACH/gB,KAAKme,SAAS8C,MAAMjhB,KAAKke,YAAY5O,IAAItP,KAAKge,KAAO,EAAI,GAAK,GAC9C,SAAT+B,GACT/f,KAAK+d,aAAavO,KAAKxP,KAAKie,SAASgD,MAAMjhB,KAAKge,KAAK9O,YACrDlP,KAAK+gB,cACH/gB,KAAKie,QAAQ3O,IAAI6M,EAAY3M,KAAKxP,KAAK+d,cAAckD,MAAMjhB,KAAKge,MAChE8C,GACgB,MAATf,GAAyB,MAATA,GAAyB,MAATA,IACzC/f,KAAK+d,aAAavO,KAAK8M,EAAMyD,IAE7B5D,EAAY3M,KAAK8M,EAAMyD,IAET,UAAVE,GACF9D,EAAYjH,gBAAgBlV,KAAKyd,iBAGnCzd,KAAK+gB,cACH/gB,KAAKie,QAAQ3O,IAAI6M,EAAY8E,MAAMjhB,KAAKge,KAAK9O,aAAe4R,GAK5D9gB,KAAKmgB,eACPngB,KAAK+gB,cACHvP,KAAK6O,MAAMrgB,KAAK+gB,cAAgB/gB,KAAKmgB,cAAgBngB,KAAKmgB,cAGhD,UAAVF,GAA8B,MAATF,GAAyB,SAATA,GACvCtZ,EAAO0I,WAAWK,KAAKxP,KAAK6e,kBAC5BpY,EAAO0I,WACJC,SACCiN,EAAgB6E,iBAAiBlhB,KAAK+d,aAAc/d,KAAK+gB,gBAE1D7R,cAEHlP,KAAK+d,aAAa7I,gBAAgBlV,KAAKue,sBACvC9X,EAAO0I,WAAWK,KAChB6M,EAAgB6E,iBAAiBlhB,KAAK+d,aAAc/d,KAAK+gB,gBAE3Dta,EAAO0I,WAAWC,SAASpP,KAAK6e,kBAAkB3P,aAItDlP,KAAKuP,cAAcnE,GACnBpL,KAAKuP,cAAcsN,O,uBAGrB,SAAUd,GACe,IAAnBA,EAAQlO,SAER7N,KAAK0f,UAA0B,OAAd1f,KAAK+f,OACxBpD,EAAcC,KAAO5c,KAAK4c,KAC1B5c,KAAKuP,cAAcoN,IAGrB3c,KAAK0f,UAAW,EAChB1f,KAAK+f,KAAO,Q,qBAGd,WACE/f,KAAKsL,WAAW0E,oBAAoB,cAAehQ,KAAKif,gBACxDjf,KAAKsL,WAAW0E,oBAAoB,cAAehQ,KAAKkf,iBACxDlf,KAAKsL,WAAW0E,oBAAoB,cAAehQ,KAAKof,gBACxDpf,KAAKsL,WAAW0E,oBAAoB,YAAahQ,KAAKqf,cAEtDrf,KAAKmhB,UAAS,SAAUC,GAClBA,EAAMxc,UAAUwc,EAAMxc,SAASuG,UAC/BiW,EAAMld,UAAUkd,EAAMld,SAASiH,e,oBAKvC,SAAO1E,GAIL,OAHAzG,KAAKyG,OAASA,EACdzG,KAAKoF,SAAU,EAERpF,O,oBAIT,WAKE,OAJAA,KAAKyG,YAASwC,EACdjJ,KAAKoF,SAAU,EACfpF,KAAK+f,KAAO,KAEL/f,O,0BAGT,WACE,OAAOic,I,qBAKT,WACE,OAAOjc,KAAK4c,O,qBAGd,SAAQA,GACN5c,KAAK4c,KAAOA,I,gCAGd,SAAmB6D,GACjBzgB,KAAKygB,gBAAkBA,I,6BAGzB,SAAgBN,GACdngB,KAAKmgB,aAAeA,I,0BAGtB,SAAaU,GACX7gB,KAAK6gB,UAAYA,I,qBAGnB,SAAQ3S,GACNlO,KAAKkO,KAAOA,I,sBAGd,SAAS+R,GACPjgB,KAAKigB,MAAQA,I,oBAGf,WACElX,QAAQwC,KACN,6G,GA3gB0B8V,YAohBhC,SAASrC,EAAW3R,GAClB,GAAIrN,KAAKsL,WAAWgW,cAAcC,mBAChC,MAAO,CACL3S,EAAG,EACHE,EAAG,EACHjB,OAAQR,EAAMQ,QAGhB,IAAM2T,EAAOxhB,KAAKsL,WAAWmW,wBAE7B,MAAO,CACL7S,GAAKvB,EAAMgM,QAAUmI,EAAKhV,MAAQgV,EAAKE,MAAS,EAAI,EACpD5S,IAAMzB,EAAMiM,QAAUkI,EAAKzI,KAAOyI,EAAK7Z,OAAU,EAAI,EACrDkG,OAAQR,EAAMQ,QAKpB,SAASsR,EAAe9R,GACtB,GAAKrN,KAAKgR,QAEV,OAAQ3D,EAAMiN,aACZ,IAAK,QACL,IAAK,MACHta,KAAK2hB,aAAa3hB,KAAK+e,YAAY1R,KAKzC,SAAS6I,EAAc7I,GAChBrN,KAAKgR,UAEVhR,KAAKsL,WAAW6O,kBAAkB9M,EAAM+M,WAExCpa,KAAKsL,WAAWkF,iBAAiB,cAAexQ,KAAKof,gBAErDpf,KAAK2hB,aAAa3hB,KAAK+e,YAAY1R,IACnCrN,KAAK4hB,YAAY5hB,KAAK+e,YAAY1R,KAGpC,SAASgJ,EAAchJ,GAChBrN,KAAKgR,SAEVhR,KAAK6hB,YAAY7hB,KAAK+e,YAAY1R,IAGpC,SAASiJ,EAAYjJ,GACdrN,KAAKgR,UAEVhR,KAAKsL,WAAWkQ,sBAAsBnO,EAAM+M,WAE5Cpa,KAAKsL,WAAW0E,oBAAoB,cAAehQ,KAAKof,gBAExDpf,KAAK8hB,UAAU9hB,KAAK+e,YAAY1R,KAGlC,SAASwS,EAAuBpZ,EAAQsb,EAAWC,GAGjD,IAFA,IAAMC,EAAmBF,EAAUG,gBAAgBzb,GAAQ,GAElDoV,EAAI,EAAGA,EAAIoG,EAAiBxJ,OAAQoD,IAC3C,GAAIoG,EAAiBpG,GAAGpV,OAAOrB,SAAW4c,EACxC,OAAOC,EAAiBpG,GAI5B,OAAO,EArETiB,EAAkBqF,UAAUC,qBAAsB,EA4ElD,IAAMC,EAAa,IAAIC,QACjBC,EAAe,IAAIrW,UAAQ,EAAG,EAAG,GACjCsW,EAAc,IAAItW,UAAQ,EAAG,EAAG,GAChCuW,EAAgB,IAAIC,UACpBC,EAAmB,IAAI3W,aACvB4W,EAAsB,IAAI5W,aAC1B6W,EAAa,IAAI3W,UACjB4W,EAAc,IAAIJ,UAElBK,EAAS,IAAI7W,UAAQ,EAAG,EAAG,GAC3B8W,EAAS,IAAI9W,UAAQ,EAAG,EAAG,GAC3B+W,EAAS,IAAI/W,UAAQ,EAAG,EAAG,GAE3BgX,EAAM,IAAIhX,UACViX,EAAM,IAAIjX,UACVkX,EAAM,IAAIlX,UAEV8Q,E,kDACJ,aAAe,IAAD,uBACZ,gBAEK3Z,KAAO,yBAIZ,IAAMggB,EAAgB,IAAIC,oBAAkB,CAC1CC,WAAW,EACXC,YAAY,EACZC,KAAK,EACLC,YAAY,EACZC,aAAa,IAGTC,EAAoB,IAAIC,oBAAkB,CAC9CN,WAAW,EACXC,YAAY,EACZC,KAAK,EACLC,YAAY,EACZC,aAAa,IAKTG,EAAeT,EAAc7P,QACnCsQ,EAAaC,QAAU,IAEvB,IAAMC,EAAYJ,EAAkBpQ,QACpCwQ,EAAUD,QAAU,GAEpB,IAAME,EAASZ,EAAc7P,QAC7ByQ,EAAOhe,MAAMie,OAAO,UAEpB,IAAMC,EAAWd,EAAc7P,QAC/B2Q,EAASle,MAAMie,OAAO,OAEtB,IAAME,EAAUf,EAAc7P,QAC9B4Q,EAAQne,MAAMie,OAAO,KAErB,IAAMG,EAAoBhB,EAAc7P,QACxC6Q,EAAkBpe,MAAMie,OAAO,UAC/BG,EAAkBN,QAAU,GAE5B,IAAMO,EAAsBjB,EAAc7P,QAC1C8Q,EAAoBre,MAAMie,OAAO,OACjCI,EAAoBP,QAAU,GAE9B,IAAMQ,EAAqBlB,EAAc7P,QACzC+Q,EAAmBte,MAAMie,OAAO,KAChCK,EAAmBR,QAAU,GAE7B,IAAMS,EAAsBnB,EAAc7P,QAC1CgR,EAAoBT,QAAU,IAE9B,IAAMU,EAAuBpB,EAAc7P,QAC3CiR,EAAqBxe,MAAMie,OAAO,UAClCO,EAAqBV,QAAU,IAEbV,EAAc7P,QACtBvN,MAAMie,OAAO,UAEvB,IAAMQ,EAAUrB,EAAc7P,QAC9BkR,EAAQze,MAAMie,OAAO,SAIrB,IAAMS,EAAgB,IAAIC,mBAAiB,EAAG,IAAM,GAAK,IACzDD,EAAcE,UAAU,EAAG,IAAM,GAEjC,IAAMC,EAAsB,IAAIC,cAAY,IAAM,IAAM,KACxDD,EAAoBD,UAAU,EAAG,IAAM,GAEvC,IAAMG,EAAe,IAAIC,iBACzBD,EAAaE,aACX,WACA,IAAIC,yBAAuB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,IAGjD,IAAMC,EAAgB,IAAIR,mBAAiB,MAAQ,MAAQ,GAAK,GAGhE,SAASS,EAAe3P,EAAQ4P,GAC9B,IAAM1gB,EAAW,IAAI2gB,gBAAc7P,EAAQ,MAAQ,EAAG,GAAI4P,EAAM9T,KAAKC,GAAK,GAG1E,OAFA7M,EAAS4gB,QAAQhU,KAAKC,GAAK,GAC3B7M,EAAS6gB,QAAQjU,KAAKC,GAAK,GACpB7M,EANTwgB,EAAcP,UAAU,EAAG,IAAM,GAqBjC,IAAMa,EAAiB,CACrBnJ,EAAG,CACD,CAAC,IAAIoJ,OAAKhB,EAAeV,GAAS,CAAC,GAAK,EAAG,GAAI,CAAC,EAAG,GAAIzS,KAAKC,GAAK,IACjE,CAAC,IAAIkU,OAAKhB,EAAeV,GAAS,EAAE,GAAK,EAAG,GAAI,CAAC,EAAG,EAAGzS,KAAKC,GAAK,IACjE,CAAC,IAAIkU,OAAKP,EAAenB,GAAS,CAAC,EAAG,EAAG,GAAI,CAAC,EAAG,GAAIzS,KAAKC,GAAK,KAEjE+K,EAAG,CACD,CAAC,IAAImJ,OAAKhB,EAAeR,GAAW,CAAC,EAAG,GAAK,IAC7C,CAAC,IAAIwB,OAAKhB,EAAeR,GAAW,CAAC,GAAI,GAAK,GAAI,CAAC3S,KAAKC,GAAI,EAAG,IAC/D,CAAC,IAAIkU,OAAKP,EAAejB,KAE3B1H,EAAG,CACD,CAAC,IAAIkJ,OAAKhB,EAAeP,GAAU,CAAC,EAAG,EAAG,IAAM,CAAC5S,KAAKC,GAAK,EAAG,EAAG,IACjE,CAAC,IAAIkU,OAAKhB,EAAeP,GAAU,CAAC,EAAG,GAAI,IAAM,EAAE5S,KAAKC,GAAK,EAAG,EAAG,IACnE,CAAC,IAAIkU,OAAKP,EAAehB,GAAU,KAAM,CAAC5S,KAAKC,GAAK,EAAG,EAAG,KAE5DmU,IAAK,CACH,CACE,IAAID,OAAK,IAAIE,qBAAmB,GAAK,GAAIrB,EAAoBhR,SAC7D,CAAC,EAAG,EAAG,KAGXsS,GAAI,CACF,CACE,IAAIH,OAAK,IAAIZ,cAAY,IAAM,IAAM,KAAOR,EAAmB/Q,SAC/D,CAAC,IAAM,IAAM,KAGjBuS,GAAI,CACF,CACE,IAAIJ,OAAK,IAAIZ,cAAY,IAAM,IAAM,KAAOV,EAAkB7Q,SAC9D,CAAC,EAAG,IAAM,KACV,CAAC,EAAGhC,KAAKC,GAAK,EAAG,KAGrBuU,GAAI,CACF,CACE,IAAIL,OAAK,IAAIZ,cAAY,IAAM,IAAM,KAAOT,EAAoB9Q,SAChE,CAAC,IAAM,EAAG,KACV,EAAEhC,KAAKC,GAAK,EAAG,EAAG,MAKlBwU,EAAkB,CACtB1J,EAAG,CACD,CACE,IAAIoJ,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,CAAC,GAAK,EAAG,GACT,CAAC,EAAG,GAAItS,KAAKC,GAAK,IAEpB,CACE,IAAIkU,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,EAAE,GAAK,EAAG,GACV,CAAC,EAAG,EAAGtS,KAAKC,GAAK,KAGrB+K,EAAG,CACD,CAAC,IAAImJ,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAAe,CAAC,EAAG,GAAK,IACxE,CACE,IAAI6B,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,CAAC,GAAI,GAAK,GACV,CAAC,EAAG,EAAGtS,KAAKC,MAGhBgL,EAAG,CACD,CACE,IAAIkJ,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,CAAC,EAAG,EAAG,IACP,CAACtS,KAAKC,GAAK,EAAG,EAAG,IAEnB,CACE,IAAIkU,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,CAAC,EAAG,GAAI,IACR,EAAEtS,KAAKC,GAAK,EAAG,EAAG,KAGtBmU,IAAK,CAAC,CAAC,IAAID,OAAK,IAAIE,qBAAmB,GAAK,GAAI/B,KAChDgC,GAAI,CAAC,CAAC,IAAIH,OAAK,IAAIZ,cAAY,GAAK,GAAK,KAAOjB,GAAe,CAAC,IAAM,IAAM,KAC5EiC,GAAI,CACF,CACE,IAAIJ,OAAK,IAAIZ,cAAY,GAAK,GAAK,KAAOjB,GAC1C,CAAC,EAAG,IAAM,KACV,CAAC,EAAGtS,KAAKC,GAAK,EAAG,KAGrBuU,GAAI,CACF,CACE,IAAIL,OAAK,IAAIZ,cAAY,GAAK,GAAK,KAAOjB,GAC1C,CAAC,IAAM,EAAG,KACV,EAAEtS,KAAKC,GAAK,EAAG,EAAG,MAKlByU,EAAkB,CACtBC,MAAO,CACL,CACE,IAAIR,OAAK,IAAIE,qBAAmB,IAAM,GAAI7B,GAC1C,KACA,KACA,KACA,WAGJoC,IAAK,CACH,CACE,IAAIT,OAAK,IAAIE,qBAAmB,IAAM,GAAI7B,GAC1C,KACA,KACA,KACA,WAGJqC,MAAO,CACL,CAAC,IAAIC,OA7HT,WACE,IAAM1hB,EAAW,IAAIqgB,iBAIrB,OAFArgB,EAASsgB,aAAa,WAAY,IAAIC,yBAAuB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,IAE1EvgB,EAwHK2hB,GAA2BvC,GAAY,KAAM,KAAM,KAAM,WAErEzH,EAAG,CACD,CACE,IAAI+J,OAAKtB,EAAchB,EAAUxQ,SACjC,EAAE,IAAK,EAAG,GACV,KACA,CAAC,IAAK,EAAG,GACT,WAGJgJ,EAAG,CACD,CACE,IAAI8J,OAAKtB,EAAchB,EAAUxQ,SACjC,CAAC,GAAI,IAAK,GACV,CAAC,EAAG,EAAGhC,KAAKC,GAAK,GACjB,CAAC,IAAK,EAAG,GACT,WAGJgL,EAAG,CACD,CACE,IAAI6J,OAAKtB,EAAchB,EAAUxQ,SACjC,CAAC,EAAG,GAAI,KACR,CAAC,GAAIhC,KAAKC,GAAK,EAAG,GAClB,CAAC,IAAK,EAAG,GACT,YAKA+U,EAAc,CAClBC,KAAM,CAAC,CAAC,IAAId,OAAKN,EAAe,GAAK,GAAIX,GAAU,KAAM,CAAC,EAAGlT,KAAKC,GAAK,EAAG,KAC1E8K,EAAG,CAAC,CAAC,IAAIoJ,OAAKN,EAAe,GAAK,IAAMpB,KACxCzH,EAAG,CAAC,CAAC,IAAImJ,OAAKN,EAAe,GAAK,IAAMlB,GAAW,KAAM,CAAC,EAAG,GAAI3S,KAAKC,GAAK,KAC3EgL,EAAG,CAAC,CAAC,IAAIkJ,OAAKN,EAAe,GAAK,IAAMjB,GAAU,KAAM,CAAC,EAAG5S,KAAKC,GAAK,EAAG,KACzEiV,EAAG,CACD,CACE,IAAIf,OAAKN,EAAe,IAAM,GAAIZ,GAClC,KACA,CAAC,EAAGjT,KAAKC,GAAK,EAAG,MAKjBkV,EAAe,CACnBC,KAAM,CACJ,CACE,IAAIN,OAAKtB,EAAchB,EAAUxQ,SACjC,EAAE,IAAK,EAAG,GACV,KACA,CAAC,IAAK,EAAG,GACT,YAKAqT,EAAe,CACnBJ,KAAM,CAAC,CAAC,IAAId,OAAK,IAAImB,iBAAe,IAAM,GAAI,GAAIhD,KAClDvH,EAAG,CACD,CACE,IAAIoJ,OAAK,IAAIJ,gBAAc,GAAK,GAAK,EAAG,IAAKzB,GAC7C,CAAC,EAAG,EAAG,GACP,CAAC,GAAItS,KAAKC,GAAK,GAAID,KAAKC,GAAK,KAGjC+K,EAAG,CACD,CACE,IAAImJ,OAAK,IAAIJ,gBAAc,GAAK,GAAK,EAAG,IAAKzB,GAC7C,CAAC,EAAG,EAAG,GACP,CAACtS,KAAKC,GAAK,EAAG,EAAG,KAGrBgL,EAAG,CACD,CACE,IAAIkJ,OAAK,IAAIJ,gBAAc,GAAK,GAAK,EAAG,IAAKzB,GAC7C,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,GAAItS,KAAKC,GAAK,KAGtBiV,EAAG,CAAC,CAAC,IAAIf,OAAK,IAAIJ,gBAAc,IAAM,GAAK,EAAG,IAAKzB,MAG/CiD,EAAa,CACjBxK,EAAG,CACD,CAAC,IAAIoJ,OAAKb,EAAqBb,GAAS,CAAC,GAAK,EAAG,GAAI,CAAC,EAAG,GAAIzS,KAAKC,GAAK,IACvE,CAAC,IAAIkU,OAAKP,EAAenB,GAAS,CAAC,EAAG,EAAG,GAAI,CAAC,EAAG,GAAIzS,KAAKC,GAAK,IAC/D,CAAC,IAAIkU,OAAKb,EAAqBb,GAAS,EAAE,GAAK,EAAG,GAAI,CAAC,EAAG,EAAGzS,KAAKC,GAAK,KAEzE+K,EAAG,CACD,CAAC,IAAImJ,OAAKb,EAAqBX,GAAW,CAAC,EAAG,GAAK,IACnD,CAAC,IAAIwB,OAAKP,EAAejB,IACzB,CAAC,IAAIwB,OAAKb,EAAqBX,GAAW,CAAC,GAAI,GAAK,GAAI,CAAC,EAAG,EAAG3S,KAAKC,MAEtEgL,EAAG,CACD,CAAC,IAAIkJ,OAAKb,EAAqBV,GAAU,CAAC,EAAG,EAAG,IAAM,CAAC5S,KAAKC,GAAK,EAAG,EAAG,IACvE,CAAC,IAAIkU,OAAKP,EAAehB,GAAU,CAAC,EAAG,EAAG,GAAI,CAAC5S,KAAKC,GAAK,EAAG,EAAG,IAC/D,CAAC,IAAIkU,OAAKb,EAAqBV,GAAU,CAAC,EAAG,GAAI,IAAM,EAAE5S,KAAKC,GAAK,EAAG,EAAG,KAE3EqU,GAAI,CACF,CACE,IAAIH,OAAK,IAAIZ,cAAY,IAAM,IAAM,KAAOR,GAC5C,CAAC,IAAM,IAAM,KAGjBwB,GAAI,CACF,CACE,IAAIJ,OAAK,IAAIZ,cAAY,IAAM,IAAM,KAAOV,GAC5C,CAAC,EAAG,IAAM,KACV,CAAC,EAAG7S,KAAKC,GAAK,EAAG,KAGrBuU,GAAI,CACF,CACE,IAAIL,OAAK,IAAIZ,cAAY,IAAM,IAAM,KAAOT,GAC5C,CAAC,IAAM,EAAG,KACV,EAAE9S,KAAKC,GAAK,EAAG,EAAG,KAGtBmU,IAAK,CAAC,CAAC,IAAID,OAAK,IAAIZ,cAAY,GAAK,GAAK,IAAMP,EAAoBhR,YAGhEwT,EAAc,CAClBzK,EAAG,CACD,CACE,IAAIoJ,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,CAAC,GAAK,EAAG,GACT,CAAC,EAAG,GAAItS,KAAKC,GAAK,IAEpB,CACE,IAAIkU,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,EAAE,GAAK,EAAG,GACV,CAAC,EAAG,EAAGtS,KAAKC,GAAK,KAGrB+K,EAAG,CACD,CAAC,IAAImJ,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAAe,CAAC,EAAG,GAAK,IACxE,CACE,IAAI6B,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,CAAC,GAAI,GAAK,GACV,CAAC,EAAG,EAAGtS,KAAKC,MAGhBgL,EAAG,CACD,CACE,IAAIkJ,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,CAAC,EAAG,EAAG,IACP,CAACtS,KAAKC,GAAK,EAAG,EAAG,IAEnB,CACE,IAAIkU,OAAK,IAAIf,mBAAiB,GAAK,EAAG,GAAK,GAAId,GAC/C,CAAC,EAAG,GAAI,IACR,EAAEtS,KAAKC,GAAK,EAAG,EAAG,KAGtBqU,GAAI,CAAC,CAAC,IAAIH,OAAK,IAAIZ,cAAY,GAAK,GAAK,KAAOjB,GAAe,CAAC,IAAM,IAAM,KAC5EiC,GAAI,CACF,CACE,IAAIJ,OAAK,IAAIZ,cAAY,GAAK,GAAK,KAAOjB,GAC1C,CAAC,EAAG,IAAM,KACV,CAAC,EAAGtS,KAAKC,GAAK,EAAG,KAGrBuU,GAAI,CACF,CACE,IAAIL,OAAK,IAAIZ,cAAY,GAAK,GAAK,KAAOjB,GAC1C,CAAC,IAAM,EAAG,KACV,EAAEtS,KAAKC,GAAK,EAAG,EAAG,KAGtBmU,IAAK,CAAC,CAAC,IAAID,OAAK,IAAIZ,cAAY,GAAK,GAAK,IAAMjB,GAAe,CAAC,EAAG,EAAG,MAGlEmD,EAAc,CAClB1K,EAAG,CACD,CACE,IAAI+J,OAAKtB,EAAchB,EAAUxQ,SACjC,EAAE,IAAK,EAAG,GACV,KACA,CAAC,IAAK,EAAG,GACT,WAGJgJ,EAAG,CACD,CACE,IAAI8J,OAAKtB,EAAchB,EAAUxQ,SACjC,CAAC,GAAI,IAAK,GACV,CAAC,EAAG,EAAGhC,KAAKC,GAAK,GACjB,CAAC,IAAK,EAAG,GACT,WAGJgL,EAAG,CACD,CACE,IAAI6J,OAAKtB,EAAchB,EAAUxQ,SACjC,CAAC,EAAG,GAAI,KACR,CAAC,GAAIhC,KAAKC,GAAK,EAAG,GAClB,CAAC,IAAK,EAAG,GACT,YAON,SAASyV,EAAWC,GAClB,IAAMC,EAAQ,IAAI/F,WAElB,IAAK,IAAMje,KAAQ+jB,EACjB,IAAK,IAAItL,EAAIsL,EAAS/jB,GAAMqV,OAAQoD,KAAO,CACzC,IAAMpV,EAAS0gB,EAAS/jB,GAAMyY,GAAG,GAAGrI,QAC9BrK,EAAWge,EAAS/jB,GAAMyY,GAAG,GAC7BuE,EAAW+G,EAAS/jB,GAAMyY,GAAG,GAC7BlG,EAAQwR,EAAS/jB,GAAMyY,GAAG,GAC1BwL,EAAMF,EAAS/jB,GAAMyY,GAAG,GAG9BpV,EAAOrD,KAAOA,EACdqD,EAAO4gB,IAAMA,EAETle,GACF1C,EAAO0C,SAAS8F,IAAI9F,EAAS,GAAIA,EAAS,GAAIA,EAAS,IAGrDiX,GACF3Z,EAAO2Z,SAASnR,IAAImR,EAAS,GAAIA,EAAS,GAAIA,EAAS,IAGrDzK,GACFlP,EAAOkP,MAAM1G,IAAI0G,EAAM,GAAIA,EAAM,GAAIA,EAAM,IAG7ClP,EAAO6gB,eAEP,IAAMC,EAAe9gB,EAAO7B,SAAS4O,QACrC+T,EAAaC,aAAa/gB,EAAOmS,QACjCnS,EAAO7B,SAAW2iB,EAClB9gB,EAAOghB,YAActW,IAErB1K,EAAO0C,SAAS8F,IAAI,EAAG,EAAG,GAC1BxI,EAAO2Z,SAASnR,IAAI,EAAG,EAAG,GAC1BxI,EAAOkP,MAAM1G,IAAI,EAAG,EAAG,GAEvBmY,EAAM9f,IAAIb,GAId,OAAO2gB,EA/cG,OAodZ,EAAKA,MAAQ,GACb,EAAKtH,OAAS,GACd,EAAKrX,OAAS,GAEd,EAAKnB,IAAK,EAAK8f,MAAL,UAA0BF,EAAWxB,IAC/C,EAAKpe,IAAK,EAAK8f,MAAL,OAAuBF,EAAWV,IAC5C,EAAKlf,IAAK,EAAK8f,MAAL,MAAsBF,EAAWH,IAC3C,EAAKzf,IAAK,EAAKwY,OAAL,UAA2BoH,EAAWjB,IAChD,EAAK3e,IAAK,EAAKwY,OAAL,OAAwBoH,EAAWL,IAC7C,EAAKvf,IAAK,EAAKwY,OAAL,MAAuBoH,EAAWF,IAC5C,EAAK1f,IAAK,EAAKmB,OAAL,UAA2Bye,EAAWhB,IAChD,EAAK5e,IAAK,EAAKmB,OAAL,OAAwBye,EAAWP,IAC7C,EAAKrf,IAAK,EAAKmB,OAAL,MAAuBye,EAAWD,IAI5C,EAAKnH,OAAL,UAAyB1a,SAAU,EACnC,EAAK0a,OAAL,OAAsB1a,SAAU,EAChC,EAAK0a,OAAL,MAAqB1a,SAAU,EAtenB,E,qDA2ed,SAAkBsiB,GAAQ,IAAD,OAGjBvY,EAAuB,WAFD,UAAdnP,KAAK4c,KAAmB,QAAU5c,KAAKigB,OAEdjgB,KAAKyd,gBAAkBmF,EAI9D5iB,KAAKonB,MAAL,UAAwBhiB,QAAwB,cAAdpF,KAAK4c,KACvC5c,KAAKonB,MAAL,OAAqBhiB,QAAwB,WAAdpF,KAAK4c,KACpC5c,KAAKonB,MAAL,MAAoBhiB,QAAwB,UAAdpF,KAAK4c,KAEnC5c,KAAKyI,OAAL,UAAyBrD,QAAwB,cAAdpF,KAAK4c,KACxC5c,KAAKyI,OAAL,OAAsBrD,QAAwB,WAAdpF,KAAK4c,KACrC5c,KAAKyI,OAAL,MAAqBrD,QAAwB,UAAdpF,KAAK4c,KAEpC,IAAI+K,EAAU,GAGdA,GADAA,GADAA,EAAUA,EAAQC,OAAO5nB,KAAK8f,OAAO9f,KAAK4c,MAAMiL,WAC9BD,OAAO5nB,KAAKonB,MAAMpnB,KAAK4c,MAAMiL,WAC7BD,OAAO5nB,KAAKyI,OAAOzI,KAAK4c,MAAMiL,UAEhD,IApBuB,eAoBdhM,GACP,IAAMiM,EAASH,EAAQ9L,GAIvBiM,EAAO1iB,SAAU,EACjB0iB,EAAO1H,SAASnR,IAAI,EAAG,EAAG,GAC1B6Y,EAAO3e,SAASqG,KAAK,EAAK+N,eAE1B,IAAIwK,OAAM,EAiBV,GAdEA,EADE,EAAKtkB,OAAOoV,sBACJ,EAAKpV,OAAOsV,IAAM,EAAKtV,OAAOuV,QAAU,EAAKvV,OAAOkQ,KAG5D,EAAK4J,cAAcpJ,WAAW,EAAKwJ,gBACnCnM,KAAK8D,IACF,IAAM9D,KAAKkH,IAAKlH,KAAKC,GAAK,EAAKhO,OAAOmC,IAAO,KAAQ,EAAKnC,OAAOkQ,KAClE,GAINmU,EAAOnS,MAAM1G,IAAI,EAAG,EAAG,GAAG8G,eAAgBgS,EAAS,EAAK7Z,KAAQ,GAI7C,WAAf4Z,EAAOT,IA2FT,OA1FAS,EAAO1iB,SAAU,EAEG,SAAhB0iB,EAAO1kB,MACT0kB,EAAO3e,SAASqG,KAAK,EAAKgO,oBAC1BsK,EAAO1iB,UAAY,EAAK2a,KAEN,MAAd,EAAKA,OACP1D,EAAgB2L,aAAa3F,EAAWpT,IAAI,EAAG,EAAG,IAClD6Y,EAAO3Y,WAAWK,KAAKL,GAAYC,SAASiN,GAG1C7K,KAAKyW,IACH1F,EAAa/S,KAAKuT,GAAQ7N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MAC7D,KAEJ8J,EAAO1iB,SAAU,IAIH,MAAd,EAAK2a,OACP1D,EAAgB2L,aAAa3F,EAAWpT,IAAI,EAAG,EAAGuC,KAAKC,GAAK,IAC5DqW,EAAO3Y,WAAWK,KAAKL,GAAYC,SAASiN,GAG1C7K,KAAKyW,IACH1F,EAAa/S,KAAKwT,GAAQ9N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MAC7D,KAEJ8J,EAAO1iB,SAAU,IAIH,MAAd,EAAK2a,OACP1D,EAAgB2L,aAAa3F,EAAWpT,IAAI,EAAGuC,KAAKC,GAAK,EAAG,IAC5DqW,EAAO3Y,WAAWK,KAAKL,GAAYC,SAASiN,GAG1C7K,KAAKyW,IACH1F,EAAa/S,KAAKyT,GAAQ/N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MAC7D,KAEJ8J,EAAO1iB,SAAU,IAIH,SAAd,EAAK2a,OACP1D,EAAgB2L,aAAa3F,EAAWpT,IAAI,EAAGuC,KAAKC,GAAK,EAAG,IAC5D8Q,EAAa/S,KAAK,EAAKuO,cACvB+J,EAAO3Y,WAAW+Y,sBAChBzF,EAAcvZ,OAAOsZ,EAAaD,EAAcS,IAElD8E,EAAO3Y,WAAWC,SAASiN,GAC3ByL,EAAO1iB,QAAU,EAAKsa,UAGN,MAAd,EAAKK,OACP+H,EAAO1iB,SAAU,IAEM,UAAhB0iB,EAAO1kB,MAChB0kB,EAAO3e,SAASqG,KAAK,EAAKgO,oBAC1BsK,EAAO1iB,QAAU,EAAKsa,UACG,QAAhBoI,EAAO1kB,MAChB0kB,EAAO3e,SAASqG,KAAK,EAAK+N,eAC1BuK,EAAO1iB,QAAU,EAAKsa,UACG,UAAhBoI,EAAO1kB,MAChB0kB,EAAO3e,SAASqG,KAAK,EAAKgO,oBAC1BsK,EAAO3Y,WAAWK,KAAK,EAAKkO,sBAC5BvB,EACGlN,IAAI,MAAO,MAAO,OAClB3H,IAAI,EAAKkW,oBACTvI,IAAI,EAAKsI,eACTxH,gBAAgB,GACnBoG,EAAYjH,gBAAgB,EAAKwI,qBAAqBlK,QAAQuB,UAC9D+S,EAAOnS,MAAMnG,KAAK2M,GAClB2L,EAAO1iB,QAAU,EAAKsa,WAEtBoI,EAAO3Y,WAAWK,KAAKL,GAEnB,EAAKuQ,SACPoI,EAAO3e,SAASqG,KAAK,EAAKgO,oBAE1BsK,EAAO3e,SAASqG,KAAK,EAAK+N,eAGxB,EAAKwC,OACP+H,EAAO1iB,SAA6C,IAAnC,EAAK2a,KAAKW,OAAOoH,EAAO1kB,QAK7C,WAOF,GAFA0kB,EAAO3Y,WAAWK,KAAKL,GAEL,cAAd,EAAKyN,MAAsC,UAAd,EAAKA,KAAkB,CAGtD,IAAMuL,EAAqB,IAGP,MAAhBL,EAAO1kB,MAEPoO,KAAKyW,IACH1F,EAAa/S,KAAKuT,GAAQ7N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MAC7DmK,IAEJL,EAAOnS,MAAM1G,IAAI,MAAO,MAAO,OAC/B6Y,EAAO1iB,SAAU,GAID,MAAhB0iB,EAAO1kB,MAEPoO,KAAKyW,IACH1F,EAAa/S,KAAKwT,GAAQ9N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MAC7DmK,IAEJL,EAAOnS,MAAM1G,IAAI,MAAO,MAAO,OAC/B6Y,EAAO1iB,SAAU,GAID,MAAhB0iB,EAAO1kB,MAEPoO,KAAKyW,IACH1F,EAAa/S,KAAKyT,GAAQ/N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MAC7DmK,IAEJL,EAAOnS,MAAM1G,IAAI,MAAO,MAAO,OAC/B6Y,EAAO1iB,SAAU,GAID,OAAhB0iB,EAAO1kB,MAEPoO,KAAKyW,IACH1F,EAAa/S,KAAKyT,GAAQ/N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MAtCzC,KAyCxB8J,EAAOnS,MAAM1G,IAAI,MAAO,MAAO,OAC/B6Y,EAAO1iB,SAAU,GAID,OAAhB0iB,EAAO1kB,MAEPoO,KAAKyW,IACH1F,EAAa/S,KAAKuT,GAAQ7N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MAjDzC,KAoDxB8J,EAAOnS,MAAM1G,IAAI,MAAO,MAAO,OAC/B6Y,EAAO1iB,SAAU,GAID,OAAhB0iB,EAAO1kB,MAEPoO,KAAKyW,IACH1F,EAAa/S,KAAKwT,GAAQ9N,gBAAgB/F,GAAYG,IAAI,EAAK0O,MA5DzC,KA+DxB8J,EAAOnS,MAAM1G,IAAI,MAAO,MAAO,OAC/B6Y,EAAO1iB,SAAU,OAGE,WAAd,EAAKwX,OAGd+F,EAAiBnT,KAAKL,GACtBoT,EACG/S,KAAK,EAAKwO,KACV9I,gBAAgBmH,EAAgB7M,KAAKL,GAAY4F,WAEnB,IAA7B+S,EAAO1kB,KAAKsd,OAAO,MACrBoH,EAAO3Y,WAAW+Y,sBAChBzF,EAAcvZ,OAAO,EAAK8U,IAAKwE,EAAaQ,IAI5B,MAAhB8E,EAAO1kB,OACTiZ,EAAgB6E,iBACd6B,EACAvR,KAAK4W,OAAO7F,EAAazT,EAAGyT,EAAavT,IAE3CqN,EAAgBgM,oBAAoB1F,EAAkBtG,GACtDyL,EAAO3Y,WAAWK,KAAK6M,IAGL,MAAhByL,EAAO1kB,OACTiZ,EAAgB6E,iBACd8B,EACAxR,KAAK4W,MAAM7F,EAAa3T,EAAG2T,EAAavT,IAE1CqN,EAAgBgM,oBAAoB1F,EAAkBtG,GACtDyL,EAAO3Y,WAAWK,KAAK6M,IAGL,MAAhByL,EAAO1kB,OACTiZ,EAAgB6E,iBACd+B,EACAzR,KAAK4W,MAAM7F,EAAazT,EAAGyT,EAAa3T,IAE1CyN,EAAgBgM,oBAAoB1F,EAAkBtG,GACtDyL,EAAO3Y,WAAWK,KAAK6M,KAK3ByL,EAAO1iB,QAAU0iB,EAAO1iB,WAA0C,IAA9B0iB,EAAO1kB,KAAKmd,QAAQ,MAAe,EAAK+H,OAC5ER,EAAO1iB,QAAU0iB,EAAO1iB,WAA0C,IAA9B0iB,EAAO1kB,KAAKmd,QAAQ,MAAe,EAAKgI,OAC5ET,EAAO1iB,QAAU0iB,EAAO1iB,WAA0C,IAA9B0iB,EAAO1kB,KAAKmd,QAAQ,MAAe,EAAKiI,OAC5EV,EAAO1iB,QACL0iB,EAAO1iB,WACwB,IAA9B0iB,EAAO1kB,KAAKmd,QAAQ,MAAgB,EAAK+H,OAAS,EAAKC,OAAS,EAAKC,OAIxEV,EAAO5jB,SAASukB,OAASX,EAAO5jB,SAASukB,QAAUX,EAAO5jB,SAAS+B,MAAMuN,QACzEsU,EAAO5jB,SAASwkB,SAAWZ,EAAO5jB,SAASwkB,UAAYZ,EAAO5jB,SAAS6f,QAEvE+D,EAAO5jB,SAAS+B,MAAMuJ,KAAKsY,EAAO5jB,SAASukB,QAC3CX,EAAO5jB,SAAS6f,QAAU+D,EAAO5jB,SAASwkB,SAEtC,EAAK1X,SAAW,EAAK+O,OACnB+H,EAAO1kB,OAAS,EAAK2c,MAIvB,EAAKA,KAAK4I,MAAM,IAAIjf,MAAK,SAAUkf,GACjC,OAAOd,EAAO1kB,OAASwlB,QAJzBd,EAAO5jB,SAAS+B,MAAMie,OAAO,UAC7B4D,EAAO5jB,SAAS6f,QAAU,IAhQvBlI,EAAI,EAAGA,EAAI8L,EAAQlP,OAAQoD,IAAK,EAAhCA,GA4QT,yEAAwB6L,O,GA5wBSrG,YAgxBrCrE,EAAuBmF,UAAU0G,0BAA2B,E,IAItD3L,E,kDACJ,aAAe,IAAD,8BACZ,cACE,IAAI4L,gBAAc,IAAQ,IAAQ,EAAG,GACrC,IAAIxF,oBAAkB,CACpBle,SAAS,EACT2jB,WAAW,EACXC,KAAMC,aACNtF,aAAa,EACbI,QAAS,GACTL,YAAY,MAIXrgB,KAAO,yBAbA,E,qDAgBd,SAAkBqkB,GAChB,IAAIzH,EAAQjgB,KAAKigB,MAoBjB,OAlBAjgB,KAAKmJ,SAASqG,KAAKxP,KAAKud,eAEN,UAAdvd,KAAK4c,OAAkBqD,EAAQ,SAEnCiD,EACG1T,KAAKuT,GACL7N,gBAA0B,UAAV+K,EAAoBjgB,KAAKyd,gBAAkBmF,GAC9DO,EACG3T,KAAKwT,GACL9N,gBAA0B,UAAV+K,EAAoBjgB,KAAKyd,gBAAkBmF,GAC9DQ,EACG5T,KAAKyT,GACL/N,gBAA0B,UAAV+K,EAAoBjgB,KAAKyd,gBAAkBmF,GAI9DL,EAAa/S,KAAK2T,GAEVnjB,KAAK4c,MACX,IAAK,YACL,IAAK,QACH,OAAQ5c,KAAK+f,MACX,IAAK,IACHwC,EAAa/S,KAAKxP,KAAKge,KAAKiD,MAAMiC,GAClCL,EAAWrT,KAAK0T,GAAKjC,MAAMsB,GAC3B,MACF,IAAK,IACHA,EAAa/S,KAAKxP,KAAKge,KAAKiD,MAAMkC,GAClCN,EAAWrT,KAAK2T,GAAKlC,MAAMsB,GAC3B,MACF,IAAK,IACHA,EAAa/S,KAAKxP,KAAKge,KAAKiD,MAAMmC,GAClCP,EAAWrT,KAAK4T,GAAKnC,MAAMsB,GAC3B,MACF,IAAK,KACHM,EAAWrT,KAAK4T,GAChB,MACF,IAAK,KACHP,EAAWrT,KAAK0T,GAChB,MACF,IAAK,KACHX,EAAa/S,KAAK4T,GAClBP,EAAWrT,KAAK2T,GAChB,MACF,IAAK,MACL,IAAK,IACHN,EAAW5T,IAAI,EAAG,EAAG,GAIzB,MACF,IAAK,SACL,QAEE4T,EAAW5T,IAAI,EAAG,EAAG,GAGG,IAAxB4T,EAAWpK,SAEbzY,KAAKmP,WAAWK,KAAKxP,KAAK4d,mBAE1BkF,EAAY5Z,OAAOiT,EAAYlN,IAAI,EAAG,EAAG,GAAI4T,EAAYN,GAEzDviB,KAAKmP,WAAW+Y,sBAAsBpF,IAGxC,yEAAwB4E,O,GAtFS/B,QA0FrCzI,EAAuBiF,UAAU+G,0BAA2B,E,oBC1/CvC5oB,E,WAKnB,aAAe,yBAHP6oB,cAGM,OAFNphB,uBAEM,EACRzH,EAAgBoE,WACpBpE,EAAgBoE,SAAW1E,M,+CAG7B,SAAYqD,EAA0BI,EAAsB6H,GAC1D,IAAItL,KAAKmpB,SAAT,CAGA,OAAQ9lB,GACN,IAAK,MACHrD,KAAKopB,gBAAgB3lB,EAAQ6H,GAC7B,MACF,IAAK,QACHtL,KAAKqpB,kBAAkB5lB,EAAQ6H,GAC/B,MACF,QACEvC,QAAQwC,KAAR,wBAA8BlI,EAA9B,eAGJrD,KAAKspB,uBAAuB7lB,EAAQ6H,M,oBAGtC,SAAO7B,M,4BAEP,WACMzJ,KAAKmpB,WAAUnpB,KAAKmpB,SAASnY,SAAU,K,6BAG7C,WACMhR,KAAKmpB,WAAUnpB,KAAKmpB,SAASnY,SAAU,K,6BAG7C,SAAwBvN,EAAsB6H,GACxCtL,KAAKmpB,WAAUnpB,KAAKmpB,SAASnY,SAAU,GAC3ChR,KAAKmpB,SAAW,IAAI9d,EAAY5H,EAAQ6H,GACxCtL,KAAKmpB,SAAS1d,cAAgB,K,+BAGhC,SAA0BhI,EAAsB6H,GAC1CtL,KAAKmpB,WAITnpB,KAAKmpB,SAAW,IAAItY,EAAcpN,EAAQ6H,GAC1CtL,KAAKmpB,SAAS/U,kBAAkBvE,W,oCAGlC,SAA+BpM,EAAsB6H,GAA0B,IAAD,OAC5EtL,KAAK+H,kBAAoB,IAAI+U,EAAkBrZ,EAAQ6H,GACvDjE,YAAmBrH,KAAK+H,kBAAmB,gBAE3C9H,IAAayE,SAAS6kB,4BAA4BvpB,KAAK+H,mBAKvD/H,KAAK+H,kBAAkByI,iBAAiB,UAAU,SAACnI,GACjD,IAAM5B,EAAS4B,EAAEoB,OAAOhD,OACxB,GAAKA,EAAL,CACA,IAAM+iB,EAAW/iB,EAAOC,KAClB+iB,EAAmD,CACvDtgB,SAAU,CAAEyF,EAAGnI,EAAO0C,SAASyF,EAAGE,EAAGrI,EAAO0C,SAAS2F,EAAGE,EAAGvI,EAAO0C,SAAS6F,GAC3EoR,SAAU,CAAExR,EAAGnI,EAAO2Z,SAASxR,EAAGE,EAAGrI,EAAO2Z,SAAStR,EAAGE,EAAGvI,EAAO2Z,SAASpR,GAC3E2G,MAAO,CAAE/G,EAAGnI,EAAOkP,MAAM/G,EAAGE,EAAGrI,EAAOkP,MAAM7G,EAAGE,EAAGvI,EAAOkP,MAAM3G,IAE3DrN,EAAc1B,IAAayE,SAASnC,2BACtCZ,GAAeA,EAAYwB,KAAOsD,EAAOC,OAC3C/E,EAAY2B,WAAWomB,UAAYD,EACnCxpB,IAAayE,SAAS9C,oBAAoB4nB,EAAU7nB,QAKxD3B,KAAK+H,kBAAkByI,iBAAiB,oBAAoB,SAACnI,GAC3D,EAAK8gB,SAASnY,SAAW3I,EAAEjE,SAI7ByL,OAAOW,iBAAiB,WAAW,SAACnD,GAClC,IAAMsc,EAAY,EAAK5hB,kBACvB,OAAQsF,EAAMuc,IAAIC,eAChB,IAAK,IACHF,EAAUG,QAAQ,aAClB,MACF,IAAK,IACHH,EAAUG,QAAQ,UAClB,MACF,IAAK,IACHH,EAAUG,QAAQ,SAClB,MACF,IAAK,QACHH,EAAUI,mBAAmB,GAC7BJ,EAAUK,gBAAgBnqB,YAAgBoqB,SAAS,KACnDN,EAAUO,aAAa,SAO7Bra,OAAOW,iBAAiB,SAAS,SAACnD,GAChC,IAAMsc,EAAY,EAAK5hB,kBACvB,OAAQsF,EAAMuc,IAAIC,eAChB,IAAK,QACHF,EAAUI,mBAAmB,MAC7BJ,EAAUK,gBAAgB,MAC1BL,EAAUO,aAAa,Y,+BAQ/B,SAAkBzjB,GACZzG,KAAK+H,mBACP/H,KAAK+H,kBAAkBoiB,OAAO1jB,K,kCAIlC,WACMzG,KAAK+H,mBAEP/H,KAAK+H,kBAAkBqiB,W,4BAI3B,SAAermB,GACT/D,KAAKmpB,UAAUnpB,KAAKmpB,SAAS3kB,OAAOT,O,KAtIvBzD,EACLoE,c,2HCCKglB,E,kDAUnB,WAAY7nB,GAAiB,IAAD,8BAC1B,cAAMA,IAVRA,YAS4B,IAR5BwoB,aAQ4B,IALrBlhB,SAA0B,IAAItJ,UAAc,EAAG,EAAG,GAK7B,EAJrBugB,SAAwB,IAAIvgB,QAAY,EAAG,EAAG,EAAG,OAI5B,EAHrB8V,MAAuB,IAAI9V,UAAc,EAAG,EAAG,GAKpD,EAAKgC,OAASA,EACd,EAAKwoB,QAAU,EAAKxoB,OAAOsD,YAHD,E,wCAM5B,SAAKjC,GAA0B,IAAD,MAC5BlD,KAAKmJ,SAAL,iBAAgBjG,QAAhB,IAAgBA,OAAhB,EAAgBA,EAAOiG,gBAAvB,QAAmCnJ,KAAKmJ,SACxCnJ,KAAKogB,SAAL,iBAAgBld,QAAhB,IAAgBA,OAAhB,EAAgBA,EAAOkd,gBAAvB,QAAmCpgB,KAAKogB,SACxCpgB,KAAK2V,MAAL,iBAAazS,QAAb,IAAaA,OAAb,EAAaA,EAAOyS,aAApB,QAA6B3V,KAAK2V,MAClC3V,KAAKsqB,gB,mBAGP,WACEtqB,KAAKsqB,gB,2BAGP,WACEtqB,KAAKqqB,QAAQlhB,SAAS8F,IAAIjP,KAAKmJ,SAASyF,EAAG5O,KAAKmJ,SAAS2F,EAAG9O,KAAKmJ,SAAS6F,K,2BAG5E,WACEhP,KAAKqqB,QAAQE,qBACX,IAAI1qB,QAAYG,KAAKogB,SAASxR,EAAG5O,KAAKogB,SAAStR,EAAG9O,KAAKogB,SAASpR,M,wBAIpE,WACEhP,KAAKqqB,QAAQ1U,MAAM1G,IAAIjP,KAAK2V,MAAM/G,EAAG5O,KAAK2V,MAAM7G,EAAG9O,KAAK2V,MAAM3G,K,yBAGhE,WACOhP,KAAK6B,SAGV7B,KAAKwqB,gBACLxqB,KAAKyqB,gBACLzqB,KAAK0qB,gB,oBAGP,WACE1qB,KAAKsqB,kB,SAnD8BK,GCLlBxqB,E,WAInB,aAAe,yBAFPmD,WAAkG,GAGpGnD,EAAiBuE,WACrBvE,EAAiBuE,SAAW1E,KAE5BA,KAAK4qB,kBAAkB,YAAalB,EAAW,CAC7CvgB,SAAU,CAAEyF,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3BoR,SAAU,CAAExR,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3B2G,MAAO,CAAE/G,EAAG,EAAGE,EAAG,EAAGE,EAAG,M,iDAI5B,WACE,OAAO,eAAKhP,KAAKsD,c,+BAGnB,SAAyBe,EAAuBE,EAA8BrB,GAC5ElD,KAAKsD,WAAWe,GAAiB,CAAEwmB,YAAatmB,EAAWrB,W,+BAG7D,SAAyBE,GAA2D,IAAD,IAC3E2G,EAAc,oBAAG/J,KAAKsD,WAAWF,UAAnB,aAAG,EAAuBF,aAA1B,QAAmC,KACvD,OAAK6G,GACI,O,0BAKX,SAAqB3G,GAAuD,IAAD,IACzE,2BAAOpD,KAAKsD,WAAWF,UAAvB,aAAO,EAAuBynB,mBAA9B,QAA6C,O,0BAG/C,SAAoBhpB,EAAgBipB,EAAqC/gB,GAEvE,IAAMxF,EAAYvE,KAAK+qB,aAAaD,GACpC,GAAKvmB,EAAL,CAMAxB,OAAO0B,QAAQsF,GAAgBzF,SAAQ,YAAmB,IAAD,mBAAhBlB,EAAgB,KAAV4nB,EAAU,KACnDC,MAAMC,QAAQF,KACI,IAAhBA,EAAKvS,OACP1O,EAAe3G,GAAQ,IAAIvD,UAAcmrB,EAAK,GAAIA,EAAK,GAAIA,EAAK,IAEzC,IAAhBA,EAAKvS,SACZ1O,EAAe3G,GAAQ,IAAIvD,UAAcmrB,EAAK,GAAIA,EAAK,SAI7D,IAAMG,EAAoB,IAAI5mB,EAAU1C,GACxC,IACEspB,EAAkBznB,KAAKqG,GACvBlI,EAAOyB,WAAWwnB,GAAiBK,EACnC,MAAO9iB,GACPU,QAAQD,MAAM,sCAAuCT,SApBrDU,QAAQD,MAAR,oBAA2BgiB,EAA3B,iB,6BAwBJ,SAAuBtoB,EAA0BC,GAC/C,IAAM8B,EAAYvE,KAAKsD,WAAWb,GAC7B8B,GAILvE,KAAKsD,WAAWd,GAAoB+B,SAC7BvE,KAAKsD,WAAWb,IAJrBsG,QAAQD,MAAR,oBAA2BrG,EAA3B,mB,KAlEetC,EACLuE,c,8GCFKtE,E,WAUnB,aAAe,yBARfoB,UAAyD,CACvD4pB,OAAQ,IAAIvrB,qBACZwrB,MAAO,IAAIxrB,oBACXyrB,MAAO,IAAIzrB,oBACX0rB,QAAS,IAAI1rB,sBACbkpB,UAAW,IAAIlpB,oBAAwB,CAAEkpB,WAAW,KAIhD3oB,EAAgBsE,WACpBtE,EAAgBsE,SAAW1E,M,+CAG7B,SAAYqD,GAA4C,IAAD,EACrD,iBAAOrD,KAAKwB,UAAU6B,UAAtB,QAA+BrD,KAAKwB,UAAU6pB,Q,+BAGhD,SAAkBvgB,GAEhB,IAAI0gB,GAAsB,EAEpBvnB,EAAM6G,EAAgB5G,SACtBunB,EAAmB1oB,OAAOC,OAAOhD,KAAKwB,WAAW4G,MACrD,SAACsjB,GAAD,OAAOA,EAAEhlB,OAASoE,EAAgB3H,MAGhCsoB,IACFA,EAAiBtgB,UACjBqgB,GAAsB,GAGxB,IAAM1hB,EAAc,IAAIjK,iBAAqB,CAC3CsE,SAAS,2BAAMF,EAAIE,UAAX,IAAqBvE,KAAM,CAAEwE,MAAO,KAC5C2G,aAAcD,EAAgBC,aAC9BE,eAAgBH,EAAgBG,iBAGlCnB,EAAYpD,KAAOoE,EAAgB3H,GACnCnD,KAAKwB,UAAUyC,EAAIb,MAAQ0G,EAEvB0hB,GACFvrB,IAAayE,SAASinB,wBAAwB7hB,O,KA3C/B1J,EACLsE,c,8GCAKxE,E,WAcnB,aAAe,IAAD,OACZ,GADY,yBAZP2H,SAAW,IAAIhI,gBAAoB,CAAE+rB,WAAW,EAAMC,OAAO,IAYtD,KAXNtrB,mBAWM,OAVNwhB,UAA6B,IAAIliB,YAU3B,KATN+F,IAAM,GASA,KARNG,KAAO,IAQD,KAPNC,IAAM,IAOA,KANNvC,YAMM,OALNqoB,gBAKM,OAJNC,iBAIM,OAHNC,gBAAsC,QAGhC,KAFNC,MAAQ,IAAIpsB,QAGdK,EAAcwE,SAAU,OAAOxE,EAAcwE,SACjDxE,EAAcwE,SAAW1E,KACzBA,KAAK8rB,WAAa,IAAIjsB,oBACpBG,KAAK4F,IACLiK,OAAOC,WAAaD,OAAOE,YAC3B/P,KAAK+F,KACL/F,KAAKgG,KAEPhG,KAAKksB,WAAWlsB,KAAK8rB,YACrBjc,OAAOW,iBAAiB,UAAU,kBAAM,EAAK2b,kB,yCAG/C,SAAM5rB,EAA4B6rB,GAChCpsB,KAAKO,cAAgBA,EACrBP,KAAKO,cAAc8rB,YAAYrsB,KAAK6H,SAASyD,YAC7CtL,KAAKssB,eACLtsB,KAAKusB,eACLvsB,KAAKwsB,gBACLxsB,KAAKysB,cAAcL,GACnBpsB,KAAKmsB,iB,4BAGP,SAAeJ,GACb/rB,KAAK+rB,YAAcA,EACnB/rB,KAAKksB,WAAWlsB,KAAK+rB,e,2BAGvB,WACE/rB,KAAKksB,WAAWlsB,KAAK8rB,c,yBAGvB,SAAY7pB,EAAgBC,GAC1B,IAAM6Z,EAAU,IAAIlc,UAAcoC,EAAQC,GAC1ClC,KAAK+hB,UAAUpC,cAAc5D,EAAS/b,KAAKyD,QAC3C,IAAMipB,EAAa1sB,KAAK+hB,UAAU4K,iBAChC1sB,IAAayE,SAAS3D,WAAW8mB,UACjC,GAGI+E,EAAiBF,EAAWG,QAAO,SAACxkB,GAAD,MAAyB,WAAlBA,EAAE5B,OAAOpD,QACzD,GAAIupB,EAAenU,OAAS,EAAG,CAC7B,GAAsC,iBAAlCmU,EAAe,GAAGnmB,OAAOpD,KAAyB,CACpD,GAA8B,IAA1BupB,EAAenU,OAEjB,YADAxY,IAAayE,SAASrC,WAEjB,GAAIpC,IAAayE,SAASpC,oBAC/B,OAIJ,IAAMwqB,EAAeJ,EAAWtkB,MAC9B,SAACC,GAAD,MAAyB,SAAlBA,EAAE5B,OAAOpD,MAAqC,qBAAlBgF,EAAE5B,OAAOpD,QAG9C,IAAKypB,EACH,OAG+B,SAA7BA,EAAarmB,OAAOpD,KACtBpD,IAAayE,SAAS0E,OAAO0jB,EAAarmB,QACJ,qBAA7BqmB,EAAarmB,OAAOpD,MAC7BpD,IAAayE,SAAStC,WAAW0qB,EAAarmB,OAAOC,MAI/B,IAAtBgmB,EAAWjU,QACbxY,IAAayE,SAASrC,a,wBAI1B,SAAmBsD,GACjB3F,KAAKyD,OAASkC,EACd3F,KAAKyD,OAAO0F,SAAS2F,EAAI,GACzB9O,KAAKyD,OAAO2c,SAASxR,GAAK,GAC1B5O,KAAKyD,OAAO0F,SAAS6F,EAAI,K,2BAG3B,SAAsBod,GAAqB,IAAD,OACxCpsB,KAAK6H,SAASklB,kBAAiB,SAACntB,GAAD,OAAkB,EAAK4E,OAAO4nB,Q,2BAG/D,WACEpsB,KAAK+hB,UAAY,IAAIliB,c,0BAGvB,WACOG,KAAKO,eAGVD,IAAgBoE,SAASsoB,YACvBhtB,KAAKgsB,gBACLhsB,KAAKyD,OACLzD,KAAK6H,SAASyD,c,0BAIlB,WACOtL,KAAKO,gBACVP,KAAK6H,SAASolB,QAAQjtB,KAAKO,cAAcuY,YAAa9Y,KAAKO,cAAcoY,cACzE3Y,KAAK6H,SAASqlB,YAAcrtB,sBAC5BG,KAAK6H,SAASslB,oBAAsB,EACpCntB,KAAK6H,SAASulB,UAAUpc,SAAU,EAClChR,KAAK6H,SAASulB,UAAU/pB,KAAOxD,iBAC/BG,KAAK6H,SAASulB,UAAU/pB,KAAOxD,sB,uBAGjC,WACE,OAAOG,KAAKyD,OAAOoC,S,0BAGrB,WAAgB,IAAD,YACb,GAAK7F,KAAKO,cAAV,CACA,IAAM8sB,EAAartB,KAAKO,cAAckhB,wBAChC6L,EAAC,oBAAGttB,KAAKO,qBAAR,iBAAG,EAAoBgtB,oBAAvB,aAAG,EAAkCzU,mBAArC,QAAoDuU,EAAW3L,MAChE8L,EAAC,oBAAGxtB,KAAKO,qBAAR,iBAAG,EAAoBgtB,oBAAvB,aAAG,EAAkC5U,oBAArC,QAAqD0U,EAAW1lB,OACvE3H,KAAKyD,OAAOoC,OAASynB,EAAIE,EACzBxtB,KAAKyD,OAAO+Q,yBACZxU,KAAK6H,SAASolB,QAAQK,EAAGE,GACzBxtB,KAAK6H,SAAS4lB,cAAc5d,OAAO6d,qB,oBAGrC,SAAOtB,GACLpsB,KAAK6H,SAAS8lB,OAAOvB,EAAOpsB,KAAKyD,QACjC,IAAMM,EAAY/D,KAAKisB,MAAM2B,WACvBjtB,EAAcX,KAAKisB,MAAM4B,iBAC/B5tB,IAAayE,SAASopB,YAAY/pB,EAAWpD,GAC7CL,IAAgBoE,SAASqpB,eAAehqB,O,KA7IvB7D,EACLwE,c,8LCFVspB,EAAa,sBACbC,EAA6B,sEAM/BD,EAN+B,wDA8CtBE,EAAoB,SAC/B9qB,EACA+qB,EACA9qB,GAEA,IAAMF,EAAKirB,eACPpjB,EAAUijB,EAEd,OAAQ5qB,GACN,IAAK,YACH2H,EAAUijB,EACV,MACF,IAAK,SACHjjB,EA1C0B,opBA2C1B,MACF,IAAK,WACHA,EA1B4B,kPAgChC,MAAO,CACL7H,KACAC,OACA+qB,WACAnjB,UACA3H,SAIEgrB,EAAsB,6BAEfC,EAAqB,SAAC5jB,GAEjC,MADe,WAAOA,EAAOM,QAAd,KACEujB,QACfP,EADK,sIASGK,EATH,gBAcIG,EAAoB,SAC/BC,EACAvrB,GAEA,IAAMwrB,EAAiB,8FAGnB3rB,OAAO0B,QAAQvB,GACdyrB,KAAI,mCAAE/E,EAAF,KAAOxlB,EAAP,0BAA0BwlB,EAA1B,qBAA0CA,EAA1C,eAAoDxlB,EAApD,QACJwqB,KAAK,MALa,SAOvB,OAAOH,EAAWF,QAAQF,EAAqBK,IAGpCG,EAAsB,SACjCzrB,EACAuH,EACAE,GAGA,MAAO,CACL1H,GAFSirB,eAGThrB,OACAuH,eAAgBA,EAChBE,iBAAkBA,EAClB1G,SAAU,M,gCC5Hd,kCAAO,IAAMkD,EAAqB,SAArBA,EAAsBZ,GAAwE,IAAhDpD,EAA+C,uDAAb,SACtFoD,IACLA,EAAOpD,KAAOA,EACdoD,EAAOohB,SAASvjB,SAAQ,SAAA8c,GAAK,OAAI/Z,EAAmB+Z,EAAO/d,S,2FCDvDyrB,EAAsB,IAAIjvB,sBAA0B,EAAG,GAC7DivB,EAAoBrJ,SAASjU,KAAKC,GAAK,GACvCqd,EAAoBnZ,MAAM,EAAG,EAAG,G,IACXtV,E,WAcnB,aAAe,yBAZf0uB,WAAgE,CAC9DC,IAAK,IAAInvB,oBACTovB,OAAQ,IAAIpvB,uBAA2B,EAAG,GAAI,IAC9CqvB,SAAU,IAAIrvB,yBAA6B,EAAG,EAAG,EAAG,GAAI,GACxDsvB,MAAO,IAAItvB,sBAA0B,EAAG,IAAK,GAAI,GAAI,KACrDuvB,MAAON,EACPO,YAAa,IAAIxvB,4BACjByvB,WAAY,IAAIzvB,2BAChB0vB,aAAc,IAAI1vB,6BAClB2vB,YAAa,IAAI3vB,6BAIbQ,EAAgBqE,WACpBrE,EAAgBqE,SAAW1E,M,+CAG7B,SAAYqD,GAAkD,IAAD,EAC3D,iBAAOrD,KAAK+uB,WAAW1rB,UAAvB,QAAgCrD,KAAK+uB,WAAWC,Q,KApB/B3uB,EACLqE,c,mCCNhB,gFACa+qB,EAAoB,WAE/B,MAAO,CACLtsB,GAFSirB,eAGThrB,KAAM,aACNC,KAAM,QACN+B,SAAS,EACTC,YAAY,EACZC,eAAe,EACfV,SAAU,MACVV,SAAU,QACV2jB,SAAU,GACVvkB,WAAY,CACVomB,UAAW,CACTvgB,SAAU,CAAEyF,EAAG,EAAGE,EAAG,GAAKE,EAAG,GAC7BoR,SAAU,CAAExR,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3B2G,MAAO,CAAE/G,EAAG,EAAGE,EAAG,EAAGE,EAAG,OAMnB0gB,EAAmB,WAE9B,MAAO,CACLvsB,GAFSirB,eAGThrB,KAAM,YACNC,KAAM,QACN+B,SAAS,EACTC,YAAY,EACZC,eAAe,EACfuiB,SAAU,GACVvkB,WAAY,CACVomB,UAAW,CACTvgB,SAAU,CAAEyF,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3BoR,SAAU,CAAExR,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3B2G,MAAO,CAAE/G,EAAG,GAAKE,EAAG,GAAKE,EAAG,MAGhClK,WAAY,CACVoB,UAAW,GACX7C,KAAM,QACN4C,MAAO,qB,qhCCjCQpD,e,+cAGnB,SAA6BD,GAC3BG,OAAOC,OAAOJ,GAAS0B,SAAQ,SAACoG,GAC9B,IACsB,cAAhBA,EAAOrH,MACTR,eAAe8sB,uBAAuBjlB,GAExC,MAAOklB,GACP7mB,QAAQD,MAAM8mB,S,oCAKpB,gCAAsCllB,QAEpC,IAAM7K,MAAQgwB,mCACRC,YAAc7vB,yDAAayE,SAAS5C,YAAYyO,KAAKtQ,yDAAayE,UAClEqrB,aAAeN,6CACfO,KAAO3wB,0DAAQO,KAEfqwB,WAAU,UAAMvlB,OAAOM,SACvBklB,aAAeD,WAAWE,UAAUF,WAAW1P,QAAQ,eAAiB,IAC1E6P,UAAYF,aAAaC,UAAU,EAAGD,aAAa3P,QAAQ,iBAC/D6P,UAAYA,UAAUC,WAAW,IAAK,KACtCD,UAAYA,UAAUC,WAAW,IAAK,KACtC,IAAIntB,MAA8C,GAC9C,UAAGktB,WAAY7B,QAAQ,MAAO,IAAI9V,SACpC2X,UAAS,WAAOA,UAAP,KACTltB,MAAQotB,KAAK,IAAD,OAAKF,UAAL,OAEd,IAAIG,gBAAkBjC,qDAAmB5jB,QACzC6lB,gBAAkB/B,qDAAkB+B,gBAAiBrtB,OACrD,IAAMstB,aAAoBF,KAAK,IAAD,OAAKC,gBAAL,MAC9BxtB,OAAO0tB,eAAeD,aAAc7F,uDAEpCxqB,6DAAiBuE,SAASkmB,kBAAkBlgB,OAAOtH,KAAMotB,aAActtB,OACvEjD,yDAAayE,SAASgsB,6BAA6BhmB,OAAOtH,KAAMF,W,+GC9CtCynB,EAG5B,WAAY9oB,GAAiB,yBAF7BA,YAE4B,EAC1B7B,KAAK6B,OAASA,I,gHCEZ8uB,EAA+B,CACnCC,kBAAmB,MAGRC,EAAgBC,wBAA8BH,GAE9CI,EAAiB,SAAC,GAIxB,IAHLlJ,EAGI,EAHJA,SAYMmJ,EAAe,CAAEzwB,cARD0wB,iBAAuB,MAQPL,kBANgBM,mBAAQ,WAC5D,IAAMC,EAAmBC,aAAaC,QAAQ,gBAC9C,OAAKF,EACE9mB,KAAKC,MAAM6mB,GADY,OAE7B,KAIH,OAAO,cAACN,EAAcS,SAAf,CAAwBltB,MAAO4sB,EAA/B,SAA8CnJ,K,8BCXjD8I,EAAe,CACnBzoB,YAAa,CACXC,SAAU,GACV1E,OAAQ,CACN0F,SAAU,IAAItJ,UACd+F,IAAK,GACLG,KAAM,GACNC,IAAK,IACLmjB,SAAU,SAEZ3nB,UAAW,IAEb+vB,iBAAkB,KAClBC,mBAAoB,KACpBC,YAAa,SAACtpB,KACdupB,oBAAqB,SAAChwB,KACtBiwB,sBAAuB,SAACC,KACxBC,eAAgB,SAAC7sB,KACjBxD,UAAW,GACXswB,aAAc,SAACtwB,MAGJuwB,EAAejB,wBAA6BH,GAE5CqB,EAAgB,SAAC,GAIvB,IAHLnK,EAGI,EAHJA,SAGI,EAE4BoK,mBAA+B,CAC7D,CACE9uB,GAAIirB,eACJhrB,KAAM,cACNC,KAAM,SACN+B,SAAS,EACTC,YAAY,EACZC,eAAe,EACfuiB,SAAU,GACVvkB,WAAY,CACVomB,UAAW,CACTvgB,SAAU,CAAEyF,EAAG,EAAGE,EAAG,EAAGE,GAAI,GAC5BoR,SAAU,CAAExR,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3B2G,MAAO,CAAE/G,EAAG,EAAGE,EAAG,EAAGE,EAAG,KAG5BhK,YAAa,CACXY,IAAK,GACLG,KAAM,GACNC,IAAK,MAGT,CACE7C,GAAIirB,eACJhrB,KAAM,gBACNC,KAAM,QACN+B,SAAS,EACTC,YAAY,EACZC,eAAe,EACfuiB,SAAU,GACVvkB,WAAY,CACVomB,UAAW,CACTvgB,SAAU,CAAEyF,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3BoR,SAAU,CAAExR,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3B2G,MAAO,CAAE/G,EAAG,EAAGE,EAAG,EAAGE,EAAG,KAG5BlK,WAAY,CACVzB,KAAM,UACN4C,MAAO,UACPC,UAAW,KAGf,CACE/C,GAAIirB,eACJhrB,KAAM,oBACNC,KAAM,QACN+B,SAAS,EACTC,YAAY,EACZC,eAAe,EACfuiB,SAAU,GACVvkB,WAAY,CACVomB,UAAW,CACTvgB,SAAU,CAAEyF,EAAG,EAAGE,EAAG,GAAIE,EAAG,GAC5BoR,SAAU,CAAExR,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3B2G,MAAO,CAAE/G,EAAG,EAAGE,EAAG,EAAGE,EAAG,KAG5BlK,WAAY,CACVzB,KAAM,cACN4C,MAAO,UACPC,UAAW,KAIf,CACE/C,GAAIirB,eACJhrB,KAAM,QACNC,KAAM,QACN+B,SAAS,EACTC,YAAY,EACZC,eAAe,EACfpB,SAAU,QACVU,SAAU,QACVijB,SAAU,GACVvkB,WAAY,CACVomB,UAAW,CACTvgB,SAAU,CAAEyF,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3BoR,SAAU,CAAExR,EAAG,EAAGE,EAAG,EAAGE,EAAG,GAC3B2G,MAAO,CAAE/G,EAAG,EAAGE,EAAG,EAAGE,EAAG,QAjF5B,mBAEG7G,EAFH,KAEaspB,EAFb,OAsF4CQ,mBAAwB,MAtFpE,mBAsFGV,EAtFH,KAsFqBG,EAtFrB,OAyFgDO,mBAAwB,MAzFxE,mBAyFGT,EAzFH,KAyFuBG,EAzFvB,OA0F8BM,mBAChC,IA3FE,mBA0FGzwB,EA1FH,KA0FcswB,EA1Fd,KA8FE5pB,EAAkCgpB,mBACtC,iBAAO,CACL/oB,WACA3G,UAAWuB,OAAOC,OAAOxB,MAE3B,CAAC2G,EAAU3G,IAIb0wB,qBAAU,WACR,IAAMtW,EAAgB,SAACvO,GACH,WAAdA,EAAMuc,MACR8H,EAAoB,MACpBC,EAAsB,MACtBtyB,IAAQ8yB,mBAIZ,OADA3mB,SAASgF,iBAAiB,UAAWoL,GAC9B,WACLpQ,SAASwE,oBAAoB,UAAW4L,MAEzC,IAEHsW,qBAAU,WACR,GAAIX,EAAkB,CACpB,IAAM5vB,EAAcwG,EAASC,MAAK,SAACC,GAAD,OAAOA,EAAElF,KAAOouB,KAClD,IAAK5vB,EAAa,OAClBtC,IAAQ+yB,qBAAqBb,EAAkB5vB,MAGhD,CAACuG,IAEJ,IAAM8oB,EAAe,CACnB9oB,cACAqpB,mBACAC,qBACAC,cACAC,sBACAC,wBACAnwB,YACAswB,gBAEF,OAAO,cAACC,EAAaT,SAAd,CAAuBltB,MAAO4sB,EAA9B,SAA6CnJ,KCvKhD8I,EAA+B,CACnC/tB,QAAS,GACTyvB,oBAAgBppB,EAChBwlB,WAAY,GACZ6D,cAAe,SAAC7D,KAChB8D,WAAY,SAAC3vB,KACb4vB,kBAAmB,SAAC9nB,KACpB+nB,eAAgB,cAGLC,EAAgB5B,wBAA8BH,GAEhDlC,EAAa,GACX6D,EAAgB,SAACK,GAC5BlE,EAAakE,GAEFC,EAAiB,SAAC,GAIxB,IAHL/K,EAGI,EAHJA,SAGI,EAC0BoK,mBAAiD,IAD3E,mBACGrvB,EADH,KACY2vB,EADZ,OAEwCN,qBAFxC,mBAEGI,EAFH,KAEmBG,EAFnB,KAIEC,EAAiB,WACrBpzB,IAAQozB,eAAe1vB,OAAOC,OAAOJ,KAGvCsvB,qBAAU,WACRO,MACC,CAAC7vB,IAEJ,IAAMouB,EAAe,CACnBpuB,UACA2vB,aACA9D,aACA6D,gBACAD,iBACAG,oBACAC,kBAGF,OACE,cAACC,EAAcpB,SAAf,CAAwBltB,MAAO4sB,EAA/B,SAA8CnJ,K,wBCkDnCgL,EAvGE,WAAO,IAAD,EAUjBC,qBAAWf,GARb7pB,EAFmB,EAEnBA,YACAupB,EAHmB,EAGnBA,YACAF,EAJmB,EAInBA,iBACAG,EALmB,EAKnBA,oBACAlwB,EANmB,EAMnBA,UACAswB,EAPmB,EAOnBA,aACAN,EARmB,EAQnBA,mBACAG,EATmB,EASnBA,sBAcIoB,EAA4C7B,mBAAQ,WAAO,IAAD,EAC9D,iBAAOhpB,EAAYC,SAASC,MAAK,SAACC,GAAD,OAAOA,EAAElF,KAAOouB,YAAjD,QAAsE,OACrE,CAACrpB,EAAaqpB,IAEXyB,EAAgD9B,mBAAQ,WAAO,IAAD,EAClE,iBAAOhpB,EAAY1G,UAAU4G,MAAK,SAACC,GAAD,OAAOA,EAAElF,KAAOquB,YAAlD,QAAyE,OACxE,CAACtpB,EAAaspB,IA0DjB,MAAO,CACLtpB,cACA6qB,iBACAC,mBACAC,aAlCmB,SAACpxB,GACpB4vB,EAAY,GAAD,mBAAKvpB,EAAYC,UAAjB,CAA2BtG,KACtCxC,IAAQ6zB,aAAarxB,IAiCrBsxB,aAhFmB,SAAChwB,GACpB,GAAIA,IAAOouB,EAGT,OAFAlyB,IAAQ8zB,aAAa,SACrBzB,EAAoB,IAGtBryB,IAAQ8zB,aAAahwB,GACrBwuB,EAAsB,IACtBD,EAAoBvuB,IAyEpBiwB,aA9DmB,SAACvxB,GACpB,IAAMwxB,EAAQnrB,EAAYC,SAASI,WAAU,SAACF,GAAD,OAAOA,EAAElF,KAAOtB,EAAOsB,OACrD,IAAXkwB,GACFtqB,QAAQD,MAAR,wBAA+BjH,EAAOsB,GAAtC,6BAEF+E,EAAYC,SAASkrB,GAASxxB,EAC9B4vB,EAAY,YAAIvpB,EAAYC,YAyD5BmrB,aAtDmB,SAAC5xB,GACpB,IAAM2xB,EAAQnrB,EAAYC,SAASI,WAAU,SAACF,GAAD,OAAOA,EAAElF,KAAOzB,MAC9C,IAAX2xB,GACFtqB,QAAQD,MAAR,wBAA+BpH,EAA/B,6BAEFwG,EAAYC,SAAS2T,OAAOuX,EAAO,GACnC5B,EAAY,YAAIvpB,EAAYC,WAC5B9I,IAAQi0B,aAAa5xB,IAgDrB6xB,mBA7CyB,SACzBnS,EACAoS,KA4CAC,eAlCqB,SACrBC,EACA/oB,EACAE,GAEA,IAAM8oB,EAAyBnyB,EACzBsI,EAAc+kB,YAClB6E,EACA/oB,EACAE,GAEF8oB,EAAuBD,GAAgB5pB,EACvCgoB,EAAa,eAAK6B,IAClBt0B,IAAQu0B,qBAAqB7wB,OAAOC,OAAO2wB,KAsB3CE,eAnBqB,SAACjC,GAClBA,IAAeJ,GAInBG,EAAsBC,GACtBF,EAAoB,KAJlBC,EAAsB,KAkBxBmC,aAAcrC,EACdsC,cAAejC,I,+DClFEkC,E,2FACnB,SAAcC,GACZ,IAAMC,EAAM,IAAIC,IACVC,EAASF,EAAIE,OAAO,WACpB,OAANA,QAAM,IAANA,KAAQC,KAAK,aAAchqB,KAAKE,UAAU0pB,IACpC,OAANG,QAAM,IAANA,KAAQC,KAAK,aAAcL,EAAgBM,iBAAiBL,IACtD,OAANG,QAAM,IAANA,KAAQC,KAAK,WAAYL,EAAgBO,eAAeN,IACxDC,EAAIM,cAAc,CAAEnxB,KAAM,SAAUoxB,MAAK,SAACzpB,GACxC0pB,iBAAO1pB,EAAS,oB,8BAIpB,SAAgCipB,GAE9B,MAjCe,kV,4BAoCjB,SAA8BA,GAE5B,MAxBa,uE,aC0EFU,EArFI,WAAM,MAIrB7B,qBAAWJ,GADL9vB,EAHe,EAGfA,QAAS2vB,EAHM,EAGNA,WAAYF,EAHN,EAGMA,eAAgBG,EAHtB,EAGsBA,kBAAmBC,EAHzC,EAGyCA,eAmEhE,MAAO,CACL7vB,QAHqCsuB,mBAAQ,kBAAMnuB,OAAOC,OAAOJ,KAAU,CAACA,IAI5EgyB,YAAarC,EACb9D,aACA6D,gBACAD,iBACAG,oBACAqC,WAvEiB,SACjBC,GAEI,IAAD,IAECC,EAHJC,EACG,uDADqB,KAExBjsB,QAAQksB,MAAM,iBAAkBH,EAAYE,EAAQpyB,GAErC,OAAXoyB,EACFD,EAAcnyB,EAAQkyB,GACF,SAAXE,IACTD,EAAchyB,OAAOC,OAAOJ,GAASwF,MAAK,SAACsC,GAAD,OAAYA,EAAOtH,OAAS0xB,MAExEtC,EAAkBuC,GAClBzC,EAAa,oBAACyC,SAAD,aAAC,EAAa/pB,eAAd,QAAyB,KA4DtCkqB,WAzDiB,SAACxqB,GAClB,IAAMqqB,EAAcnyB,EAAQ8H,EAAOvH,IAC9B4xB,IACLA,EAAY/pB,QAAUyjB,EACF,cAAhB/jB,EAAOrH,KACTovB,IAEAF,EAAW,eAAK3vB,MAmDlBuyB,aAzCmB,SAACC,GACpB,IAAMC,EAA8B,GAC9BC,EAAuB1yB,EAY7B,OAXAwyB,EAAe9wB,SAAQ,SAACixB,GACtB,IAAMC,EAAYtH,YAChBqH,EAAcnyB,KACdmyB,EAAcpH,SACdoH,EAAclyB,MAEhBgyB,EAAW9rB,KAAKisB,GAChBF,EAAqBE,EAAUryB,IAAMqyB,KAGvCjD,EAAW,eAAK+C,IACTD,GA4BPI,iBAzBuB,SAACryB,EAAcD,GACtC,IAAMmyB,EAAuB1yB,EAE7B,IAD4BG,OAAOC,OAAOJ,GAAS+rB,KAAI,SAACjkB,GAAD,OAAYA,EAAOtH,QAClDsyB,SAAStyB,GAAjC,CAGA,IAAMuyB,EAAUL,EAAqBnyB,GAAIC,KAEzCkyB,EAAqBnyB,GAAIC,KAAOA,EAChC/D,IAAQqD,gBAAgBU,EAAMuyB,GAC9BpD,EAAW,eAAK+C,MAgBhBM,gBAAiBnD,ICuBNoD,EArGG,SAACC,GAAwB,IAAD,EACPnB,IAAzB/xB,EADgC,EAChCA,QAASgyB,EADuB,EACvBA,YADuB,EAGtC/B,IADM3qB,EAFgC,EAEhCA,YAAairB,EAFmB,EAEnBA,aAAcW,EAFK,EAELA,aAAcC,EAFT,EAESA,cAFT,EAIKjB,qBAAWjC,GAAhDtwB,EAJgC,EAIhCA,cAAeqwB,EAJiB,EAIjBA,kBAJiB,EAKNqB,mBAAS5yB,IAAQ2C,aALX,mBAKjC+zB,EALiC,KAKtBC,EALsB,KAOxC9D,qBAAU,WACR,GAAKtB,GAAsBkF,EAA3B,CAEA,IAAMV,EAAiBryB,OAAOkzB,YAC5BrF,EAAkBhuB,QAAQ+rB,KAAI,SAACuH,GAAD,MAAO,CAACA,EAAE/yB,GAAI+yB,OAG9CtB,EAAYQ,GACZvyB,IAAeC,eAAe8tB,EAAkBhuB,SAEhDkxB,EAAalD,EAAkB1oB,YAAYC,UAE3C,IAAMguB,EAAmBpzB,OAAOkzB,YAC9BrF,EAAkB1oB,YAAY1G,UAAUmtB,KAAI,SAACjD,GAAD,MAAO,CAACA,EAAEvoB,GAAIuoB,OAE5DqI,EAAcoC,GAEd92B,IAAQoB,mBAAmBmwB,GAAmB,MAC7C,CAACkD,EAAcC,EAAea,EAAahE,EAAmBkF,IAGjE,IAAMM,EAAoClF,mBACxC,iBAAO,CAAEhpB,cAAatF,aACtB,CAACsF,EAAatF,IAGhBsvB,qBAAU,WAED3xB,GAAkBA,EAAc81B,SAAYD,GAAiBN,GAGlEz2B,IAAQqE,KAAKnD,EAAc81B,QAASD,KAIrC,CAAC71B,EAAeu1B,IAEnB5D,qBAAU,WACJ4D,GAAYM,GACd/2B,IAAQoB,mBAAmB21B,KAE5B,CAACxzB,IA0CJ,MAAO,CACLrC,gBACAw1B,YACAO,UA1CgB,WAChB,GAAK/1B,GAAkBA,EAAc81B,QAArC,CAGA,GAAIp2B,IAAa+B,YAGf,OAFAg0B,GAAa,QACb32B,IAAQqB,cAGVrB,IAAQoB,mBAAmB21B,GAC3B/2B,IAAQk3B,cACRP,GAAa,KAgCbQ,iBAxBuB,SAACnuB,GAAyB,IAAD,EAC1CouB,EAA4BpuB,EAAEoB,OACpCgtB,EAAOC,QACP,IAAMC,EAAmBF,EAAOhV,wBACzBxf,GACHoG,EAAEgR,QAAUsd,EAAQ/nB,GAAK+nB,EAAQjV,MAAS,EAAI,EADnCxf,IAEVmG,EAAEiR,QAAUqd,EAAQ7nB,GAAK6nB,EAAQhvB,OAAU,EAAI,EAEpDtI,IAAQ8C,YAAYF,EAAQC,GAC5BixB,EAAY,UAAC9zB,IAAQiD,2BAAT,QAAgC,KAgB5Cs0B,UATgB,WAChBxF,aAAayF,QAAQ,eAAgBxsB,KAAKE,UAAU6rB,KASpDU,YAdkB,WAClB9C,EAAgB+C,OAAOX,IAcvBY,wBA/B8B,WAC9B33B,IAAQoB,mBAAmB21B,MCpEhB,SAASa,EAAT,GAAqE,IAApDC,EAAmD,EAAnDA,MAAOC,EAA4C,EAA5CA,UAAWtP,EAAiC,EAAjCA,SAChD,OACE,sBAAKuP,UAAU,2DAAf,UACE,oBAAIA,UAAU,sCAAd,SAAqDF,IACrD,qBAAKE,UAAS,iBAAKD,QAAL,IAAKA,IAAa,GAAlB,cAAd,SAAiDtP,O,YCTnDwP,EAAgB,GAmCLC,EAjCS,SACtBC,EACAr0B,EACAs0B,GAEI,IADJC,EACG,uDADkC,GAErCC,aAAY,WACV,IAAMC,EAAY50B,OAAO0B,QAAQvB,GAAOyrB,KAAI,YAA8B,IAAD,mBAA3BiJ,EAA2B,KAAhBC,EAAgB,KACjEjO,EAAMwE,eACZ,MAAO,CACLxE,EACA,CACExlB,MAAOyzB,EACPX,MAAOU,EACPE,YAAa,WACXT,EAAgBzN,GAElBmO,SAAU,SAAC3zB,GACLizB,IAAkBzN,GACpB4N,EAAYpzB,EAAOwzB,IAGvBI,UAAW,WACTX,EAAgB,SAKlBY,EAAiBl1B,OAAOkzB,YAAY0B,GAC1C,OAAO,eAAGJ,EAAanD,YAAO,2BAAI6D,GAAmBR,SC3B1C,SAASS,EAAT,GAGU,IAFvBlzB,EAEsB,EAFtBA,YACAmzB,EACsB,EADtBA,kBAaA,OAFAb,EAAgB,SAAUtyB,GARH,SAACZ,EAAYwzB,GAClC,IAAMQ,EAAkB,eACnBpzB,GAELozB,EAAmBR,GAAaxzB,EAChC+zB,EAAkBC,MAKb,6BCPT,IAsBeC,EAtBO,SAAC,GAKW,IAJhCvN,EAI+B,EAJ/BA,cACA/gB,EAG+B,EAH/BA,eACAuuB,EAE+B,EAF/BA,gBACAC,EAC+B,EAD/BA,gBAeA,OATAjB,EACExM,EACA/gB,GANwB,SAAC3F,EAAYwzB,GACrCU,EAAgBxN,EAAe8M,EAAWxzB,KAOxB,cAAlB0mB,EAAgC,CAC9B,mBAAoBjd,YAAO0qB,SACzBtvB,GAGC,8BC1BM,SAASuvB,EAAT,GAA2E,IAAtD1zB,EAAqD,EAArDA,WAAY2zB,EAAyC,EAAzCA,iBAU9C,OADAnB,EAAgB,QAASxyB,GAPH,SAACV,EAAYwzB,GACjC,IAAMc,EAAiB,eAClB5zB,GAEL4zB,EAAkBd,GAAaxzB,EAC/Bq0B,EAAiBC,MAGZ,6B,oBCRM,SAASC,EAAT,GAA4D,IAAD,IAAvC5F,EAAuC,EAAvCA,eACzBK,EAAiBP,IAAjBO,aADgE,EAGhCnB,mBAAQ,UAC9Cc,EAAe7uB,gBAD+B,QACnB,SAJ2C,mBAGjEqB,EAHiE,KAGnDqzB,EAHmD,OAMhC3G,mBAAQ,UAC9Cc,EAAenuB,gBAD+B,QACnB,OAP2C,mBAMjEY,EANiE,KAMnDqzB,EANmD,KAiClEC,EANG/1B,OAAOkH,KAAK7J,IAAgBsE,SAASlD,WAAWmtB,KAAI,SAACzqB,GAAD,MAAe,CACxEgzB,MAAOhzB,EACPE,MAAOF,MAaL60B,EANGh2B,OAAOkH,KAAK5J,IAAgBqE,SAASqqB,YAAYJ,KAAI,SAAC/pB,GAAD,MAAe,CACzEsyB,MAAOtyB,EACPR,MAAOQ,MAMX,OACE,kCACE,sBAAKwyB,UAAU,yBAAf,UACE,sCACA,sBAAKA,UAAU,YAAf,UACE,sBAAKA,UAAU,8BAAf,UACE,mBAAGA,UAAU,wBAAb,sBACA,wBAAQW,SAAU,SAAC1vB,GAAD,OAzCJyB,EAyC0BzB,EAAEoB,OAAOrF,MAxCzDw0B,EAAgB9uB,QACZipB,IACFA,EAAe7uB,SAAW4F,EAC1BspB,EAAa,eAAKL,MAJC,IAACjpB,GAyC2C1F,MAAOmB,EAAhE,SACGuzB,EAAgBnK,KAAI,SAACqK,GAAD,OACnB,wBAA2B50B,MAAO40B,EAAO50B,MAAzC,SACG40B,EAAO9B,OADG8B,EAAO50B,eAM1B,sBAAKgzB,UAAU,8BAAf,UACE,mBAAGA,UAAU,wBAAb,sBACA,wBAAQW,SAAU,SAAC1vB,GAAD,OA3CJ4wB,EA2C0B5wB,EAAEoB,OAAOrF,MA1CzDy0B,EAAgBI,QACZlG,IACFA,EAAenuB,SAAWq0B,EAC1B7F,EAAa,eAAKL,MAJC,IAACkG,GA2C2C70B,MAAOoB,EAAhE,SACGuzB,EAAgBpK,KAAI,SAACqK,GAAD,OACnB,wBAA2B50B,MAAO40B,EAAO50B,MAAzC,SACG40B,EAAO9B,OADG8B,EAAO50B,uBCzDrB,SAAS80B,EAAT,GAAmE,IAAD,EAAvCnG,EAAuC,EAAvCA,eAAuC,EAC3BF,IAA5CO,EADuE,EACvEA,aAAcE,EADyD,EACzDA,aAAcprB,EAD2C,EAC3CA,YAC5B6tB,EAAcF,IAAdE,UAFuE,EAI/C9D,mBAE9B,IAN6E,mBAIxE9I,EAJwE,KAI9D6D,EAJ8D,KAS/EkF,qBAAU,WAQJa,GAP0B,SAAClxB,GAC7B,IAAMs3B,EAAkE,GACxEp2B,OAAO0B,QAAQ5C,EAAOyB,YAAYgB,SAAQ,YAAoB,IAAD,mBAAjBjB,EAAiB,KAAXH,EAAW,KAC3Di2B,EAAW91B,GAAQH,KAErB8pB,EAAY,eAAKmM,IAECC,CAAsBrG,KACzC,CAACA,EAAgB7qB,EAAa6tB,IAEjC,IAaMuC,EAAkB,SACtBj1B,EACAg2B,EACAj1B,GAEA,IAAMk1B,EAAW,eAAQnQ,GACzBmQ,EAAYj2B,GAAMg2B,GAASj1B,EAC3B4oB,EAAYsM,GACRvG,IACFA,EAAezvB,WAAag2B,EAC5BlG,EAAa,eAAKL,MA2BhBwG,EAZsB,WAC1B,IAAMj2B,EAAanD,IAAiBuE,SAAS80B,gBAC7C,IAAKzG,EAAgB,MAAO,GAC5B,IAAM0G,EAAoB12B,OAAOkH,KAAP,OAAY8oB,QAAZ,IAAYA,OAAZ,EAAYA,EAAgBzvB,YACtD,OAAOP,OAAOkH,KAAK3G,GAChBupB,QAAO,SAAC6M,GAAD,OAAQD,EAAkB/D,SAASgE,MAC1C/K,KAAI,SAACpqB,GAAD,MAAgB,CACnB2yB,MAAO3yB,EACPH,MAAOG,MAIYo1B,GAwBzB,OACE,eAAC1C,EAAD,CAAOC,MAAM,YAAb,UACE,sBAAKE,UAAU,oCAAf,UACE,6BACE,uBACEA,UAAU,6DACV/zB,KAAK,OACL+Z,aAAY,OAAE2V,QAAF,IAAEA,OAAF,EAAEA,EAAgB3vB,KAE9Bw2B,OAAQ,SAACvxB,GAAD,OAnFQwxB,EAmFgBxxB,EAAEoB,OAAOrF,WAlF5C2uB,GAA0C,WAAxBA,EAAe1vB,MACtC+vB,EAAa,2BAAKL,GAAN,IAAsB3vB,KAAMy2B,MAFjB,IAACA,GAoFhBC,SAAmC,YAAX,OAAd/G,QAAc,IAAdA,OAAA,EAAAA,EAAgB1vB,MAE1BgR,UAAW,SAAChM,GAAD,MAAiB,UAAVA,EAAEuhB,KAAmBvhB,EAAEoB,OAAOswB,SARlD,iBAIOhH,QAJP,IAIOA,OAJP,EAIOA,EAAgB5vB,UAJvB,QAI6B,MAO/B,qBACEi0B,UAAU,yFACV4C,QA1DmB,WACpBjH,GACLO,EAAaP,EAAe5vB,KAsDxB,uBAOF,0BAASi0B,UAAU,iBAAnB,UACE,sBAAKA,UAAU,iBAAf,UACE,mBAAGA,UAAU,wBAAb,qBACA,uBACE/zB,KAAK,WACL42B,QAASlH,EAAe3tB,QACxB2yB,SAAU,SAAC1vB,GAAD,OACR+qB,EAAa,2BAAKL,GAAN,IAAsB3tB,QAASiD,EAAEoB,OAAOwwB,mBAnCpC,UAAxBlH,EAAe1vB,MACf0vB,EAAejuB,YACoB,YAAnCiuB,EAAejuB,WAAWzB,OAsCtB,qCACE,sBAAK+zB,UAAU,iBAAf,UACE,mBAAGA,UAAU,wBAAb,yBACA,uBACE/zB,KAAK,WACL42B,QAASlH,EAAe1tB,WACxB0yB,SAAU,SAAC1vB,GAAD,OACR+qB,EAAa,2BAAKL,GAAN,IAAsB1tB,WAAYgD,EAAEoB,OAAOwwB,iBAI7D,sBAAK7C,UAAU,iBAAf,UACE,mBAAGA,UAAU,wBAAb,4BACA,uBACE/zB,KAAK,WACL42B,QAASlH,EAAeztB,cACxByyB,SAAU,SAAC1vB,GAAD,OACR+qB,EAAa,2BACRL,GADO,IAEVztB,cAAe+C,EAAEoB,OAAOwwB,uBAUb,UAAxBlH,EAAe1vB,MAAoB0vB,EAAejuB,YACjD,cAAC0zB,EAAD,CACE1zB,WAAYiuB,EAAejuB,WAC3B2zB,iBAxFiB,SAACyB,GACpBnH,IACFA,EAAejuB,WAAao1B,EAC5B9G,EAAa,eAAKL,OAsFTA,EAAe5vB,IAKC,WAAxB4vB,EAAe1vB,MAAqB0vB,EAAe/tB,aAClD,cAACkzB,EAAD,CACElzB,YAAa+tB,EAAe/tB,YAC5BmzB,kBA1FkB,SAAC+B,GACrBnH,IACFA,EAAe/tB,YAAck1B,EAC7B9G,EAAa,eAAKL,QA4FlB,0BAASqE,UAAU,YAAnB,UACGr0B,OAAO0B,QAAQ0kB,GAAUwF,KAAI,mCAAEtrB,EAAF,KAAQH,EAAR,YAC5B,cAAC,EAAD,CACE4nB,cAAeznB,EACf0G,eAAgB7G,EAEhBi3B,kBAAmB,GACnB7B,gBAAiBA,EACjBC,gBAAiB,kBAvIG,SAACl1B,GACxB0vB,WACEA,EAAezvB,WAAWD,GACjC+vB,EAAaL,IAoIkBqH,CAAsB/2B,KAN/C,UAGUA,EAHV,aAGmB0vB,EAAe5vB,QAMpC,cAAC,IAAD,CAAMk3B,MAAI,EAACC,MAAI,EAACC,UAAU,OAI3BhB,EAAiB9gB,OAAS,GACzB,oCACE,wBAAQsf,SAAU,SAAC1vB,GAAD,OAAOU,QAAQyxB,IAAInyB,EAAEoB,OAAOrF,QAA9C,SACGm1B,EAAiB5K,KAAI,gBAAGuI,EAAH,EAAGA,MAAO9yB,EAAV,EAAUA,MAAV,OACpB,wBAAoBA,MAAOA,EAA3B,SACG8yB,GADU9yB,QAKjB,qBAAKgzB,UAAU,+BAAf,SACE,wBAAQ4C,QAAS,kBA9KN,SAAC31B,GACpB,GAAK0uB,EAAL,CACA,IAAMhpB,EAAiB5J,IAAiBuE,SAAS+1B,kBAAkBp2B,GAC9D0F,IACLgpB,EAAezvB,WAAWe,GAAiB0F,EAC3CqpB,EAAaL,KAyKkB2H,CAAanB,EAAiB,GAAGn1B,QAAxD,gCAQmB,UAAxB2uB,EAAe1vB,MAAoB,cAACs1B,EAAD,CAAU5F,eAAgBA,OCvNrD,SAAS4H,EAAT,GAAuE,IAA1C3H,EAAyC,EAAzCA,iBAClC6B,EAAeF,IAAfE,WACR,OACE,eAACoC,EAAD,CAAOC,MAAM,YAAb,UACE,6BAAKlE,EAAiB5vB,OACtB,sDACkB,IAChB,uBACEg0B,UAAU,2FACV4C,QAAS,WACPnF,EAAW7B,EAAiBnoB,mBAHhC,+BASF,oDACgB,IACd,uBACEusB,UAAU,2FACV4C,QAAS,WACPnF,EAAW7B,EAAiBroB,iBAHhC,kCCtBO,SAASiwB,IAAkB,IAAD,EACK/H,IAApCE,EAD+B,EAC/BA,eAAgBC,EADe,EACfA,iBAExB,OAAIA,EACF,cAAC2H,EAAD,CAAmB3H,iBAAkBA,IAE9BD,EACP,cAACmG,EAAD,CAAiBnG,eAAgBA,IAEvB,6B,YCPC,SAAS8H,IAAqB,IAAD,EACAhI,IAAlCI,EADkC,EAClCA,aAAeQ,EADmB,EACnBA,eADmB,EAEeoC,GAAU,GAA3DS,EAFkC,EAElCA,UAAWP,EAFuB,EAEvBA,UAAWa,EAFY,EAEZA,UAFY,KAEDE,YAEvCnC,KADMQ,EAHkC,EAGlCA,aAAc9C,EAHoB,EAGpBA,eAAgBwC,EAHI,EAGJA,WAAYK,EAHR,EAGQA,WAAYzG,EAHpB,EAGoBA,WAqD9D,OACE,gCACE,wBAAQ2I,UAAS,sCAAiCrB,GAAa,kBAC/D,sBAAKqB,UAAU,wCAAf,UACE,sBAAKA,UAAU,YAAf,UACE,yBAAQ4C,QAAS1D,EAAWc,UAAU,UAAtC,UACGrB,EAAY,OAAS,MADxB,YAGA,wBAAQiE,QApCW,WACzB,IAAMc,EAAgCrL,cACtCwD,EAAa6H,IAkC8B1D,UAAU,YAA/C,wBAGA,wBAAQ4C,QAlCU,WACxB,IAAMe,EAA+BrL,cACrCuD,EAAa8H,IAgC6B3D,UAAU,YAA9C,uBAGA,wBAAQ4C,QAhEc,WAE5B7E,EAAa,CAAC,CAAE/xB,KADM,eACe+qB,SAAU,KAAM9qB,KAAM,gBA8Db+zB,UAAU,YAAlD,2BAGA,wBAAQ4C,QA9Da,WAC3B,IADiC,EAEN7E,EAAa,CACtC,CACE/xB,KAAM,SACN+qB,SAAU,OACV9qB,KAAM,UAER,CACED,KAAM,WACN+qB,SAAU,OACV9qB,KAAM,cAXuB,mBAE1B23B,EAF0B,KAEjBC,EAFiB,KAcjCxH,EAbqB,cAaQuH,EAAQ73B,GAAI83B,EAAQ93B,KAgDJi0B,UAAU,YAAjD,0BAIA,wBAAQ4C,QAvCQ,WACtBpD,KAsCwCQ,UAAU,YAA5C,2BAOD/E,GACC,sBAAK+E,UAAU,oBAAf,UACE,wBAAQA,UAAU,YAAY4C,QAtCd,WACxBnF,EAAW,KAqCH,0BAGA,wBAAQmF,QA/CO,WACnB3H,GACF6C,EAAW,2BAAK7C,GAAN,IAAsBrnB,QAASyjB,MA6CA2I,UAAU,SAA7C,kC,aC3FG,SAAS8D,KAA6B,IAAD,EACIvG,IAA9CtC,EAD0C,EAC1CA,eAAgB5D,EAD0B,EAC1BA,WAAY6D,EADc,EACdA,cAEpCJ,qBAAU,YACHzD,GAAc4D,GACjBC,EAAcD,EAAernB,WAE9B,CAACqnB,IAoBJ,OACE,mCACGA,GACC,mCACE,qBAAK+E,UAAU,yBAAf,SACE,cAAC,KAAD,CACEzvB,OAAO,OACP+Z,MAAM,OACNyZ,gBAtBQ,WAClB,IAAK9I,EAAgB,MAAO,aAC5B,OAAQA,EAAelE,UACrB,IAAK,KACH,MAAO,aACT,IAAK,KACH,MAAO,aACT,IAAK,OACH,MAAO,IACT,QACE,MAAO,OAYgBiN,GACjBhe,aAAciV,EAAernB,QAC7BqwB,MAAM,UACNtD,SA7Be,SAACuD,GAC1BhJ,EAAa,OAACgJ,QAAD,IAACA,IAAY,KA6BhBC,YAAY,gBAR6BlJ,EAAelvB,QChCvD,SAASq4B,KAA4B,IAAD,EACL3F,IAApCt1B,EADyC,EACzCA,cAAei2B,EAD0B,EAC1BA,iBAEvB,OACE,mCACGj2B,GACC,qBACE4C,GAAG,QACHs4B,IAAKl7B,EACLm7B,UAAW,EACX3gB,YAAa,SAAC1S,GAAD,OAAOmuB,EAAiBnuB,QC+BhCszB,OArCf,YAAyD,IAAD,EAA/B95B,EAA+B,EAA/BA,OAA+B,EACbgxB,IAAjCE,EAD8C,EAC9CA,eAAgBI,EAD8B,EAC9BA,aAElByI,EAAa1K,mBACjB,kBAAoB,OAAd6B,QAAc,IAAdA,OAAA,EAAAA,EAAgB5vB,MAAOtB,EAAOsB,KACpC,CAAC4vB,EAAgBlxB,EAAOsB,KAQpB04B,EAAW3K,mBAAQ,kBAAOrvB,EAAOuD,UAAS,CAACvD,IAEjD,OACE,qBACEu1B,UAAS,yKAQHwE,GAAc,cARX,uBASHA,EAAa,oBAAsB,oBAThC,uBAUHC,GAAY,aAVT,YAaT9gB,YAtBgB,SAAC1S,GACnBA,EAAEyzB,kBACF3I,EAAatxB,EAAOsB,KAMpB,0BAgBGtB,QAhBH,IAgBGA,OAhBH,EAgBGA,EAAQuB,YAhBX,QAgBmB,gBClCR,SAAS24B,KAAgC,IAC9C7zB,EAAgB2qB,IAAhB3qB,YACR,OACE,cAAC+uB,EAAD,CAAOC,MAAM,YAAb,SACE,qBAAKE,UAAU,YAAf,SACGlvB,EAAYC,SAASwmB,KAAI,SAAC9sB,GAAD,OACxB,cAAC,GAAD,CAA+BA,OAAQA,GAAnBA,EAAOsB,WCJtB,SAAS64B,GAAT,GAAqE,IAAxCC,EAAuC,EAAvCA,MAAOpU,EAAgC,EAAhCA,SACjD,OACE,oCACE,kCAAUoU,IADZ,OAEGpU,QAFH,IAEGA,IAFH,aAEqBoU,MCJV,SAASC,GAAT,GAAsD,IAAD,EAA/BxxB,EAA+B,EAA/BA,OAA+B,EACTiqB,IAAjDE,EAD0D,EAC1DA,WAAYxC,EAD8C,EAC9CA,eAAgBoD,EAD8B,EAC9BA,iBAC9BgG,EAAMxK,iBAAyB,MAerC,OACE,qBACEmG,UAAS,6DAEW,OAAd/E,QAAc,IAAdA,OAAA,EAAAA,EAAgBlvB,MAAOuH,EAAOvH,IAAM,cAFjC,wBAIW,OAAdkvB,QAAc,IAAdA,OAAA,EAAAA,EAAgBlvB,MAAOuH,EAAOvH,GAAK,oBAAsB,qBAE/D62B,QArBgB,SAAC3xB,GACnBA,EAAEqI,iBACFrI,EAAEyzB,kBACFjH,EAAWnqB,EAAOvH,KAmBhB8S,cAhBqB,SAAC5N,GAAY,IAAD,EACnCA,EAAEqI,iBACFrI,EAAEyzB,kBACC,OAAHL,QAAG,IAAHA,GAAA,UAAAA,EAAKpF,eAAL,SAAcK,SAKd,SAWE,uBACE+E,IAAKA,EACLrE,UAAU,gCACV/zB,KAAK,OACL+Z,aAAc1S,EAAOtH,KAErBw2B,OAAQ,SAACvxB,GAAD,OAAOotB,EAAiBptB,EAAEoB,OAAOrF,MAAOsG,EAAOvH,KAEvDkR,UAAW,SAAChM,GAAD,MAAiB,UAAVA,EAAEuhB,KAAmBvhB,EAAEoB,OAAOswB,SARlD,UAKOrvB,EAAOvH,UALd,QAKoB,KAPfuH,EAAOvH,IC3BH,SAASg5B,KAA8B,IAAD,EACOtJ,IAAlD3qB,EAD2C,EAC3CA,YAAa8qB,EAD8B,EAC9BA,iBAAkBa,EADY,EACZA,eAC/BjxB,EAAY+xB,IAAZ/xB,QACR,OACE,eAACq0B,EAAD,CAAOC,MAAM,UAAUC,UAAU,YAAjC,UACE,cAAC6E,GAAD,CAAoBC,MAAM,UAA1B,SACGr5B,EAAQiqB,QAAO,SAAAqJ,GAAC,MAAe,cAAXA,EAAE7yB,QAAsBsrB,KAAI,SAACuH,GAAD,OAC/C,cAACgG,GAAD,CAAuBxxB,OAAQwrB,GAAdA,EAAE/yB,SAIvB,cAAC64B,GAAD,CAAoBC,MAAM,YAE1B,cAACD,GAAD,CAAoBC,MAAM,YAA1B,SACG/zB,EAAY1G,UAAUmtB,KAAI,SAACzqB,GAAD,OACzB,qBAEEkzB,UAAS,wBACS,OAAhBpE,QAAgB,IAAhBA,OAAA,EAAAA,EAAkB7vB,MAAOe,EAASf,IAAM,cADjC,wBAIO,OAAhB6vB,QAAgB,IAAhBA,OAAA,EAAAA,EAAkB7vB,MAAOe,EAASf,GAC9B,oBACA,qBAEJ62B,QAAS,kBAAMnG,EAAe3vB,EAASf,KAVzC,SAYGe,EAASd,MAXLc,EAASf,YCdX,SAASi5B,KAA+B,IAAD,EACPvJ,IAArCE,EAD4C,EAC5CA,eAAgBC,EAD4B,EAC5BA,iBAClBqJ,EAA6BnL,mBACjC,mBAAQ6B,KAAoBC,IAC5B,CAACD,EAAgBC,IAGnB,OACE,sBAAKoE,UAAU,oCAAf,UACE,cAACyD,EAAD,IACA,0BACEzD,UAAU,qBACVtmB,MAAO,CAAEwrB,oBAAqB,YAFhC,UAIE,sBAAKlF,UAAU,8BAAf,UACE,cAACoE,GAAD,IACA,cAACN,GAAD,OAGDmB,EACC,uBAAOjF,UAAU,OAAjB,SACE,cAACwD,EAAD,MAGF,wBAAOxD,UAAU,mBAAjB,UACE,qBAAKA,UAAU,aAAf,SACE,cAAC2E,GAAD,MAEF,qBAAK3E,UAAU,aAAf,SACE,cAAC+E,GAAD,eCrBCI,OAZf,WACE,OACE,cAAC,EAAD,UACE,cAAC,EAAD,UACE,cAAC,EAAD,UACE,cAACH,GAAD,WCLVI,IAAS7O,OACP,cAAC,IAAM8O,WAAP,UACE,cAAC,GAAD,MAEFjxB,SAASkxB,eAAe,W","file":"static/js/main.8551fa50.chunk.js","sourcesContent":["import * as THREE from \"three\"\nimport ScriptCompiler from \"../../utils/ScriptCompiler\"\nimport CameraManager from \"./CameraManager\"\nimport ComponentManager from \"./ComponentManager\"\nimport ControlsManager from \"./ControlsManager\"\nimport GeometryManager from \"./GeometryManager\"\nimport MaterialManager from \"./MaterialManager\"\nimport SceneManager from \"./SceneManager\"\n\nclass EngineContext {\n  sceneManager: SceneManager\n  cameraManager: CameraManager\n  componentManager: ComponentManager\n  materialManager: MaterialManager\n  geometryManager: GeometryManager\n  controlsManager: ControlsManager\n  time = new THREE.Clock()\n  private _renderElement!: HTMLElement\n  private isInitialized = false\n\n  constructor() {\n    this.sceneManager = new SceneManager()\n    this.cameraManager = new CameraManager()\n    this.componentManager = new ComponentManager()\n    this.materialManager = new MaterialManager()\n    this.geometryManager = new GeometryManager()\n    this.controlsManager = new ControlsManager()\n  }\n\n  init(renderElement: HTMLElement, payload?: Engine.ScenePayload) {\n    if (this.isInitialized) return\n    this._renderElement = renderElement\n    if (payload) this.updateScenePayload(payload, true)\n    this.runEditMode()\n    this.isInitialized = true\n  }\n\n  runPlayMode() {\n    this.time.elapsedTime = 0\n    this.time.start()\n    this.sceneManager.runPlayScene()\n    const sceneCam = this.sceneManager.getScene().getObjectByName(\"Main Camera\")\n    this.cameraManager.useSceneCamera(sceneCam as THREE.PerspectiveCamera)\n    this.cameraManager.setup(this._renderElement, this.sceneManager.getScene())\n  }\n\n  runEditMode() {\n    this.time.stop()\n    this.sceneManager.runEditScene()\n    this.cameraManager.useEditCamera()\n    this.cameraManager.setup(this._renderElement, this.sceneManager.getScene())\n  }\n\n  updateScenePayload(payload: Engine.ScenePayload, forInitialization = false) {\n    this.sceneManager.setScenePayload(payload, forInitialization)\n  }\n\n  updateSceneMaterials(materials: Engine.MaterialProps[]) {\n    this.sceneManager.setSceneMaterials(materials)\n  }\n\n  updateSpecificEntity(entityID: Engine.EntityID, entityProps: Engine.EntityProps) {\n    this.sceneManager.updateEntityPayload(entityID, entityProps)\n  }\n\n  addNewEntity(entity: Engine.EntityProps) {\n    this.sceneManager.buildEntity(entity)\n  }\n\n  removeEntity(entityID: Engine.EntityID) {\n    this.sceneManager.destroyEntity(entityID)\n  }\n\n  isPlaying(): boolean {\n    return SceneManager.isPlaying() ?? false\n  }\n\n  handleClick(mouseX: number, mouseY: number) {\n    this.cameraManager.handleClick(mouseX, mouseY)\n  }\n\n  selectEntity(entityID: Engine.EntityID) {\n    this.sceneManager.selectByID(entityID)\n  }\n\n  deselectEntity() {\n    this.sceneManager.deselect()\n  }\n\n  getSelectedEntity(): Engine.EntityID | undefined {\n    return this.sceneManager.getSelectedEntity()\n  }\n\n  getSelectedEntityProps(): Engine.EntityProps | undefined {\n    return this.sceneManager.getSelectedEntityPayload()\n  }\n\n  renameComponent(newComponentName: string, oldComponentName: string) {\n    this.componentManager.renameComponent(newComponentName, oldComponentName)\n    this.sceneManager.renameComponentInEntities(newComponentName, oldComponentName)\n  }\n\n  compileScripts(scripts: Engine.Script[]) {\n    ScriptCompiler.CompileScripts(Object.values(scripts))\n  }\n}\n\nconst context = new EngineContext()\n\nexport default context\n","import * as THREE from \"three\"\nimport Component from \"./Component\"\nimport ComponentManager from \"./ComponentManager\"\nimport MaterialManager from \"./MaterialManager\"\nimport GeometryManager from \"./GeometryManager\"\nimport SceneManager from \"./SceneManager\"\nimport { Color } from \"three\"\nimport CameraManager from \"./CameraManager\"\n\nexport default class Entity {\n  public readonly id: Engine.EntityID\n  public name: string = \"\"\n  public type: Engine.EntityType | undefined\n  public components: Record<Engine.ComponentType, Component> = {}\n  \n  // Based on \"type\", an entity either has a mesh, light, or camera.\n  private mesh: THREE.Mesh | undefined\n  private light: THREE.Light | undefined\n  private camera: THREE.Camera | undefined\n\n  constructor(props: Engine.EntityProps) {\n    this.id = props.id\n    this.name = props.name\n    this.type = props.type\n    this.init(props)\n  }\n\n  public init(props: Engine.EntityProps) {\n    this._initObject(props)\n    this._appendIdentifiers(props.id, props.name)\n    this._initComponents(props.components)\n  }\n\n  public start() {\n    if (SceneManager.isPlaying()) {\n      this._startComponents()\n    }\n  }\n\n  public update(deltaTime: number, elapsedTime: number) {\n    if (SceneManager.isPlaying()) {\n      this._updateComponents()\n    }\n\n    const mat = this?.mesh?.material as any\n    if (mat?.uniforms) {\n      mat.uniforms.time.value = elapsedTime\n    }\n  }\n\n  public destroy() {\n    // TODO: Implement\n  }\n\n  public getComponent(componentName: string): Component | undefined {\n    return this.components[componentName]\n  }\n\n  public getObject(): THREE.Object3D | undefined {\n    return this.mesh || this.light || this.camera\n  }\n\n  private _startComponents() {\n    Object.values(this.components).forEach((component) => component.start())\n  }\n\n  private _updateComponents() {\n    Object.values(this.components).forEach((component) => component.update())\n  }\n\n  private _initComponents(\n    components: Record<Engine.ComponentType, Engine.ComponentProps>\n  ) {\n    this.components = {}\n    Object.entries(components).forEach(([type, props]) => {\n      ComponentManager.instance.setComponent(this, type, props)\n    })\n  }\n\n  private _initObject(props: Engine.EntityProps) {\n    if (props.type === \"basic\" && props.geometry && props.material) {\n      this._initMesh(props.material, props.geometry)\n    } else if (props.type === \"light\" && props.lightProps) {\n      this._initLight(props.lightProps)\n    } else if (props.type === \"camera\" && props.cameraProps) {\n      this._initCamera(props.cameraProps)\n    }\n    \n    const obj = this.getObject();\n    if (obj) {\n      obj.visible = props.visible;\n      obj.castShadow = props.castShadow;\n      obj.receiveShadow = props.receiveShadow;\n    }\n  }\n\n  private _initMesh(materialType: string, geometryType: string) {\n    const mat = MaterialManager.instance.getMaterial(materialType)\n    const geometry = GeometryManager.instance.getGeometry(geometryType)\n    if (!this.mesh) {\n      this.mesh = new THREE.Mesh(geometry, mat)\n    } else {\n      this.mesh.geometry = geometry\n      this.mesh.material = mat\n    }\n  }\n\n  private _initCamera(cameraProps: Engine.CameraProps) {\n    if (!this.camera) {\n      this.camera = new THREE.PerspectiveCamera(\n        cameraProps.fov,\n        CameraManager.instance.getAspect(),\n        cameraProps.near,\n        cameraProps.far\n      )\n    } else {\n      const cam = this.camera as THREE.PerspectiveCamera;\n      cam.fov = cameraProps.fov\n      cam.aspect = CameraManager.instance.getAspect()\n      cam.near = cameraProps.near\n      cam.far = cameraProps.far\n    }\n  }\n\n  private _initLight(lightProps: Engine.LightProps) {\n    const createLight = (props: Engine.LightProps): THREE.Light => {\n      switch (props.type) {\n        case \"ambient\":\n          return new THREE.AmbientLight(props.color, props.intensity)\n        case \"directional\":\n          return new THREE.DirectionalLight(props.color, props.intensity)\n        case \"hemisphere\":\n          return new THREE.HemisphereLight(props.color, props.color2, props.intensity)\n        case \"point\":\n          return new THREE.PointLight(props.color, props.intensity)\n        default:\n          return new THREE.AmbientLight(props.color, props.intensity)\n      }\n    }\n    \n    if (!this.light) {\n      this.light = createLight(lightProps)\n    }\n    \n    this.light.intensity = lightProps.intensity\n    const downcastedLight = this.light as any\n\n    if (downcastedLight.color) {\n      downcastedLight.color = new Color(lightProps.color)\n    }\n    \n    else if (downcastedLight.groundColor) {\n      downcastedLight.groundColor = new Color(lightProps.color)\n    }\n\n    if (downcastedLight.skyColor && lightProps.color2) {\n      downcastedLight.skyColor = new Color(lightProps.color2)\n    }\n  }\n\n  private _appendIdentifiers(id: string, name: string) {\n    const object: THREE.Object3D | undefined = this.getObject()\n    if (!object) return\n    object.uuid = id\n    object.name = name\n  }\n}\n","import * as THREE from \"three\"\nimport { deepClone } from \"../../utils\"\nimport CameraManager from \"./CameraManager\"\nimport ControlsManager from \"./ControlsManager\"\nimport Entity from \"./Entity\"\nimport MaterialManager from \"./MaterialManager\"\nimport { recursiveSetHelper } from \"./utils\"\nexport default class SceneManager {\n  public static instance: SceneManager\n  private isPlaying: boolean = false // If true, in play mode, else in edit mode\n  private _scene!: THREE.Scene\n  private _entities: Entity[] = []\n  private _scenePayload: Engine.ScenePayload | undefined\n  private _scenePayloadInitialized = false\n\n  // Selection\n  private _selectedEntityID: Engine.EntityID | undefined\n\n  // Helpers\n  private _axes = new THREE.AxesHelper(2)\n  private _gridHelper = new THREE.GridHelper(1000, 200)\n  private _cameraHelper = new THREE.CameraHelper(new THREE.PerspectiveCamera())\n  private _selectionHelper!: THREE.BoxHelper\n  private _lightHelpers: THREE.PointLightHelper[] = []\n\n  constructor() {\n    if (SceneManager.instance) {\n      return SceneManager.instance\n    }\n    SceneManager.instance = this\n    this._scene = new THREE.Scene()\n\n    recursiveSetHelper(this._axes)\n    this._scene.add(this._axes)\n\n    recursiveSetHelper(this._gridHelper)\n    this._scene.add(this._gridHelper)\n\n    recursiveSetHelper(this._selectionHelper)\n    this._selectionHelper = new THREE.BoxHelper(this._gridHelper, 0xffff00)\n    this._selectionHelper.visible = false\n    this._scene.add(this._selectionHelper)\n\n    const loader = new THREE.TextureLoader()\n    loader.load(\"/browser-engine/resources/skybox.png\", (texture) => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(CameraManager.instance.renderer, texture)\n      this._scene.background = rt.texture\n    })\n  }\n\n  static isPlaying() {\n    return SceneManager.instance.isPlaying\n  }\n\n  // ! Only to be used for adding transform controls from ControlsManager\n  addTransformControlsToScene(transformControls: any) {\n    this._scene.add(transformControls)\n  }\n\n  getScene(): THREE.Scene {\n    return this._scene\n  }\n\n  setScenePayload(payload: Engine.ScenePayload, forInit?: boolean) {\n    if (forInit && this._scenePayloadInitialized) return\n    this._scenePayload = payload\n    this._compileMaterials()\n    if (forInit) {\n      this._scenePayloadInitialized = true\n    }\n  }\n\n  setSceneMaterials(payload: Engine.MaterialProps[]) {\n    if (!this._scenePayload) return\n    this._scenePayload.sceneConfig.materials = payload\n    // this._compileMaterials()\n  }\n\n  getSelectedEntityPayload(): Engine.EntityProps | undefined {\n    return this._scenePayload?.sceneConfig.entities.find(\n      (e) => e.id === this._selectedEntityID\n    )\n  }\n\n  updateEntityPayload(entityID: Engine.EntityID, entityProps: Engine.EntityProps) {\n    const updateIndex = this._entities.findIndex((e) => e.id === entityID)\n    if (updateIndex === -1) return\n    this._entities[updateIndex].init(entityProps)\n    const object = this._entities[updateIndex].getObject()\n    if (object) {\n      if (object.type === \"Mesh\") {\n        this._selectionHelper?.setFromObject(object)\n      } else {\n        this._lightHelpers.forEach((helper) => {\n          helper.update()\n        })\n      }\n    }\n  }\n\n  updateScene(deltaTime: number, elapsedTime: number) {\n    this._entities.forEach((entity) => {\n      entity.update(deltaTime, elapsedTime)\n    })\n  }\n\n  /** Runs scene in play mode.\n   *\n   *  In play mode, the components in all\n   *  entities are updated each frame.\n   */\n  runPlayScene() {\n    this.isPlaying = true\n    this._resetScene()\n    this._hideHelpers()\n    try {\n      this._buildScene()\n      this._startEntities()\n    } catch (error) {\n      console.error(\"Error whilst setting up play scene\")\n    }\n  }\n\n  /** Runs scene in edit mode\n   *\n   *  In edit mode, the scene is reset and all\n   *  entities are reverted to their initial states,\n   *  based on the scenePayload.\n   */\n  runEditScene() {\n    this.isPlaying = false\n    this._resetScene()\n    this._showHelpers()\n    this._buildScene()\n  }\n\n  /** Select an entity by ID */\n  selectByID(entityID: Engine.EntityID) {\n    const object = this._entities.find((e) => e.id === entityID)?.getObject() ?? undefined\n    if (object) {\n      ControlsManager.instance.lookAt(object.position)\n      this.select(object)\n    }\n  }\n\n  /** Sets Entity with corresponding object as selected\n   * @param object THREE.Object3D\n   */\n  select(object: THREE.Object3D) {\n    if (this.isPlaying) return\n\n    if (object) {\n      ControlsManager.instance.addObjectControls(object)\n      this._selectedEntityID = object.uuid\n      this._selectionHelper.setFromObject(object)\n      if (object.type === \"Mesh\") {\n        this._selectionHelper.visible = true\n      } else if (object.type === \"PerspectiveCamera\") {\n        this._cameraHelper.visible = true\n      }\n      return\n    }\n    this._cameraHelper.visible = false\n  }\n\n  deselect() {\n    this._selectionHelper.visible = false\n    this._selectedEntityID = undefined\n    this._cameraHelper.visible = false\n    ControlsManager.instance.removeObjectControls()\n  }\n\n  getSelectedEntity(): Engine.EntityID | undefined {\n    return this._selectedEntityID\n  }\n\n  buildEntity(props: Engine.EntityProps): Entity {\n    const entity = new Entity(props)\n    this._entities.push(entity)\n    const entityObject = entity.getObject()\n    if (entityObject) {\n      this._scene.add(entityObject)\n      if (entityObject.type === \"PointLight\" && !this.isPlaying) {\n        const previouslyMadeHelper = this._lightHelpers.some(\n          (helper) => helper.uuid === props.id\n        )\n        if (!previouslyMadeHelper) {\n          const sphereSize = 1\n          const pointLightHelper = new THREE.PointLightHelper(\n            entityObject as THREE.PointLight,\n            sphereSize\n          )\n          pointLightHelper.uuid = entityObject.uuid\n          this._scene.add(pointLightHelper)\n          this._lightHelpers.push(pointLightHelper)\n        }\n      } else if (entityObject.type === \"DirectionalLight\") {\n        const light = entityObject as any\n        this._scene.add(light.target)\n      } else if (entityObject.type === \"PerspectiveCamera\") {\n        this._cameraHelper = new THREE.CameraHelper(entityObject as THREE.Camera)\n        recursiveSetHelper(this._cameraHelper)\n        this._cameraHelper.uuid = entityObject.uuid\n        this._cameraHelper.visible = false\n        this._scene.add(this._cameraHelper)\n      }\n    }\n    return entity\n  }\n\n  destroyEntity(entityID: Engine.EntityID) {\n    if (entityID === this._selectedEntityID) {\n      this.deselect()\n    }\n    const entity = this._entities.find((e) => e.id === entityID)\n    if (entity) {\n      const object = entity.getObject()\n      if (object) {\n        this._scene.remove(object)\n      }\n      entity.destroy()\n    }\n  }\n\n  renameComponentInEntities(newComponentName: string, oldComponentName: string) {\n    this._scenePayload?.sceneConfig.entities.forEach((entity) => {\n      const component = entity.components[oldComponentName]\n      if (component) {\n        entity.components[newComponentName] = component\n        delete entity.components[oldComponentName]\n      }\n    })\n  }\n\n  refreshEntitiesMaterial(newMaterial: THREE.Material) {\n    this._entities.forEach((entity) => {\n      const object = entity.getObject() as any\n      if (object && object.material && object.material.uuid === newMaterial.uuid) {\n        object.material = newMaterial\n      }\n    })\n  }\n\n  /** Adds any missing prop fields to all entities component props,\n   *  and removes any present props that are not defined in componentProps */\n  updateEntitiesComponentProps(\n    componentName: string,\n    componentProps: Engine.ComponentProps\n  ) {\n    this._scenePayload?.sceneConfig.entities.forEach((entity) => {\n      const entityComponentProps = entity.components[componentName]\n      if (entityComponentProps) {\n        Object.keys(componentProps).forEach((propName) => {\n          if (!entityComponentProps[propName]) {\n            entityComponentProps[propName] = componentProps[propName]\n          }\n        })\n\n        Object.keys(entityComponentProps).forEach((propName) => {\n          if (!componentProps[propName]) {\n            delete entityComponentProps[propName]\n          }\n        })\n      }\n    })\n  }\n\n  private _startEntities() {\n    this._entities.forEach((entity) => {\n      entity.start()\n    })\n  }\n\n  private _resetScene() {\n    this._entities.forEach((entity) => {\n      const object = entity.getObject()\n      if (object) {\n        this._scene.remove(object)\n      }\n      entity.destroy()\n    })\n    this._entities = []\n  }\n\n  private _buildScene() {\n    if (!this._scenePayload) return\n    const localPayloadCopy = deepClone<Engine.ScenePayload>(this._scenePayload)\n    this._buildEntities(localPayloadCopy.sceneConfig.entities)\n  }\n\n  private _buildEntities(entities: Engine.EntityProps[]) {\n    entities.forEach((entityProps) => {\n      this.buildEntity(entityProps)\n    })\n  }\n\n  private _compileMaterials() {\n    if (!this._scenePayload) return\n    this._scenePayload.sceneConfig.materials.forEach((material) => {\n      const associatedVertexShader = this._scenePayload?.scripts.find(\n        (script) => script.id === material.vertexShaderID\n      )\n\n      const associatedFragmentShader = this._scenePayload?.scripts.find(\n        (script) => script.id === material.fragmentShaderID\n      )\n\n      if (!associatedVertexShader || !associatedFragmentShader) return\n      const materialPayload: Engine.Material = {\n        id: material.id,\n        material,\n        vertexShader: associatedVertexShader.content,\n        fragmentShader: associatedFragmentShader.content,\n      }\n      MaterialManager.instance.addCustomMaterial(materialPayload)\n    })\n  }\n\n  private _hideHelpers() {\n    this._axes.visible = false\n    this._gridHelper.visible = false\n    this._cameraHelper.visible = false\n    ControlsManager.instance.removeObjectControls()\n\n    if (this._selectionHelper) {\n      this._selectionHelper.visible = false\n    }\n\n    this._lightHelpers.forEach((helper) => {\n      helper.dispose()\n      this._scene.remove(helper)\n    })\n    this._lightHelpers = []\n  }\n\n  private _showHelpers() {\n    this._axes.visible = true\n    this._gridHelper.visible = true\n    if (this._selectionHelper) {\n      this._selectionHelper.visible = true\n      if (this._selectedEntityID) {\n        const object =\n          this._entities.find((e) => e.id === this._selectedEntityID)?.getObject() ??\n          undefined\n        if (object) {\n          ControlsManager.instance.addObjectControls(object)\n        }\n      }\n    }\n  }\n}\n","export const deepClone = <T>(input: T): T => {\n  return JSON.parse(JSON.stringify(input)) as T\n}\n\nconst numberToHexadecimal = (value: number): Engine.Hexadecimal => {\n  return parseInt(`${value}`, 16);\n}\n\nexport const rgbToHexa = (r: number, g: number, b: number): Engine.Hexadecimal => {\n  const hexaR = numberToHexadecimal(r)\n  const hexaG = numberToHexadecimal(g)\n  const hexaB = numberToHexadecimal(b)\n  return parseInt(`0x${hexaR}${hexaG}${hexaB}`, 16)\n}","import { EventDispatcher, Quaternion, Vector3 } from \"three\"\n\nconst _changeEvent = { type: \"change\" }\n\nclass FlyControls extends EventDispatcher {\n  constructor(object, domElement) {\n    super()\n\n    if (domElement === undefined) {\n      console.warn(\n        'THREE.FlyControls: The second parameter \"domElement\" is now mandatory.'\n      )\n      domElement = document\n    }\n\n    this.object = object\n    this.domElement = domElement\n\n    // API\n\n    this.movementSpeed = 1.0\n    this.rollSpeed = 0.005\n\n    this.dragToLook = false\n    this.autoForward = false\n\n    // disable default target object behavior\n\n    // internals\n\n    const scope = this\n\n    const EPS = 0.000001\n\n    const lastQuaternion = new Quaternion()\n    const lastPosition = new Vector3()\n\n    this.tmpQuaternion = new Quaternion()\n\n    this.mouseStatus = 0\n\n    this.moveState = {\n      up: 0,\n      down: 0,\n      left: 0,\n      right: 0,\n      forward: 0,\n      back: 0,\n      pitchUp: 0,\n      pitchDown: 0,\n      yawLeft: 0,\n      yawRight: 0,\n      rollLeft: 0,\n      rollRight: 0,\n    }\n    this.moveVector = new Vector3(0, 0, 0)\n    this.rotationVector = new Vector3(0, 0, 0)\n\n    this.keydown = function (event) {\n      if (event.altKey) {\n        return\n      }\n\n      switch (event.code) {\n        case \"ShiftLeft\":\n        case \"ShiftRight\":\n          this.movementSpeedMultiplier = 0.1\n          break\n\n        case \"KeyW\":\n          this.moveState.forward = 1\n          break\n        case \"KeyS\":\n          this.moveState.back = 1\n          break\n\n        case \"KeyA\":\n          this.moveState.left = 1\n          break\n        case \"KeyD\":\n          this.moveState.right = 1\n          break\n\n        case \"KeyR\":\n          this.moveState.up = 1\n          break\n        case \"KeyF\":\n          this.moveState.down = 1\n          break\n\n        case \"ArrowUp\":\n          this.moveState.pitchUp = 1\n          break\n        case \"ArrowDown\":\n          this.moveState.pitchDown = 1\n          break\n\n        case \"ArrowLeft\":\n          this.moveState.yawLeft = 1\n          break\n        case \"ArrowRight\":\n          this.moveState.yawRight = 1\n          break\n\n        case \"KeyQ\":\n          this.moveState.rollLeft = 1\n          break\n        case \"KeyE\":\n          this.moveState.rollRight = 1\n          break\n      }\n\n      this.updateMovementVector()\n      this.updateRotationVector()\n    }\n\n    this.keyup = function (event) {\n      switch (event.code) {\n        case \"ShiftLeft\":\n        case \"ShiftRight\":\n          this.movementSpeedMultiplier = 1\n          break\n\n        case \"KeyW\":\n          this.moveState.forward = 0\n          break\n        case \"KeyS\":\n          this.moveState.back = 0\n          break\n\n        case \"KeyA\":\n          this.moveState.left = 0\n          break\n        case \"KeyD\":\n          this.moveState.right = 0\n          break\n\n        case \"KeyR\":\n          this.moveState.up = 0\n          break\n        case \"KeyF\":\n          this.moveState.down = 0\n          break\n\n        case \"ArrowUp\":\n          this.moveState.pitchUp = 0\n          break\n        case \"ArrowDown\":\n          this.moveState.pitchDown = 0\n          break\n\n        case \"ArrowLeft\":\n          this.moveState.yawLeft = 0\n          break\n        case \"ArrowRight\":\n          this.moveState.yawRight = 0\n          break\n\n        case \"KeyQ\":\n          this.moveState.rollLeft = 0\n          break\n        case \"KeyE\":\n          this.moveState.rollRight = 0\n          break\n      }\n\n      this.updateMovementVector()\n      this.updateRotationVector()\n    }\n\n    this.mousedown = function (event) {\n      if (this.dragToLook) {\n        this.mouseStatus++\n      } else {\n        switch (event.button) {\n          case 0:\n            this.moveState.forward = 1\n            break\n          case 2:\n            this.moveState.back = 1\n            break\n        }\n\n        this.updateMovementVector()\n      }\n    }\n\n    this.mousemove = function (event) {\n      if (!this.dragToLook || this.mouseStatus > 0) {\n        const container = this.getContainerDimensions()\n        const halfWidth = container.size[0] / 2\n        const halfHeight = container.size[1] / 2\n\n        this.moveState.yawLeft =\n          -(event.pageX - container.offset[0] - halfWidth) / halfWidth\n        this.moveState.pitchDown =\n          (event.pageY - container.offset[1] - halfHeight) / halfHeight\n\n        this.updateRotationVector()\n      }\n    }\n\n    this.mouseup = function (event) {\n      if (this.dragToLook) {\n        this.mouseStatus--\n\n        this.moveState.yawLeft = this.moveState.pitchDown = 0\n      } else {\n        switch (event.button) {\n          case 0:\n            this.moveState.forward = 0\n            break\n          case 2:\n            this.moveState.back = 0\n            break\n        }\n\n        this.updateMovementVector()\n      }\n\n      this.updateRotationVector()\n    }\n\n    this.update = function (delta) {\n      const moveMult = delta * scope.movementSpeed\n      const rotMult = delta * scope.rollSpeed\n\n      scope.object.translateX(scope.moveVector.x * moveMult)\n      scope.object.translateY(scope.moveVector.y * moveMult)\n      scope.object.translateZ(scope.moveVector.z * moveMult)\n\n      scope.tmpQuaternion\n        .set(\n          scope.rotationVector.x * rotMult,\n          scope.rotationVector.y * rotMult,\n          scope.rotationVector.z * rotMult,\n          1\n        )\n        .normalize()\n      scope.object.quaternion.multiply(scope.tmpQuaternion)\n\n      if (\n        lastPosition.distanceToSquared(scope.object.position) > EPS ||\n        8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS\n      ) {\n        scope.dispatchEvent(_changeEvent)\n        lastQuaternion.copy(scope.object.quaternion)\n        lastPosition.copy(scope.object.position)\n      }\n    }\n\n    this.updateMovementVector = function () {\n      const forward =\n        this.moveState.forward || (this.autoForward && !this.moveState.back) ? 1 : 0\n\n      this.moveVector.x = -this.moveState.left + this.moveState.right\n      this.moveVector.y = -this.moveState.down + this.moveState.up\n      this.moveVector.z = -forward + this.moveState.back\n    }\n\n    this.updateRotationVector = function () {\n      this.rotationVector.x = -this.moveState.pitchDown + this.moveState.pitchUp\n      this.rotationVector.y = -this.moveState.yawRight + this.moveState.yawLeft\n      this.rotationVector.z = -this.moveState.rollRight + this.moveState.rollLeft\n    }\n\n    this.getContainerDimensions = function () {\n      if (this.domElement != document) {\n        return {\n          size: [this.domElement.offsetWidth, this.domElement.offsetHeight],\n          offset: [this.domElement.offsetLeft, this.domElement.offsetTop],\n        }\n      } else {\n        return {\n          size: [window.innerWidth, window.innerHeight],\n          offset: [0, 0],\n        }\n      }\n    }\n\n    this.dispose = function () {\n      this.domElement.removeEventListener(\"contextmenu\", contextmenu)\n      this.domElement.removeEventListener(\"mousedown\", _mousedown)\n      this.domElement.removeEventListener(\"mousemove\", _mousemove)\n      this.domElement.removeEventListener(\"mouseup\", _mouseup)\n\n      window.removeEventListener(\"keydown\", _keydown)\n      window.removeEventListener(\"keyup\", _keyup)\n    }\n\n    const _mousemove = this.mousemove.bind(this)\n    const _mousedown = this.mousedown.bind(this)\n    const _mouseup = this.mouseup.bind(this)\n    const _keydown = this.keydown.bind(this)\n    const _keyup = this.keyup.bind(this)\n\n    this.domElement.addEventListener(\"contextmenu\", contextmenu)\n\n    this.domElement.addEventListener(\"mousemove\", _mousemove)\n    this.domElement.addEventListener(\"mousedown\", _mousedown)\n    this.domElement.addEventListener(\"mouseup\", _mouseup)\n\n    window.addEventListener(\"keydown\", _keydown)\n    window.addEventListener(\"keyup\", _keyup)\n\n    this.updateMovementVector()\n    this.updateRotationVector()\n  }\n}\n\nfunction contextmenu(event) {\n  event.preventDefault()\n}\n\nexport { FlyControls }\n","import {\n  EventDispatcher,\n  MOUSE,\n  Quaternion,\n  Spherical,\n  TOUCH,\n  Vector2,\n  Vector3,\n} from \"three\"\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: \"change\" }\nconst _startEvent = { type: \"start\" }\nconst _endEvent = { type: \"end\" }\n\nclass OrbitControls extends EventDispatcher {\n  constructor(object, domElement) {\n    super()\n\n    if (domElement === undefined)\n      console.warn(\n        'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.'\n      )\n    if (domElement === document)\n      console.error(\n        'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.'\n      )\n\n    this.object = object\n    this.domElement = domElement\n    this.domElement.style.touchAction = \"none\" // disable touch scroll\n\n    // Set to false to disable this control\n    this.enabled = true\n\n    // \"target\" sets the location of focus, where the object orbits around\n    this.target = new Vector3()\n\n    // How far you can dolly in and out ( PerspectiveCamera only )\n    this.minDistance = 0\n    this.maxDistance = Infinity\n\n    // How far you can zoom in and out ( OrthographicCamera only )\n    this.minZoom = 0\n    this.maxZoom = Infinity\n\n    // How far you can orbit vertically, upper and lower limits.\n    // Range is 0 to Math.PI radians.\n    this.minPolarAngle = 0 // radians\n    this.maxPolarAngle = Math.PI // radians\n\n    // How far you can orbit horizontally, upper and lower limits.\n    // If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n    this.minAzimuthAngle = -Infinity // radians\n    this.maxAzimuthAngle = Infinity // radians\n\n    // Set to true to enable damping (inertia)\n    // If damping is enabled, you must call controls.update() in your animation loop\n    this.enableDamping = false\n    this.dampingFactor = 0.05\n\n    // This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n    // Set to false to disable zooming\n    this.enableZoom = true\n    this.zoomSpeed = 1.0\n\n    // Set to false to disable rotating\n    this.enableRotate = true\n    this.rotateSpeed = 1.0\n\n    // Set to false to disable panning\n    this.enablePan = true\n    this.panSpeed = 7.0\n    this.screenSpacePanning = true // if false, pan orthogonal to world-space direction camera.up\n    this.keyPanSpeed = 15 // pixels moved per arrow key push\n\n    // Set to true to automatically rotate around the target\n    // If auto-rotate is enabled, you must call controls.update() in your animation loop\n    this.autoRotate = false\n    this.autoRotateSpeed = 2.0 // 30 seconds per orbit when fps is 60\n\n    // The four arrow keys\n    this.keys = {\n      LEFT: \"ArrowLeft\",\n      UP: \"ArrowUp\",\n      RIGHT: \"ArrowRight\",\n      BOTTOM: \"ArrowDown\",\n    }\n\n    // Mouse buttons\n    this.mouseButtons = {\n      LEFT: MOUSE.ROTATE,\n      MIDDLE: MOUSE.DOLLY,\n      RIGHT: MOUSE.PAN,\n    }\n\n    // Touch fingers\n    this.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN }\n\n    // for reset\n    this.target0 = this.target.clone()\n    this.position0 = this.object.position.clone()\n    this.zoom0 = this.object.zoom\n\n    // the target DOM element for key events\n    this._domElementKeyEvents = null\n\n    //\n    // public methods\n    //\n\n    this.getPolarAngle = function () {\n      return spherical.phi\n    }\n\n    this.getAzimuthalAngle = function () {\n      return spherical.theta\n    }\n\n    this.getDistance = function () {\n      return this.object.position.distanceTo(this.target)\n    }\n\n    this.listenToKeyEvents = function (domElement) {\n      domElement.addEventListener(\"keydown\", onKeyDown)\n      this._domElementKeyEvents = domElement\n    }\n\n    this.saveState = function () {\n      scope.target0.copy(scope.target)\n      scope.position0.copy(scope.object.position)\n      scope.zoom0 = scope.object.zoom\n    }\n\n    this.reset = function () {\n      scope.target.copy(scope.target0)\n      scope.object.position.copy(scope.position0)\n      scope.object.zoom = scope.zoom0\n\n      scope.object.updateProjectionMatrix()\n      scope.dispatchEvent(_changeEvent)\n\n      scope.update()\n\n      state = STATE.NONE\n    }\n\n    // this method is exposed, but perhaps it would be better if we can make it private...\n    this.update = (function () {\n      const offset = new Vector3()\n\n      // so camera.up is the orbit axis\n      const quat = new Quaternion().setFromUnitVectors(object.up, new Vector3(0, 1, 0))\n      const quatInverse = quat.clone().invert()\n\n      const lastPosition = new Vector3()\n      const lastQuaternion = new Quaternion()\n\n      const twoPI = 2 * Math.PI\n\n      return function update() {\n        const position = scope.object.position\n\n        offset.copy(position).sub(scope.target)\n\n        // rotate offset to \"y-axis-is-up\" space\n        offset.applyQuaternion(quat)\n\n        // angle from z-axis around y-axis\n        spherical.setFromVector3(offset)\n\n        if (scope.autoRotate && state === STATE.NONE) {\n          rotateLeft(getAutoRotationAngle())\n        }\n\n        if (scope.enableDamping) {\n          spherical.theta += sphericalDelta.theta * scope.dampingFactor\n          spherical.phi += sphericalDelta.phi * scope.dampingFactor\n        } else {\n          spherical.theta += sphericalDelta.theta\n          spherical.phi += sphericalDelta.phi\n        }\n\n        // restrict theta to be between desired limits\n\n        let min = scope.minAzimuthAngle\n        let max = scope.maxAzimuthAngle\n\n        if (isFinite(min) && isFinite(max)) {\n          if (min < -Math.PI) min += twoPI\n          else if (min > Math.PI) min -= twoPI\n\n          if (max < -Math.PI) max += twoPI\n          else if (max > Math.PI) max -= twoPI\n\n          if (min <= max) {\n            spherical.theta = Math.max(min, Math.min(max, spherical.theta))\n          } else {\n            spherical.theta =\n              spherical.theta > (min + max) / 2\n                ? Math.max(min, spherical.theta)\n                : Math.min(max, spherical.theta)\n          }\n        }\n\n        // restrict phi to be between desired limits\n        spherical.phi = Math.max(\n          scope.minPolarAngle,\n          Math.min(scope.maxPolarAngle, spherical.phi)\n        )\n\n        spherical.makeSafe()\n\n        spherical.radius *= scale\n\n        // restrict radius to be between desired limits\n        spherical.radius = Math.max(\n          scope.minDistance,\n          Math.min(scope.maxDistance, spherical.radius)\n        )\n\n        // move target to panned location\n\n        if (scope.enableDamping === true) {\n          scope.target.addScaledVector(panOffset, scope.dampingFactor)\n        } else {\n          scope.target.add(panOffset)\n        }\n\n        offset.setFromSpherical(spherical)\n\n        // rotate offset back to \"camera-up-vector-is-up\" space\n        offset.applyQuaternion(quatInverse)\n\n        position.copy(scope.target).add(offset)\n\n        scope.object.lookAt(scope.target)\n\n        if (scope.enableDamping === true) {\n          sphericalDelta.theta *= 1 - scope.dampingFactor\n          sphericalDelta.phi *= 1 - scope.dampingFactor\n\n          panOffset.multiplyScalar(1 - scope.dampingFactor)\n        } else {\n          sphericalDelta.set(0, 0, 0)\n\n          panOffset.set(0, 0, 0)\n        }\n\n        scale = 1\n\n        // update condition is:\n        // min(camera displacement, camera rotation in radians)^2 > EPS\n        // using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n        if (\n          zoomChanged ||\n          lastPosition.distanceToSquared(scope.object.position) > EPS ||\n          8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS\n        ) {\n          scope.dispatchEvent(_changeEvent)\n\n          lastPosition.copy(scope.object.position)\n          lastQuaternion.copy(scope.object.quaternion)\n          zoomChanged = false\n\n          return true\n        }\n\n        return false\n      }\n    })()\n\n    this.dispose = function () {\n      scope.domElement.removeEventListener(\"contextmenu\", onContextMenu)\n\n      scope.domElement.removeEventListener(\"pointerdown\", onPointerDown)\n      scope.domElement.removeEventListener(\"pointercancel\", onPointerCancel)\n      scope.domElement.removeEventListener(\"wheel\", onMouseWheel)\n\n      scope.domElement.removeEventListener(\"pointermove\", onPointerMove)\n      scope.domElement.removeEventListener(\"pointerup\", onPointerUp)\n\n      if (scope._domElementKeyEvents !== null) {\n        scope._domElementKeyEvents.removeEventListener(\"keydown\", onKeyDown)\n      }\n\n      //scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n    }\n\n    //\n    // internals\n    //\n\n    const scope = this\n\n    const STATE = {\n      NONE: -1,\n      ROTATE: 0,\n      DOLLY: 1,\n      PAN: 2,\n      TOUCH_ROTATE: 3,\n      TOUCH_PAN: 4,\n      TOUCH_DOLLY_PAN: 5,\n      TOUCH_DOLLY_ROTATE: 6,\n    }\n\n    let state = STATE.NONE\n\n    const EPS = 0.000001\n\n    // current position in spherical coordinates\n    const spherical = new Spherical()\n    const sphericalDelta = new Spherical()\n\n    let scale = 1\n    const panOffset = new Vector3()\n    let zoomChanged = false\n\n    const rotateStart = new Vector2()\n    const rotateEnd = new Vector2()\n    const rotateDelta = new Vector2()\n\n    const panStart = new Vector2()\n    const panEnd = new Vector2()\n    const panDelta = new Vector2()\n\n    const dollyStart = new Vector2()\n    const dollyEnd = new Vector2()\n    const dollyDelta = new Vector2()\n\n    const pointers = []\n    const pointerPositions = {}\n\n    function getAutoRotationAngle() {\n      return ((2 * Math.PI) / 60 / 60) * scope.autoRotateSpeed\n    }\n\n    function getZoomScale() {\n      return Math.pow(0.95, scope.zoomSpeed)\n    }\n\n    function rotateLeft(angle) {\n      sphericalDelta.theta -= angle\n    }\n\n    function rotateUp(angle) {\n      sphericalDelta.phi -= angle\n    }\n\n    const panLeft = (function () {\n      const v = new Vector3()\n\n      return function panLeft(distance, objectMatrix) {\n        v.setFromMatrixColumn(objectMatrix, 0) // get X column of objectMatrix\n        v.multiplyScalar(-distance)\n\n        panOffset.add(v)\n      }\n    })()\n\n    const panUp = (function () {\n      const v = new Vector3()\n\n      return function panUp(distance, objectMatrix) {\n        if (scope.screenSpacePanning === true) {\n          v.setFromMatrixColumn(objectMatrix, 1)\n        } else {\n          v.setFromMatrixColumn(objectMatrix, 0)\n          v.crossVectors(scope.object.up, v)\n        }\n\n        v.multiplyScalar(distance)\n\n        panOffset.add(v)\n      }\n    })()\n\n    // deltaX and deltaY are in pixels; right and down are positive\n    const pan = (function () {\n      const offset = new Vector3()\n\n      return function pan(deltaX, deltaY) {\n        const element = scope.domElement\n\n        if (scope.object.isPerspectiveCamera) {\n          // perspective\n          const position = scope.object.position\n          offset.copy(position).sub(scope.target)\n          let targetDistance = offset.length()\n\n          // half of the fov is center to top of screen\n          targetDistance *= Math.tan(((scope.object.fov / 2) * Math.PI) / 180.0)\n\n          // we use only clientHeight here so aspect ratio does not distort speed\n          panLeft(\n            (2 * deltaX * targetDistance) / element.clientHeight,\n            scope.object.matrix\n          )\n          panUp((2 * deltaY * targetDistance) / element.clientHeight, scope.object.matrix)\n        } else if (scope.object.isOrthographicCamera) {\n          // orthographic\n          panLeft(\n            (deltaX * (scope.object.right - scope.object.left)) /\n              scope.object.zoom /\n              element.clientWidth,\n            scope.object.matrix\n          )\n          panUp(\n            (deltaY * (scope.object.top - scope.object.bottom)) /\n              scope.object.zoom /\n              element.clientHeight,\n            scope.object.matrix\n          )\n        } else {\n          // camera neither orthographic nor perspective\n          console.warn(\n            \"WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.\"\n          )\n          scope.enablePan = false\n        }\n      }\n    })()\n\n    function dollyOut(dollyScale) {\n      if (scope.object.isPerspectiveCamera) {\n        scale /= dollyScale\n      } else if (scope.object.isOrthographicCamera) {\n        scope.object.zoom = Math.max(\n          scope.minZoom,\n          Math.min(scope.maxZoom, scope.object.zoom * dollyScale)\n        )\n        scope.object.updateProjectionMatrix()\n        zoomChanged = true\n      } else {\n        console.warn(\n          \"WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.\"\n        )\n        scope.enableZoom = false\n      }\n    }\n\n    function dollyIn(dollyScale) {\n      if (scope.object.isPerspectiveCamera) {\n        scale *= dollyScale\n      } else if (scope.object.isOrthographicCamera) {\n        scope.object.zoom = Math.max(\n          scope.minZoom,\n          Math.min(scope.maxZoom, scope.object.zoom / dollyScale)\n        )\n        scope.object.updateProjectionMatrix()\n        zoomChanged = true\n      } else {\n        console.warn(\n          \"WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.\"\n        )\n        scope.enableZoom = false\n      }\n    }\n\n    //\n    // event callbacks - update the object state\n    //\n\n    function handleMouseDownRotate(event) {\n      rotateStart.set(event.clientX, event.clientY)\n    }\n\n    function handleMouseDownDolly(event) {\n      dollyStart.set(event.clientX, event.clientY)\n    }\n\n    function handleMouseDownPan(event) {\n      panStart.set(event.clientX, event.clientY)\n    }\n\n    function handleMouseMoveRotate(event) {\n      rotateEnd.set(event.clientX, event.clientY)\n\n      rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed)\n\n      const element = scope.domElement\n\n      rotateLeft((2 * Math.PI * rotateDelta.x) / element.clientHeight) // yes, height\n\n      rotateUp((2 * Math.PI * rotateDelta.y) / element.clientHeight)\n\n      rotateStart.copy(rotateEnd)\n\n      scope.update()\n    }\n\n    function handleMouseMoveDolly(event) {\n      dollyEnd.set(event.clientX, event.clientY)\n\n      dollyDelta.subVectors(dollyEnd, dollyStart)\n\n      if (dollyDelta.y > 0) {\n        dollyOut(getZoomScale())\n      } else if (dollyDelta.y < 0) {\n        dollyIn(getZoomScale())\n      }\n\n      dollyStart.copy(dollyEnd)\n\n      scope.update()\n    }\n\n    function handleMouseMovePan(event) {\n      panEnd.set(event.clientX, event.clientY)\n\n      panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed)\n\n      pan(panDelta.x, panDelta.y)\n\n      panStart.copy(panEnd)\n\n      scope.update()\n    }\n\n    function handleMouseUp(/*event*/) {\n      // no-op\n    }\n\n    function handleMouseWheel(event) {\n      if (event.deltaY < 0) {\n        dollyIn(getZoomScale())\n      } else if (event.deltaY > 0) {\n        dollyOut(getZoomScale())\n      }\n\n      scope.update()\n    }\n\n    function handleKeyDown(event) {\n      let needsUpdate = false\n      if (document.activeElement.id !== \"scene\") return\n      switch (event.code) {\n        // case \"KeyW\":\n        //   dollyIn(0.3)\n        //   needsUpdate = true\n        //   break\n        case \"KeyS\":\n          dollyOut(0.3)\n          needsUpdate = true\n          break\n        case scope.keys.UP:\n        case \"Space\":\n          pan(0, scope.keyPanSpeed)\n          needsUpdate = true\n          break\n        case scope.keys.BOTTOM:\n          pan(0, -scope.keyPanSpeed)\n          needsUpdate = true\n          break\n\n        case scope.keys.LEFT:\n        case \"KeyA\":\n          pan(scope.keyPanSpeed, 0)\n          needsUpdate = true\n          break\n\n        case scope.keys.RIGHT || \"d\":\n        case \"KeyD\":\n          pan(-scope.keyPanSpeed, 0)\n          needsUpdate = true\n          break\n        default:\n          break\n      }\n\n      if (needsUpdate) {\n        // prevent the browser from scrolling on cursor keys\n        event.preventDefault()\n\n        scope.update()\n      }\n    }\n\n    function handleTouchStartRotate() {\n      if (pointers.length === 1) {\n        rotateStart.set(pointers[0].pageX, pointers[0].pageY)\n      } else {\n        const x = 0.5 * (pointers[0].pageX + pointers[1].pageX)\n        const y = 0.5 * (pointers[0].pageY + pointers[1].pageY)\n\n        rotateStart.set(x, y)\n      }\n    }\n\n    function handleTouchStartPan() {\n      if (pointers.length === 1) {\n        panStart.set(pointers[0].pageX, pointers[0].pageY)\n      } else {\n        const x = 0.5 * (pointers[0].pageX + pointers[1].pageX)\n        const y = 0.5 * (pointers[0].pageY + pointers[1].pageY)\n\n        panStart.set(x, y)\n      }\n    }\n\n    function handleTouchStartDolly() {\n      const dx = pointers[0].pageX - pointers[1].pageX\n      const dy = pointers[0].pageY - pointers[1].pageY\n\n      const distance = Math.sqrt(dx * dx + dy * dy)\n\n      dollyStart.set(0, distance)\n    }\n\n    function handleTouchStartDollyPan() {\n      if (scope.enableZoom) handleTouchStartDolly()\n\n      if (scope.enablePan) handleTouchStartPan()\n    }\n\n    function handleTouchStartDollyRotate() {\n      if (scope.enableZoom) handleTouchStartDolly()\n\n      if (scope.enableRotate) handleTouchStartRotate()\n    }\n\n    function handleTouchMoveRotate(event) {\n      if (pointers.length == 1) {\n        rotateEnd.set(event.pageX, event.pageY)\n      } else {\n        const position = getSecondPointerPosition(event)\n\n        const x = 0.5 * (event.pageX + position.x)\n        const y = 0.5 * (event.pageY + position.y)\n\n        rotateEnd.set(x, y)\n      }\n\n      rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed)\n\n      const element = scope.domElement\n\n      rotateLeft((2 * Math.PI * rotateDelta.x) / element.clientHeight) // yes, height\n\n      rotateUp((2 * Math.PI * rotateDelta.y) / element.clientHeight)\n\n      rotateStart.copy(rotateEnd)\n    }\n\n    function handleTouchMovePan(event) {\n      if (pointers.length === 1) {\n        panEnd.set(event.pageX, event.pageY)\n      } else {\n        const position = getSecondPointerPosition(event)\n\n        const x = 0.5 * (event.pageX + position.x)\n        const y = 0.5 * (event.pageY + position.y)\n\n        panEnd.set(x, y)\n      }\n\n      panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed)\n\n      pan(panDelta.x, panDelta.y)\n\n      panStart.copy(panEnd)\n    }\n\n    function handleTouchMoveDolly(event) {\n      const position = getSecondPointerPosition(event)\n\n      const dx = event.pageX - position.x\n      const dy = event.pageY - position.y\n\n      const distance = Math.sqrt(dx * dx + dy * dy)\n\n      dollyEnd.set(0, distance)\n\n      dollyDelta.set(0, Math.pow(dollyEnd.y / dollyStart.y, scope.zoomSpeed))\n\n      dollyOut(dollyDelta.y)\n\n      dollyStart.copy(dollyEnd)\n    }\n\n    function handleTouchMoveDollyPan(event) {\n      if (scope.enableZoom) handleTouchMoveDolly(event)\n\n      if (scope.enablePan) handleTouchMovePan(event)\n    }\n\n    function handleTouchMoveDollyRotate(event) {\n      if (scope.enableZoom) handleTouchMoveDolly(event)\n\n      if (scope.enableRotate) handleTouchMoveRotate(event)\n    }\n\n    function handleTouchEnd(/*event*/) {\n      // no-op\n    }\n\n    //\n    // event handlers - FSM: listen for events and reset state\n    //\n\n    function onPointerDown(event) {\n      if (scope.enabled === false) return\n\n      if (pointers.length === 0) {\n        scope.domElement.setPointerCapture(event.pointerId)\n\n        scope.domElement.addEventListener(\"pointermove\", onPointerMove)\n        scope.domElement.addEventListener(\"pointerup\", onPointerUp)\n      }\n\n      //\n\n      addPointer(event)\n\n      if (event.pointerType === \"touch\") {\n        onTouchStart(event)\n      } else {\n        onMouseDown(event)\n      }\n    }\n\n    function onPointerMove(event) {\n      if (scope.enabled === false) return\n\n      if (event.pointerType === \"touch\") {\n        onTouchMove(event)\n      } else {\n        onMouseMove(event)\n      }\n    }\n\n    function onPointerUp(event) {\n      if (scope.enabled === false) return\n\n      if (event.pointerType === \"touch\") {\n        onTouchEnd()\n      } else {\n        onMouseUp(event)\n      }\n\n      removePointer(event)\n\n      //\n\n      if (pointers.length === 0) {\n        scope.domElement.releasePointerCapture(event.pointerId)\n\n        scope.domElement.removeEventListener(\"pointermove\", onPointerMove)\n        scope.domElement.removeEventListener(\"pointerup\", onPointerUp)\n      }\n    }\n\n    function onPointerCancel(event) {\n      removePointer(event)\n    }\n\n    function onMouseDown(event) {\n      let mouseAction\n\n      switch (event.button) {\n        case 0:\n          mouseAction = scope.mouseButtons.LEFT\n          break\n\n        case 1:\n          mouseAction = scope.mouseButtons.MIDDLE\n          break\n\n        case 2:\n          mouseAction = scope.mouseButtons.RIGHT\n          break\n\n        default:\n          mouseAction = -1\n      }\n\n      switch (mouseAction) {\n        case MOUSE.DOLLY:\n          if (scope.enableZoom === false) return\n\n          handleMouseDownDolly(event)\n\n          state = STATE.DOLLY\n\n          break\n\n        case MOUSE.ROTATE:\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            if (scope.enablePan === false) return\n\n            handleMouseDownPan(event)\n\n            state = STATE.PAN\n          } else {\n            if (scope.enableRotate === false) return\n\n            handleMouseDownRotate(event)\n\n            state = STATE.ROTATE\n          }\n\n          break\n\n        case MOUSE.PAN:\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            if (scope.enableRotate === false) return\n\n            handleMouseDownRotate(event)\n\n            state = STATE.ROTATE\n          } else {\n            if (scope.enablePan === false) return\n\n            handleMouseDownPan(event)\n\n            state = STATE.PAN\n          }\n\n          break\n\n        default:\n          state = STATE.NONE\n      }\n\n      if (state !== STATE.NONE) {\n        scope.dispatchEvent(_startEvent)\n      }\n    }\n\n    function onMouseMove(event) {\n      if (scope.enabled === false) return\n\n      switch (state) {\n        case STATE.ROTATE:\n          if (scope.enableRotate === false) return\n\n          handleMouseMoveRotate(event)\n\n          break\n\n        case STATE.DOLLY:\n          if (scope.enableZoom === false) return\n\n          handleMouseMoveDolly(event)\n\n          break\n\n        case STATE.PAN:\n          if (scope.enablePan === false) return\n\n          handleMouseMovePan(event)\n\n          break\n      }\n    }\n\n    function onMouseUp(event) {\n      handleMouseUp(event)\n\n      scope.dispatchEvent(_endEvent)\n\n      state = STATE.NONE\n    }\n\n    function onMouseWheel(event) {\n      if (\n        scope.enabled === false ||\n        scope.enableZoom === false ||\n        (state !== STATE.NONE && state !== STATE.ROTATE)\n      )\n        return\n\n      event.preventDefault()\n\n      scope.dispatchEvent(_startEvent)\n\n      handleMouseWheel(event)\n\n      scope.dispatchEvent(_endEvent)\n    }\n\n    function onKeyDown(event) {\n      if (scope.enabled === false || scope.enablePan === false) return\n      handleKeyDown(event)\n    }\n\n    function onTouchStart(event) {\n      trackPointer(event)\n\n      switch (pointers.length) {\n        case 1:\n          switch (scope.touches.ONE) {\n            case TOUCH.ROTATE:\n              if (scope.enableRotate === false) return\n\n              handleTouchStartRotate()\n\n              state = STATE.TOUCH_ROTATE\n\n              break\n\n            case TOUCH.PAN:\n              if (scope.enablePan === false) return\n\n              handleTouchStartPan()\n\n              state = STATE.TOUCH_PAN\n\n              break\n\n            default:\n              state = STATE.NONE\n          }\n\n          break\n\n        case 2:\n          switch (scope.touches.TWO) {\n            case TOUCH.DOLLY_PAN:\n              if (scope.enableZoom === false && scope.enablePan === false) return\n\n              handleTouchStartDollyPan()\n\n              state = STATE.TOUCH_DOLLY_PAN\n\n              break\n\n            case TOUCH.DOLLY_ROTATE:\n              if (scope.enableZoom === false && scope.enableRotate === false) return\n\n              handleTouchStartDollyRotate()\n\n              state = STATE.TOUCH_DOLLY_ROTATE\n\n              break\n\n            default:\n              state = STATE.NONE\n          }\n\n          break\n\n        default:\n          state = STATE.NONE\n      }\n\n      if (state !== STATE.NONE) {\n        scope.dispatchEvent(_startEvent)\n      }\n    }\n\n    function onTouchMove(event) {\n      trackPointer(event)\n\n      switch (state) {\n        case STATE.TOUCH_ROTATE:\n          if (scope.enableRotate === false) return\n\n          handleTouchMoveRotate(event)\n\n          scope.update()\n\n          break\n\n        case STATE.TOUCH_PAN:\n          if (scope.enablePan === false) return\n\n          handleTouchMovePan(event)\n\n          scope.update()\n\n          break\n\n        case STATE.TOUCH_DOLLY_PAN:\n          if (scope.enableZoom === false && scope.enablePan === false) return\n\n          handleTouchMoveDollyPan(event)\n\n          scope.update()\n\n          break\n\n        case STATE.TOUCH_DOLLY_ROTATE:\n          if (scope.enableZoom === false && scope.enableRotate === false) return\n\n          handleTouchMoveDollyRotate(event)\n\n          scope.update()\n\n          break\n\n        default:\n          state = STATE.NONE\n      }\n    }\n\n    function onTouchEnd(event) {\n      handleTouchEnd(event)\n\n      scope.dispatchEvent(_endEvent)\n\n      state = STATE.NONE\n    }\n\n    function onContextMenu(event) {\n      if (scope.enabled === false) return\n\n      event.preventDefault()\n    }\n\n    function addPointer(event) {\n      pointers.push(event)\n    }\n\n    function removePointer(event) {\n      delete pointerPositions[event.pointerId]\n\n      for (let i = 0; i < pointers.length; i++) {\n        if (pointers[i].pointerId == event.pointerId) {\n          pointers.splice(i, 1)\n          return\n        }\n      }\n    }\n\n    function trackPointer(event) {\n      let position = pointerPositions[event.pointerId]\n\n      if (position === undefined) {\n        position = new Vector2()\n        pointerPositions[event.pointerId] = position\n      }\n\n      position.set(event.pageX, event.pageY)\n    }\n\n    function getSecondPointerPosition(event) {\n      const pointer =\n        event.pointerId === pointers[0].pointerId ? pointers[1] : pointers[0]\n\n      return pointerPositions[pointer.pointerId]\n    }\n\n    //\n\n    scope.domElement.addEventListener(\"contextmenu\", onContextMenu)\n    scope.domElement.addEventListener(\"pointerdown\", onPointerDown)\n    scope.domElement.addEventListener(\"pointercancel\", onPointerCancel)\n    scope.domElement.addEventListener(\"wheel\", onMouseWheel, {\n      passive: false,\n    })\n\n    // force an update at start\n\n    this.update()\n  }\n}\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nclass MapControls extends OrbitControls {\n  constructor(object, domElement) {\n    super(object, domElement)\n\n    this.screenSpacePanning = false // pan orthogonal to world-space direction camera.up\n\n    this.mouseButtons.LEFT = MOUSE.PAN\n    this.mouseButtons.RIGHT = MOUSE.ROTATE\n\n    this.touches.ONE = TOUCH.PAN\n    this.touches.TWO = TOUCH.DOLLY_ROTATE\n  }\n}\n\nexport { OrbitControls, MapControls }\n","import {\n  BoxGeometry,\n  BufferGeometry,\n  CylinderGeometry,\n  DoubleSide,\n  Euler,\n  Float32BufferAttribute,\n  Line,\n  LineBasicMaterial,\n  Matrix4,\n  Mesh,\n  MeshBasicMaterial,\n  Object3D,\n  OctahedronGeometry,\n  PlaneGeometry,\n  Quaternion,\n  Raycaster,\n  SphereGeometry,\n  TorusGeometry,\n  Vector3,\n} from \"three\"\n\nconst _raycaster = new Raycaster()\n\nconst _tempVector = new Vector3()\nconst _tempVector2 = new Vector3()\nconst _tempQuaternion = new Quaternion()\nconst _unit = {\n  X: new Vector3(1, 0, 0),\n  Y: new Vector3(0, 1, 0),\n  Z: new Vector3(0, 0, 1),\n}\n\nconst _changeEvent = { type: \"change\" }\nconst _mouseDownEvent = { type: \"mouseDown\" }\nconst _mouseUpEvent = { type: \"mouseUp\", mode: null }\nconst _objectChangeEvent = { type: \"objectChange\" }\n\nclass TransformControls extends Object3D {\n  constructor(camera, domElement) {\n    super()\n    if (domElement === undefined) {\n      console.warn(\n        'THREE.TransformControls: The second parameter \"domElement\" is now mandatory.'\n      )\n      domElement = document\n    }\n\n    this.visible = false\n    this.domElement = domElement\n    this.domElement.style.touchAction = \"none\" // disable touch scroll\n\n    const _gizmo = new TransformControlsGizmo()\n    this._gizmo = _gizmo\n    this.add(_gizmo)\n\n    const _plane = new TransformControlsPlane()\n    this._plane = _plane\n    this.add(_plane)\n\n    const scope = this\n\n    // Defined getter, setter and store for a property\n    function defineProperty(propName, defaultValue) {\n      let propValue = defaultValue\n\n      Object.defineProperty(scope, propName, {\n        get: function () {\n          return propValue !== undefined ? propValue : defaultValue\n        },\n\n        set: function (value) {\n          if (propValue !== value) {\n            propValue = value\n            _plane[propName] = value\n            _gizmo[propName] = value\n\n            scope.dispatchEvent({ type: propName + \"-changed\", value: value })\n            scope.dispatchEvent(_changeEvent)\n          }\n        },\n      })\n\n      scope[propName] = defaultValue\n      _plane[propName] = defaultValue\n      _gizmo[propName] = defaultValue\n    }\n\n    // Define properties with getters/setter\n    // Setting the defined property will automatically trigger change event\n    // Defined properties are passed down to gizmo and plane\n\n    defineProperty(\"camera\", camera)\n    defineProperty(\"object\", undefined)\n    defineProperty(\"enabled\", true)\n    defineProperty(\"axis\", null)\n    defineProperty(\"mode\", \"translate\")\n    defineProperty(\"translationSnap\", null)\n    defineProperty(\"rotationSnap\", null)\n    defineProperty(\"scaleSnap\", null)\n    defineProperty(\"space\", \"world\")\n    defineProperty(\"size\", 1)\n    defineProperty(\"dragging\", false)\n    defineProperty(\"showX\", true)\n    defineProperty(\"showY\", true)\n    defineProperty(\"showZ\", true)\n\n    // Reusable utility variables\n\n    const worldPosition = new Vector3()\n    const worldPositionStart = new Vector3()\n    const worldQuaternion = new Quaternion()\n    const worldQuaternionStart = new Quaternion()\n    const cameraPosition = new Vector3()\n    const cameraQuaternion = new Quaternion()\n    const pointStart = new Vector3()\n    const pointEnd = new Vector3()\n    const rotationAxis = new Vector3()\n    const rotationAngle = 0\n    const eye = new Vector3()\n\n    // TODO: remove properties unused in plane and gizmo\n\n    defineProperty(\"worldPosition\", worldPosition)\n    defineProperty(\"worldPositionStart\", worldPositionStart)\n    defineProperty(\"worldQuaternion\", worldQuaternion)\n    defineProperty(\"worldQuaternionStart\", worldQuaternionStart)\n    defineProperty(\"cameraPosition\", cameraPosition)\n    defineProperty(\"cameraQuaternion\", cameraQuaternion)\n    defineProperty(\"pointStart\", pointStart)\n    defineProperty(\"pointEnd\", pointEnd)\n    defineProperty(\"rotationAxis\", rotationAxis)\n    defineProperty(\"rotationAngle\", rotationAngle)\n    defineProperty(\"eye\", eye)\n\n    this._offset = new Vector3()\n    this._startNorm = new Vector3()\n    this._endNorm = new Vector3()\n    this._cameraScale = new Vector3()\n\n    this._parentPosition = new Vector3()\n    this._parentQuaternion = new Quaternion()\n    this._parentQuaternionInv = new Quaternion()\n    this._parentScale = new Vector3()\n\n    this._worldScaleStart = new Vector3()\n    this._worldQuaternionInv = new Quaternion()\n    this._worldScale = new Vector3()\n\n    this._positionStart = new Vector3()\n    this._quaternionStart = new Quaternion()\n    this._scaleStart = new Vector3()\n\n    this._getPointer = getPointer.bind(this)\n    this._onPointerDown = onPointerDown.bind(this)\n    this._onPointerHover = onPointerHover.bind(this)\n    this._onPointerMove = onPointerMove.bind(this)\n    this._onPointerUp = onPointerUp.bind(this)\n\n    this.domElement.addEventListener(\"pointerdown\", this._onPointerDown)\n    this.domElement.addEventListener(\"pointermove\", this._onPointerHover)\n    this.domElement.addEventListener(\"pointerup\", this._onPointerUp)\n  }\n\n  // updateMatrixWorld  updates key transformation variables\n  updateMatrixWorld() {\n    if (this.object !== undefined) {\n      this.object.updateMatrixWorld()\n\n      if (this.object.parent === null) {\n        console.error(\n          \"TransformControls: The attached 3D object must be a part of the scene graph.\"\n        )\n      } else {\n        this.object.parent.matrixWorld.decompose(\n          this._parentPosition,\n          this._parentQuaternion,\n          this._parentScale\n        )\n      }\n\n      this.object.matrixWorld.decompose(\n        this.worldPosition,\n        this.worldQuaternion,\n        this._worldScale\n      )\n\n      this._parentQuaternionInv.copy(this._parentQuaternion).invert()\n      this._worldQuaternionInv.copy(this.worldQuaternion).invert()\n    }\n\n    this.camera.updateMatrixWorld()\n    this.camera.matrixWorld.decompose(\n      this.cameraPosition,\n      this.cameraQuaternion,\n      this._cameraScale\n    )\n\n    this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize()\n\n    super.updateMatrixWorld(this)\n  }\n\n  pointerHover(pointer) {\n    if (this.object === undefined || this.dragging === true) return\n\n    _raycaster.setFromCamera(pointer, this.camera)\n\n    const intersect = intersectObjectWithRay(this._gizmo.picker[this.mode], _raycaster)\n\n    if (intersect) {\n      this.axis = intersect.object.name\n    } else {\n      this.axis = null\n    }\n  }\n\n  pointerDown(pointer) {\n    if (this.object === undefined || this.dragging === true || pointer.button !== 0)\n      return\n\n    if (this.axis !== null) {\n      _raycaster.setFromCamera(pointer, this.camera)\n\n      const planeIntersect = intersectObjectWithRay(this._plane, _raycaster, true)\n\n      if (planeIntersect) {\n        let space = this.space\n\n        if (this.mode === \"scale\") {\n          space = \"local\"\n        } else if (this.axis === \"E\" || this.axis === \"XYZE\" || this.axis === \"XYZ\") {\n          space = \"world\"\n        }\n\n        if (space === \"local\" && this.mode === \"rotate\") {\n          const snap = this.rotationSnap\n\n          if (this.axis === \"X\" && snap)\n            this.object.rotation.x = Math.round(this.object.rotation.x / snap) * snap\n          if (this.axis === \"Y\" && snap)\n            this.object.rotation.y = Math.round(this.object.rotation.y / snap) * snap\n          if (this.axis === \"Z\" && snap)\n            this.object.rotation.z = Math.round(this.object.rotation.z / snap) * snap\n        }\n\n        this.object.updateMatrixWorld()\n        this.object.parent.updateMatrixWorld()\n\n        this._positionStart.copy(this.object.position)\n        this._quaternionStart.copy(this.object.quaternion)\n        this._scaleStart.copy(this.object.scale)\n\n        this.object.matrixWorld.decompose(\n          this.worldPositionStart,\n          this.worldQuaternionStart,\n          this._worldScaleStart\n        )\n\n        this.pointStart.copy(planeIntersect.point).sub(this.worldPositionStart)\n      }\n\n      this.dragging = true\n      _mouseDownEvent.mode = this.mode\n      this.dispatchEvent(_mouseDownEvent)\n    }\n  }\n\n  pointerMove(pointer) {\n    const axis = this.axis\n    const mode = this.mode\n    const object = this.object\n    let space = this.space\n\n    if (mode === \"scale\") {\n      space = \"local\"\n    } else if (axis === \"E\" || axis === \"XYZE\" || axis === \"XYZ\") {\n      space = \"world\"\n    }\n\n    if (\n      object === undefined ||\n      axis === null ||\n      this.dragging === false ||\n      pointer.button !== -1\n    )\n      return\n\n    _raycaster.setFromCamera(pointer, this.camera)\n\n    const planeIntersect = intersectObjectWithRay(this._plane, _raycaster, true)\n\n    if (!planeIntersect) return\n\n    this.pointEnd.copy(planeIntersect.point).sub(this.worldPositionStart)\n\n    if (mode === \"translate\") {\n      // Apply translate\n\n      this._offset.copy(this.pointEnd).sub(this.pointStart)\n\n      if (space === \"local\" && axis !== \"XYZ\") {\n        this._offset.applyQuaternion(this._worldQuaternionInv)\n      }\n\n      if (axis.indexOf(\"X\") === -1) this._offset.x = 0\n      if (axis.indexOf(\"Y\") === -1) this._offset.y = 0\n      if (axis.indexOf(\"Z\") === -1) this._offset.z = 0\n\n      if (space === \"local\" && axis !== \"XYZ\") {\n        this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale)\n      } else {\n        this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale)\n      }\n\n      object.position.copy(this._offset).add(this._positionStart)\n\n      // Apply translation snap\n\n      if (this.translationSnap) {\n        if (space === \"local\") {\n          object.position.applyQuaternion(\n            _tempQuaternion.copy(this._quaternionStart).invert()\n          )\n\n          if (axis.search(\"X\") !== -1) {\n            object.position.x =\n              Math.round(object.position.x / this.translationSnap) * this.translationSnap\n          }\n\n          if (axis.search(\"Y\") !== -1) {\n            object.position.y =\n              Math.round(object.position.y / this.translationSnap) * this.translationSnap\n          }\n\n          if (axis.search(\"Z\") !== -1) {\n            object.position.z =\n              Math.round(object.position.z / this.translationSnap) * this.translationSnap\n          }\n\n          object.position.applyQuaternion(this._quaternionStart)\n        }\n\n        if (space === \"world\") {\n          if (object.parent) {\n            object.position.add(\n              _tempVector.setFromMatrixPosition(object.parent.matrixWorld)\n            )\n          }\n\n          if (axis.search(\"X\") !== -1) {\n            object.position.x =\n              Math.round(object.position.x / this.translationSnap) * this.translationSnap\n          }\n\n          if (axis.search(\"Y\") !== -1) {\n            object.position.y =\n              Math.round(object.position.y / this.translationSnap) * this.translationSnap\n          }\n\n          if (axis.search(\"Z\") !== -1) {\n            object.position.z =\n              Math.round(object.position.z / this.translationSnap) * this.translationSnap\n          }\n\n          if (object.parent) {\n            object.position.sub(\n              _tempVector.setFromMatrixPosition(object.parent.matrixWorld)\n            )\n          }\n        }\n      }\n    } else if (mode === \"scale\") {\n      if (axis.search(\"XYZ\") !== -1) {\n        let d = this.pointEnd.length() / this.pointStart.length()\n\n        if (this.pointEnd.dot(this.pointStart) < 0) d *= -1\n\n        _tempVector2.set(d, d, d)\n      } else {\n        _tempVector.copy(this.pointStart)\n        _tempVector2.copy(this.pointEnd)\n\n        _tempVector.applyQuaternion(this._worldQuaternionInv)\n        _tempVector2.applyQuaternion(this._worldQuaternionInv)\n\n        _tempVector2.divide(_tempVector)\n\n        if (axis.search(\"X\") === -1) {\n          _tempVector2.x = 1\n        }\n\n        if (axis.search(\"Y\") === -1) {\n          _tempVector2.y = 1\n        }\n\n        if (axis.search(\"Z\") === -1) {\n          _tempVector2.z = 1\n        }\n      }\n\n      // Apply scale\n\n      object.scale.copy(this._scaleStart).multiply(_tempVector2)\n\n      if (this.scaleSnap) {\n        if (axis.search(\"X\") !== -1) {\n          object.scale.x =\n            Math.round(object.scale.x / this.scaleSnap) * this.scaleSnap || this.scaleSnap\n        }\n\n        if (axis.search(\"Y\") !== -1) {\n          object.scale.y =\n            Math.round(object.scale.y / this.scaleSnap) * this.scaleSnap || this.scaleSnap\n        }\n\n        if (axis.search(\"Z\") !== -1) {\n          object.scale.z =\n            Math.round(object.scale.z / this.scaleSnap) * this.scaleSnap || this.scaleSnap\n        }\n      }\n    } else if (mode === \"rotate\") {\n      this._offset.copy(this.pointEnd).sub(this.pointStart)\n\n      const ROTATION_SPEED =\n        20 /\n        this.worldPosition.distanceTo(\n          _tempVector.setFromMatrixPosition(this.camera.matrixWorld)\n        )\n\n      if (axis === \"E\") {\n        this.rotationAxis.copy(this.eye)\n        this.rotationAngle = this.pointEnd.angleTo(this.pointStart)\n\n        this._startNorm.copy(this.pointStart).normalize()\n        this._endNorm.copy(this.pointEnd).normalize()\n\n        this.rotationAngle *=\n          this._endNorm.cross(this._startNorm).dot(this.eye) < 0 ? 1 : -1\n      } else if (axis === \"XYZE\") {\n        this.rotationAxis.copy(this._offset).cross(this.eye).normalize()\n        this.rotationAngle =\n          this._offset.dot(_tempVector.copy(this.rotationAxis).cross(this.eye)) *\n          ROTATION_SPEED\n      } else if (axis === \"X\" || axis === \"Y\" || axis === \"Z\") {\n        this.rotationAxis.copy(_unit[axis])\n\n        _tempVector.copy(_unit[axis])\n\n        if (space === \"local\") {\n          _tempVector.applyQuaternion(this.worldQuaternion)\n        }\n\n        this.rotationAngle =\n          this._offset.dot(_tempVector.cross(this.eye).normalize()) * ROTATION_SPEED\n      }\n\n      // Apply rotation snap\n\n      if (this.rotationSnap)\n        this.rotationAngle =\n          Math.round(this.rotationAngle / this.rotationSnap) * this.rotationSnap\n\n      // Apply rotate\n      if (space === \"local\" && axis !== \"E\" && axis !== \"XYZE\") {\n        object.quaternion.copy(this._quaternionStart)\n        object.quaternion\n          .multiply(\n            _tempQuaternion.setFromAxisAngle(this.rotationAxis, this.rotationAngle)\n          )\n          .normalize()\n      } else {\n        this.rotationAxis.applyQuaternion(this._parentQuaternionInv)\n        object.quaternion.copy(\n          _tempQuaternion.setFromAxisAngle(this.rotationAxis, this.rotationAngle)\n        )\n        object.quaternion.multiply(this._quaternionStart).normalize()\n      }\n    }\n\n    this.dispatchEvent(_changeEvent)\n    this.dispatchEvent(_objectChangeEvent)\n  }\n\n  pointerUp(pointer) {\n    if (pointer.button !== 0) return\n\n    if (this.dragging && this.axis !== null) {\n      _mouseUpEvent.mode = this.mode\n      this.dispatchEvent(_mouseUpEvent)\n    }\n\n    this.dragging = false\n    this.axis = null\n  }\n\n  dispose() {\n    this.domElement.removeEventListener(\"pointerdown\", this._onPointerDown)\n    this.domElement.removeEventListener(\"pointermove\", this._onPointerHover)\n    this.domElement.removeEventListener(\"pointermove\", this._onPointerMove)\n    this.domElement.removeEventListener(\"pointerup\", this._onPointerUp)\n\n    this.traverse(function (child) {\n      if (child.geometry) child.geometry.dispose()\n      if (child.material) child.material.dispose()\n    })\n  }\n\n  // Set current object\n  attach(object) {\n    this.object = object\n    this.visible = true\n\n    return this\n  }\n\n  // Detatch from object\n  detach() {\n    this.object = undefined\n    this.visible = false\n    this.axis = null\n\n    return this\n  }\n\n  getRaycaster() {\n    return _raycaster\n  }\n\n  // TODO: deprecate\n\n  getMode() {\n    return this.mode\n  }\n\n  setMode(mode) {\n    this.mode = mode\n  }\n\n  setTranslationSnap(translationSnap) {\n    this.translationSnap = translationSnap\n  }\n\n  setRotationSnap(rotationSnap) {\n    this.rotationSnap = rotationSnap\n  }\n\n  setScaleSnap(scaleSnap) {\n    this.scaleSnap = scaleSnap\n  }\n\n  setSize(size) {\n    this.size = size\n  }\n\n  setSpace(space) {\n    this.space = space\n  }\n\n  update() {\n    console.warn(\n      \"THREE.TransformControls: update function has no more functionality and therefore has been deprecated.\"\n    )\n  }\n}\n\nTransformControls.prototype.isTransformControls = true\n\n// mouse / touch event handlers\n\nfunction getPointer(event) {\n  if (this.domElement.ownerDocument.pointerLockElement) {\n    return {\n      x: 0,\n      y: 0,\n      button: event.button,\n    }\n  } else {\n    const rect = this.domElement.getBoundingClientRect()\n\n    return {\n      x: ((event.clientX - rect.left) / rect.width) * 2 - 1,\n      y: (-(event.clientY - rect.top) / rect.height) * 2 + 1,\n      button: event.button,\n    }\n  }\n}\n\nfunction onPointerHover(event) {\n  if (!this.enabled) return\n\n  switch (event.pointerType) {\n    case \"mouse\":\n    case \"pen\":\n      this.pointerHover(this._getPointer(event))\n      break\n  }\n}\n\nfunction onPointerDown(event) {\n  if (!this.enabled) return\n\n  this.domElement.setPointerCapture(event.pointerId)\n\n  this.domElement.addEventListener(\"pointermove\", this._onPointerMove)\n\n  this.pointerHover(this._getPointer(event))\n  this.pointerDown(this._getPointer(event))\n}\n\nfunction onPointerMove(event) {\n  if (!this.enabled) return\n\n  this.pointerMove(this._getPointer(event))\n}\n\nfunction onPointerUp(event) {\n  if (!this.enabled) return\n\n  this.domElement.releasePointerCapture(event.pointerId)\n\n  this.domElement.removeEventListener(\"pointermove\", this._onPointerMove)\n\n  this.pointerUp(this._getPointer(event))\n}\n\nfunction intersectObjectWithRay(object, raycaster, includeInvisible) {\n  const allIntersections = raycaster.intersectObject(object, true)\n\n  for (let i = 0; i < allIntersections.length; i++) {\n    if (allIntersections[i].object.visible || includeInvisible) {\n      return allIntersections[i]\n    }\n  }\n\n  return false\n}\n\n//\n\n// Reusable utility variables\n\nconst _tempEuler = new Euler()\nconst _alignVector = new Vector3(0, 1, 0)\nconst _zeroVector = new Vector3(0, 0, 0)\nconst _lookAtMatrix = new Matrix4()\nconst _tempQuaternion2 = new Quaternion()\nconst _identityQuaternion = new Quaternion()\nconst _dirVector = new Vector3()\nconst _tempMatrix = new Matrix4()\n\nconst _unitX = new Vector3(1, 0, 0)\nconst _unitY = new Vector3(0, 1, 0)\nconst _unitZ = new Vector3(0, 0, 1)\n\nconst _v1 = new Vector3()\nconst _v2 = new Vector3()\nconst _v3 = new Vector3()\n\nclass TransformControlsGizmo extends Object3D {\n  constructor() {\n    super()\n\n    this.type = \"TransformControlsGizmo\"\n\n    // shared materials\n\n    const gizmoMaterial = new MeshBasicMaterial({\n      depthTest: false,\n      depthWrite: false,\n      fog: false,\n      toneMapped: false,\n      transparent: true,\n    })\n\n    const gizmoLineMaterial = new LineBasicMaterial({\n      depthTest: false,\n      depthWrite: false,\n      fog: false,\n      toneMapped: false,\n      transparent: true,\n    })\n\n    // Make unique material for each axis/color\n\n    const matInvisible = gizmoMaterial.clone()\n    matInvisible.opacity = 0.15\n\n    const matHelper = gizmoLineMaterial.clone()\n    matHelper.opacity = 0.5\n\n    const matRed = gizmoMaterial.clone()\n    matRed.color.setHex(0xff0000)\n\n    const matGreen = gizmoMaterial.clone()\n    matGreen.color.setHex(0x00ff00)\n\n    const matBlue = gizmoMaterial.clone()\n    matBlue.color.setHex(0x0000ff)\n\n    const matRedTransparent = gizmoMaterial.clone()\n    matRedTransparent.color.setHex(0xff0000)\n    matRedTransparent.opacity = 0.5\n\n    const matGreenTransparent = gizmoMaterial.clone()\n    matGreenTransparent.color.setHex(0x00ff00)\n    matGreenTransparent.opacity = 0.5\n\n    const matBlueTransparent = gizmoMaterial.clone()\n    matBlueTransparent.color.setHex(0x0000ff)\n    matBlueTransparent.opacity = 0.5\n\n    const matWhiteTransparent = gizmoMaterial.clone()\n    matWhiteTransparent.opacity = 0.25\n\n    const matYellowTransparent = gizmoMaterial.clone()\n    matYellowTransparent.color.setHex(0xffff00)\n    matYellowTransparent.opacity = 0.25\n\n    const matYellow = gizmoMaterial.clone()\n    matYellow.color.setHex(0xffff00)\n\n    const matGray = gizmoMaterial.clone()\n    matGray.color.setHex(0x787878)\n\n    // reusable geometry\n\n    const arrowGeometry = new CylinderGeometry(0, 0.04, 0.1, 12)\n    arrowGeometry.translate(0, 0.05, 0)\n\n    const scaleHandleGeometry = new BoxGeometry(0.08, 0.08, 0.08)\n    scaleHandleGeometry.translate(0, 0.04, 0)\n\n    const lineGeometry = new BufferGeometry()\n    lineGeometry.setAttribute(\n      \"position\",\n      new Float32BufferAttribute([0, 0, 0, 1, 0, 0], 3)\n    )\n\n    const lineGeometry2 = new CylinderGeometry(0.0075, 0.0075, 0.5, 3)\n    lineGeometry2.translate(0, 0.25, 0)\n\n    function CircleGeometry(radius, arc) {\n      const geometry = new TorusGeometry(radius, 0.0075, 3, 64, arc * Math.PI * 2)\n      geometry.rotateY(Math.PI / 2)\n      geometry.rotateX(Math.PI / 2)\n      return geometry\n    }\n\n    // Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n    function TranslateHelperGeometry() {\n      const geometry = new BufferGeometry()\n\n      geometry.setAttribute(\"position\", new Float32BufferAttribute([0, 0, 0, 1, 1, 1], 3))\n\n      return geometry\n    }\n\n    // Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n    const gizmoTranslate = {\n      X: [\n        [new Mesh(arrowGeometry, matRed), [0.5, 0, 0], [0, 0, -Math.PI / 2]],\n        [new Mesh(arrowGeometry, matRed), [-0.5, 0, 0], [0, 0, Math.PI / 2]],\n        [new Mesh(lineGeometry2, matRed), [0, 0, 0], [0, 0, -Math.PI / 2]],\n      ],\n      Y: [\n        [new Mesh(arrowGeometry, matGreen), [0, 0.5, 0]],\n        [new Mesh(arrowGeometry, matGreen), [0, -0.5, 0], [Math.PI, 0, 0]],\n        [new Mesh(lineGeometry2, matGreen)],\n      ],\n      Z: [\n        [new Mesh(arrowGeometry, matBlue), [0, 0, 0.5], [Math.PI / 2, 0, 0]],\n        [new Mesh(arrowGeometry, matBlue), [0, 0, -0.5], [-Math.PI / 2, 0, 0]],\n        [new Mesh(lineGeometry2, matBlue), null, [Math.PI / 2, 0, 0]],\n      ],\n      XYZ: [\n        [\n          new Mesh(new OctahedronGeometry(0.1, 0), matWhiteTransparent.clone()),\n          [0, 0, 0],\n        ],\n      ],\n      XY: [\n        [\n          new Mesh(new BoxGeometry(0.15, 0.15, 0.01), matBlueTransparent.clone()),\n          [0.15, 0.15, 0],\n        ],\n      ],\n      YZ: [\n        [\n          new Mesh(new BoxGeometry(0.15, 0.15, 0.01), matRedTransparent.clone()),\n          [0, 0.15, 0.15],\n          [0, Math.PI / 2, 0],\n        ],\n      ],\n      XZ: [\n        [\n          new Mesh(new BoxGeometry(0.15, 0.15, 0.01), matGreenTransparent.clone()),\n          [0.15, 0, 0.15],\n          [-Math.PI / 2, 0, 0],\n        ],\n      ],\n    }\n\n    const pickerTranslate = {\n      X: [\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [0.3, 0, 0],\n          [0, 0, -Math.PI / 2],\n        ],\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [-0.3, 0, 0],\n          [0, 0, Math.PI / 2],\n        ],\n      ],\n      Y: [\n        [new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible), [0, 0.3, 0]],\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [0, -0.3, 0],\n          [0, 0, Math.PI],\n        ],\n      ],\n      Z: [\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [0, 0, 0.3],\n          [Math.PI / 2, 0, 0],\n        ],\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [0, 0, -0.3],\n          [-Math.PI / 2, 0, 0],\n        ],\n      ],\n      XYZ: [[new Mesh(new OctahedronGeometry(0.2, 0), matInvisible)]],\n      XY: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.01), matInvisible), [0.15, 0.15, 0]]],\n      YZ: [\n        [\n          new Mesh(new BoxGeometry(0.2, 0.2, 0.01), matInvisible),\n          [0, 0.15, 0.15],\n          [0, Math.PI / 2, 0],\n        ],\n      ],\n      XZ: [\n        [\n          new Mesh(new BoxGeometry(0.2, 0.2, 0.01), matInvisible),\n          [0.15, 0, 0.15],\n          [-Math.PI / 2, 0, 0],\n        ],\n      ],\n    }\n\n    const helperTranslate = {\n      START: [\n        [\n          new Mesh(new OctahedronGeometry(0.01, 2), matHelper),\n          null,\n          null,\n          null,\n          \"helper\",\n        ],\n      ],\n      END: [\n        [\n          new Mesh(new OctahedronGeometry(0.01, 2), matHelper),\n          null,\n          null,\n          null,\n          \"helper\",\n        ],\n      ],\n      DELTA: [\n        [new Line(TranslateHelperGeometry(), matHelper), null, null, null, \"helper\"],\n      ],\n      X: [\n        [\n          new Line(lineGeometry, matHelper.clone()),\n          [-1e3, 0, 0],\n          null,\n          [1e6, 1, 1],\n          \"helper\",\n        ],\n      ],\n      Y: [\n        [\n          new Line(lineGeometry, matHelper.clone()),\n          [0, -1e3, 0],\n          [0, 0, Math.PI / 2],\n          [1e6, 1, 1],\n          \"helper\",\n        ],\n      ],\n      Z: [\n        [\n          new Line(lineGeometry, matHelper.clone()),\n          [0, 0, -1e3],\n          [0, -Math.PI / 2, 0],\n          [1e6, 1, 1],\n          \"helper\",\n        ],\n      ],\n    }\n\n    const gizmoRotate = {\n      XYZE: [[new Mesh(CircleGeometry(0.5, 1), matGray), null, [0, Math.PI / 2, 0]]],\n      X: [[new Mesh(CircleGeometry(0.5, 0.5), matRed)]],\n      Y: [[new Mesh(CircleGeometry(0.5, 0.5), matGreen), null, [0, 0, -Math.PI / 2]]],\n      Z: [[new Mesh(CircleGeometry(0.5, 0.5), matBlue), null, [0, Math.PI / 2, 0]]],\n      E: [\n        [\n          new Mesh(CircleGeometry(0.75, 1), matYellowTransparent),\n          null,\n          [0, Math.PI / 2, 0],\n        ],\n      ],\n    }\n\n    const helperRotate = {\n      AXIS: [\n        [\n          new Line(lineGeometry, matHelper.clone()),\n          [-1e3, 0, 0],\n          null,\n          [1e6, 1, 1],\n          \"helper\",\n        ],\n      ],\n    }\n\n    const pickerRotate = {\n      XYZE: [[new Mesh(new SphereGeometry(0.25, 10, 8), matInvisible)]],\n      X: [\n        [\n          new Mesh(new TorusGeometry(0.5, 0.1, 4, 24), matInvisible),\n          [0, 0, 0],\n          [0, -Math.PI / 2, -Math.PI / 2],\n        ],\n      ],\n      Y: [\n        [\n          new Mesh(new TorusGeometry(0.5, 0.1, 4, 24), matInvisible),\n          [0, 0, 0],\n          [Math.PI / 2, 0, 0],\n        ],\n      ],\n      Z: [\n        [\n          new Mesh(new TorusGeometry(0.5, 0.1, 4, 24), matInvisible),\n          [0, 0, 0],\n          [0, 0, -Math.PI / 2],\n        ],\n      ],\n      E: [[new Mesh(new TorusGeometry(0.75, 0.1, 2, 24), matInvisible)]],\n    }\n\n    const gizmoScale = {\n      X: [\n        [new Mesh(scaleHandleGeometry, matRed), [0.5, 0, 0], [0, 0, -Math.PI / 2]],\n        [new Mesh(lineGeometry2, matRed), [0, 0, 0], [0, 0, -Math.PI / 2]],\n        [new Mesh(scaleHandleGeometry, matRed), [-0.5, 0, 0], [0, 0, Math.PI / 2]],\n      ],\n      Y: [\n        [new Mesh(scaleHandleGeometry, matGreen), [0, 0.5, 0]],\n        [new Mesh(lineGeometry2, matGreen)],\n        [new Mesh(scaleHandleGeometry, matGreen), [0, -0.5, 0], [0, 0, Math.PI]],\n      ],\n      Z: [\n        [new Mesh(scaleHandleGeometry, matBlue), [0, 0, 0.5], [Math.PI / 2, 0, 0]],\n        [new Mesh(lineGeometry2, matBlue), [0, 0, 0], [Math.PI / 2, 0, 0]],\n        [new Mesh(scaleHandleGeometry, matBlue), [0, 0, -0.5], [-Math.PI / 2, 0, 0]],\n      ],\n      XY: [\n        [\n          new Mesh(new BoxGeometry(0.15, 0.15, 0.01), matBlueTransparent),\n          [0.15, 0.15, 0],\n        ],\n      ],\n      YZ: [\n        [\n          new Mesh(new BoxGeometry(0.15, 0.15, 0.01), matRedTransparent),\n          [0, 0.15, 0.15],\n          [0, Math.PI / 2, 0],\n        ],\n      ],\n      XZ: [\n        [\n          new Mesh(new BoxGeometry(0.15, 0.15, 0.01), matGreenTransparent),\n          [0.15, 0, 0.15],\n          [-Math.PI / 2, 0, 0],\n        ],\n      ],\n      XYZ: [[new Mesh(new BoxGeometry(0.1, 0.1, 0.1), matWhiteTransparent.clone())]],\n    }\n\n    const pickerScale = {\n      X: [\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [0.3, 0, 0],\n          [0, 0, -Math.PI / 2],\n        ],\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [-0.3, 0, 0],\n          [0, 0, Math.PI / 2],\n        ],\n      ],\n      Y: [\n        [new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible), [0, 0.3, 0]],\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [0, -0.3, 0],\n          [0, 0, Math.PI],\n        ],\n      ],\n      Z: [\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [0, 0, 0.3],\n          [Math.PI / 2, 0, 0],\n        ],\n        [\n          new Mesh(new CylinderGeometry(0.2, 0, 0.6, 4), matInvisible),\n          [0, 0, -0.3],\n          [-Math.PI / 2, 0, 0],\n        ],\n      ],\n      XY: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.01), matInvisible), [0.15, 0.15, 0]]],\n      YZ: [\n        [\n          new Mesh(new BoxGeometry(0.2, 0.2, 0.01), matInvisible),\n          [0, 0.15, 0.15],\n          [0, Math.PI / 2, 0],\n        ],\n      ],\n      XZ: [\n        [\n          new Mesh(new BoxGeometry(0.2, 0.2, 0.01), matInvisible),\n          [0.15, 0, 0.15],\n          [-Math.PI / 2, 0, 0],\n        ],\n      ],\n      XYZ: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.2), matInvisible), [0, 0, 0]]],\n    }\n\n    const helperScale = {\n      X: [\n        [\n          new Line(lineGeometry, matHelper.clone()),\n          [-1e3, 0, 0],\n          null,\n          [1e6, 1, 1],\n          \"helper\",\n        ],\n      ],\n      Y: [\n        [\n          new Line(lineGeometry, matHelper.clone()),\n          [0, -1e3, 0],\n          [0, 0, Math.PI / 2],\n          [1e6, 1, 1],\n          \"helper\",\n        ],\n      ],\n      Z: [\n        [\n          new Line(lineGeometry, matHelper.clone()),\n          [0, 0, -1e3],\n          [0, -Math.PI / 2, 0],\n          [1e6, 1, 1],\n          \"helper\",\n        ],\n      ],\n    }\n\n    // Creates an Object3D with gizmos described in custom hierarchy definition.\n\n    function setupGizmo(gizmoMap) {\n      const gizmo = new Object3D()\n\n      for (const name in gizmoMap) {\n        for (let i = gizmoMap[name].length; i--; ) {\n          const object = gizmoMap[name][i][0].clone()\n          const position = gizmoMap[name][i][1]\n          const rotation = gizmoMap[name][i][2]\n          const scale = gizmoMap[name][i][3]\n          const tag = gizmoMap[name][i][4]\n\n          // name and tag properties are essential for picking and updating logic.\n          object.name = name\n          object.tag = tag\n\n          if (position) {\n            object.position.set(position[0], position[1], position[2])\n          }\n\n          if (rotation) {\n            object.rotation.set(rotation[0], rotation[1], rotation[2])\n          }\n\n          if (scale) {\n            object.scale.set(scale[0], scale[1], scale[2])\n          }\n\n          object.updateMatrix()\n\n          const tempGeometry = object.geometry.clone()\n          tempGeometry.applyMatrix4(object.matrix)\n          object.geometry = tempGeometry\n          object.renderOrder = Infinity\n\n          object.position.set(0, 0, 0)\n          object.rotation.set(0, 0, 0)\n          object.scale.set(1, 1, 1)\n\n          gizmo.add(object)\n        }\n      }\n\n      return gizmo\n    }\n\n    // Gizmo creation\n\n    this.gizmo = {}\n    this.picker = {}\n    this.helper = {}\n\n    this.add((this.gizmo[\"translate\"] = setupGizmo(gizmoTranslate)))\n    this.add((this.gizmo[\"rotate\"] = setupGizmo(gizmoRotate)))\n    this.add((this.gizmo[\"scale\"] = setupGizmo(gizmoScale)))\n    this.add((this.picker[\"translate\"] = setupGizmo(pickerTranslate)))\n    this.add((this.picker[\"rotate\"] = setupGizmo(pickerRotate)))\n    this.add((this.picker[\"scale\"] = setupGizmo(pickerScale)))\n    this.add((this.helper[\"translate\"] = setupGizmo(helperTranslate)))\n    this.add((this.helper[\"rotate\"] = setupGizmo(helperRotate)))\n    this.add((this.helper[\"scale\"] = setupGizmo(helperScale)))\n\n    // Pickers should be hidden always\n\n    this.picker[\"translate\"].visible = false\n    this.picker[\"rotate\"].visible = false\n    this.picker[\"scale\"].visible = false\n  }\n\n  // updateMatrixWorld will update transformations and appearance of individual handles\n\n  updateMatrixWorld(force) {\n    const space = this.mode === \"scale\" ? \"local\" : this.space // scale always oriented to local rotation\n\n    const quaternion = space === \"local\" ? this.worldQuaternion : _identityQuaternion\n\n    // Show only gizmos for current transform mode\n\n    this.gizmo[\"translate\"].visible = this.mode === \"translate\"\n    this.gizmo[\"rotate\"].visible = this.mode === \"rotate\"\n    this.gizmo[\"scale\"].visible = this.mode === \"scale\"\n\n    this.helper[\"translate\"].visible = this.mode === \"translate\"\n    this.helper[\"rotate\"].visible = this.mode === \"rotate\"\n    this.helper[\"scale\"].visible = this.mode === \"scale\"\n\n    let handles = []\n    handles = handles.concat(this.picker[this.mode].children)\n    handles = handles.concat(this.gizmo[this.mode].children)\n    handles = handles.concat(this.helper[this.mode].children)\n\n    for (let i = 0; i < handles.length; i++) {\n      const handle = handles[i]\n\n      // hide aligned to camera\n\n      handle.visible = true\n      handle.rotation.set(0, 0, 0)\n      handle.position.copy(this.worldPosition)\n\n      let factor\n\n      if (this.camera.isOrthographicCamera) {\n        factor = (this.camera.top - this.camera.bottom) / this.camera.zoom\n      } else {\n        factor =\n          this.worldPosition.distanceTo(this.cameraPosition) *\n          Math.min(\n            (1.9 * Math.tan((Math.PI * this.camera.fov) / 360)) / this.camera.zoom,\n            7\n          )\n      }\n\n      handle.scale.set(1, 1, 1).multiplyScalar((factor * this.size) / 4)\n\n      // TODO: simplify helpers and consider decoupling from gizmo\n\n      if (handle.tag === \"helper\") {\n        handle.visible = false\n\n        if (handle.name === \"AXIS\") {\n          handle.position.copy(this.worldPositionStart)\n          handle.visible = !!this.axis\n\n          if (this.axis === \"X\") {\n            _tempQuaternion.setFromEuler(_tempEuler.set(0, 0, 0))\n            handle.quaternion.copy(quaternion).multiply(_tempQuaternion)\n\n            if (\n              Math.abs(\n                _alignVector.copy(_unitX).applyQuaternion(quaternion).dot(this.eye)\n              ) > 0.9\n            ) {\n              handle.visible = false\n            }\n          }\n\n          if (this.axis === \"Y\") {\n            _tempQuaternion.setFromEuler(_tempEuler.set(0, 0, Math.PI / 2))\n            handle.quaternion.copy(quaternion).multiply(_tempQuaternion)\n\n            if (\n              Math.abs(\n                _alignVector.copy(_unitY).applyQuaternion(quaternion).dot(this.eye)\n              ) > 0.9\n            ) {\n              handle.visible = false\n            }\n          }\n\n          if (this.axis === \"Z\") {\n            _tempQuaternion.setFromEuler(_tempEuler.set(0, Math.PI / 2, 0))\n            handle.quaternion.copy(quaternion).multiply(_tempQuaternion)\n\n            if (\n              Math.abs(\n                _alignVector.copy(_unitZ).applyQuaternion(quaternion).dot(this.eye)\n              ) > 0.9\n            ) {\n              handle.visible = false\n            }\n          }\n\n          if (this.axis === \"XYZE\") {\n            _tempQuaternion.setFromEuler(_tempEuler.set(0, Math.PI / 2, 0))\n            _alignVector.copy(this.rotationAxis)\n            handle.quaternion.setFromRotationMatrix(\n              _lookAtMatrix.lookAt(_zeroVector, _alignVector, _unitY)\n            )\n            handle.quaternion.multiply(_tempQuaternion)\n            handle.visible = this.dragging\n          }\n\n          if (this.axis === \"E\") {\n            handle.visible = false\n          }\n        } else if (handle.name === \"START\") {\n          handle.position.copy(this.worldPositionStart)\n          handle.visible = this.dragging\n        } else if (handle.name === \"END\") {\n          handle.position.copy(this.worldPosition)\n          handle.visible = this.dragging\n        } else if (handle.name === \"DELTA\") {\n          handle.position.copy(this.worldPositionStart)\n          handle.quaternion.copy(this.worldQuaternionStart)\n          _tempVector\n            .set(1e-10, 1e-10, 1e-10)\n            .add(this.worldPositionStart)\n            .sub(this.worldPosition)\n            .multiplyScalar(-1)\n          _tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert())\n          handle.scale.copy(_tempVector)\n          handle.visible = this.dragging\n        } else {\n          handle.quaternion.copy(quaternion)\n\n          if (this.dragging) {\n            handle.position.copy(this.worldPositionStart)\n          } else {\n            handle.position.copy(this.worldPosition)\n          }\n\n          if (this.axis) {\n            handle.visible = this.axis.search(handle.name) !== -1\n          }\n        }\n\n        // If updating helper, skip rest of the loop\n        continue\n      }\n\n      // Align handles to current local or world rotation\n\n      handle.quaternion.copy(quaternion)\n\n      if (this.mode === \"translate\" || this.mode === \"scale\") {\n        // Hide translate and scale axis facing the camera\n\n        const AXIS_HIDE_TRESHOLD = 0.99\n        const PLANE_HIDE_TRESHOLD = 0.2\n\n        if (handle.name === \"X\") {\n          if (\n            Math.abs(\n              _alignVector.copy(_unitX).applyQuaternion(quaternion).dot(this.eye)\n            ) > AXIS_HIDE_TRESHOLD\n          ) {\n            handle.scale.set(1e-10, 1e-10, 1e-10)\n            handle.visible = false\n          }\n        }\n\n        if (handle.name === \"Y\") {\n          if (\n            Math.abs(\n              _alignVector.copy(_unitY).applyQuaternion(quaternion).dot(this.eye)\n            ) > AXIS_HIDE_TRESHOLD\n          ) {\n            handle.scale.set(1e-10, 1e-10, 1e-10)\n            handle.visible = false\n          }\n        }\n\n        if (handle.name === \"Z\") {\n          if (\n            Math.abs(\n              _alignVector.copy(_unitZ).applyQuaternion(quaternion).dot(this.eye)\n            ) > AXIS_HIDE_TRESHOLD\n          ) {\n            handle.scale.set(1e-10, 1e-10, 1e-10)\n            handle.visible = false\n          }\n        }\n\n        if (handle.name === \"XY\") {\n          if (\n            Math.abs(\n              _alignVector.copy(_unitZ).applyQuaternion(quaternion).dot(this.eye)\n            ) < PLANE_HIDE_TRESHOLD\n          ) {\n            handle.scale.set(1e-10, 1e-10, 1e-10)\n            handle.visible = false\n          }\n        }\n\n        if (handle.name === \"YZ\") {\n          if (\n            Math.abs(\n              _alignVector.copy(_unitX).applyQuaternion(quaternion).dot(this.eye)\n            ) < PLANE_HIDE_TRESHOLD\n          ) {\n            handle.scale.set(1e-10, 1e-10, 1e-10)\n            handle.visible = false\n          }\n        }\n\n        if (handle.name === \"XZ\") {\n          if (\n            Math.abs(\n              _alignVector.copy(_unitY).applyQuaternion(quaternion).dot(this.eye)\n            ) < PLANE_HIDE_TRESHOLD\n          ) {\n            handle.scale.set(1e-10, 1e-10, 1e-10)\n            handle.visible = false\n          }\n        }\n      } else if (this.mode === \"rotate\") {\n        // Align handles to current local or world rotation\n\n        _tempQuaternion2.copy(quaternion)\n        _alignVector\n          .copy(this.eye)\n          .applyQuaternion(_tempQuaternion.copy(quaternion).invert())\n\n        if (handle.name.search(\"E\") !== -1) {\n          handle.quaternion.setFromRotationMatrix(\n            _lookAtMatrix.lookAt(this.eye, _zeroVector, _unitY)\n          )\n        }\n\n        if (handle.name === \"X\") {\n          _tempQuaternion.setFromAxisAngle(\n            _unitX,\n            Math.atan2(-_alignVector.y, _alignVector.z)\n          )\n          _tempQuaternion.multiplyQuaternions(_tempQuaternion2, _tempQuaternion)\n          handle.quaternion.copy(_tempQuaternion)\n        }\n\n        if (handle.name === \"Y\") {\n          _tempQuaternion.setFromAxisAngle(\n            _unitY,\n            Math.atan2(_alignVector.x, _alignVector.z)\n          )\n          _tempQuaternion.multiplyQuaternions(_tempQuaternion2, _tempQuaternion)\n          handle.quaternion.copy(_tempQuaternion)\n        }\n\n        if (handle.name === \"Z\") {\n          _tempQuaternion.setFromAxisAngle(\n            _unitZ,\n            Math.atan2(_alignVector.y, _alignVector.x)\n          )\n          _tempQuaternion.multiplyQuaternions(_tempQuaternion2, _tempQuaternion)\n          handle.quaternion.copy(_tempQuaternion)\n        }\n      }\n\n      // Hide disabled axes\n      handle.visible = handle.visible && (handle.name.indexOf(\"X\") === -1 || this.showX)\n      handle.visible = handle.visible && (handle.name.indexOf(\"Y\") === -1 || this.showY)\n      handle.visible = handle.visible && (handle.name.indexOf(\"Z\") === -1 || this.showZ)\n      handle.visible =\n        handle.visible &&\n        (handle.name.indexOf(\"E\") === -1 || (this.showX && this.showY && this.showZ))\n\n      // highlight selected axis\n\n      handle.material._color = handle.material._color || handle.material.color.clone()\n      handle.material._opacity = handle.material._opacity || handle.material.opacity\n\n      handle.material.color.copy(handle.material._color)\n      handle.material.opacity = handle.material._opacity\n\n      if (this.enabled && this.axis) {\n        if (handle.name === this.axis) {\n          handle.material.color.setHex(0xffff00)\n          handle.material.opacity = 1.0\n        } else if (\n          this.axis.split(\"\").some(function (a) {\n            return handle.name === a\n          })\n        ) {\n          handle.material.color.setHex(0xffff00)\n          handle.material.opacity = 1.0\n        }\n      }\n    }\n\n    super.updateMatrixWorld(force)\n  }\n}\n\nTransformControlsGizmo.prototype.isTransformControlsGizmo = true\n\n//\n\nclass TransformControlsPlane extends Mesh {\n  constructor() {\n    super(\n      new PlaneGeometry(100000, 100000, 2, 2),\n      new MeshBasicMaterial({\n        visible: false,\n        wireframe: true,\n        side: DoubleSide,\n        transparent: true,\n        opacity: 0.1,\n        toneMapped: false,\n      })\n    )\n\n    this.type = \"TransformControlsPlane\"\n  }\n\n  updateMatrixWorld(force) {\n    let space = this.space\n\n    this.position.copy(this.worldPosition)\n\n    if (this.mode === \"scale\") space = \"local\" // scale always oriented to local rotation\n\n    _v1\n      .copy(_unitX)\n      .applyQuaternion(space === \"local\" ? this.worldQuaternion : _identityQuaternion)\n    _v2\n      .copy(_unitY)\n      .applyQuaternion(space === \"local\" ? this.worldQuaternion : _identityQuaternion)\n    _v3\n      .copy(_unitZ)\n      .applyQuaternion(space === \"local\" ? this.worldQuaternion : _identityQuaternion)\n\n    // Align the plane for current transform mode, axis and space.\n\n    _alignVector.copy(_v2)\n\n    switch (this.mode) {\n      case \"translate\":\n      case \"scale\":\n        switch (this.axis) {\n          case \"X\":\n            _alignVector.copy(this.eye).cross(_v1)\n            _dirVector.copy(_v1).cross(_alignVector)\n            break\n          case \"Y\":\n            _alignVector.copy(this.eye).cross(_v2)\n            _dirVector.copy(_v2).cross(_alignVector)\n            break\n          case \"Z\":\n            _alignVector.copy(this.eye).cross(_v3)\n            _dirVector.copy(_v3).cross(_alignVector)\n            break\n          case \"XY\":\n            _dirVector.copy(_v3)\n            break\n          case \"YZ\":\n            _dirVector.copy(_v1)\n            break\n          case \"XZ\":\n            _alignVector.copy(_v3)\n            _dirVector.copy(_v2)\n            break\n          case \"XYZ\":\n          case \"E\":\n            _dirVector.set(0, 0, 0)\n            break\n        }\n\n        break\n      case \"rotate\":\n      default:\n        // special case for rotate\n        _dirVector.set(0, 0, 0)\n    }\n\n    if (_dirVector.length() === 0) {\n      // If in rotate mode, make the plane parallel to camera\n      this.quaternion.copy(this.cameraQuaternion)\n    } else {\n      _tempMatrix.lookAt(_tempVector.set(0, 0, 0), _dirVector, _alignVector)\n\n      this.quaternion.setFromRotationMatrix(_tempMatrix)\n    }\n\n    super.updateMatrixWorld(force)\n  }\n}\n\nTransformControlsPlane.prototype.isTransformControlsPlane = true\n\nexport { TransformControls, TransformControlsGizmo, TransformControlsPlane }\n","import * as THREE from \"three\"\nimport { FlyControls } from \"../controls/FlyControls\"\nimport { OrbitControls } from \"../controls/OrbitControls\"\nimport { TransformControls } from \"../controls/TransformControls\"\nimport SceneManager from \"./SceneManager\"\nimport { recursiveSetHelper } from \"./utils\"\n\nexport default class ControlsManager {\n  public static instance: ControlsManager\n  private controls: any\n  private transformControls!: THREE.Object3D\n\n  constructor() {\n    if (ControlsManager.instance) return\n    ControlsManager.instance = this\n  }\n\n  setControls(type: Engine.ControlType, camera: THREE.Camera, domElement: HTMLElement) {\n    if (this.controls) {\n      return\n    }\n    switch (type) {\n      case \"fly\":\n        this._setFlyControls(camera, domElement)\n        break\n      case \"orbit\":\n        this._setOrbitControls(camera, domElement)\n        break\n      default:\n        console.warn(`Control type: ${type} not found`)\n        break\n    }\n    this._initTransformControls(camera, domElement)\n  }\n\n  lookAt(target: THREE.Vector3) {}\n\n  enableControls() {\n    if (this.controls) this.controls.enabled = true\n  }\n\n  disableControls() {\n    if (this.controls) this.controls.enabled = false\n  }\n\n  private _setFlyControls(camera: THREE.Camera, domElement: HTMLElement) {\n    if (this.controls) this.controls.enabled = false\n    this.controls = new FlyControls(camera, domElement)\n    this.controls.movementSpeed = 33\n  }\n\n  private _setOrbitControls(camera: THREE.Camera, domElement: HTMLElement) {\n    if (this.controls) {\n      // this.controls.enabled = false;\n      return\n    }\n    this.controls = new OrbitControls(camera, domElement)\n    this.controls.listenToKeyEvents(window)\n  }\n\n  private _initTransformControls(camera: THREE.Camera, domElement: HTMLElement) {\n    this.transformControls = new TransformControls(camera, domElement) as THREE.Object3D\n    recursiveSetHelper(this.transformControls, \"helper-block\")\n\n    SceneManager.instance.addTransformControlsToScene(this.transformControls)\n\n    //  - Event listeners -\n\n    // Updates position transform of object\n    this.transformControls.addEventListener(\"change\", (e: any) => {\n      const object = e.target.object\n      if (!object) return\n      const objectID = object.uuid\n      const updatedTransformComponent: Engine.ComponentProps = {\n        position: { x: object.position.x, y: object.position.y, z: object.position.z },\n        rotation: { x: object.rotation.x, y: object.rotation.y, z: object.rotation.z },\n        scale: { x: object.scale.x, y: object.scale.y, z: object.scale.z },\n      }\n      const entityProps = SceneManager.instance.getSelectedEntityPayload()\n      if (entityProps && entityProps.id === object.uuid) {\n        entityProps.components.Transform = updatedTransformComponent\n        SceneManager.instance.updateEntityPayload(objectID, entityProps)\n      }\n    })\n\n    // Disabled external controls when using transform controls\n    this.transformControls.addEventListener(\"dragging-changed\", (e: any) => {\n      this.controls.enabled = !e.value\n    })\n\n    // Key controls\n    window.addEventListener(\"keydown\", (event) => {\n      const tControls = this.transformControls as any\n      switch (event.key.toLowerCase()) {\n        case \"w\":\n          tControls.setMode(\"translate\")\n          break\n        case \"e\":\n          tControls.setMode(\"rotate\")\n          break\n        case \"r\":\n          tControls.setMode(\"scale\")\n          break\n        case \"shift\":\n          tControls.setTranslationSnap(2)\n          tControls.setRotationSnap(THREE.MathUtils.degToRad(15))\n          tControls.setScaleSnap(0.25)\n          break\n        default:\n          break\n      }\n    })\n\n    window.addEventListener(\"keyup\", (event) => {\n      const tControls = this.transformControls as any\n      switch (event.key.toLowerCase()) {\n        case \"shift\":\n          tControls.setTranslationSnap(null)\n          tControls.setRotationSnap(null)\n          tControls.setScaleSnap(null)\n          break\n        default:\n          break\n      }\n    })\n  }\n\n  addObjectControls(object: THREE.Object3D) {\n    if (this.transformControls) {\n      this.transformControls.attach(object)\n    }\n  }\n\n  removeObjectControls() {\n    if (this.transformControls) {\n      // @ts-ignore\n      this.transformControls.detach()\n    }\n  }\n\n  updateControls(deltaTime: number) {\n    if (this.controls) this.controls.update(deltaTime)\n  }\n}\n","import * as THREE from \"three\"\nimport Component from \"./Component\"\nimport Entity from \"./Entity\"\ninterface ITransformProps {\n  position?: THREE.Vector3\n  rotation?: THREE.Euler\n  scale?: THREE.Vector3\n}\n\nexport default class Transform extends Component {\n  entity: Entity\n  _object: THREE.Object3D\n\n  // <@public>\n  public position: THREE.Vector3 = new THREE.Vector3(0, 0, 0)\n  public rotation: THREE.Euler = new THREE.Euler(0, 0, 0, \"XYZ\")\n  public scale: THREE.Vector3 = new THREE.Vector3(1, 1, 1)\n  // </@public>\n\n  constructor(entity: Entity) {\n    super(entity)\n    this.entity = entity\n    this._object = this.entity.getObject() as THREE.Object3D\n  }\n\n  init(props?: ITransformProps) {\n    this.position = props?.position ?? this.position\n    this.rotation = props?.rotation ?? this.rotation\n    this.scale = props?.scale ?? this.scale\n    this.applyMatrix()\n  }\n\n  start() {\n    this.applyMatrix()\n  }\n\n  private applyPosition() {\n    this._object.position.set(this.position.x, this.position.y, this.position.z)\n  }\n\n  private applyRotation() {\n    this._object.setRotationFromEuler(\n      new THREE.Euler(this.rotation.x, this.rotation.y, this.rotation.z)\n    )\n  }\n\n  private applyScale() {\n    this._object.scale.set(this.scale.x, this.scale.y, this.scale.z)\n  }\n\n  private applyMatrix() {\n    if (!this.entity) {\n      return\n    }\n    this.applyPosition()\n    this.applyRotation()\n    this.applyScale()\n  }\n\n  update() {\n    this.applyMatrix()\n  }\n}\n","import * as THREE from 'three';\nimport Transform from \"./Transform\";\nimport { BaseComponentType } from \"./Component\";\nimport Entity from \"./Entity\";\nexport default class ComponentManager {\n  public static instance: ComponentManager;\n  private components: { [key: string]: { constructor: BaseComponentType, props: Engine.ComponentProps } } = {};\n\n  constructor() {\n    if (ComponentManager.instance) return;\n    ComponentManager.instance = this;\n\n    this.registerComponent(\"Transform\", Transform, {\n      position: { x: 0, y: 0, z: 0 },\n      rotation: { x: 0, y: 0, z: 0 },\n      scale: { x: 1, y: 1, z: 1 },\n    });\n  }\n\n  public getComponents() {\n    return { ...this.components };\n  };\n\n  public registerComponent(componentName: string, component: BaseComponentType, props: Engine.ComponentProps): void {\n    this.components[componentName] = { constructor: component, props };\n  };\n\n  public getComponentProps(name: Engine.ComponentType): Engine.ComponentProps | null {\n    const componentProps = this.components[name]?.props ?? null;\n    if (!componentProps) {\n      return null;\n    }\n    return componentProps;\n  }\n\n  private getComponent(name: Engine.ComponentType): BaseComponentType | null {\n    return this.components[name]?.constructor ?? null;\n  }\n\n  public setComponent(entity: Entity, componentType: Engine.ComponentType, componentProps: Engine.ComponentProps): void {\n    \n    const component = this.getComponent(componentType);\n    if (!component) {\n      console.error(`Component ${componentType} not found`);\n      return;\n    }\n\n    // Translate vector props \n    Object.entries(componentProps).forEach(([name, prop]) => {\n      if (Array.isArray(prop)) {\n        if (prop.length === 3) {\n          componentProps[name] = new THREE.Vector3(prop[0], prop[1], prop[2]) as any;\n        }\n        else if (prop.length === 2) {\n          componentProps[name] = new THREE.Vector2(prop[0], prop[1]) as any;\n        }\n      }\n    });\n    const componentInstance = new component(entity);\n    try {\n      componentInstance.init(componentProps);\n      entity.components[componentType] = componentInstance;\n    } catch (e) {\n      console.error('Error whilst initializing component', e);\n    }\n  }\n\n  public renameComponent(newComponentName: string, oldComponentName: string) {\n    const component = this.components[oldComponentName];\n    if (!component) {\n      console.error(`Component ${oldComponentName} not found`);\n      return;\n    }\n    this.components[newComponentName] = component;\n    delete this.components[oldComponentName];\n  }\n}","import * as THREE from \"three\"\nimport SceneManager from \"./SceneManager\"\n\nexport default class MaterialManager {\n  public static instance: MaterialManager\n  materials: Record<Engine.MaterialType, THREE.Material> = {\n    normal: new THREE.MeshNormalMaterial(),\n    basic: new THREE.MeshBasicMaterial(),\n    phong: new THREE.MeshPhongMaterial(),\n    lambert: new THREE.MeshLambertMaterial(),\n    wireframe: new THREE.MeshBasicMaterial({ wireframe: true }),\n  }\n\n  constructor() {\n    if (MaterialManager.instance) return\n    MaterialManager.instance = this\n  }\n\n  getMaterial(type: Engine.MaterialType): THREE.Material {\n    return this.materials[type] ?? this.materials.basic\n  }\n\n  addCustomMaterial(materialPayload: Engine.Material): void {\n    // true when an existing custom material is edited, and must refresh materials for each entity that uses it\n    let mustRefreshEntities = false\n\n    const mat = materialPayload.material\n    const matchingMaterial = Object.values(this.materials).find(\n      (m) => m.uuid === materialPayload.id\n    )\n\n    if (matchingMaterial) {\n      matchingMaterial.dispose()\n      mustRefreshEntities = true;\n    }\n\n    const newMaterial = new THREE.ShaderMaterial({\n      uniforms: { ...mat.uniforms, time: { value: 0.0 } },\n      vertexShader: materialPayload.vertexShader,\n      fragmentShader: materialPayload.fragmentShader,\n    })\n\n    newMaterial.uuid = materialPayload.id\n    this.materials[mat.name] = newMaterial\n\n    if (mustRefreshEntities) {\n      SceneManager.instance.refreshEntitiesMaterial(newMaterial)\n    }\n  }\n}\n","import * as THREE from \"three\"\nimport ControlsManager from \"./ControlsManager\"\nimport SceneManager from \"./SceneManager\"\n\nexport default class CameraManager {\n  public static instance: CameraManager\n  public renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true })\n  private renderElement: HTMLElement | undefined\n  private raycaster: THREE.Raycaster = new THREE.Raycaster()\n  private fov = 60\n  private near = 0.01\n  private far = 20000\n  private camera!: THREE.PerspectiveCamera\n  private editCamera!: THREE.PerspectiveCamera\n  private sceneCamera: THREE.PerspectiveCamera | undefined\n  private currentControls: Engine.ControlType = \"orbit\"\n  private clock = new THREE.Clock()\n\n  constructor() {\n    if (CameraManager.instance) return CameraManager.instance\n    CameraManager.instance = this\n    this.editCamera = new THREE.PerspectiveCamera(\n      this.fov,\n      window.innerWidth / window.innerHeight,\n      this.near,\n      this.far\n    )\n    this._setCamera(this.editCamera)\n    window.addEventListener(\"resize\", () => this.handleResize())\n  }\n\n  setup(renderElement: HTMLElement, scene: THREE.Scene) {\n    this.renderElement = renderElement\n    this.renderElement.appendChild(this.renderer.domElement)\n    this._setRenderer()\n    this._setControls()\n    this._setRaycaster()\n    this._runSceneLoop(scene)\n    this.handleResize()\n  }\n\n  useSceneCamera(sceneCamera: THREE.PerspectiveCamera) {\n    this.sceneCamera = sceneCamera\n    this._setCamera(this.sceneCamera)\n  }\n\n  useEditCamera() {\n    this._setCamera(this.editCamera)\n  }\n\n  handleClick(mouseX: number, mouseY: number) {\n    const pointer = new THREE.Vector2(mouseX, mouseY)\n    this.raycaster.setFromCamera(pointer, this.camera)\n    const intersects = this.raycaster.intersectObjects(\n      SceneManager.instance.getScene().children,\n      true\n    )\n\n    const withoutHelpers = intersects.filter((e) => e.object.type !== \"helper\")\n    if (withoutHelpers.length > 0) {\n      if (withoutHelpers[0].object.type === \"helper-block\") {\n        if (withoutHelpers.length === 1) {\n          SceneManager.instance.deselect()\n          return;\n        } else if (SceneManager.instance.getSelectedEntity()) {\n          return;\n        }\n      }\n\n      const objectSelect = intersects.find(\n        (e) => e.object.type === \"Mesh\" || e.object.type === \"PointLightHelper\"\n      )\n\n      if (!objectSelect) {\n        return\n      }\n\n      if (objectSelect.object.type === \"Mesh\") {\n        SceneManager.instance.select(objectSelect.object)\n      } else if (objectSelect.object.type === \"PointLightHelper\") {\n        SceneManager.instance.selectByID(objectSelect.object.uuid)\n      }\n    }\n\n    if (intersects.length === 0) {\n      SceneManager.instance.deselect()\n    }\n  }\n\n  private _setCamera(cam: THREE.PerspectiveCamera) {\n    this.camera = cam\n    this.camera.position.y = 10\n    this.camera.rotation.x = -0.1\n    this.camera.position.z = 50\n  }\n\n  private _runSceneLoop(scene: THREE.Scene) {\n    this.renderer.setAnimationLoop((time: number) => this.update(scene))\n  }\n\n  private _setRaycaster() {\n    this.raycaster = new THREE.Raycaster()\n  }\n\n  private _setControls() {\n    if (!this.renderElement) {\n      return\n    }\n    ControlsManager.instance.setControls(\n      this.currentControls,\n      this.camera,\n      this.renderer.domElement\n    )\n  }\n\n  private _setRenderer() {\n    if (!this.renderElement) return\n    this.renderer.setSize(this.renderElement.clientWidth, this.renderElement.clientHeight)\n    this.renderer.toneMapping = THREE.ReinhardToneMapping\n    this.renderer.toneMappingExposure = 2\n    this.renderer.shadowMap.enabled = true\n    this.renderer.shadowMap.type = THREE.BasicShadowMap\n    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap\n  }\n\n  getAspect() {\n    return this.camera.aspect\n  }\n\n  handleResize() {\n    if (!this.renderElement) return\n    const dimensions = this.renderElement.getBoundingClientRect()\n    const w = this.renderElement?.offsetParent?.clientWidth ?? dimensions.width\n    const h = this.renderElement?.offsetParent?.clientHeight ?? dimensions.height\n    this.camera.aspect = w / h\n    this.camera.updateProjectionMatrix()\n    this.renderer.setSize(w, h)\n    this.renderer.setPixelRatio(window.devicePixelRatio)\n  }\n\n  update(scene: THREE.Scene) {\n    this.renderer.render(scene, this.camera)\n    const deltaTime = this.clock.getDelta()\n    const elapsedTime = this.clock.getElapsedTime()\n    SceneManager.instance.updateScene(deltaTime, elapsedTime)\n    ControlsManager.instance.updateControls(deltaTime)\n  }\n}\n","import * as THREE from \"three\"\nimport { v4 as uuidv4 } from \"uuid\"\n\nconst COMPONENT_DEF = `// @defineComponent`\nconst BASE_COMPONENT_SCRIPT_CONTENT = `class Component {\n  \n  // <public>\n\n  // </public>\n\n  ${COMPONENT_DEF}\n\n  start() {\n    \n  }\n\n  update() {\n\n  }\n}`\n\nconst BASE_VERTEX_SHADER_CONTENT = `// -- Injected uniforms / attributes --\n// uniform mat4 modelMatrix; // object.matrixWorld\n// uniform mat4 modelViewMatrix; // camera.matrixWorld * object.matrixWorld\n// uniform mat4 projectionMatrix; // camera.projectionMatrix\n// uniform mat4 viewMatrix; // camera.matrixWorld\n// uniform mat3 normalMatrix; // camera.matrixWorldInverse.transpose()\n// uniform vec3 cameraPosition; // camera.position\n\n// attribute vec3 position;\n// attribute vec3 normal;\n// attribute vec2 uv;\n// -- Able to delete above, but do not uncomment --\n\nuniform float time;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}`\n\nconst BASE_FRAGMENT_SHADER_CONTENT = `// -- Injected uniforms / attributes --\n// uniform mat4 viewMatrix;\n// uniform vec3 cameraPosition;\n// -- Able to delete above, but do not uncomment --\nuniform float time;\n\nvoid main() {\n  gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n}`\n\nexport const generateNewScript = (\n  name: string,\n  language: Engine.Language,\n  type: Engine.ScriptType\n): Engine.Script => {\n  const id = uuidv4()\n  let content = BASE_COMPONENT_SCRIPT_CONTENT\n\n  switch (type) {\n    case \"component\":\n      content = BASE_COMPONENT_SCRIPT_CONTENT\n      break\n    case \"vertex\":\n      content = BASE_VERTEX_SHADER_CONTENT\n      break\n    case \"fragment\":\n      content = BASE_FRAGMENT_SHADER_CONTENT\n      break\n    default:\n      break\n  }\n\n  return {\n    id,\n    name,\n    language,\n    content,\n    type,\n  }\n}\n\nconst initPropPlaceholder = \"// <initPropPlaceholder />\"\n\nexport const formatScriptString = (script: Engine.Script): string => {\n  const formatted = `(${script.content})`\n  return formatted.replace(\n    COMPONENT_DEF,\n    `\n          entity;\n        \n          constructor(entity) {\n            this.entity = entity;\n          }\n\n          ${initPropPlaceholder}\n        `\n  )\n}\n\nexport const injectInitSection = (\n  scriptBody: string,\n  props: Record<string, Engine.ComponentPropType>\n): string => {\n  const actualInitSection = `\n  init(props) {\n    this.transform = this.entity.getComponent('Transform');\n    ${Object.entries(props)\n      .map(([key, value]) => `this.${key} = props?.${key} ?? ${value};`)\n      .join(\"\\n\")}\n  }`\n  return scriptBody.replace(initPropPlaceholder, actualInitSection)\n}\n\nexport const generateNewMaterial = (\n  name: string,\n  vertexShaderID: string,\n  fragmentShaderID: string\n): Engine.MaterialProps => {\n  const id = uuidv4()\n  return {\n    id,\n    name,\n    vertexShaderID: vertexShaderID,\n    fragmentShaderID: fragmentShaderID,\n    uniforms: {},\n  }\n}\n","export const recursiveSetHelper = (object: THREE.Object3D, type: 'helper' | 'helper-block' = 'helper') => {\n  if (!object) return;\n  object.type = type\n  object.children.forEach(child => recursiveSetHelper(child, type))\n}\n","import * as THREE from \"three\"\n\nconst planeBufferGeometry = new THREE.PlaneBufferGeometry(5, 5)\nplaneBufferGeometry.rotateX(-Math.PI / 2)\nplaneBufferGeometry.scale(5, 1, 5);\nexport default class GeometryManager {\n  public static instance: GeometryManager\n  geometries: Record<Engine.GeometryType, THREE.BufferGeometry> = {\n    box: new THREE.BoxBufferGeometry(),\n    sphere: new THREE.SphereBufferGeometry(1, 16, 16),\n    cylinder: new THREE.CylinderBufferGeometry(1, 1, 1, 16, 1),\n    torus: new THREE.TorusBufferGeometry(6, 1.1, 10, 32, 6.3),\n    plane: planeBufferGeometry,\n    tetrahedron: new THREE.TetrahedronBufferGeometry(),\n    octahedron: new THREE.OctahedronBufferGeometry(),\n    dodecahedron: new THREE.DodecahedronBufferGeometry(),\n    icosahedron: new THREE.IcosahedronBufferGeometry(),\n  }\n\n  constructor() {\n    if (GeometryManager.instance) return\n    GeometryManager.instance = this\n  }\n\n  getGeometry(type: Engine.GeometryType): THREE.BufferGeometry {\n    return this.geometries[type] ?? this.geometries.box\n  }\n}\n","import { v4 as uuidv4 } from 'uuid';\nexport const generateNewEntity = (): Engine.EntityProps => {\n  const id = uuidv4();\n  return {\n    id,\n    name: \"New Entity\",\n    type: \"basic\",\n    visible: true,\n    castShadow: true,\n    receiveShadow: true,\n    geometry: \"box\",\n    material: \"phong\",\n    children: [],\n    components: {\n      Transform: {\n        position: { x: 0, y: 0.5, z: 0 },\n        rotation: { x: 0, y: 0, z: 0 },\n        scale: { x: 1, y: 1, z: 1 },\n      },\n    },\n  }\n}\n\nexport const generateNewLight = (): Engine.EntityProps => {\n  const id = uuidv4()\n  return {\n    id,\n    name: \"New Light\",\n    type: \"light\",\n    visible: true,\n    castShadow: true,\n    receiveShadow: true,\n    children: [],\n    components: {\n      Transform: {\n        position: { x: 0, y: 1, z: 0 },\n        rotation: { x: 0, y: 0, z: 0 },\n        scale: { x: 0.5, y: 0.5, z: 0.5 },\n      },\n    },\n    lightProps: {\n      intensity: 0.7,\n      type: \"point\",\n      color: \"rgb(255,255,0)\",\n    },\n  }\n}","/* eslint-disable no-eval */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport * as three from \"three\"\nimport Component from \"../engine/core/Component\"\nimport ComponentManager from \"../engine/core/ComponentManager\"\nimport context from \"../engine/core/EngineContext\"\nimport SceneManager from \"../engine/core/SceneManager\"\nimport { generateNewEntity } from \"./entity.utils\"\nimport { formatScriptString, injectInitSection } from \"./script.utils\"\n\nexport default class ScriptCompiler {\n\n  // Converts all scripts to components\n  public static CompileScripts(scripts: Engine.Script[]) {\n    Object.values(scripts).forEach((script) => {\n      try {\n        if (script.type === \"component\") {\n          ScriptCompiler.CompileComponentScript(script)\n        }\n      } catch (err) {\n        console.error(err)\n      }\n    })\n  }\n\n  private static CompileComponentScript(script: Engine.Script) {\n    // References to be used when running eval\n    const THREE = three\n    const Instantiate = SceneManager.instance.buildEntity.bind(SceneManager.instance)\n    const CreateEntity = generateNewEntity\n    const Time = context.time\n\n    const scriptCopy = `${script.content}`\n    const removePrefix = scriptCopy.substring(scriptCopy.indexOf(\"// <public>\") + 11)\n    let pureProps = removePrefix.substring(0, removePrefix.indexOf(\"// </public>\"))\n    pureProps = pureProps.replaceAll(\";\", \",\")\n    pureProps = pureProps.replaceAll(\"=\", \":\")\n    let props: Record<string, Engine.ComponentType> = {}\n    if (`${pureProps}`.replace(/\\s/g, \"\").length) {\n      pureProps = `{${pureProps}}`\n      props = eval(`(${pureProps})`) // ! <-- Eval: For generating props object\n    }\n    let formattedScript = formatScriptString(script)\n    formattedScript = injectInitSection(formattedScript, props)\n    const NewComponent: any = eval(`(${formattedScript})`) // ! <-- Eval: Compile script into component class\n    Object.setPrototypeOf(NewComponent, Component)\n\n    ComponentManager.instance.registerComponent(script.name, NewComponent, props)\n    SceneManager.instance.updateEntitiesComponentProps(script.name, props)\n  }\n}\n","import Entity from \"./Entity\";\n\nexport default abstract class Component {\n  entity: Entity;\n\n  constructor(entity: Entity) {\n    this.entity = entity;\n  }\n\n  abstract init(props: Engine.ComponentProps): void;\n\n  abstract start(): void;\n\n  abstract update(): void;\n}\n\n// This is only used for generating the BaseComponentType for internal use, \n// when creating Components, extend the abstract Component class instead.\nclass BaseComponent extends Component {\n  entity!: Entity;\n\n  init(props: Engine.ComponentProps) { }\n\n  start() { }\n\n  update() { }\n}\n\nexport type BaseComponentType = typeof BaseComponent;","import { ReactElement, useEffect, useMemo, useRef } from \"react\"\nimport { createContext } from \"react\"\n\ninterface IEditorContext {\n  renderElement?: React.MutableRefObject<HTMLDivElement | null>\n  localScenePayload: Engine.ScenePayload | null\n}\n\nconst initialValue: IEditorContext = {\n  localScenePayload: null,\n}\n\nexport const EditorContext = createContext<IEditorContext>(initialValue)\n\nexport const EditorProvider = ({\n  children,\n}: {\n  children: ReactElement | ReactElement[]\n}) => {\n  const renderElement = useRef<HTMLDivElement>(null)\n  \n  const localScenePayload: Engine.ScenePayload | null = useMemo(() => {\n    const fromLocalStorage = localStorage.getItem(\"scenePayload\")\n    if (!fromLocalStorage) return null\n    return JSON.parse(fromLocalStorage)\n  }, [])\n\n  const contextValue = { renderElement, localScenePayload }\n\n  return <EditorContext.Provider value={contextValue}>{children}</EditorContext.Provider>\n}\n","import * as THREE from \"three\"\nimport { ReactElement, useEffect, useMemo } from \"react\"\nimport { createContext } from \"react\"\nimport { useState } from \"react\"\nimport { v4 as uuidv4 } from \"uuid\"\nimport context from \"../../engine/core/EngineContext\"\n\ninterface ISceneContext {\n  sceneConfig: Engine.SceneConfig\n  setEntities: (entities: Engine.EntityProps[]) => void\n  selectedEntityID: string | null\n  setSelectedEntityID: (entityID: Engine.EntityID | null) => void\n  selectedMaterialID: string | null\n  setSelectedMaterialID: (materialID: Engine.MaterialID | null) => void\n  materials: Record<string, Engine.MaterialProps>\n  setMaterials: (materials: Record<string, Engine.MaterialProps>) => void\n}\n\nconst initialValue = {\n  sceneConfig: {\n    entities: [] as Engine.EntityProps[],\n    camera: {\n      position: new THREE.Vector3(),\n      fov: 70,\n      near: 0.1,\n      far: 1000,\n      controls: \"orbit\" as Engine.ControlType,\n    },\n    materials: [],\n  },\n  selectedEntityID: null,\n  selectedMaterialID: null,\n  setEntities: (entities: Engine.EntityProps[]) => {},\n  setSelectedEntityID: (entityID: string | null) => {},\n  setSelectedMaterialID: (materialID: string | null) => {},\n  setCameraProps: (cameraProps: Engine.CameraProps) => {},\n  materials: {},\n  setMaterials: (materials: Record<string, Engine.MaterialProps>) => {},\n}\n\nexport const SceneContext = createContext<ISceneContext>(initialValue)\n\nexport const SceneProvider = ({\n  children,\n}: {\n  children: ReactElement | ReactElement[]\n}) => {\n  // entities\n  const [entities, setEntities] = useState<Engine.EntityProps[]>([\n    {\n      id: uuidv4(),\n      name: \"Main Camera\",\n      type: \"camera\",\n      visible: true,\n      castShadow: false,\n      receiveShadow: false,\n      children: [],\n      components: {\n        Transform: {\n          position: { x: 0, y: 5, z: -5 },\n          rotation: { x: 0, y: 0, z: 0 },\n          scale: { x: 1, y: 1, z: 1 },\n        },\n      },\n      cameraProps: {\n        fov: 70,\n        near: 0.1,\n        far: 1000,\n      },\n    },\n    {\n      id: uuidv4(),\n      name: \"Ambient Light\",\n      type: \"light\",\n      visible: true,\n      castShadow: false,\n      receiveShadow: false,\n      children: [],\n      components: {\n        Transform: {\n          position: { x: 0, y: 0, z: 0 },\n          rotation: { x: 0, y: 0, z: 0 },\n          scale: { x: 6, y: 6, z: 6 },\n        },\n      },\n      lightProps: {\n        type: \"ambient\",\n        color: \"#ffffff\",\n        intensity: 0.4,\n      },\n    },\n    {\n      id: uuidv4(),\n      name: \"Directional Light\",\n      type: \"light\",\n      visible: true,\n      castShadow: true,\n      receiveShadow: true,\n      children: [],\n      components: {\n        Transform: {\n          position: { x: 0, y: 10, z: 0 },\n          rotation: { x: 0, y: 0, z: 0 },\n          scale: { x: 1, y: 1, z: 1 },\n        },\n      },\n      lightProps: {\n        type: \"directional\",\n        color: \"#ffffff\",\n        intensity: 0.1,\n      },\n    },\n\n    {\n      id: uuidv4(),\n      name: \"Plane\",\n      type: \"basic\",\n      visible: true,\n      castShadow: true,\n      receiveShadow: true,\n      material: \"phong\",\n      geometry: \"plane\",\n      children: [],\n      components: {\n        Transform: {\n          position: { x: 0, y: 0, z: 0 },\n          rotation: { x: 0, y: 0, z: 0 },\n          scale: { x: 1, y: 1, z: 1 },\n        },\n      },\n    },\n  ])\n  const [selectedEntityID, setSelectedEntityID] = useState<string | null>(null)\n\n  // materials\n  const [selectedMaterialID, setSelectedMaterialID] = useState<string | null>(null)\n  const [materials, setMaterials] = useState<Record<string, Engine.MaterialProps>>(\n    {} as Record<string, Engine.MaterialProps>\n  )\n\n  const sceneConfig: Engine.SceneConfig = useMemo(\n    () => ({\n      entities,\n      materials: Object.values(materials),\n    }),\n    [entities, materials]\n  )\n\n  // use effect on mount that listens for escape key press\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        setSelectedEntityID(null)\n        setSelectedMaterialID(null)\n        context.deselectEntity();\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyDown)\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown)\n    }\n  }, [])\n\n  useEffect(() => {\n    if (selectedEntityID) {\n      const entityProps = entities.find((e) => e.id === selectedEntityID)\n      if (!entityProps) return\n      context.updateSpecificEntity(selectedEntityID, entityProps)\n    } \n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [sceneConfig])\n\n  const contextValue = {\n    sceneConfig,\n    selectedEntityID,\n    selectedMaterialID,\n    setEntities,\n    setSelectedEntityID,\n    setSelectedMaterialID,\n    materials,\n    setMaterials,\n  }\n  return <SceneContext.Provider value={contextValue}>{children}</SceneContext.Provider>\n}\n","import {  ReactElement, useEffect, useState } from \"react\"\nimport { createContext } from \"react\"\nimport context from \"../../engine/core/EngineContext\"\nimport ScriptCompiler from \"../../utils/ScriptCompiler\"\n\ninterface IScriptContext {\n  scripts: Record<Engine.ScriptID, Engine.Script>\n  selectedScript: Engine.Script | undefined\n  scriptBody: string\n  setScriptBody: (scriptBody: string) => void\n  setScripts: (scripts: Record<Engine.ScriptID, Engine.Script>) => void\n  setSelectedScript: (script: Engine.Script | undefined) => void\n  compileScripts: () => void\n}\n\nconst initialValue: IScriptContext = {\n  scripts: {},\n  selectedScript: undefined,\n  scriptBody: \"\",\n  setScriptBody: (scriptBody: string) => {},\n  setScripts: (scripts: Record<Engine.ScriptID, Engine.Script>) => {},\n  setSelectedScript: (script: Engine.Script | undefined) => {},\n  compileScripts: () => {},\n}\n\nexport const ScriptContext = createContext<IScriptContext>(initialValue)\n\nexport let scriptBody = \"\"\nexport const setScriptBody = (val: string) => {\n  scriptBody = val\n}\nexport const ScriptProvider = ({\n  children,\n}: {\n  children: ReactElement | ReactElement[]\n}) => {\n  const [scripts, setScripts] = useState<Record<Engine.ScriptID, Engine.Script>>({})\n  const [selectedScript, setSelectedScript] = useState<Engine.Script | undefined>()\n\n  const compileScripts = () => {\n    context.compileScripts(Object.values(scripts))\n  }\n\n  useEffect(() => {\n    compileScripts()\n  }, [scripts])\n\n  const contextValue = {\n    scripts,\n    setScripts,\n    scriptBody,\n    setScriptBody,\n    selectedScript,\n    setSelectedScript,\n    compileScripts,\n  }\n\n  return (\n    <ScriptContext.Provider value={contextValue}>{children}</ScriptContext.Provider>\n  )\n}\n","import { useContext, useMemo } from \"react\"\nimport { SceneContext } from \"./SceneContext\"\nimport context from \"../../engine/core/EngineContext\"\nimport {  generateNewMaterial } from \"../../utils/script.utils\"\n\nconst useScene = () => {\n  const {\n    sceneConfig,\n    setEntities,\n    selectedEntityID,\n    setSelectedEntityID,\n    materials,\n    setMaterials,\n    selectedMaterialID,\n    setSelectedMaterialID,\n  } = useContext(SceneContext)\n\n  const selectEntity = (id: Engine.EntityID) => {\n    if (id === selectedEntityID) {\n      context.selectEntity(\"\")\n      setSelectedEntityID(\"\")\n      return\n    }\n    context.selectEntity(id)\n    setSelectedMaterialID(\"\")\n    setSelectedEntityID(id)\n  }\n\n  const selectedEntity: Engine.EntityProps | null = useMemo(() => {\n    return sceneConfig.entities.find((e) => e.id === selectedEntityID) ?? null\n  }, [sceneConfig, selectedEntityID])\n\n  const selectedMaterial: Engine.MaterialProps | null = useMemo(() => {\n    return sceneConfig.materials.find((e) => e.id === selectedMaterialID) ?? null\n  }, [sceneConfig, selectedMaterialID])\n  \n  const updateEntity = (entity: Engine.EntityProps) => {\n    const index = sceneConfig.entities.findIndex((e) => e.id === entity.id)\n    if (index === -1) {\n      console.error(`Couldn't find ${entity.id} in sceneConfig.entities`)\n    }\n    sceneConfig.entities[index] = entity\n    setEntities([...sceneConfig.entities])\n  }\n\n  const removeEntity = (entityID: Engine.EntityID) => {\n    const index = sceneConfig.entities.findIndex((e) => e.id === entityID)\n    if (index === -1) {\n      console.error(`Couldn't find ${entityID} in sceneConfig.entities`)\n    }\n    sceneConfig.entities.splice(index, 1)\n    setEntities([...sceneConfig.entities])\n    context.removeEntity(entityID);\n  }\n\n  const updateEntityParent = (\n    child: Engine.EntityID,\n    newParent: Engine.EntityID | null\n  ) => {\n    // TODO: Implement this\n  }\n\n  const createEntity = (entity: Engine.EntityProps) => {\n    setEntities([...sceneConfig.entities, entity])\n    context.addNewEntity(entity)\n  }\n\n  const createMaterial = (\n    materialName: string,\n    vertexShaderID: Engine.ScriptID,\n    fragmentShaderID: Engine.ScriptID\n  ) => {\n    const updatedMaterialsObject = materials;\n    const newMaterial = generateNewMaterial(\n      materialName,\n      vertexShaderID,\n      fragmentShaderID\n    )\n    updatedMaterialsObject[materialName] = newMaterial;\n    setMaterials({ ...updatedMaterialsObject })\n    context.updateSceneMaterials(Object.values(updatedMaterialsObject))\n  }\n\n  const selectMaterial = (materialID: Engine.MaterialID) => {\n    if (materialID === selectedMaterialID) {\n      setSelectedMaterialID(\"\")\n      return\n    }\n    setSelectedMaterialID(materialID)\n    setSelectedEntityID(\"\")\n  }\n\n  return {\n    sceneConfig,\n    selectedEntity,\n    selectedMaterial,\n    createEntity,\n    selectEntity,\n    updateEntity,\n    removeEntity,\n    updateEntityParent,\n    createMaterial,\n    selectMaterial,\n    _setEntities: setEntities,\n    _setMaterials: setMaterials,\n  }\n}\n\nexport default useScene\n","import JSZip from \"jszip\"\nimport { saveAs } from \"file-saver\"\n\nconst baseIndexHTML = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Document</title>\n</head>\n<body>\n    <div id=\"app\"></div>\n    <script src=\"index.js\"></script>\n</body>\n</html>`\n\nconst baseIndexJS = `// import threejs from cdn\n//import * as THREE from 'three'\n\n`\n\nexport default class ProjectExporter {\n  static Export(project: Engine.ScenePayload) {\n    const zip = new JSZip()\n    const folder = zip.folder(\"project\")\n    folder?.file(\"scene.json\", JSON.stringify(project))\n    folder?.file(\"index.html\", ProjectExporter.generateHtmlFile(project))\n    folder?.file(\"index.js\", ProjectExporter.generateJsFile(project))\n    zip.generateAsync({ type: \"blob\" }).then((content) => {\n      saveAs(content, \"example.zip\")\n    })\n  }\n\n  private static generateHtmlFile(project: Engine.ScenePayload) {\n    const html = baseIndexHTML\n    return html\n  }\n\n  private static generateJsFile(project: Engine.ScenePayload) {\n    const js = baseIndexJS\n    return js\n  }\n}\n","import { useContext, useMemo } from \"react\"\nimport context from \"../../engine/core/EngineContext\"\nimport { generateNewScript } from \"../../utils/script.utils\"\nimport useEditor from \"../editor/useEditor\"\nimport { scriptBody, ScriptContext, setScriptBody } from \"./ScriptContext\"\n\nconst useScripts = () => {\n  // const { forceUpdateScenePayload } = useEditor();\n\n  const { scripts, setScripts, selectedScript, setSelectedScript, compileScripts } =\n    useContext(ScriptContext)\n\n  const loadScript = (\n    scriptName: Engine.ScriptID | string,\n    method: \"name\" | \"id\" = \"id\"\n  ) => {\n    console.debug(\"loading script\", scriptName, method, scripts)\n    let foundScript\n    if (method === \"id\") {\n      foundScript = scripts[scriptName]\n    } else if (method === \"name\") {\n      foundScript = Object.values(scripts).find((script) => script.name === scriptName)\n    }\n    setSelectedScript(foundScript)\n    setScriptBody(foundScript?.content ?? \"\")\n  }\n\n  const saveScript = (script: Engine.Script) => {\n    const foundScript = scripts[script.id]\n    if (!foundScript) return\n    foundScript.content = scriptBody\n    if (script.type === \"component\") {\n      compileScripts()\n    } else {\n      setScripts({ ...scripts })\n    }\n  }\n\n  interface CreateScriptPayload {\n    name: string\n    language: Engine.Language\n    type: Engine.ScriptType\n  }\n\n  const createScript = (scriptsPayload: CreateScriptPayload[]): Engine.Script[] => {\n    const newScripts: Engine.Script[] = []\n    const updatedScriptsObject = scripts\n    scriptsPayload.forEach((scriptPayload) => {\n      const newScript = generateNewScript(\n        scriptPayload.name,\n        scriptPayload.language,\n        scriptPayload.type\n      )\n      newScripts.push(newScript)\n      updatedScriptsObject[newScript.id] = newScript\n    })\n\n    setScripts({ ...updatedScriptsObject })\n    return newScripts\n  }\n\n  const updateScriptName = (name: string, id: Engine.ScriptID) => {\n    const updatedScriptsObject = scripts\n    const otherComponentNames = Object.values(scripts).map((script) => script.name)\n    if (otherComponentNames.includes(name)) {\n      return\n    }\n    const oldName = updatedScriptsObject[id].name\n\n    updatedScriptsObject[id].name = name\n    context.renameComponent(name, oldName)\n    setScripts({ ...updatedScriptsObject })\n  }\n\n  const scriptsOutput: Engine.Script[] = useMemo(() => Object.values(scripts), [scripts])\n\n  return {\n    scripts: scriptsOutput,\n    _setScripts: setScripts,\n    scriptBody,\n    setScriptBody,\n    selectedScript,\n    setSelectedScript,\n    loadScript,\n    saveScript,\n    createScript,\n    updateScriptName,\n    _compileScripts: compileScripts,\n  }\n}\n\nexport default useScripts\n","import { useContext, useEffect, useMemo, useState } from \"react\"\nimport context from \"../../engine/core/EngineContext\"\nimport SceneManager from \"../../engine/core/SceneManager\"\nimport ProjectExporter from \"../../utils/ProjectExporter\"\nimport ScriptCompiler from \"../../utils/ScriptCompiler\"\nimport useScene from \"../scene/useScene\"\nimport useScripts from \"../scripts/useScripts\"\nimport { EditorContext } from \"./EditorContext\"\n\nconst useEditor = (rootHook?: boolean) => {\n  const { scripts, _setScripts } = useScripts()\n  const { sceneConfig, selectEntity, _setEntities, _setMaterials } =\n    useScene()\n  const { renderElement, localScenePayload } = useContext(EditorContext)\n  const [isRunning, setIsRunning] = useState(context.isPlaying())\n\n  useEffect(() => {\n    if (!localScenePayload || !rootHook) return\n\n    const scriptsPayload = Object.fromEntries(\n      localScenePayload.scripts.map((s) => [s.id, s])\n    )\n\n    _setScripts(scriptsPayload)\n    ScriptCompiler.CompileScripts(localScenePayload.scripts)\n\n    _setEntities(localScenePayload.sceneConfig.entities)\n\n    const materialsPayload = Object.fromEntries(\n      localScenePayload.sceneConfig.materials.map((m) => [m.id, m])\n    )\n    _setMaterials(materialsPayload)\n\n    context.updateScenePayload(localScenePayload, true)\n  }, [_setEntities, _setMaterials, _setScripts, localScenePayload, rootHook])\n\n\n  const scenePayload: Engine.ScenePayload = useMemo(\n    () => ({ sceneConfig, scripts }),\n    [sceneConfig, scripts]\n  )\n  \n  useEffect(() => {\n    const init = () => {\n      if (!renderElement || !renderElement.current || !scenePayload || !rootHook)  {\n        return\n      }\n      context.init(renderElement.current, scenePayload)\n    }\n    init()\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [renderElement, rootHook])\n\n  useEffect(() => {\n    if (rootHook && scenePayload) {\n      context.updateScenePayload(scenePayload)\n    }\n  }, [scripts])\n\n\n  const toggleRun = () => {\n    if (!renderElement || !renderElement.current) {\n      return\n    }\n    if (SceneManager.isPlaying()) {\n      setIsRunning(false)\n      context.runEditMode()\n      return\n    }\n    context.updateScenePayload(scenePayload)\n    context.runPlayMode()\n    setIsRunning(true)\n  }\n\n  /** ! Use this sparingly */\n  const forceUpdateScenePayload = () => {\n    context.updateScenePayload(scenePayload)\n  }\n\n  const handleClickScene = (e: React.MouseEvent) => {\n    const canvas: HTMLCanvasElement = e.target as unknown as HTMLCanvasElement\n    canvas.focus()\n    const domRect: DOMRect = canvas.getBoundingClientRect()\n    const [mouseX, mouseY]: [number, number] = [\n      ((e.clientX - domRect.x) / domRect.width) * 2 - 1,\n      -((e.clientY - domRect.y) / domRect.height) * 2 + 1,\n    ]\n    context.handleClick(mouseX, mouseY)\n    selectEntity(context.getSelectedEntity() ?? \"\")\n  }\n\n  const exportScene = () => {\n    ProjectExporter.Export(scenePayload)\n  }\n\n  const saveScene = () => {\n    localStorage.setItem(\"scenePayload\", JSON.stringify(scenePayload))\n  }\n\n  return {\n    renderElement,\n    isRunning,\n    toggleRun,\n    handleClickScene,\n    saveScene,\n    exportScene,\n    forceUpdateScenePayload,\n  }\n}\n\nexport default useEditor\n","import { ReactElement } from \"react\"\n\ninterface Props {\n  label: string\n  bodyClass?: string\n  children?: ReactElement | ReactElement[] | any\n}\n\nexport default function Panel({ label, bodyClass, children }: Props): ReactElement {\n  return (\n    <div className=\"bg-gray-800 p-1 h-full border border-gray-900 text-white\">\n      <h4 className=\"font-mono text-xs text-red-500 mb-1\">{label}</h4>\n      <div className={`${bodyClass ?? \"\"} space-y-1`}>{children}</div>\n    </div>\n  )\n}\n","import { folder, useControls } from \"leva\"\nimport { v4 as uuidv4 } from \"uuid\"\n\nlet changingField = \"\"\n\nconst useControlPanel = (\n  folderName: string,\n  props: Record<string, unknown>,\n  changeProps: (value: any, fieldName: string) => void,\n  customActions: Record<string, any> = {},\n) => {\n  useControls(() => {\n    const asEntries = Object.entries(props).map(([fieldName, fieldValue]) => {\n      const key = uuidv4()\n      return [\n        key,\n        {\n          value: fieldValue,\n          label: fieldName,\n          onEditStart: () => {\n            changingField = key\n          },\n          onChange: (value: any) => {\n            if (changingField === key) {\n              changeProps(value, fieldName)\n            }\n          },\n          onEditEnd: () => {\n            changingField = \"\"\n          },\n        },\n      ]\n    })\n    const actualControls = Object.fromEntries(asEntries)\n    return { [folderName]: folder({...actualControls, ...customActions}) }\n  })\n}\n\nexport default useControlPanel\n","import { ReactElement } from \"react\"\nimport useControlPanel from \"./useControlPanel\"\ninterface Props {\n  cameraProps: Engine.CameraProps\n  updateCameraProps: (updated: Engine.CameraProps) => void\n}\n\nexport default function CameraNode({\n  cameraProps,\n  updateCameraProps,\n}: Props): ReactElement {\n\n  const setCameraProps = (value: any, fieldName: string) => {\n    const updatedCameraProps = {\n      ...cameraProps,\n    } as any\n    updatedCameraProps[fieldName] = value\n    updateCameraProps(updatedCameraProps)\n  }\n\n  useControlPanel('Camera', cameraProps as any, setCameraProps);\n  \n  return <></>\n}\n","import { button } from \"leva\"\nimport useControlPanel from \"./useControlPanel\"\n\ninterface Props {\n  componentType: Engine.ComponentType\n  componentProps: Engine.ComponentProps\n  componentScriptID: Engine.ScriptID\n  updateComponent: (\n    type: Engine.ComponentType,\n    field: string,\n    value: Engine.ComponentPropType\n  ) => void\n  removeComponent: () => void\n}\n\nconst ComponentNode = ({\n  componentType,\n  componentProps,\n  updateComponent,\n  removeComponent,\n}: Props): React.ReactElement => {\n  const setComponentProps = (value: any, fieldName: string) => {\n    updateComponent(componentType, fieldName, value)\n  }\n\n  useControlPanel(\n    componentType,\n    componentProps as any,\n    setComponentProps,\n    componentType !== \"Transform\" ? {\n      \"Remove Component\": button(removeComponent),\n    } : undefined\n  )\n\n  return <></>\n}\n\nexport default ComponentNode\n","import { ReactElement } from \"react\"\nimport useControlPanel from \"./useControlPanel\"\n\ninterface Props {\n  lightProps: Engine.LightProps\n  updateLightProps: (updated: Engine.LightProps) => void\n}\n\nexport default function LightNode({ lightProps, updateLightProps }: Props): ReactElement {\n\n  const setLightProps = (value: any, fieldName: string) => {\n    const updatedLightProps = {\n      ...lightProps,\n    } as any\n    updatedLightProps[fieldName] = value\n    updateLightProps(updatedLightProps)\n  }\n  useControlPanel('Light', lightProps as any, setLightProps)\n  return <></>\n}\n","import React, { ReactElement, useState } from \"react\"\nimport GeometryManager from \"../../../../engine/core/GeometryManager\"\nimport MaterialManager from \"../../../../engine/core/MaterialManager\"\nimport useScene from \"../../../../state/scene/useScene\"\nimport { SelectOption } from \"../../../interfaces\"\n\ninterface Props {\n  selectedEntity: Engine.EntityProps\n}\n\nexport default function MeshNode({ selectedEntity }: Props): ReactElement {\n  const { updateEntity } = useScene()\n\n  const [materialType, setMaterialType] = useState<Engine.MaterialType>(\n    selectedEntity.material ?? \"phong\"\n  )\n  const [geometryType, setGeometryType] = useState<Engine.GeometryType>(\n    selectedEntity.geometry ?? \"box\"\n  )\n\n  const updateMaterial = (newMaterial: Engine.MaterialType) => {\n    setMaterialType(newMaterial)\n    if (selectedEntity) {\n      selectedEntity.material = newMaterial\n      updateEntity({ ...selectedEntity })\n    }\n  }\n\n  const updateGeometry = (newGeometry: Engine.GeometryType) => {\n    setGeometryType(newGeometry)\n    if (selectedEntity) {\n      selectedEntity.geometry = newGeometry\n      updateEntity({ ...selectedEntity })\n    }\n  }\n\n  const getMaterialOptions = (): SelectOption[] => {\n    return Object.keys(MaterialManager.instance.materials).map((material) => ({\n      label: material,\n      value: material,\n    }))\n  }\n\n  const materialOptions: SelectOption[] = getMaterialOptions()\n\n  const getGeometryOptions = (): SelectOption[] => {\n    return Object.keys(GeometryManager.instance.geometries).map((geometry) => ({\n      label: geometry,\n      value: geometry,\n    }))\n  }\n\n  const geometryOptions: SelectOption[] = getGeometryOptions()\n\n  return (\n    <section>\n      <div className=\"bg-gray-800 text-white\">\n        <h3>Mesh</h3>\n        <div className=\"space-y-2\">\n          <div className=\"flex space-x-2 items-center\">\n            <p className=\"inspector-field-label\">Material</p>\n            <select onChange={(e) => updateMaterial(e.target.value)} value={materialType}>\n              {materialOptions.map((option) => (\n                <option key={option.value} value={option.value}>\n                  {option.label}\n                </option>\n              ))}\n            </select>\n          </div>\n          <div className=\"flex space-x-2 items-center\">\n            <p className=\"inspector-field-label\">Geometry</p>\n            <select onChange={(e) => updateGeometry(e.target.value)} value={geometryType}>\n              {geometryOptions.map((option) => (\n                <option key={option.value} value={option.value}>\n                  {option.label}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n    </section>\n  )\n}\n","import { Leva } from \"leva\"\nimport { ReactElement, useEffect, useState } from \"react\"\nimport ComponentManager from \"../../../engine/core/ComponentManager\"\nimport useEditor from \"../../../state/editor/useEditor\"\nimport useScene from \"../../../state/scene/useScene\"\nimport { SelectOption } from \"../../interfaces\"\nimport Panel from \"../Panel\"\nimport CameraNode from \"./entity/CameraNode\"\nimport ComponentNode from \"./entity/ComponentNode\"\nimport LightNode from \"./entity/LightNode\"\nimport MeshNode from \"./entity/MeshNode\"\n\ninterface Props {\n  selectedEntity: Engine.EntityProps\n}\n\nexport default function EntityInspector({ selectedEntity }: Props): ReactElement {\n  const { updateEntity, removeEntity, sceneConfig } = useScene()\n  const { isRunning } = useEditor()\n\n  const [controls, setControls] = useState<\n    Record<Engine.ComponentType, Engine.ComponentProps>\n  >({})\n\n  // * Handles populating all correct value fields when selecting entity */\n  useEffect(() => {\n    const updateComponentFields = (entity: Engine.EntityProps) => {\n      const propFields: Record<Engine.ComponentType, Engine.ComponentProps> = {}\n      Object.entries(entity.components).forEach(([type, props]) => {\n        propFields[type] = props\n      })\n      setControls({ ...propFields } as any)\n    }\n    if (selectedEntity) updateComponentFields(selectedEntity)\n  }, [selectedEntity, sceneConfig, isRunning])\n\n  const handleChangeName = (newName: string) => {\n    if (!selectedEntity || selectedEntity.type === \"camera\") return\n    updateEntity({ ...selectedEntity, name: newName })\n  }\n\n  const addComponent = (componentName: Engine.ComponentType) => {\n    if (!selectedEntity) return\n    const componentProps = ComponentManager.instance.getComponentProps(componentName)\n    if (!componentProps) return\n    selectedEntity.components[componentName] = componentProps\n    updateEntity(selectedEntity)\n  }\n\n  const updateComponent = (\n    type: Engine.ComponentType,\n    field: string,\n    value: Engine.ComponentPropType\n  ) => {\n    const newControls = { ...controls }\n    newControls[type][field] = value\n    setControls(newControls)\n    if (selectedEntity) {\n      selectedEntity.components = newControls\n      updateEntity({ ...selectedEntity })\n    }\n  }\n\n  const handleRemoveComponent = (type: Engine.ComponentType) => {\n    if (!selectedEntity) return\n    delete selectedEntity.components[type]\n    updateEntity(selectedEntity)\n  }\n\n  const handleRemoveEntity = () => {\n    if (!selectedEntity) return\n    removeEntity(selectedEntity.id)\n  }\n\n  const getComponentOptions = (): SelectOption[] => {\n    const components = ComponentManager.instance.getComponents()\n    if (!selectedEntity) return []\n    const currentComponents = Object.keys(selectedEntity?.components)\n    return Object.keys(components)\n      .filter((c) => !currentComponents.includes(c))\n      .map((component) => ({\n        label: component,\n        value: component,\n      }))\n  }\n\n  const componentOptions = getComponentOptions()\n\n  const updateLightProps = (updatedProps: Engine.LightProps) => {\n    if (selectedEntity) {\n      selectedEntity.lightProps = updatedProps\n      updateEntity({ ...selectedEntity })\n    }\n  }\n\n  const updateCameraProps = (updatedProps: Engine.CameraProps) => {\n    if (selectedEntity) {\n      selectedEntity.cameraProps = updatedProps\n      updateEntity({ ...selectedEntity })\n    }\n  }\n\n  const showShadowOptions = (): boolean => {\n    return !(\n      selectedEntity.type === \"light\" &&\n      selectedEntity.lightProps &&\n      selectedEntity.lightProps.type === \"ambient\"\n    )\n  }\n\n  return (\n    <Panel label=\"Inspector\">\n      <div className=\"flex items-center justify-between\">\n        <h1>\n          <input\n            className=\"transition bg-gray-800 hover:bg-gray-700 focus:bg-gray-900\"\n            type=\"text\"\n            defaultValue={selectedEntity?.name}\n            key={selectedEntity?.id ?? \"\"}\n            onBlur={(e) => handleChangeName(e.target.value)}\n            disabled={selectedEntity?.type === \"camera\"}\n            // @ts-ignore\n            onKeyDown={(e) => e.key === \"Enter\" && e.target.blur()}\n          />\n        </h1>\n        <div\n          className=\"text-xs font-light underline cursor-pointer text-red-400 transition hover:text-red-300\"\n          onClick={handleRemoveEntity}\n        >\n          Remove\n        </div>\n      </div>\n      <section className=\"space-y-2 py-2\">\n        <div className=\"flex space-x-2\">\n          <p className=\"inspector-field-label\">Visible</p>\n          <input\n            type=\"checkbox\"\n            checked={selectedEntity.visible}\n            onChange={(e) =>\n              updateEntity({ ...selectedEntity, visible: e.target.checked })\n            }\n          />\n        </div>\n        {showShadowOptions() && (\n          <>\n            <div className=\"flex space-x-2\">\n              <p className=\"inspector-field-label\">Cast shadow</p>\n              <input\n                type=\"checkbox\"\n                checked={selectedEntity.castShadow}\n                onChange={(e) =>\n                  updateEntity({ ...selectedEntity, castShadow: e.target.checked })\n                }\n              />\n            </div>\n            <div className=\"flex space-x-2\">\n              <p className=\"inspector-field-label\">Receive shadow</p>\n              <input\n                type=\"checkbox\"\n                checked={selectedEntity.receiveShadow}\n                onChange={(e) =>\n                  updateEntity({\n                    ...selectedEntity,\n                    receiveShadow: e.target.checked,\n                  })\n                }\n              />\n            </div>\n          </>\n        )}\n      </section>\n\n      {/* Light */}\n      {selectedEntity.type === \"light\" && selectedEntity.lightProps && (\n        <LightNode\n          lightProps={selectedEntity.lightProps}\n          updateLightProps={updateLightProps}\n          key={selectedEntity.id}\n        />\n      )}\n\n      {/* Camera */}\n      {selectedEntity.type === \"camera\" && selectedEntity.cameraProps && (\n        <CameraNode\n          cameraProps={selectedEntity.cameraProps}\n          updateCameraProps={updateCameraProps}\n        />\n      )}\n\n      {/* Components */}\n      <section className=\"space-y-2\">\n        {Object.entries(controls).map(([type, props]) => (\n          <ComponentNode\n            componentType={type}\n            componentProps={props}\n            key={`${type}--${selectedEntity.id}`}\n            componentScriptID={\"\"}\n            updateComponent={updateComponent}\n            removeComponent={() => handleRemoveComponent(type)}\n          />\n        ))}\n        <Leva fill flat titleBar={false} />\n      </section>\n\n      {/* Add components */}\n      {componentOptions.length > 0 && (\n        <section>\n          <select onChange={(e) => console.log(e.target.value)}>\n            {componentOptions.map(({ label, value }) => (\n              <option key={value} value={value}>\n                {label}\n              </option>\n            ))}\n          </select>\n          <div className=\"grid place-items-center mt-2\">\n            <button onClick={() => addComponent(componentOptions[0].value)}>\n              Add Component\n            </button>\n          </div>\n        </section>\n      )}\n\n      {/* Mesh */}\n      {selectedEntity.type === \"basic\" && <MeshNode selectedEntity={selectedEntity} />}\n    </Panel>\n  )\n}\n","import { ReactElement } from 'react'\nimport useScripts from '../../../state/scripts/useScripts'\nimport Panel from '../Panel'\n\ninterface Props {\n  selectedMaterial: Engine.MaterialProps\n}\n\nexport default function MaterialInspector({ selectedMaterial }: Props): ReactElement {\n  const { loadScript } = useScripts()\n  return (\n    <Panel label=\"Inspector\">\n      <h1>{selectedMaterial.name}</h1>\n      <section>\n        Fragment shader{\" \"}\n        <small\n          className=\"text-xs font-light underline text-gray-400 cursor-pointer transition hover:text-gray-300\"\n          onClick={() => {\n            loadScript(selectedMaterial.fragmentShaderID)\n          }}\n        >\n          Open in editor\n        </small>\n      </section>\n      <section>\n        Vertex shader{\" \"}\n        <small\n          className=\"text-xs font-light underline text-gray-400 cursor-pointer transition hover:text-gray-300\"\n          onClick={() => {\n            loadScript(selectedMaterial.vertexShaderID)\n          }}\n        >\n          Open in editor\n        </small>\n      </section>\n    </Panel>\n  )\n}\n","import useScene from \"../../../state/scene/useScene\"\nimport EntityInspector from \"./EntityInspector\"\nimport MaterialInspector from \"./MaterialInspector\"\n\nexport default function InspectorPanel() {\n  const { selectedEntity, selectedMaterial} = useScene()\n  \n  if (selectedMaterial) return (\n    <MaterialInspector selectedMaterial={selectedMaterial} />\n  )\n  else if (selectedEntity) return (\n    <EntityInspector selectedEntity={selectedEntity} />\n  )\n  else return <></>\n\n}\n","import { ReactElement } from \"react\"\nimport useEditor from \"../../../state/editor/useEditor\"\nimport useScene from \"../../../state/scene/useScene\"\nimport useScripts from \"../../../state/scripts/useScripts\"\nimport { generateNewEntity, generateNewLight } from \"../../../utils/entity.utils\"\n\nexport default function Nav(): ReactElement {\n  const { createEntity,  createMaterial } = useScene()\n  const { toggleRun, isRunning, saveScene, exportScene } = useEditor(true)\n  const { createScript, selectedScript, loadScript, saveScript, scriptBody } =\n    useScripts()\n\n  const handleCreateComponent = () => {\n    const componentName = \"NewComponent\"\n    createScript([{ name: componentName, language: \"js\", type: \"component\" }])\n  }\n\n  const handleCreateMaterial = () => {\n    const materialName = \"NewMaterial\"\n    const [vShader, fShader] = createScript([\n      {\n        name: \"vertex\",\n        language: \"glsl\",\n        type: \"vertex\",\n      },\n      {\n        name: \"fragment\",\n        language: \"glsl\",\n        type: \"fragment\",\n      },\n    ])\n    createMaterial(materialName, vShader.id, fShader.id)\n  }\n\n  const handleCreateEntity = () => {\n    const newEntity: Engine.EntityProps = generateNewEntity()\n    createEntity(newEntity);\n  }\n\n  const handleCreateLight = () => {\n    const newLight: Engine.EntityProps = generateNewLight()\n    createEntity(newLight)\n  }\n\n  const handleSaveScene = () => {\n    saveScene();\n  }\n\n  const handleSaveScript = () => {\n    if (selectedScript) {\n      saveScript({ ...selectedScript, content: scriptBody })\n    }\n  }\n\n  const handleCloseScript = () => {\n    loadScript(\"\")\n  }\n\n  const handleExportScene = () => {\n    exportScene();\n  }\n  \n  return (\n    <div>\n      <header className={`h-0.5 transition bg-red-600 ${isRunning && \"bg-green-500\"}`} />\n      <nav className=\"bg-gray-900 p-2 flex w-full shadow-sm\">\n        <div className=\"space-x-2\">\n          <button onClick={toggleRun} className=\"primary\">\n            {isRunning ? \"Stop\" : \"Run\"} Scene\n          </button>\n          <button onClick={handleCreateEntity} className=\"secondary\">\n            Add Entity\n          </button>\n          <button onClick={handleCreateLight} className=\"secondary\">\n            Add Light\n          </button>\n          <button onClick={handleCreateComponent} className=\"secondary\">\n            Add Component\n          </button>\n          <button onClick={handleCreateMaterial} className=\"secondary\">\n            Add Material\n          </button>\n          {/* save scene button */}\n          <button onClick={handleSaveScene} className=\"secondary\">\n            Save Scene\n          </button>\n          {/* <button onClick={handleExportScene} className=\"secondary\">\n            Export Scene\n          </button> */}\n        </div>\n        {selectedScript && (\n          <div className=\"space-x-2 ml-auto\">\n            <button className=\"secondary\" onClick={handleCloseScript}>\n              Close Editor\n            </button>\n            <button onClick={handleSaveScript} className=\"submit\">\n              Save script\n            </button>\n          </div>\n        )}\n      </nav>\n    </div>\n  )\n}\n","import Editor from '@monaco-editor/react';\nimport { ReactElement, useEffect } from 'react'\nimport useScripts from '../../../state/scripts/useScripts';\n\nexport default function EditorPanel(): ReactElement {\n  const { selectedScript, scriptBody, setScriptBody } = useScripts();\n\n  useEffect(() => {\n    if (!scriptBody && selectedScript) {\n      setScriptBody(selectedScript.content)\n    }\n  }, [selectedScript])\n\n  const handleEditorChange = (newValue: string | undefined) => {\n    setScriptBody(newValue ?? \"\")\n  }\n\n  const getLanguage = () => {\n    if (!selectedScript) return 'javascript';\n    switch (selectedScript.language) {\n      case 'js':\n        return 'javascript';\n      case 'ts':\n        return 'typescript';\n      case 'glsl':\n        return 'c';\n      default:\n        return 'cpp';\n    }\n  }\n\n  return (\n    <>\n      {selectedScript && (\n        <>\n          <div className=\"absolute h-full w-full\" key={selectedScript.id}>\n            <Editor\n              height=\"100%\"\n              width=\"100%\"\n              defaultLanguage={getLanguage()}\n              defaultValue={selectedScript.content}\n              theme=\"vs-dark\"\n              onChange={handleEditorChange}\n              defaultPath=\"/src/modal\"\n            />\n          </div>\n        </>\n      )}\n    </>\n  )\n}\n","import { ReactElement } from 'react'\nimport useEditor from '../../../state/editor/useEditor'\n\nexport default function ScenePanel(): ReactElement {\n  const { renderElement, handleClickScene } = useEditor()\n  \n  return (\n    <>\n      {renderElement && (\n        <div\n          id=\"scene\"\n          ref={renderElement}\n          tabIndex={-1}\n          onMouseDown={(e) => handleClickScene(e)}\n        />\n      )}\n    </>\n  )\n}\n","import { ReactElement, useMemo } from \"react\"\nimport useScene from \"../../../state/scene/useScene\"\n\ninterface Props {\n  entity: Engine.EntityProps\n}\n\nfunction HierarchyNode({ entity }: Props): ReactElement {\n  const { selectedEntity, selectEntity } = useScene()\n\n  const isSelected = useMemo(\n    () => selectedEntity?.id === entity.id,\n    [selectedEntity, entity.id]\n  )\n\n  const handleClick = (e: React.MouseEvent) => {\n    e.stopPropagation()\n    selectEntity(entity.id)\n  }\n\n  const isHidden = useMemo(() => !entity.visible, [entity])\n\n  return (\n    <div\n      className={`\n          p-1\n          rounded-sm\n          transition\n          cursor-pointer\n          select-none\n        text-white\n          text-sm\n          ${isSelected && \"bg-gray-500\"}\n          ${isSelected ? \"hover:bg-gray-600\" : \"hover:bg-gray-500\"}\n          ${isHidden && \"opacity-50\"}\n\n    `}\n      onMouseDown={handleClick}\n    >\n      {entity?.name ?? \"__ENTITY__\"}\n    </div>\n  )\n}\n\nexport default HierarchyNode\n","import { ReactElement } from \"react\"\nimport useScene from \"../../../state/scene/useScene\"\nimport Panel from \"../Panel\"\nimport HierarchyNode from \"./HierarchyNode\"\n\nexport default function HierarchyPanel(): ReactElement {\n  const { sceneConfig } = useScene()\n  return (\n    <Panel label=\"Hierarchy\">\n      <div className=\"space-y-1\">\n        {sceneConfig.entities.map((entity) => (\n          <HierarchyNode key={entity.id} entity={entity} />\n        ))}\n      </div>\n    </Panel>\n  )\n}\n","import React, { ReactElement } from 'react'\n\ninterface Props {\n  title: string\n  children?: ReactElement | ReactElement[] | any\n}\n\nexport default function ProjectNodeWrapper({title, children}: Props): ReactElement {\n  return (\n    <details>\n      <summary>{title}</summary>\n      {children ?? `No ${title}`}\n    </details>\n  )\n}\n","import { ReactElement, useRef } from \"react\"\nimport useScripts from \"../../../state/scripts/useScripts\"\n\ninterface Props {\n  script: Engine.Script\n}\n\nexport default function ScriptNode({ script }: Props): ReactElement {\n  const { loadScript, selectedScript, updateScriptName } = useScripts()\n  const ref = useRef<HTMLInputElement>(null)\n\n  const handleClick = (e: any) => {\n    e.preventDefault();\n    e.stopPropagation()\n    loadScript(script.id)\n  }\n\n  const handleRightClick = (e: any) => {\n    e.preventDefault();\n    e.stopPropagation();\n    ref?.current?.focus();\n\n  }\n\n  return (\n    <div\n      className={`project-node\n          cursor-pointer\n          ${selectedScript?.id === script.id && \"bg-gray-500\"}\n          ${\n            selectedScript?.id === script.id ? \"hover:bg-gray-600\" : \"hover:bg-gray-500\"\n          }`}\n      onClick={handleClick}\n      onContextMenu={handleRightClick}\n      key={script.id}\n    >\n      <input\n        ref={ref}\n        className=\"bg-transparent cursor-pointer\"\n        type=\"text\"\n        defaultValue={script.name}\n        key={script.id ?? \"\"}\n        onBlur={(e) => updateScriptName(e.target.value, script.id)}\n        // @ts-ignore\n        onKeyDown={(e) => e.key === \"Enter\" && e.target.blur()}\n      />\n    </div>\n  )\n}\n","import { ReactElement } from \"react\"\nimport useScene from \"../../../state/scene/useScene\"\nimport useScripts from \"../../../state/scripts/useScripts\"\nimport Panel from \"../Panel\"\nimport ProjectNodeWrapper from \"./ProjectNodeWrapper\"\nimport ScriptNode from \"./ScriptNode\"\n\nexport default function ProjectPanel(): ReactElement {\n  const { sceneConfig, selectedMaterial, selectMaterial } = useScene()\n  const { scripts } = useScripts()\n  return (\n    <Panel label=\"Project\" bodyClass=\"space-y-2\">\n      <ProjectNodeWrapper title=\"Scripts\">\n        {scripts.filter(s => s.type === \"component\").map((s) => (\n          <ScriptNode key={s.id} script={s} />\n        ))}\n      </ProjectNodeWrapper>\n\n      <ProjectNodeWrapper title=\"Prefabs\"></ProjectNodeWrapper>\n\n      <ProjectNodeWrapper title=\"Materials\">\n        {sceneConfig.materials.map((material) => (\n          <div\n            key={material.id}\n            className={`project-node ${\n              selectedMaterial?.id === material.id && \"bg-gray-500\"\n            }\n          ${\n            selectedMaterial?.id === material.id\n              ? \"hover:bg-gray-600\"\n              : \"hover:bg-gray-500\"\n          }`}\n            onClick={() => selectMaterial(material.id)}\n          >\n            {material.name}\n          </div>\n        ))}\n      </ProjectNodeWrapper>\n    </Panel>\n  )\n}\n","import { ReactElement, useMemo } from \"react\"\nimport InspectorPanel from \"../panels/inspector/InspectorPanel\"\nimport Nav from \"../panels/nav/Nav\"\nimport EditorPanel from \"../panels/editor/EditorPanel\"\nimport ScenePanel from \"../panels/scene/ScenePanel\"\nimport HierarchyPanel from \"../panels/hierarchy/HierarchyPanel\"\nimport ProjectPanel from \"../panels/project/ProjectPanel\"\nimport useScene from \"../../state/scene/useScene\"\n\nexport default function BrowserEngine(): ReactElement {\n  const { selectedEntity, selectedMaterial } = useScene()\n  const selectedSomething: boolean = useMemo(\n    () => !!selectedEntity || !!selectedMaterial,\n    [selectedEntity, selectedMaterial]\n  )\n\n  return (\n    <div className=\"w-screen h-screen overflow-hidden\">\n      <Nav />\n      <section\n        className=\"w-full h-full grid\"\n        style={{ gridTemplateColumns: \"80vw 1fr\" }}\n      >\n        <div className=\"h-full w-full grid relative\">\n          <ScenePanel />\n          <EditorPanel />\n          {/* <div className=\"absolute inset-0 bg-red-200 border-2 border-green-500\"></div> */}\n        </div>\n        {selectedSomething ? (\n          <aside className=\"grid\">\n            <InspectorPanel />\n          </aside>\n        ) : (\n          <aside className=\"grid grid-rows-5\">\n            <div className=\"row-span-3\">\n              <HierarchyPanel />\n            </div>\n            <div className=\"row-span-2\">\n              <ProjectPanel />\n            </div>\n          </aside>\n        )}\n      </section>\n    </div>\n  )\n}\n","import { EditorProvider } from \"./state/editor/EditorContext\"\nimport { SceneProvider } from \"./state/scene/SceneContext\"\nimport { ScriptProvider } from \"./state/scripts/ScriptContext\"\nimport BrowserEngine from \"./ui/base/BrowserEngine\"\n\nfunction App() {\n  return (\n    <ScriptProvider>\n      <SceneProvider>\n        <EditorProvider>\n          <BrowserEngine />\n        </EditorProvider>\n      </SceneProvider>\n    </ScriptProvider>\n  )\n}\n\nexport default App\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}