(this["webpackJsonpbrowser-engine"]=this["webpackJsonpbrowser-engine"]||[]).push([[0],{14:function(e,t,n){"use strict";var i=n(2),o=n(3),a=n(1),r=n(39),s=n(27),c=n(21),l=n(20),u=n(33),d=n(23),h=n(15),p=new(function(){function e(){Object(i.a)(this,e),this.sceneManager=void 0,this.cameraManager=void 0,this.componentManager=void 0,this.materialManager=void 0,this.geometryManager=void 0,this.controlsManager=void 0,this.time=new a.Clock,this._renderElement=void 0,this.isInitialized=!1,this.sceneManager=new h.a,this.cameraManager=new s.a,this.componentManager=new c.a,this.materialManager=new d.a,this.geometryManager=new u.a,this.controlsManager=new l.a}return Object(o.a)(e,[{key:"init",value:function(e,t){this.isInitialized||(this._renderElement=e,t&&this.updateScenePayload(t,!0),this.runEditMode(),this.isInitialized=!0)}},{key:"runPlayMode",value:function(){this.time.elapsedTime=0,this.time.start(),this.sceneManager.runPlayScene();var e=this.sceneManager.getScene().getObjectByName("Main Camera");this.cameraManager.useSceneCamera(e),this.cameraManager.setup(this._renderElement,this.sceneManager.getScene())}},{key:"runEditMode",value:function(){this.time.stop(),this.sceneManager.runEditScene(),this.cameraManager.useEditCamera(),this.cameraManager.setup(this._renderElement,this.sceneManager.getScene())}},{key:"updateScenePayload",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.sceneManager.setScenePayload(e,t)}},{key:"updateSceneMaterials",value:function(e){this.sceneManager.setSceneMaterials(e)}},{key:"updateSpecificEntity",value:function(e,t){this.sceneManager.updateEntityPayload(e,t)}},{key:"addNewEntity",value:function(e){this.sceneManager.buildEntity(e)}},{key:"removeEntity",value:function(e){this.sceneManager.destroyEntity(e)}},{key:"isPlaying",value:function(){var e;return null!==(e=h.a.isPlaying())&&void 0!==e&&e}},{key:"handleClick",value:function(e,t){this.cameraManager.handleClick(e,t)}},{key:"selectEntity",value:function(e){this.sceneManager.selectByID(e)}},{key:"deselectEntity",value:function(){this.sceneManager.deselect()}},{key:"getSelectedEntity",value:function(){return this.sceneManager.getSelectedEntity()}},{key:"getSelectedEntityProps",value:function(){return this.sceneManager.getSelectedEntityPayload()}},{key:"renameComponent",value:function(e,t){this.componentManager.renameComponent(e,t),this.sceneManager.renameComponentInEntities(e,t)}},{key:"compileScripts",value:function(e){r.a.CompileScripts(Object.values(e))}}]),e}());t.a=p},15:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var i=n(2),o=n(3),a=n(1),r=n(27),s=n(20),c=n(7),l=n(21),u=n(23),d=n(33),h=function(){function e(t){Object(i.a)(this,e),this.id=void 0,this.name="",this.type=void 0,this.components={},this.children=[],this.mesh=void 0,this.light=void 0,this.camera=void 0,this.id=t.id,this.name=t.name,this.type=t.type,this.init(t)}return Object(o.a)(e,[{key:"init",value:function(e){this._initObject(e),this._appendIdentifiers(e.id,e.name),this._initComponents(e.components)}},{key:"start",value:function(){m.isPlaying()&&this._startComponents()}},{key:"update",value:function(e,t){var n;m.isPlaying()&&this._updateComponents();var i=null===this||void 0===this||null===(n=this.mesh)||void 0===n?void 0:n.material;(null===i||void 0===i?void 0:i.uniforms)&&(i.uniforms.time.value=t)}},{key:"addChild",value:function(e){this.children.push(e);var t=this.getObject(),n=e.getObject();t&&n&&(console.debug("added child"),t.children.push(n),n.parent=t)}},{key:"destroy",value:function(){console.debug("destroy!");var e=this.getObject();e&&e.removeFromParent(),this.mesh&&(this.mesh.geometry.dispose(),this.mesh.material instanceof a.Material&&this.mesh.material.dispose())}},{key:"getComponent",value:function(e){return this.components[e]}},{key:"getObject",value:function(){return this.mesh||this.light||this.camera}},{key:"_startComponents",value:function(){Object.values(this.components).forEach((function(e){return e.start()}))}},{key:"_updateComponents",value:function(){Object.values(this.components).forEach((function(e){return e.update()}))}},{key:"_initComponents",value:function(e){var t=this;this.components={},Object.entries(e).forEach((function(e){var n=Object(c.a)(e,2),i=n[0],o=n[1];l.a.instance.setComponent(t,i,o)}))}},{key:"_initObject",value:function(e){"basic"===e.type&&e.geometry&&e.material?this._initMesh(e.material,e.geometry):"light"===e.type&&e.lightProps?this._initLight(e.lightProps):"camera"===e.type&&e.cameraProps&&this._initCamera(e.cameraProps);var t=this.getObject();t&&(t.visible=e.visible,t.castShadow=e.castShadow,t.receiveShadow=e.receiveShadow)}},{key:"_initMesh",value:function(e,t){var n=u.a.instance.getMaterial(e),i=d.a.instance.getGeometry(t);this.mesh?(this.mesh.geometry=i,this.mesh.material=n):this.mesh=new a.Mesh(i,n)}},{key:"_initCamera",value:function(e){if(this.camera){var t=this.camera;t.fov=e.fov,t.aspect=r.a.instance.getAspect(),t.near=e.near,t.far=e.far}else this.camera=new a.PerspectiveCamera(e.fov,r.a.instance.getAspect(),e.near,e.far)}},{key:"_initLight",value:function(e){this.light||(this.light=function(e){switch(e.type){case"ambient":return new a.AmbientLight(e.color,e.intensity);case"directional":return new a.DirectionalLight(e.color,e.intensity);case"hemisphere":return new a.HemisphereLight(e.color,e.color2,e.intensity);case"point":return new a.PointLight(e.color,e.intensity);default:return new a.AmbientLight(e.color,e.intensity)}}(e)),this.light.intensity=e.intensity;var t=this.light;t.color?t.color=new a.Color(e.color):t.groundColor&&(t.groundColor=new a.Color(e.color)),t.skyColor&&e.color2&&(t.skyColor=new a.Color(e.color2))}},{key:"_appendIdentifiers",value:function(e,t){var n=this.getObject();n&&(n.uuid=e,n.name=t)}}]),e}(),p=n(29),m=function(){function e(){var t=this;if(Object(i.a)(this,e),this.isPlaying=!1,this._scene=void 0,this._entities=[],this._scenePayload=void 0,this._scenePayloadInitialized=!1,this._selectedEntityID=void 0,this._axes=new a.AxesHelper(2),this._gridHelper=new a.GridHelper(1e3,200),this._cameraHelper=new a.CameraHelper(new a.PerspectiveCamera),this._selectionHelper=void 0,this._lightHelpers=[],e.instance)return e.instance;e.instance=this,this._scene=new a.Scene,Object(p.a)(this._axes),this._scene.add(this._axes),Object(p.a)(this._gridHelper),this._scene.add(this._gridHelper),Object(p.a)(this._selectionHelper),this._selectionHelper=new a.BoxHelper(this._gridHelper,16776960),this._selectionHelper.visible=!1,this._scene.add(this._selectionHelper),(new a.TextureLoader).load("/browser-engine/resources/skybox.png",(function(e){var n=new a.WebGLCubeRenderTarget(e.image.height);n.fromEquirectangularTexture(r.a.instance.renderer,e),t._scene.background=n.texture}))}return Object(o.a)(e,[{key:"addTransformControlsToScene",value:function(e){this._scene.add(e)}},{key:"getScene",value:function(){return this._scene}},{key:"setScenePayload",value:function(e,t){t&&this._scenePayloadInitialized||(this._scenePayload=e,this._compileMaterials(),t&&(this._scenePayloadInitialized=!0))}},{key:"setSceneMaterials",value:function(e){this._scenePayload&&(this._scenePayload.sceneConfig.materials=e)}},{key:"getSelectedEntityPayload",value:function(){var e,t=this;return null===(e=this._scenePayload)||void 0===e?void 0:e.sceneConfig.entities.find((function(e){return e.id===t._selectedEntityID}))}},{key:"updateEntityPayload",value:function(e,t){var n=this._entities.findIndex((function(t){return t.id===e}));if(-1!==n){this._entities[n].init(t);var i,o=this._entities[n].getObject();if(o)if("Mesh"===o.type)null===(i=this._selectionHelper)||void 0===i||i.setFromObject(o);else this._lightHelpers.forEach((function(e){e.update()}))}}},{key:"updateScene",value:function(e,t){this._entities.forEach((function(n){n.update(e,t)}))}},{key:"runPlayScene",value:function(){this.isPlaying=!0,this._resetScene(),this._hideHelpers();try{this._buildScene(),this._startEntities()}catch(e){console.error("Error whilst setting up play scene")}}},{key:"runEditScene",value:function(){this.isPlaying=!1,this._resetScene(),this._showHelpers(),this._buildScene()}},{key:"selectByID",value:function(e){var t,n,i=null!==(t=null===(n=this._entities.find((function(t){return t.id===e})))||void 0===n?void 0:n.getObject())&&void 0!==t?t:void 0;i&&(s.a.instance.lookAt(i.position),this.select(i))}},{key:"select",value:function(e){if(!this.isPlaying)return e?(s.a.instance.addObjectControls(e),this._selectedEntityID=e.uuid,this._selectionHelper.setFromObject(e),void("Mesh"===e.type?this._selectionHelper.visible=!0:"PerspectiveCamera"===e.type&&(this._cameraHelper.visible=!0))):void(this._cameraHelper.visible=!1)}},{key:"deselect",value:function(){this._selectionHelper.visible=!1,this._selectedEntityID=void 0,this._cameraHelper.visible=!1,s.a.instance.removeObjectControls()}},{key:"getSelectedEntity",value:function(){return this._selectedEntityID}},{key:"buildEntity",value:function(e){console.debug("build entity");var t=new h(e);this._entities.push(t);var n=t.getObject();if(n)if(this._scene.add(n),"PointLight"!==n.type||this.isPlaying)if("DirectionalLight"===n.type){var i=n;this._scene.add(i.target)}else"PerspectiveCamera"===n.type&&(this._cameraHelper=new a.CameraHelper(n),Object(p.a)(this._cameraHelper),this._cameraHelper.uuid=n.uuid,this._cameraHelper.visible=!1,this._scene.add(this._cameraHelper));else if(!this._lightHelpers.some((function(t){return t.uuid===e.id}))){var o=new a.PointLightHelper(n,1);o.uuid=n.uuid,this._scene.add(o),this._lightHelpers.push(o)}return t}},{key:"destroyEntity",value:function(e){var t=this;e===this._selectedEntityID&&this.deselect();var n=this._entities.find((function(t){return t.id===e}));if(n){var i=n.getObject();i&&this._scene.remove(i),n.destroy(),n.children.length>0&&n.children.forEach((function(e){return t.destroyEntity(e.id)}))}}},{key:"renameComponentInEntities",value:function(e,t){var n;null===(n=this._scenePayload)||void 0===n||n.sceneConfig.entities.forEach((function(n){var i=n.components[t];i&&(n.components[e]=i,delete n.components[t])}))}},{key:"refreshEntitiesMaterial",value:function(e){this._entities.forEach((function(t){var n=t.getObject();n&&n.material&&n.material.uuid===e.uuid&&(n.material=e)}))}},{key:"updateEntitiesComponentProps",value:function(e,t){var n;null===(n=this._scenePayload)||void 0===n||n.sceneConfig.entities.forEach((function(n){var i=n.components[e];i&&(Object.keys(t).forEach((function(e){i[e]||(i[e]=t[e])})),Object.keys(i).forEach((function(e){t[e]||delete i[e]})))}))}},{key:"removeFromScene",value:function(e){this._scene.remove(e)}},{key:"_startEntities",value:function(){this._entities.forEach((function(e){e.start()}))}},{key:"_resetScene",value:function(){this._entities.forEach((function(e){e.destroy()})),this._entities=[]}},{key:"_buildScene",value:function(){if(this._scenePayload){var e,t=(e=this._scenePayload,JSON.parse(JSON.stringify(e)));this._buildEntities(t.sceneConfig.entities)}}},{key:"_buildEntities",value:function(e){var t=this;e.forEach((function(e){t.buildEntity(e)})),this._entities.forEach((function(e){t._bindHierarchy(e)}))}},{key:"_bindHierarchy",value:function(e){if(this._scenePayload){var t=this._scenePayload.sceneConfig.entities.find((function(t){return t.id===e.id}));if(t){var n=t.parent;if(n){var i=this._entities.find((function(e){return e.id===n}));i&&i.addChild(e)}}}}},{key:"_compileMaterials",value:function(){var e=this;this._scenePayload&&this._scenePayload.sceneConfig.materials.forEach((function(t){var n,i,o=null===(n=e._scenePayload)||void 0===n?void 0:n.scripts.find((function(e){return e.id===t.vertexShaderID})),a=null===(i=e._scenePayload)||void 0===i?void 0:i.scripts.find((function(e){return e.id===t.fragmentShaderID}));if(o&&a){var r={id:t.id,material:t,vertexShader:o.content,fragmentShader:a.content};u.a.instance.addCustomMaterial(r)}}))}},{key:"_hideHelpers",value:function(){var e=this;this._axes.visible=!1,this._gridHelper.visible=!1,this._cameraHelper.visible=!1,s.a.instance.removeObjectControls(),this._selectionHelper&&(this._selectionHelper.visible=!1),this._lightHelpers.forEach((function(t){t.dispose(),e._scene.remove(t)})),this._lightHelpers=[]}},{key:"_showHelpers",value:function(){var e=this;if(this._axes.visible=!0,this._gridHelper.visible=!0,this._selectionHelper&&(this._selectionHelper.visible=!0,this._selectedEntityID)){var t,n,i=null!==(t=null===(n=this._entities.find((function(t){return t.id===e._selectedEntityID})))||void 0===n?void 0:n.getObject())&&void 0!==t?t:void 0;i&&s.a.instance.addObjectControls(i)}}}],[{key:"isPlaying",value:function(){return e.instance.isPlaying}}]),e}();m.instance=void 0},20:function(e,t,n){"use strict";n.d(t,"a",(function(){return J}));var i=n(2),o=n(3),a=n(1),r=n(13),s=n(4),c=n(5),l={type:"change"},u=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,o){var s;Object(i.a)(this,n),s=t.call(this),void 0===o&&(console.warn('THREE.FlyControls: The second parameter "domElement" is now mandatory.'),o=document),s.object=e,s.domElement=o,s.movementSpeed=1,s.rollSpeed=.005,s.dragToLook=!1,s.autoForward=!1;var c=Object(r.a)(s),u=1e-6,h=new a.Quaternion,p=new a.Vector3;s.tmpQuaternion=new a.Quaternion,s.mouseStatus=0,s.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},s.moveVector=new a.Vector3(0,0,0),s.rotationVector=new a.Vector3(0,0,0),s.keydown=function(e){if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},s.keyup=function(e){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},s.mousedown=function(e){if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},s.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}},s.mouseup=function(e){if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},s.update=function(e){var t=e*c.movementSpeed,n=e*c.rollSpeed;c.object.translateX(c.moveVector.x*t),c.object.translateY(c.moveVector.y*t),c.object.translateZ(c.moveVector.z*t),c.tmpQuaternion.set(c.rotationVector.x*n,c.rotationVector.y*n,c.rotationVector.z*n,1).normalize(),c.object.quaternion.multiply(c.tmpQuaternion),(p.distanceToSquared(c.object.position)>u||8*(1-h.dot(c.object.quaternion))>u)&&(c.dispatchEvent(l),h.copy(c.object.quaternion),p.copy(c.object.position))},s.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},s.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},s.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},s.dispose=function(){this.domElement.removeEventListener("contextmenu",d),this.domElement.removeEventListener("mousedown",v),this.domElement.removeEventListener("mousemove",m),this.domElement.removeEventListener("mouseup",f),window.removeEventListener("keydown",b),window.removeEventListener("keyup",y)};var m=s.mousemove.bind(Object(r.a)(s)),v=s.mousedown.bind(Object(r.a)(s)),f=s.mouseup.bind(Object(r.a)(s)),b=s.keydown.bind(Object(r.a)(s)),y=s.keyup.bind(Object(r.a)(s));return s.domElement.addEventListener("contextmenu",d),s.domElement.addEventListener("mousemove",m),s.domElement.addEventListener("mousedown",v),s.domElement.addEventListener("mouseup",f),window.addEventListener("keydown",b),window.addEventListener("keyup",y),s.updateMovementVector(),s.updateRotationVector(),s}return n}(a.EventDispatcher);function d(e){e.preventDefault()}var h={type:"change"},p={type:"start"},m={type:"end"},v=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,o){var s;Object(i.a)(this,n),s=t.call(this),void 0===o&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),o===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),s.object=e,s.domElement=o,s.domElement.style.touchAction="none",s.enabled=!0,s.target=new a.Vector3,s.minDistance=0,s.maxDistance=1/0,s.minZoom=0,s.maxZoom=1/0,s.minPolarAngle=0,s.maxPolarAngle=Math.PI,s.minAzimuthAngle=-1/0,s.maxAzimuthAngle=1/0,s.enableDamping=!1,s.dampingFactor=.05,s.enableZoom=!0,s.zoomSpeed=1,s.enableRotate=!0,s.rotateSpeed=1,s.enablePan=!0,s.panSpeed=7,s.screenSpacePanning=!0,s.keyPanSpeed=15,s.autoRotate=!1,s.autoRotateSpeed=2,s.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},s.mouseButtons={LEFT:a.MOUSE.ROTATE,MIDDLE:a.MOUSE.DOLLY,RIGHT:a.MOUSE.PAN},s.touches={ONE:a.TOUCH.ROTATE,TWO:a.TOUCH.DOLLY_PAN},s.target0=s.target.clone(),s.position0=s.object.position.clone(),s.zoom0=s.object.zoom,s._domElementKeyEvents=null,s.getPolarAngle=function(){return v.phi},s.getAzimuthalAngle=function(){return v.theta},s.getDistance=function(){return this.object.position.distanceTo(this.target)},s.listenToKeyEvents=function(e){e.addEventListener("keydown",J),this._domElementKeyEvents=e},s.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},s.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(h),c.update(),u=l.NONE},s.update=function(){var t=new a.Vector3,n=(new a.Quaternion).setFromUnitVectors(e.up,new a.Vector3(0,1,0)),i=n.clone().invert(),o=new a.Vector3,r=new a.Quaternion,s=2*Math.PI;return function(){var e=c.object.position;t.copy(e).sub(c.target),t.applyQuaternion(n),v.setFromVector3(t),c.autoRotate&&u===l.NONE&&T(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(v.theta+=f.theta*c.dampingFactor,v.phi+=f.phi*c.dampingFactor):(v.theta+=f.theta,v.phi+=f.phi);var a=c.minAzimuthAngle,p=c.maxAzimuthAngle;return isFinite(a)&&isFinite(p)&&(a<-Math.PI?a+=s:a>Math.PI&&(a-=s),p<-Math.PI?p+=s:p>Math.PI&&(p-=s),v.theta=a<=p?Math.max(a,Math.min(p,v.theta)):v.theta>(a+p)/2?Math.max(a,v.theta):Math.min(p,v.theta)),v.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,v.phi)),v.makeSafe(),v.radius*=b,v.radius=Math.max(c.minDistance,Math.min(c.maxDistance,v.radius)),!0===c.enableDamping?c.target.addScaledVector(y,c.dampingFactor):c.target.add(y),t.setFromSpherical(v),t.applyQuaternion(i),e.copy(c.target).add(t),c.object.lookAt(c.target),!0===c.enableDamping?(f.theta*=1-c.dampingFactor,f.phi*=1-c.dampingFactor,y.multiplyScalar(1-c.dampingFactor)):(f.set(0,0,0),y.set(0,0,0)),b=1,!!(g||o.distanceToSquared(c.object.position)>d||8*(1-r.dot(c.object.quaternion))>d)&&(c.dispatchEvent(h),o.copy(c.object.position),r.copy(c.object.quaternion),g=!1,!0)}}(),s.dispose=function(){c.domElement.removeEventListener("contextmenu",$),c.domElement.removeEventListener("pointerdown",U),c.domElement.removeEventListener("pointercancel",K),c.domElement.removeEventListener("wheel",q),c.domElement.removeEventListener("pointermove",G),c.domElement.removeEventListener("pointerup",W),null!==c._domElementKeyEvents&&c._domElementKeyEvents.removeEventListener("keydown",J)};var c=Object(r.a)(s),l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},u=l.NONE,d=1e-6,v=new a.Spherical,f=new a.Spherical,b=1,y=new a.Vector3,g=!1,_=new a.Vector2,j=new a.Vector2,w=new a.Vector2,O=new a.Vector2,E=new a.Vector2,x=new a.Vector2,M=new a.Vector2,S=new a.Vector2,P=new a.Vector2,C=[],k={};function I(){return Math.pow(.95,c.zoomSpeed)}function T(e){f.theta-=e}function L(e){f.phi-=e}var A=function(){var e=new a.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),y.add(e)}}(),D=function(){var e=new a.Vector3;return function(t,n){!0===c.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(c.object.up,e)),e.multiplyScalar(t),y.add(e)}}(),R=function(){var e=new a.Vector3;return function(t,n){var i=c.domElement;if(c.object.isPerspectiveCamera){var o=c.object.position;e.copy(o).sub(c.target);var a=e.length();a*=Math.tan(c.object.fov/2*Math.PI/180),A(2*t*a/i.clientHeight,c.object.matrix),D(2*n*a/i.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(A(t*(c.object.right-c.object.left)/c.object.zoom/i.clientWidth,c.object.matrix),D(n*(c.object.top-c.object.bottom)/c.object.zoom/i.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function N(e){c.object.isPerspectiveCamera?b/=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function z(e){c.object.isPerspectiveCamera?b*=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function H(e){_.set(e.clientX,e.clientY)}function V(e){O.set(e.clientX,e.clientY)}function Y(){if(1===C.length)_.set(C[0].pageX,C[0].pageY);else{var e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);_.set(e,t)}}function X(){if(1===C.length)O.set(C[0].pageX,C[0].pageY);else{var e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);O.set(e,t)}}function B(){var e=C[0].pageX-C[1].pageX,t=C[0].pageY-C[1].pageY,n=Math.sqrt(e*e+t*t);M.set(0,n)}function Z(e){if(1==C.length)j.set(e.pageX,e.pageY);else{var t=ne(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);j.set(n,i)}w.subVectors(j,_).multiplyScalar(c.rotateSpeed);var o=c.domElement;T(2*Math.PI*w.x/o.clientHeight),L(2*Math.PI*w.y/o.clientHeight),_.copy(j)}function Q(e){if(1===C.length)E.set(e.pageX,e.pageY);else{var t=ne(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);E.set(n,i)}x.subVectors(E,O).multiplyScalar(c.panSpeed),R(x.x,x.y),O.copy(E)}function F(e){var t=ne(e),n=e.pageX-t.x,i=e.pageY-t.y,o=Math.sqrt(n*n+i*i);S.set(0,o),P.set(0,Math.pow(S.y/M.y,c.zoomSpeed)),N(P.y),M.copy(S)}function U(e){!1!==c.enabled&&(0===C.length&&(c.domElement.setPointerCapture(e.pointerId),c.domElement.addEventListener("pointermove",G),c.domElement.addEventListener("pointerup",W)),function(e){C.push(e)}(e),"touch"===e.pointerType?function(e){switch(te(e),C.length){case 1:switch(c.touches.ONE){case a.TOUCH.ROTATE:if(!1===c.enableRotate)return;Y(),u=l.TOUCH_ROTATE;break;case a.TOUCH.PAN:if(!1===c.enablePan)return;X(),u=l.TOUCH_PAN;break;default:u=l.NONE}break;case 2:switch(c.touches.TWO){case a.TOUCH.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;c.enableZoom&&B(),c.enablePan&&X(),u=l.TOUCH_DOLLY_PAN;break;case a.TOUCH.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;c.enableZoom&&B(),c.enableRotate&&Y(),u=l.TOUCH_DOLLY_ROTATE;break;default:u=l.NONE}break;default:u=l.NONE}u!==l.NONE&&c.dispatchEvent(p)}(e):function(e){var t;switch(e.button){case 0:t=c.mouseButtons.LEFT;break;case 1:t=c.mouseButtons.MIDDLE;break;case 2:t=c.mouseButtons.RIGHT;break;default:t=-1}switch(t){case a.MOUSE.DOLLY:if(!1===c.enableZoom)return;!function(e){M.set(e.clientX,e.clientY)}(e),u=l.DOLLY;break;case a.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enablePan)return;V(e),u=l.PAN}else{if(!1===c.enableRotate)return;H(e),u=l.ROTATE}break;case a.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enableRotate)return;H(e),u=l.ROTATE}else{if(!1===c.enablePan)return;V(e),u=l.PAN}break;default:u=l.NONE}u!==l.NONE&&c.dispatchEvent(p)}(e))}function G(e){!1!==c.enabled&&("touch"===e.pointerType?function(e){switch(te(e),u){case l.TOUCH_ROTATE:if(!1===c.enableRotate)return;Z(e),c.update();break;case l.TOUCH_PAN:if(!1===c.enablePan)return;Q(e),c.update();break;case l.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&F(e),c.enablePan&&Q(e)}(e),c.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&F(e),c.enableRotate&&Z(e)}(e),c.update();break;default:u=l.NONE}}(e):function(e){if(!1===c.enabled)return;switch(u){case l.ROTATE:if(!1===c.enableRotate)return;!function(e){j.set(e.clientX,e.clientY),w.subVectors(j,_).multiplyScalar(c.rotateSpeed);var t=c.domElement;T(2*Math.PI*w.x/t.clientHeight),L(2*Math.PI*w.y/t.clientHeight),_.copy(j),c.update()}(e);break;case l.DOLLY:if(!1===c.enableZoom)return;!function(e){S.set(e.clientX,e.clientY),P.subVectors(S,M),P.y>0?N(I()):P.y<0&&z(I()),M.copy(S),c.update()}(e);break;case l.PAN:if(!1===c.enablePan)return;!function(e){E.set(e.clientX,e.clientY),x.subVectors(E,O).multiplyScalar(c.panSpeed),R(x.x,x.y),O.copy(E),c.update()}(e)}}(e))}function W(e){!1!==c.enabled&&(e.pointerType,c.dispatchEvent(m),u=l.NONE,ee(e),0===C.length&&(c.domElement.releasePointerCapture(e.pointerId),c.domElement.removeEventListener("pointermove",G),c.domElement.removeEventListener("pointerup",W)))}function K(e){ee(e)}function q(e){!1===c.enabled||!1===c.enableZoom||u!==l.NONE&&u!==l.ROTATE||(e.preventDefault(),c.dispatchEvent(p),function(e){e.deltaY<0?z(I()):e.deltaY>0&&N(I()),c.update()}(e),c.dispatchEvent(m))}function J(e){!1!==c.enabled&&!1!==c.enablePan&&function(e){var t=!1;if("scene"===document.activeElement.id){switch(e.code){case"KeyS":N(.3),t=!0;break;case c.keys.UP:case"Space":R(0,c.keyPanSpeed),t=!0;break;case c.keys.BOTTOM:R(0,-c.keyPanSpeed),t=!0;break;case c.keys.LEFT:case"KeyA":R(c.keyPanSpeed,0),t=!0;break;case c.keys.RIGHT||"d":case"KeyD":R(-c.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),c.update())}}(e)}function $(e){!1!==c.enabled&&e.preventDefault()}function ee(e){delete k[e.pointerId];for(var t=0;t<C.length;t++)if(C[t].pointerId==e.pointerId)return void C.splice(t,1)}function te(e){var t=k[e.pointerId];void 0===t&&(t=new a.Vector2,k[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ne(e){var t=e.pointerId===C[0].pointerId?C[1]:C[0];return k[t.pointerId]}return c.domElement.addEventListener("contextmenu",$),c.domElement.addEventListener("pointerdown",U),c.domElement.addEventListener("pointercancel",K),c.domElement.addEventListener("wheel",q,{passive:!1}),s.update(),s}return n}(a.EventDispatcher),f=n(9),b=n(8),y=new a.Raycaster,g=new a.Vector3,_=new a.Vector3,j=new a.Quaternion,w={X:new a.Vector3(1,0,0),Y:new a.Vector3(0,1,0),Z:new a.Vector3(0,0,1)},O={type:"change"},E={type:"mouseDown"},x={type:"mouseUp",mode:null},M={type:"objectChange"},S=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,o){var s;Object(i.a)(this,n),s=t.call(this),void 0===o&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),o=document),s.visible=!1,s.domElement=o,s.domElement.style.touchAction="none";var c=new G;s._gizmo=c,s.add(c);var l=new W;s._plane=l,s.add(l);var u=Object(r.a)(s);function d(e,t){var n=t;Object.defineProperty(u,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,l[e]=t,c[e]=t,u.dispatchEvent({type:e+"-changed",value:t}),u.dispatchEvent(O))}}),u[e]=t,l[e]=t,c[e]=t}d("camera",e),d("object",void 0),d("enabled",!0),d("axis",null),d("mode","translate"),d("translationSnap",null),d("rotationSnap",null),d("scaleSnap",null),d("space","world"),d("size",1),d("dragging",!1),d("showX",!0),d("showY",!0),d("showZ",!0);var h=new a.Vector3,p=new a.Vector3,m=new a.Quaternion,v=new a.Quaternion,f=new a.Vector3,b=new a.Quaternion,y=new a.Vector3,g=new a.Vector3,_=new a.Vector3,j=new a.Vector3;return d("worldPosition",h),d("worldPositionStart",p),d("worldQuaternion",m),d("worldQuaternionStart",v),d("cameraPosition",f),d("cameraQuaternion",b),d("pointStart",y),d("pointEnd",g),d("rotationAxis",_),d("rotationAngle",0),d("eye",j),s._offset=new a.Vector3,s._startNorm=new a.Vector3,s._endNorm=new a.Vector3,s._cameraScale=new a.Vector3,s._parentPosition=new a.Vector3,s._parentQuaternion=new a.Quaternion,s._parentQuaternionInv=new a.Quaternion,s._parentScale=new a.Vector3,s._worldScaleStart=new a.Vector3,s._worldQuaternionInv=new a.Quaternion,s._worldScale=new a.Vector3,s._positionStart=new a.Vector3,s._quaternionStart=new a.Quaternion,s._scaleStart=new a.Vector3,s._getPointer=P.bind(Object(r.a)(s)),s._onPointerDown=k.bind(Object(r.a)(s)),s._onPointerHover=C.bind(Object(r.a)(s)),s._onPointerMove=I.bind(Object(r.a)(s)),s._onPointerUp=T.bind(Object(r.a)(s)),s.domElement.addEventListener("pointerdown",s._onPointerDown),s.domElement.addEventListener("pointermove",s._onPointerHover),s.domElement.addEventListener("pointerup",s._onPointerUp),s}return Object(o.a)(n,[{key:"updateMatrixWorld",value:function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),Object(f.a)(Object(b.a)(n.prototype),"updateMatrixWorld",this).call(this,this)}},{key:"pointerHover",value:function(e){if(void 0!==this.object&&!0!==this.dragging){y.setFromCamera(e,this.camera);var t=L(this._gizmo.picker[this.mode],y);this.axis=t?t.object.name:null}}},{key:"pointerDown",value:function(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){y.setFromCamera(e,this.camera);var t=L(this._plane,y,!0);if(t){var n=this.space;if("scale"===this.mode?n="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(n="world"),"local"===n&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,E.mode=this.mode,this.dispatchEvent(E)}}},{key:"pointerMove",value:function(e){var t=this.axis,n=this.mode,i=this.object,o=this.space;if("scale"===n?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==i&&null!==t&&!1!==this.dragging&&-1===e.button){y.setFromCamera(e,this.camera);var a=L(this._plane,y,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===o&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===o&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(j.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===o&&(i.parent&&i.position.add(g.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(g.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var r=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(r*=-1),_.set(r,r,r)}else g.copy(this.pointStart),_.copy(this.pointEnd),g.applyQuaternion(this._worldQuaternionInv),_.applyQuaternion(this._worldQuaternionInv),_.divide(g),-1===t.search("X")&&(_.x=1),-1===t.search("Y")&&(_.y=1),-1===t.search("Z")&&(_.z=1);i.scale.copy(this._scaleStart).multiply(_),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);var s=20/this.worldPosition.distanceTo(g.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(g.copy(this.rotationAxis).cross(this.eye))*s):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(w[t]),g.copy(w[t]),"local"===o&&g.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(g.cross(this.eye).normalize())*s),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===o&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(j.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(j.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(O),this.dispatchEvent(M)}}}},{key:"pointerUp",value:function(e){0===e.button&&(this.dragging&&null!==this.axis&&(x.mode=this.mode,this.dispatchEvent(x)),this.dragging=!1,this.axis=null)}},{key:"dispose",value:function(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}},{key:"attach",value:function(e){return this.object=e,this.visible=!0,this}},{key:"detach",value:function(){return this.object=void 0,this.visible=!1,this.axis=null,this}},{key:"getRaycaster",value:function(){return y}},{key:"getMode",value:function(){return this.mode}},{key:"setMode",value:function(e){this.mode=e}},{key:"setTranslationSnap",value:function(e){this.translationSnap=e}},{key:"setRotationSnap",value:function(e){this.rotationSnap=e}},{key:"setScaleSnap",value:function(e){this.scaleSnap=e}},{key:"setSize",value:function(e){this.size=e}},{key:"setSpace",value:function(e){this.space=e}},{key:"update",value:function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}]),n}(a.Object3D);function P(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};var t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}function C(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function k(e){this.enabled&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function I(e){this.enabled&&this.pointerMove(this._getPointer(e))}function T(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function L(e,t,n){for(var i=t.intersectObject(e,!0),o=0;o<i.length;o++)if(i[o].object.visible||n)return i[o];return!1}S.prototype.isTransformControls=!0;var A=new a.Euler,D=new a.Vector3(0,1,0),R=new a.Vector3(0,0,0),N=new a.Matrix4,z=new a.Quaternion,H=new a.Quaternion,V=new a.Vector3,Y=new a.Matrix4,X=new a.Vector3(1,0,0),B=new a.Vector3(0,1,0),Z=new a.Vector3(0,0,1),Q=new a.Vector3,F=new a.Vector3,U=new a.Vector3,G=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(i.a)(this,n),(e=t.call(this)).type="TransformControlsGizmo";var o=new a.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=new a.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=o.clone();s.opacity=.15;var c=r.clone();c.opacity=.5;var l=o.clone();l.color.setHex(16711680);var u=o.clone();u.color.setHex(65280);var d=o.clone();d.color.setHex(255);var h=o.clone();h.color.setHex(16711680),h.opacity=.5;var p=o.clone();p.color.setHex(65280),p.opacity=.5;var m=o.clone();m.color.setHex(255),m.opacity=.5;var v=o.clone();v.opacity=.25;var f=o.clone();f.color.setHex(16776960),f.opacity=.25,o.clone().color.setHex(16776960);var b=o.clone();b.color.setHex(7895160);var y=new a.CylinderGeometry(0,.04,.1,12);y.translate(0,.05,0);var g=new a.BoxGeometry(.08,.08,.08);g.translate(0,.04,0);var _=new a.BufferGeometry;_.setAttribute("position",new a.Float32BufferAttribute([0,0,0,1,0,0],3));var j=new a.CylinderGeometry(.0075,.0075,.5,3);function w(e,t){var n=new a.TorusGeometry(e,.0075,3,64,t*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}j.translate(0,.25,0);var O={X:[[new a.Mesh(y,l),[.5,0,0],[0,0,-Math.PI/2]],[new a.Mesh(y,l),[-.5,0,0],[0,0,Math.PI/2]],[new a.Mesh(j,l),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new a.Mesh(y,u),[0,.5,0]],[new a.Mesh(y,u),[0,-.5,0],[Math.PI,0,0]],[new a.Mesh(j,u)]],Z:[[new a.Mesh(y,d),[0,0,.5],[Math.PI/2,0,0]],[new a.Mesh(y,d),[0,0,-.5],[-Math.PI/2,0,0]],[new a.Mesh(j,d),null,[Math.PI/2,0,0]]],XYZ:[[new a.Mesh(new a.OctahedronGeometry(.1,0),v.clone()),[0,0,0]]],XY:[[new a.Mesh(new a.BoxGeometry(.15,.15,.01),m.clone()),[.15,.15,0]]],YZ:[[new a.Mesh(new a.BoxGeometry(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a.Mesh(new a.BoxGeometry(.15,.15,.01),p.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},E={X:[[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[0,.3,0]],[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new a.Mesh(new a.OctahedronGeometry(.2,0),s)]],XY:[[new a.Mesh(new a.BoxGeometry(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new a.Mesh(new a.BoxGeometry(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a.Mesh(new a.BoxGeometry(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},x={START:[[new a.Mesh(new a.OctahedronGeometry(.01,2),c),null,null,null,"helper"]],END:[[new a.Mesh(new a.OctahedronGeometry(.01,2),c),null,null,null,"helper"]],DELTA:[[new a.Line(function(){var e=new a.BufferGeometry;return e.setAttribute("position",new a.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),c),null,null,null,"helper"]],X:[[new a.Line(_,c.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new a.Line(_,c.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new a.Line(_,c.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new a.Mesh(w(.5,1),b),null,[0,Math.PI/2,0]]],X:[[new a.Mesh(w(.5,.5),l)]],Y:[[new a.Mesh(w(.5,.5),u),null,[0,0,-Math.PI/2]]],Z:[[new a.Mesh(w(.5,.5),d),null,[0,Math.PI/2,0]]],E:[[new a.Mesh(w(.75,1),f),null,[0,Math.PI/2,0]]]},S={AXIS:[[new a.Line(_,c.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={XYZE:[[new a.Mesh(new a.SphereGeometry(.25,10,8),s)]],X:[[new a.Mesh(new a.TorusGeometry(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new a.Mesh(new a.TorusGeometry(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new a.Mesh(new a.TorusGeometry(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new a.Mesh(new a.TorusGeometry(.75,.1,2,24),s)]]},C={X:[[new a.Mesh(g,l),[.5,0,0],[0,0,-Math.PI/2]],[new a.Mesh(j,l),[0,0,0],[0,0,-Math.PI/2]],[new a.Mesh(g,l),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new a.Mesh(g,u),[0,.5,0]],[new a.Mesh(j,u)],[new a.Mesh(g,u),[0,-.5,0],[0,0,Math.PI]]],Z:[[new a.Mesh(g,d),[0,0,.5],[Math.PI/2,0,0]],[new a.Mesh(j,d),[0,0,0],[Math.PI/2,0,0]],[new a.Mesh(g,d),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new a.Mesh(new a.BoxGeometry(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new a.Mesh(new a.BoxGeometry(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a.Mesh(new a.BoxGeometry(.15,.15,.01),p),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new a.Mesh(new a.BoxGeometry(.1,.1,.1),v.clone())]]},k={X:[[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[0,.3,0]],[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new a.Mesh(new a.CylinderGeometry(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new a.Mesh(new a.BoxGeometry(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new a.Mesh(new a.BoxGeometry(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a.Mesh(new a.BoxGeometry(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new a.Mesh(new a.BoxGeometry(.2,.2,.2),s),[0,0,0]]]},I={X:[[new a.Line(_,c.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new a.Line(_,c.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new a.Line(_,c.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function T(e){var t=new a.Object3D;for(var n in e)for(var i=e[n].length;i--;){var o=e[n][i][0].clone(),r=e[n][i][1],s=e[n][i][2],c=e[n][i][3],l=e[n][i][4];o.name=n,o.tag=l,r&&o.position.set(r[0],r[1],r[2]),s&&o.rotation.set(s[0],s[1],s[2]),c&&o.scale.set(c[0],c[1],c[2]),o.updateMatrix();var u=o.geometry.clone();u.applyMatrix4(o.matrix),o.geometry=u,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),t.add(o)}return t}return e.gizmo={},e.picker={},e.helper={},e.add(e.gizmo.translate=T(O)),e.add(e.gizmo.rotate=T(M)),e.add(e.gizmo.scale=T(C)),e.add(e.picker.translate=T(E)),e.add(e.picker.rotate=T(P)),e.add(e.picker.scale=T(k)),e.add(e.helper.translate=T(x)),e.add(e.helper.rotate=T(S)),e.add(e.helper.scale=T(I)),e.picker.translate.visible=!1,e.picker.rotate.visible=!1,e.picker.scale.visible=!1,e}return Object(o.a)(n,[{key:"updateMatrixWorld",value:function(e){var t=this,i="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:H;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var o=[];o=(o=(o=o.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var a=function(e){var n=o[e];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(t.worldPosition);var a=void 0;if(a=t.camera.isOrthographicCamera?(t.camera.top-t.camera.bottom)/t.camera.zoom:t.worldPosition.distanceTo(t.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*t.camera.fov/360)/t.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(a*t.size/4),"helper"===n.tag)return n.visible=!1,"AXIS"===n.name?(n.position.copy(t.worldPositionStart),n.visible=!!t.axis,"X"===t.axis&&(j.setFromEuler(A.set(0,0,0)),n.quaternion.copy(i).multiply(j),Math.abs(D.copy(X).applyQuaternion(i).dot(t.eye))>.9&&(n.visible=!1)),"Y"===t.axis&&(j.setFromEuler(A.set(0,0,Math.PI/2)),n.quaternion.copy(i).multiply(j),Math.abs(D.copy(B).applyQuaternion(i).dot(t.eye))>.9&&(n.visible=!1)),"Z"===t.axis&&(j.setFromEuler(A.set(0,Math.PI/2,0)),n.quaternion.copy(i).multiply(j),Math.abs(D.copy(Z).applyQuaternion(i).dot(t.eye))>.9&&(n.visible=!1)),"XYZE"===t.axis&&(j.setFromEuler(A.set(0,Math.PI/2,0)),D.copy(t.rotationAxis),n.quaternion.setFromRotationMatrix(N.lookAt(R,D,B)),n.quaternion.multiply(j),n.visible=t.dragging),"E"===t.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(t.worldPositionStart),n.visible=t.dragging):"END"===n.name?(n.position.copy(t.worldPosition),n.visible=t.dragging):"DELTA"===n.name?(n.position.copy(t.worldPositionStart),n.quaternion.copy(t.worldQuaternionStart),g.set(1e-10,1e-10,1e-10).add(t.worldPositionStart).sub(t.worldPosition).multiplyScalar(-1),g.applyQuaternion(t.worldQuaternionStart.clone().invert()),n.scale.copy(g),n.visible=t.dragging):(n.quaternion.copy(i),t.dragging?n.position.copy(t.worldPositionStart):n.position.copy(t.worldPosition),t.axis&&(n.visible=-1!==t.axis.search(n.name))),"continue";if(n.quaternion.copy(i),"translate"===t.mode||"scale"===t.mode){var r=.99;"X"===n.name&&Math.abs(D.copy(X).applyQuaternion(i).dot(t.eye))>r&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&Math.abs(D.copy(B).applyQuaternion(i).dot(t.eye))>r&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&Math.abs(D.copy(Z).applyQuaternion(i).dot(t.eye))>r&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(D.copy(Z).applyQuaternion(i).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(D.copy(X).applyQuaternion(i).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(D.copy(B).applyQuaternion(i).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)}else"rotate"===t.mode&&(z.copy(i),D.copy(t.eye).applyQuaternion(j.copy(i).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(N.lookAt(t.eye,R,B)),"X"===n.name&&(j.setFromAxisAngle(X,Math.atan2(-D.y,D.z)),j.multiplyQuaternions(z,j),n.quaternion.copy(j)),"Y"===n.name&&(j.setFromAxisAngle(B,Math.atan2(D.x,D.z)),j.multiplyQuaternions(z,j),n.quaternion.copy(j)),"Z"===n.name&&(j.setFromAxisAngle(Z,Math.atan2(D.y,D.x)),j.multiplyQuaternions(z,j),n.quaternion.copy(j)));n.visible=n.visible&&(-1===n.name.indexOf("X")||t.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||t.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||t.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||t.showX&&t.showY&&t.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,t.enabled&&t.axis&&(n.name===t.axis||t.axis.split("").some((function(e){return n.name===e})))&&(n.material.color.setHex(16776960),n.material.opacity=1)},r=0;r<o.length;r++)a(r);Object(f.a)(Object(b.a)(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(a.Object3D);G.prototype.isTransformControlsGizmo=!0;var W=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this,new a.PlaneGeometry(1e5,1e5,2,2),new a.MeshBasicMaterial({visible:!1,wireframe:!0,side:a.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1}))).type="TransformControlsPlane",e}return Object(o.a)(n,[{key:"updateMatrixWorld",value:function(e){var t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),Q.copy(X).applyQuaternion("local"===t?this.worldQuaternion:H),F.copy(B).applyQuaternion("local"===t?this.worldQuaternion:H),U.copy(Z).applyQuaternion("local"===t?this.worldQuaternion:H),D.copy(F),this.mode){case"translate":case"scale":switch(this.axis){case"X":D.copy(this.eye).cross(Q),V.copy(Q).cross(D);break;case"Y":D.copy(this.eye).cross(F),V.copy(F).cross(D);break;case"Z":D.copy(this.eye).cross(U),V.copy(U).cross(D);break;case"XY":V.copy(U);break;case"YZ":V.copy(Q);break;case"XZ":D.copy(U),V.copy(F);break;case"XYZ":case"E":V.set(0,0,0)}break;case"rotate":default:V.set(0,0,0)}0===V.length()?this.quaternion.copy(this.cameraQuaternion):(Y.lookAt(g.set(0,0,0),V,D),this.quaternion.setFromRotationMatrix(Y)),Object(f.a)(Object(b.a)(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(a.Mesh);W.prototype.isTransformControlsPlane=!0;var K=n(15),q=n(29),J=function(){function e(){Object(i.a)(this,e),this.controls=void 0,this.transformControls=void 0,e.instance||(e.instance=this)}return Object(o.a)(e,[{key:"setControls",value:function(e,t,n){if(!this.controls){switch(e){case"fly":this._setFlyControls(t,n);break;case"orbit":this._setOrbitControls(t,n);break;default:console.warn("Control type: ".concat(e," not found"))}this._initTransformControls(t,n)}}},{key:"lookAt",value:function(e){}},{key:"enableControls",value:function(){this.controls&&(this.controls.enabled=!0)}},{key:"disableControls",value:function(){this.controls&&(this.controls.enabled=!1)}},{key:"_setFlyControls",value:function(e,t){this.controls&&(this.controls.enabled=!1),this.controls=new u(e,t),this.controls.movementSpeed=33}},{key:"_setOrbitControls",value:function(e,t){this.controls||(this.controls=new v(e,t),this.controls.listenToKeyEvents(window))}},{key:"_initTransformControls",value:function(e,t){var n=this;this.transformControls=new S(e,t),Object(q.a)(this.transformControls,"helper-block"),K.a.instance.addTransformControlsToScene(this.transformControls),this.transformControls.addEventListener("change",(function(e){var t=e.target.object;if(t){var n=t.uuid,i={position:{x:t.position.x,y:t.position.y,z:t.position.z},rotation:{x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},scale:{x:t.scale.x,y:t.scale.y,z:t.scale.z}},o=K.a.instance.getSelectedEntityPayload();o&&o.id===t.uuid&&(o.components.Transform=i,K.a.instance.updateEntityPayload(n,o))}})),this.transformControls.addEventListener("dragging-changed",(function(e){n.controls.enabled=!e.value})),window.addEventListener("keydown",(function(e){var t=n.transformControls;switch(e.key.toLowerCase()){case"w":t.setMode("translate");break;case"e":t.setMode("rotate");break;case"r":t.setMode("scale");break;case"shift":t.setTranslationSnap(2),t.setRotationSnap(a.MathUtils.degToRad(15)),t.setScaleSnap(.25)}})),window.addEventListener("keyup",(function(e){var t=n.transformControls;switch(e.key.toLowerCase()){case"shift":t.setTranslationSnap(null),t.setRotationSnap(null),t.setScaleSnap(null)}}))}},{key:"addObjectControls",value:function(e){this.transformControls&&this.transformControls.attach(e)}},{key:"removeObjectControls",value:function(){this.transformControls&&this.transformControls.detach()}},{key:"updateControls",value:function(e){this.controls&&this.controls.update(e)}}]),e}();J.instance=void 0},21:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(7),o=n(10),a=n(2),r=n(3),s=n(1),c=n(4),l=n(5),u=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var i;return Object(a.a)(this,n),(i=t.call(this,e)).entity=void 0,i._object=void 0,i.position=new s.Vector3(0,0,0),i.rotation=new s.Euler(0,0,0,"XYZ"),i.scale=new s.Vector3(1,1,1),i.entity=e,i._object=i.entity.getObject(),i}return Object(r.a)(n,[{key:"init",value:function(e){this.position=(null===e||void 0===e?void 0:e.position)?new s.Vector3(e.position.x,e.position.y,e.position.z):this.position,this.rotation=(null===e||void 0===e?void 0:e.rotation)?new s.Euler(e.rotation.x,e.rotation.y,e.rotation.z,"XYZ"):this.rotation,this.scale=(null===e||void 0===e?void 0:e.scale)?new s.Vector3(e.scale.x,e.scale.y,e.scale.z):this.scale,this.applyMatrix()}},{key:"start",value:function(){this.applyMatrix()}},{key:"lookAt",value:function(e){var t=new s.Euler(e.x,e.y,e.z);this.rotation=t}},{key:"moveForward",value:function(e){this.position.addScaledVector(this.rotation.toVector3(),e)}},{key:"applyPosition",value:function(){this._object.position.set(this.position.x,this.position.y,this.position.z)}},{key:"applyRotation",value:function(){this._object.setRotationFromEuler(new s.Euler(this.rotation.x,this.rotation.y,this.rotation.z))}},{key:"applyScale",value:function(){this._object.scale.set(this.scale.x,this.scale.y,this.scale.z)}},{key:"applyMatrix",value:function(){this.entity&&(this.applyPosition(),this.applyRotation(),this.applyScale())}},{key:"update",value:function(){this.applyMatrix()}}]),n}(n(40).a),d=function(){function e(){Object(a.a)(this,e),this.components={},e.instance||(e.instance=this,this.registerComponent("Transform",u,{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}))}return Object(r.a)(e,[{key:"getComponents",value:function(){return Object(o.a)({},this.components)}},{key:"registerComponent",value:function(e,t,n){this.components[e]={constructor:t,props:n}}},{key:"getComponentProps",value:function(e){var t,n,i=null!==(t=null===(n=this.components[e])||void 0===n?void 0:n.props)&&void 0!==t?t:null;return i||null}},{key:"getComponent",value:function(e){var t,n;return null!==(t=null===(n=this.components[e])||void 0===n?void 0:n.constructor)&&void 0!==t?t:null}},{key:"setComponent",value:function(e,t,n){var o=this.getComponent(t);if(o){Object.entries(n).forEach((function(e){var t=Object(i.a)(e,2),o=t[0],a=t[1];Array.isArray(a)&&(3===a.length?n[o]=new s.Vector3(a[0],a[1],a[2]):2===a.length&&(n[o]=new s.Vector2(a[0],a[1])))}));var a=new o(e);try{a.init(n),e.components[t]=a}catch(r){console.error("Error whilst initializing component",r)}}else console.error("Component ".concat(t," not found"))}},{key:"renameComponent",value:function(e,t){var n=this.components[t];n?(this.components[e]=n,delete this.components[t]):console.error("Component ".concat(t," not found"))}}]),e}();d.instance=void 0},23:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(10),o=n(2),a=n(3),r=n(1),s=n(15),c=function(){function e(){Object(o.a)(this,e),this.materials={normal:new r.MeshNormalMaterial,basic:new r.MeshBasicMaterial,phong:new r.MeshPhongMaterial,lambert:new r.MeshLambertMaterial,wireframe:new r.MeshBasicMaterial({wireframe:!0})},e.instance||(e.instance=this)}return Object(a.a)(e,[{key:"getMaterial",value:function(e){var t;return null!==(t=this.materials[e])&&void 0!==t?t:this.materials.basic}},{key:"addCustomMaterial",value:function(e){var t=!1,n=e.material,o=Object.values(this.materials).find((function(t){return t.uuid===e.id}));o&&(o.dispose(),t=!0);var a=new r.ShaderMaterial({uniforms:Object(i.a)(Object(i.a)({},n.uniforms),{},{time:{value:0}}),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});a.uuid=e.id,this.materials[n.name]=a,t&&s.a.instance.refreshEntitiesMaterial(a)}}]),e}();c.instance=void 0},24:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var i=n(19),o=function(){return{id:Object(i.v4)(),name:"New Entity",type:"basic",visible:!0,castShadow:!0,receiveShadow:!0,geometry:"box",material:"phong",parent:null,children:[],components:{Transform:{position:{x:0,y:.5,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}}},a=function(){return{id:Object(i.v4)(),name:"New Light",type:"light",visible:!0,castShadow:!0,receiveShadow:!0,parent:null,children:[],components:{Transform:{position:{x:0,y:1,z:0},rotation:{x:0,y:0,z:0},scale:{x:.5,y:.5,z:.5}}},lightProps:{intensity:.7,type:"point",color:"rgb(255,255,0)"}}}},27:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(2),o=n(3),a=n(1),r=n(20),s=n(15),c=function(){function e(){var t=this;if(Object(i.a)(this,e),this.renderer=new a.WebGLRenderer({antialias:!0,alpha:!0}),this.renderElement=void 0,this.raycaster=new a.Raycaster,this.fov=60,this.near=.01,this.far=2e4,this.camera=void 0,this.editCamera=void 0,this.sceneCamera=void 0,this.currentControls="orbit",this.clock=new a.Clock,e.instance)return e.instance;e.instance=this,this.editCamera=new a.PerspectiveCamera(this.fov,window.innerWidth/window.innerHeight,this.near,this.far),this._setCamera(this.editCamera),window.addEventListener("resize",(function(){return t.handleResize()}))}return Object(o.a)(e,[{key:"setup",value:function(e,t){this.renderElement=e,this.renderElement.appendChild(this.renderer.domElement),this._setRenderer(),this._setControls(),this._setRaycaster(),this._runSceneLoop(t),this.handleResize()}},{key:"useSceneCamera",value:function(e){this.sceneCamera=e,this._setCamera(this.sceneCamera)}},{key:"useEditCamera",value:function(){this._setCamera(this.editCamera)}},{key:"handleClick",value:function(e,t){var n=new a.Vector2(e,t);this.raycaster.setFromCamera(n,this.camera);var i=this.raycaster.intersectObjects(s.a.instance.getScene().children,!0),o=i.filter((function(e){return"helper"!==e.object.type}));if(o.length>0){if("helper-block"===o[0].object.type){if(1===o.length)return void s.a.instance.deselect();if(s.a.instance.getSelectedEntity())return}var r=i.find((function(e){return"Mesh"===e.object.type||"PointLightHelper"===e.object.type}));if(!r)return;"Mesh"===r.object.type?s.a.instance.select(r.object):"PointLightHelper"===r.object.type&&s.a.instance.selectByID(r.object.uuid)}0===i.length&&s.a.instance.deselect()}},{key:"_setCamera",value:function(e){this.camera=e,this.camera.position.y=10,this.camera.rotation.x=-.1,this.camera.position.z=50}},{key:"_runSceneLoop",value:function(e){var t=this;this.renderer.setAnimationLoop((function(n){return t.update(e)}))}},{key:"_setRaycaster",value:function(){this.raycaster=new a.Raycaster}},{key:"_setControls",value:function(){this.renderElement&&r.a.instance.setControls(this.currentControls,this.camera,this.renderer.domElement)}},{key:"_setRenderer",value:function(){this.renderElement&&(this.renderer.setSize(this.renderElement.clientWidth,this.renderElement.clientHeight),this.renderer.toneMapping=a.ReinhardToneMapping,this.renderer.toneMappingExposure=2,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=a.BasicShadowMap,this.renderer.shadowMap.type=a.PCFSoftShadowMap)}},{key:"getAspect",value:function(){return this.camera.aspect}},{key:"handleResize",value:function(){var e,t,n,i,o,a;if(this.renderElement){var r=this.renderElement.getBoundingClientRect(),s=null!==(e=null===(t=this.renderElement)||void 0===t||null===(n=t.offsetParent)||void 0===n?void 0:n.clientWidth)&&void 0!==e?e:r.width,c=null!==(i=null===(o=this.renderElement)||void 0===o||null===(a=o.offsetParent)||void 0===a?void 0:a.clientHeight)&&void 0!==i?i:r.height;this.camera.aspect=s/c,this.camera.updateProjectionMatrix(),this.renderer.setSize(s,c),this.renderer.setPixelRatio(window.devicePixelRatio)}}},{key:"update",value:function(e){this.renderer.render(e,this.camera);var t=this.clock.getDelta(),n=this.clock.getElapsedTime();s.a.instance.updateScene(t,n),r.a.instance.updateControls(t)}}]),e}();c.instance=void 0},28:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"b",(function(){return d}));var i=n(7),o=n(19),a="// @defineComponent",r="class Component {\n  \n  // <public>\n\n  // </public>\n\n  ".concat(a,"\n\n  start() {\n    \n  }\n\n  update() {\n\n  }\n}"),s=function(e,t,n){var i=Object(o.v4)(),a=r;switch(n){case"component":a=r;break;case"vertex":a="// -- Injected uniforms / attributes --\n// uniform mat4 modelMatrix; // object.matrixWorld\n// uniform mat4 modelViewMatrix; // camera.matrixWorld * object.matrixWorld\n// uniform mat4 projectionMatrix; // camera.projectionMatrix\n// uniform mat4 viewMatrix; // camera.matrixWorld\n// uniform mat3 normalMatrix; // camera.matrixWorldInverse.transpose()\n// uniform vec3 cameraPosition; // camera.position\n\n// attribute vec3 position;\n// attribute vec3 normal;\n// attribute vec2 uv;\n// -- Able to delete above, but do not uncomment --\n\nuniform float time;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";break;case"fragment":a="// -- Injected uniforms / attributes --\n// uniform mat4 viewMatrix;\n// uniform vec3 cameraPosition;\n// -- Able to delete above, but do not uncomment --\nuniform float time;\n\nvoid main() {\n  gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n}"}return{id:i,name:e,language:t,content:a,type:n}},c="// <initPropPlaceholder />",l=function(e){return"(".concat(e.content,")").replace(a,"\n          entity;\n        \n          constructor(entity) {\n            this.entity = entity;\n          }\n\n          ".concat(c,"\n        "))},u=function(e,t){var n="\n  init(props) {\n    this.transform = this.entity.getComponent('Transform');\n    ".concat(Object.entries(t).map((function(e){var t=Object(i.a)(e,2),n=t[0],o=t[1];return"this.".concat(n," = props?.").concat(n," ?? ").concat(o,";")})).join("\n"),"\n  }");return e.replace(c,n)},d=function(e,t,n){return{id:Object(o.v4)(),name:e,vertexShaderID:t,fragmentShaderID:n,uniforms:{}}}},29:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"helper";t&&(t.type=n,t.children.forEach((function(t){return e(t,n)})))}},33:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(2),o=n(3),a=n(1),r=new a.PlaneBufferGeometry(5,5);r.rotateX(-Math.PI/2),r.scale(5,1,5);var s=function(){function e(){Object(i.a)(this,e),this.geometries={box:new a.BoxBufferGeometry,sphere:new a.SphereBufferGeometry(1,16,16),cylinder:new a.CylinderBufferGeometry(1,1,1,16,1),torus:new a.TorusBufferGeometry(6,1.1,10,32,6.3),plane:r,tetrahedron:new a.TetrahedronBufferGeometry,octahedron:new a.OctahedronBufferGeometry,dodecahedron:new a.DodecahedronBufferGeometry,icosahedron:new a.IcosahedronBufferGeometry},e.instance||(e.instance=this)}return Object(o.a)(e,[{key:"getGeometry",value:function(e){var t;return null!==(t=this.geometries[e])&&void 0!==t?t:this.geometries.box}}]),e}();s.instance=void 0},39:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ScriptCompiler}));var _Users_parssa_projects_personal_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_Users_parssa_projects_personal_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),three__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_engine_core_Component__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(40),_engine_core_ComponentManager__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(21),_engine_core_EngineContext__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(14),_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(15),_entity_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(24),_script_utils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(28),ScriptCompiler=function(){function ScriptCompiler(){Object(_Users_parssa_projects_personal_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,ScriptCompiler)}return Object(_Users_parssa_projects_personal_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__.a)(ScriptCompiler,null,[{key:"CompileScripts",value:function(e){Object.values(e).forEach((function(e){try{"component"===e.type&&ScriptCompiler.CompileComponentScript(e)}catch(t){console.error(t)}}))}},{key:"CompileComponentScript",value:function CompileComponentScript(script){var THREE=three__WEBPACK_IMPORTED_MODULE_2__,Instantiate=function(){console.debug("[ScriptCompiler] Instantiate entity");var e=Object(_entity_utils__WEBPACK_IMPORTED_MODULE_7__.a)();return _engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__.a.instance.buildEntity(e)},CreateEntity=_entity_utils__WEBPACK_IMPORTED_MODULE_7__.a,Time=_engine_core_EngineContext__WEBPACK_IMPORTED_MODULE_5__.a.time,scriptCopy="".concat(script.content),removePrefix=scriptCopy.substring(scriptCopy.indexOf("// <public>")+11),pureProps=removePrefix.substring(0,removePrefix.indexOf("// </public>"));pureProps=pureProps.replaceAll(";",","),pureProps=pureProps.replaceAll("=",":");var props={};"".concat(pureProps).replace(/\s/g,"").length&&(pureProps="{".concat(pureProps,"}"),props=eval("(".concat(pureProps,")")));var formattedScript=Object(_script_utils__WEBPACK_IMPORTED_MODULE_8__.a)(script);formattedScript=Object(_script_utils__WEBPACK_IMPORTED_MODULE_8__.d)(formattedScript,props);var NewComponent=eval("(".concat(formattedScript,")"));Object.setPrototypeOf(NewComponent,_engine_core_Component__WEBPACK_IMPORTED_MODULE_3__.a),console.debug("COMPILED SCRIPT"),_engine_core_ComponentManager__WEBPACK_IMPORTED_MODULE_4__.a.instance.registerComponent(script.name,NewComponent,props),_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__.a.instance.updateEntitiesComponentProps(script.name,props)}}]),ScriptCompiler}()},40:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n(3),n(4),n(5);var i=n(2),o=function e(t){Object(i.a)(this,e),this.entity=void 0,this.entity=t}},55:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),a=n(32),r=n.n(a),s=(n(55),n(6)),c={localScenePayload:null},l=Object(i.createContext)(c),u=function(e){var t=e.children,n={renderElement:Object(i.useRef)(null),localScenePayload:Object(i.useMemo)((function(){var e=localStorage.getItem("scenePayload");return e?JSON.parse(e):null}),[])};return Object(s.jsx)(l.Provider,{value:n,children:t})},d=n(7),h=n(19),p=n(14),m={sceneConfig:{entities:[],camera:{fov:70,near:.1,far:1e3},materials:[]},selectedEntityID:null,selectedMaterialID:null,setEntities:function(e){},setSelectedEntityID:function(e){},setSelectedMaterialID:function(e){},setCameraProps:function(e){},materials:{},setMaterials:function(e){}},v=Object(i.createContext)(m),f=function(e){var t=e.children,n=Object(i.useState)([{id:Object(h.v4)(),name:"Main Camera",type:"camera",visible:!0,castShadow:!1,receiveShadow:!1,parent:null,children:[],components:{Transform:{position:{x:0,y:8.8,z:38},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}},cameraProps:{fov:70,near:.1,far:1e3}},{id:Object(h.v4)(),name:"Ambient Light",type:"light",visible:!0,castShadow:!1,receiveShadow:!1,parent:null,children:[],components:{Transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:6,y:6,z:6}}},lightProps:{type:"ambient",color:"#ffffff",intensity:.4}},{id:Object(h.v4)(),name:"Directional Light",type:"light",visible:!0,castShadow:!0,receiveShadow:!0,parent:null,children:[],components:{Transform:{position:{x:0,y:10,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}},lightProps:{type:"directional",color:"#ffffff",intensity:.1}},{id:Object(h.v4)(),name:"Plane",type:"basic",visible:!0,castShadow:!0,receiveShadow:!0,material:"phong",geometry:"plane",parent:null,children:[],components:{Transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}}]),o=Object(d.a)(n,2),a=o[0],r=o[1],c=Object(i.useState)(null),l=Object(d.a)(c,2),u=l[0],m=l[1],f=Object(i.useState)(null),b=Object(d.a)(f,2),y=b[0],g=b[1],_=Object(i.useState)({}),j=Object(d.a)(_,2),w=j[0],O=j[1],E=Object(i.useMemo)((function(){return{entities:a,materials:Object.values(w)}}),[a,w]);Object(i.useEffect)((function(){var e=function(e){"Escape"===e.key&&(m(null),g(null),p.a.deselectEntity())};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[]),Object(i.useEffect)((function(){if(u){var e=a.find((function(e){return e.id===u}));if(!e)return;p.a.updateSpecificEntity(u,e)}}),[E]);var x={sceneConfig:E,selectedEntityID:u,selectedMaterialID:y,setEntities:r,setSelectedEntityID:m,setSelectedMaterialID:g,materials:w,setMaterials:O};return Object(s.jsx)(v.Provider,{value:x,children:t})},b={scripts:{},selectedScript:void 0,scriptBody:"",setScriptBody:function(e){},setScripts:function(e){},setSelectedScript:function(e){},compileScripts:function(){}},y=Object(i.createContext)(b),g="",_=function(e){g=e},j=function(e){var t=e.children,n=Object(i.useState)({}),o=Object(d.a)(n,2),a=o[0],r=o[1],c=Object(i.useState)(),l=Object(d.a)(c,2),u=l[0],h=l[1],m=function(){p.a.compileScripts(Object.values(a))};Object(i.useEffect)((function(){m()}),[a]);var v={scripts:a,setScripts:r,scriptBody:g,setScriptBody:_,selectedScript:u,setSelectedScript:h,compileScripts:m};return Object(s.jsx)(y.Provider,{value:v,children:t})},w=n(10),O=n(17),E=n(28),x=function(){var e=Object(i.useContext)(v),t=e.sceneConfig,n=e.setEntities,o=e.selectedEntityID,a=e.setSelectedEntityID,r=e.materials,s=e.setMaterials,c=e.selectedMaterialID,l=e.setSelectedMaterialID,u=Object(i.useMemo)((function(){var e;return null!==(e=t.entities.find((function(e){return e.id===o})))&&void 0!==e?e:null}),[t,o]),d=Object(i.useMemo)((function(){var e;return null!==(e=t.materials.find((function(e){return e.id===c})))&&void 0!==e?e:null}),[t,c]);return{sceneConfig:t,selectedEntity:u,selectedMaterial:d,createEntity:function(e,i){console.debug("adding new entity");var o=t.entities;if(i){e.parent=i.id,i.children.push(e.id);var a=o.findIndex((function(e){return e.id===i.id}));-1===a&&console.error("Couldn't find ".concat(e.id," in currEntities")),o[a]=i}n([].concat(Object(O.a)(o),[e])),p.a.addNewEntity(e)},selectEntity:function(e){if(e===o)return p.a.selectEntity(""),void a("");p.a.selectEntity(e),l(""),a(e)},updateEntity:function(e){var i=t.entities.findIndex((function(t){return t.id===e.id}));-1===i&&console.error("Couldn't find ".concat(e.id," in sceneConfig.entities")),t.entities[i]=e,n(Object(O.a)(t.entities))},removeEntity:function(e){var i=t.entities.findIndex((function(t){return t.id===e}));-1===i&&console.error("Couldn't find ".concat(e," in sceneConfig.entities")),t.entities.splice(i,1),n(Object(O.a)(t.entities)),p.a.removeEntity(e)},updateEntityParent:function(e,t){},createMaterial:function(e,t,n){var i=r,o=Object(E.b)(e,t,n);i[e]=o,s(Object(w.a)({},i)),p.a.updateSceneMaterials(Object.values(i))},selectMaterial:function(e){e!==c?(l(e),a("")):l("")},_setEntities:n,_setMaterials:s}},M=n(25),S=n(21),P=n(15),C=n(2),k=n(3),I=n(48),T=n.n(I),L=n(49),A=function(){function e(){Object(C.a)(this,e)}return Object(k.a)(e,null,[{key:"Export",value:function(t){var n=new T.a,i=n.folder("project");null===i||void 0===i||i.file("scene.json",JSON.stringify(t)),null===i||void 0===i||i.file("index.html",e.generateHtmlFile(t)),null===i||void 0===i||i.file("index.js",e.generateJsFile(t)),n.generateAsync({type:"blob"}).then((function(e){Object(L.saveAs)(e,"example.zip")}))}},{key:"generateHtmlFile",value:function(e){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n    <title>Document</title>\n</head>\n<body>\n    <div id="app"></div>\n    <script src="index.js"><\/script>\n</body>\n</html>'}},{key:"generateJsFile",value:function(e){return"// import threejs from cdn\n//import * as THREE from 'three'\n\n"}}]),e}(),D=n(39),R=function(){var e=Object(i.useContext)(y),t=e.scripts,n=e.setScripts,o=e.selectedScript,a=e.setSelectedScript,r=e.compileScripts;return{scripts:Object(i.useMemo)((function(){return Object.values(t)}),[t]),_setScripts:n,scriptBody:g,setScriptBody:_,selectedScript:o,setSelectedScript:a,loadScript:function(e){var n,i,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";console.debug("loading script",e,r,t),"id"===r?o=t[e]:"name"===r&&(o=Object.values(t).find((function(t){return t.name===e}))),a(o),_(null!==(n=null===(i=o)||void 0===i?void 0:i.content)&&void 0!==n?n:"")},saveScript:function(e){var i=t[e.id];i&&(i.content=g,"component"===e.type?r():n(Object(w.a)({},t)))},createScript:function(e){var i=[],o=t;return e.forEach((function(e){var t=Object(E.c)(e.name,e.language,e.type);i.push(t),o[t.id]=t})),n(Object(w.a)({},o)),i},updateScriptName:function(e,i){var o=t;if(!Object.values(t).map((function(e){return e.name})).includes(e)){var a=o[i].name;o[i].name=e,p.a.renameComponent(e,a),n(Object(w.a)({},o))}},_compileScripts:r}},N=function(e){var t=R(),n=t.scripts,o=t._setScripts,a=x(),r=a.sceneConfig,s=a.selectEntity,c=a._setEntities,u=a._setMaterials,h=Object(i.useContext)(l),m=h.renderElement,v=h.localScenePayload,f=Object(i.useState)(p.a.isPlaying()),b=Object(d.a)(f,2),y=b[0],g=b[1];Object(i.useEffect)((function(){if(v&&e){var t=Object.fromEntries(v.scripts.map((function(e){return[e.id,e]})));o(t),D.a.CompileScripts(v.scripts),c(v.sceneConfig.entities);var n=Object.fromEntries(v.sceneConfig.materials.map((function(e){return[e.id,e]})));u(n),p.a.updateScenePayload(v,!0)}}),[c,u,o,v,e]);var _=Object(i.useMemo)((function(){return{sceneConfig:r,scripts:n}}),[r,n]);Object(i.useEffect)((function(){m&&m.current&&_&&e&&p.a.init(m.current,_)}),[m,e]),Object(i.useEffect)((function(){e&&_&&p.a.updateScenePayload(_)}),[n]);return{renderElement:m,isRunning:y,toggleRun:function(){if(m&&m.current){if(P.a.isPlaying())return g(!1),void p.a.runEditMode();p.a.updateScenePayload(_),p.a.runPlayMode(),g(!0)}},handleClickScene:function(e){var t,n=e.target;n.focus();var i=n.getBoundingClientRect(),o=(e.clientX-i.x)/i.width*2-1,a=-(e.clientY-i.y)/i.height*2+1;p.a.handleClick(o,a),s(null!==(t=p.a.getSelectedEntity())&&void 0!==t?t:"")},saveScene:function(){localStorage.setItem("scenePayload",JSON.stringify(_))},exportScene:function(){A.Export(_)},forceUpdateScenePayload:function(){p.a.updateScenePayload(_)}}},z=n(24);function H(e){var t=e.label,n=e.bodyClass,i=e.children;return Object(s.jsxs)("div",{className:"bg-gray-800 p-1 h-full border border-gray-900 text-white",children:[Object(s.jsx)("h4",{className:"font-mono text-xs text-red-500 mb-1",children:t}),Object(s.jsx)("div",{className:"".concat(null!==n&&void 0!==n?n:""," space-y-1"),children:i})]})}var V=n(12),Y="",X=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(M.d)((function(){var o=Object.entries(t).map((function(e){var t=Object(d.a)(e,2),i=t[0],o=t[1],a=Object(h.v4)();return[a,{value:o,label:i,onEditStart:function(){Y=a},onChange:function(e){Y===a&&n(e,i)},onEditEnd:function(){Y=""}}]})),a=Object.fromEntries(o);return Object(V.a)({},e,Object(M.c)(Object(w.a)(Object(w.a)({},a),i)))}))};function B(e){var t=e.cameraProps,n=e.updateCameraProps;return X("Camera",t,(function(e,i){var o=Object(w.a)({},t);o[i]=e,n(o)})),Object(s.jsx)(s.Fragment,{})}var Z=function(e){var t=e.componentType,n=e.componentProps,i=(e.componentScriptID,e.updateComponent),o=e.removeComponent,a=R().loadScript;return X(t,n,(function(e,n){i(t,n,e)}),"Transform"!==t?{"Open File":Object(M.b)((function(){return a(t,"name")})),"Remove Component":Object(M.b)(o)}:void 0),Object(s.jsx)(s.Fragment,{})};function Q(e){var t=e.lightProps,n=e.updateLightProps;return X("Light",t,(function(e,i){var o=Object(w.a)({},t);o[i]=e,n(o)})),Object(s.jsx)(s.Fragment,{})}var F=n(33),U=n(23);function G(e){var t,n,o=e.selectedEntity,a=x().updateEntity,r=Object(i.useState)(null!==(t=o.material)&&void 0!==t?t:"phong"),c=Object(d.a)(r,2),l=c[0],u=c[1],h=Object(i.useState)(null!==(n=o.geometry)&&void 0!==n?n:"box"),p=Object(d.a)(h,2),m=p[0],v=p[1],f=Object.keys(U.a.instance.materials).map((function(e){return{label:e,value:e}})),b=Object.keys(F.a.instance.geometries).map((function(e){return{label:e,value:e}}));return Object(s.jsx)("section",{children:Object(s.jsxs)("div",{className:"bg-gray-800 text-white",children:[Object(s.jsx)("h3",{children:"Mesh"}),Object(s.jsxs)("div",{className:"space-y-2",children:[Object(s.jsxs)("div",{className:"flex space-x-2 items-center",children:[Object(s.jsx)("p",{className:"inspector-field-label",children:"Material"}),Object(s.jsx)("select",{onChange:function(e){return t=e.target.value,u(t),void(o&&(o.material=t,a(Object(w.a)({},o))));var t},value:l,children:f.map((function(e){return Object(s.jsx)("option",{value:e.value,children:e.label},e.value)}))})]}),Object(s.jsxs)("div",{className:"flex space-x-2 items-center",children:[Object(s.jsx)("p",{className:"inspector-field-label",children:"Geometry"}),Object(s.jsx)("select",{onChange:function(e){return t=e.target.value,v(t),void(o&&(o.geometry=t,a(Object(w.a)({},o))));var t},value:m,children:b.map((function(e){return Object(s.jsx)("option",{value:e.value,children:e.label},e.value)}))})]})]})]})})}function W(e){var t,n=e.selectedEntity,o=x(),a=o.updateEntity,r=o.createEntity,c=o.removeEntity,l=o.sceneConfig,u=N().isRunning,h=Object(i.useState)({}),p=Object(d.a)(h,2),m=p[0],v=p[1];Object(i.useEffect)((function(){n&&function(e){var t={};Object.entries(e.components).forEach((function(e){var n=Object(d.a)(e,2),i=n[0],o=n[1];t[i]=o})),v(Object(w.a)({},t))}(n)}),[n,l,u]);var f=function(e,t,i){var o=Object(w.a)({},m);o[e][t]=i,v(o),n&&(n.components=o,a(Object(w.a)({},n)))},b=function(){var e=S.a.instance.getComponents();if(!n)return[];var t=Object.keys(null===n||void 0===n?void 0:n.components);return Object.keys(e).filter((function(e){return!t.includes(e)})).map((function(e){return{label:e,value:e}}))}();return Object(s.jsxs)(H,{label:"Inspector",children:[Object(s.jsxs)("div",{className:"flex items-center justify-between",children:[Object(s.jsx)("h1",{children:Object(s.jsx)("input",{className:"transition bg-gray-800 hover:bg-gray-700 focus:bg-gray-900",type:"text",defaultValue:null===n||void 0===n?void 0:n.name,onBlur:function(e){return t=e.target.value,void(n&&"camera"!==n.type&&a(Object(w.a)(Object(w.a)({},n),{},{name:t})));var t},disabled:"camera"===(null===n||void 0===n?void 0:n.type),onKeyDown:function(e){return"Enter"===e.key&&e.target.blur()}},null!==(t=null===n||void 0===n?void 0:n.id)&&void 0!==t?t:"")}),Object(s.jsx)("div",{className:"text-xs font-light underline cursor-pointer text-red-400 transition hover:text-red-300",onClick:function(){n&&c(n.id)},children:"Remove"})]}),Object(s.jsxs)("section",{className:"space-y-2 py-2",children:[Object(s.jsxs)("div",{className:"flex space-x-2",children:[Object(s.jsx)("p",{className:"inspector-field-label",children:"Visible"}),Object(s.jsx)("input",{type:"checkbox",checked:n.visible,onChange:function(e){return a(Object(w.a)(Object(w.a)({},n),{},{visible:e.target.checked}))}})]}),!("light"===n.type&&n.lightProps&&"ambient"===n.lightProps.type)&&Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{className:"flex space-x-2",children:[Object(s.jsx)("p",{className:"inspector-field-label",children:"Cast shadow"}),Object(s.jsx)("input",{type:"checkbox",checked:n.castShadow,onChange:function(e){return a(Object(w.a)(Object(w.a)({},n),{},{castShadow:e.target.checked}))}})]}),Object(s.jsxs)("div",{className:"flex space-x-2",children:[Object(s.jsx)("p",{className:"inspector-field-label",children:"Receive shadow"}),Object(s.jsx)("input",{type:"checkbox",checked:n.receiveShadow,onChange:function(e){return a(Object(w.a)(Object(w.a)({},n),{},{receiveShadow:e.target.checked}))}})]})]})]}),"light"===n.type&&n.lightProps&&Object(s.jsx)(Q,{lightProps:n.lightProps,updateLightProps:function(e){n&&(n.lightProps=e,a(Object(w.a)({},n)))}},n.id),"camera"===n.type&&n.cameraProps&&Object(s.jsx)(B,{cameraProps:n.cameraProps,updateCameraProps:function(e){n&&(n.cameraProps=e,a(Object(w.a)({},n)))}}),Object(s.jsxs)("section",{className:"space-y-2",children:[Object.entries(m).map((function(e){var t=Object(d.a)(e,2),i=t[0],o=t[1];return Object(s.jsx)(Z,{componentType:i,componentProps:o,componentScriptID:"",updateComponent:f,removeComponent:function(){return function(e){n&&(delete n.components[e],a(n))}(i)}},"".concat(i,"--").concat(n.id))})),Object(s.jsx)(M.a,{fill:!0,flat:!0,titleBar:!1})]}),"basic"===n.type&&Object(s.jsx)(G,{selectedEntity:n}),b.length>0&&Object(s.jsxs)("section",{className:"pt-4 flex items-center space-x-4 ",children:[Object(s.jsx)("select",{onChange:function(e){return console.log(e.target.value)},children:b.map((function(e){var t=e.label,n=e.value;return Object(s.jsx)("option",{value:n,children:t},n)}))}),Object(s.jsx)("div",{className:"grid place-items-center whitespace-nowrap",children:Object(s.jsx)("button",{onClick:function(){return function(e){if(n){var t=S.a.instance.getComponentProps(e);t&&(n.components[e]=t,a(n))}}(b[0].value)},children:"Add Component"})})]}),Object(s.jsx)("div",{className:"pt-2",children:Object(s.jsx)("button",{onClick:function(){var e=Object(z.a)();r(e,n)},className:"block mx-auto",children:"Add Child"})})]})}function K(e){var t=e.selectedMaterial,n=R().loadScript;return Object(s.jsxs)(H,{label:"Inspector",children:[Object(s.jsx)("h1",{children:t.name}),Object(s.jsxs)("section",{children:["Fragment shader"," ",Object(s.jsx)("small",{className:"text-xs font-light underline text-gray-400 cursor-pointer transition hover:text-gray-300",onClick:function(){n(t.fragmentShaderID)},children:"Open in editor"})]}),Object(s.jsxs)("section",{children:["Vertex shader"," ",Object(s.jsx)("small",{className:"text-xs font-light underline text-gray-400 cursor-pointer transition hover:text-gray-300",onClick:function(){n(t.vertexShaderID)},children:"Open in editor"})]})]})}function q(){var e=x(),t=e.selectedEntity,n=e.selectedMaterial;return n?Object(s.jsx)(K,{selectedMaterial:n}):t?Object(s.jsx)(W,{selectedEntity:t}):Object(s.jsx)(s.Fragment,{})}function J(){var e=x(),t=e.createEntity,n=e.createMaterial,i=N(!0),o=i.toggleRun,a=i.isRunning,r=i.saveScene,c=(i.exportScene,R()),l=c.createScript,u=c.selectedScript,h=c.loadScript,p=c.saveScript,m=c.scriptBody;return Object(s.jsxs)("div",{children:[Object(s.jsx)("header",{className:"h-0.5 transition bg-red-600 ".concat(a&&"bg-green-500")}),Object(s.jsxs)("nav",{className:"bg-gray-900 p-2 flex w-full shadow-sm",children:[Object(s.jsxs)("div",{className:"space-x-2",children:[Object(s.jsxs)("button",{onClick:o,className:"primary",children:[a?"Stop":"Run"," Scene"]}),Object(s.jsx)("button",{onClick:function(){var e=Object(z.a)();t(e)},className:"secondary",children:"Add Entity"}),Object(s.jsx)("button",{onClick:function(){var e=Object(z.b)();t(e)},className:"secondary",children:"Add Light"}),Object(s.jsx)("button",{onClick:function(){l([{name:"NewComponent",language:"js",type:"component"}])},className:"secondary",children:"Add Component"}),Object(s.jsx)("button",{onClick:function(){var e=l([{name:"vertex",language:"glsl",type:"vertex"},{name:"fragment",language:"glsl",type:"fragment"}]),t=Object(d.a)(e,2),i=t[0],o=t[1];n("NewMaterial",i.id,o.id)},className:"secondary",children:"Add Material"}),Object(s.jsx)("button",{onClick:function(){r()},className:"secondary",children:"Save Scene"})]}),u&&Object(s.jsxs)("div",{className:"space-x-2 ml-auto",children:[Object(s.jsx)("button",{className:"secondary",onClick:function(){h("")},children:"Close Editor"}),Object(s.jsx)("button",{onClick:function(){u&&p(Object(w.a)(Object(w.a)({},u),{},{content:m}))},className:"submit",children:"Save script"})]})]})]})}var $=n(50);function ee(){var e=R(),t=e.selectedScript,n=e.scriptBody,o=e.setScriptBody;Object(i.useEffect)((function(){!n&&t&&o(t.content)}),[t]);return Object(s.jsx)(s.Fragment,{children:t&&Object(s.jsx)(s.Fragment,{children:Object(s.jsx)("div",{className:"absolute h-full w-full",children:Object(s.jsx)($.a,{height:"100%",width:"100%",defaultLanguage:function(){if(!t)return"javascript";switch(t.language){case"js":return"javascript";case"ts":return"typescript";case"glsl":return"c";default:return"cpp"}}(),defaultValue:t.content,theme:"vs-dark",onChange:function(e){o(null!==e&&void 0!==e?e:"")},defaultPath:"/src/modal"})},t.id)})})}function te(){var e=N(),t=e.renderElement,n=e.handleClickScene;return Object(s.jsx)(s.Fragment,{children:t&&Object(s.jsx)("div",{id:"scene",ref:t,tabIndex:-1,onMouseDown:function(e){return n(e)}})})}var ne=function e(t){var n,o=t.entity,a=t.parent,r=x(),c=r.selectedEntity,l=r.selectEntity,u=r.sceneConfig,d=Object(i.useMemo)((function(){return(null===c||void 0===c?void 0:c.id)===o.id}),[c,o.id]),h=Object(i.useMemo)((function(){return!o.visible}),[o]),p=Object(i.useMemo)((function(){if(o.children.length<=0)return[];return o.children.map((function(e){return t=e,u.entities.find((function(e){return e.id===t}));var t}))}),[o,u]);return o.parent!==a?Object(s.jsx)(s.Fragment,{}):Object(s.jsxs)("div",{className:"\n          p-1\n          rounded-sm\n          transition\n          cursor-pointer\n          select-none\n        text-white\n          text-sm\n          ".concat(d&&"bg-gray-500","\n          ").concat(d?"hover:bg-gray-600":"hover:bg-gray-500","\n          ").concat(h&&"opacity-50","\n\n    "),onMouseDown:function(e){e.stopPropagation(),l(o.id)},children:[null!==(n=o.name)&&void 0!==n?n:"__ENTITY__",p.map((function(t){return t&&Object(s.jsx)(e,{entity:t,parent:o.id},t.id)}))]})};function ie(){var e=x().sceneConfig;return Object(s.jsx)(H,{label:"Hierarchy",children:Object(s.jsx)("div",{className:"space-y-1",children:e.entities.map((function(e){return Object(s.jsx)(ne,{entity:e,parent:null},e.id)}))})})}function oe(e){var t=e.title,n=e.children;return Object(s.jsxs)("details",{children:[Object(s.jsx)("summary",{children:t}),null!==n&&void 0!==n?n:"No ".concat(t)]})}function ae(e){var t,n=e.script,o=R(),a=o.loadScript,r=o.selectedScript,c=o.updateScriptName,l=Object(i.useRef)(null);return Object(s.jsx)("div",{className:"project-node\n          cursor-pointer\n          ".concat((null===r||void 0===r?void 0:r.id)===n.id&&"bg-gray-500","\n          ").concat((null===r||void 0===r?void 0:r.id)===n.id?"hover:bg-gray-600":"hover:bg-gray-500"),onClick:function(e){e.preventDefault(),e.stopPropagation(),a(n.id)},onContextMenu:function(e){var t;e.preventDefault(),e.stopPropagation(),null===l||void 0===l||null===(t=l.current)||void 0===t||t.focus()},children:Object(s.jsx)("input",{ref:l,className:"bg-transparent cursor-pointer",type:"text",defaultValue:n.name,onBlur:function(e){return c(e.target.value,n.id)},onKeyDown:function(e){return"Enter"===e.key&&e.target.blur()}},null!==(t=n.id)&&void 0!==t?t:"")},n.id)}function re(){var e=x(),t=e.sceneConfig,n=e.selectedMaterial,i=e.selectMaterial,o=R().scripts;return Object(s.jsxs)(H,{label:"Project",bodyClass:"space-y-2",children:[Object(s.jsx)(oe,{title:"Scripts",children:o.filter((function(e){return"component"===e.type})).map((function(e){return Object(s.jsx)(ae,{script:e},e.id)}))}),Object(s.jsx)(oe,{title:"Prefabs"}),Object(s.jsx)(oe,{title:"Materials",children:t.materials.map((function(e){return Object(s.jsx)("div",{className:"project-node ".concat((null===n||void 0===n?void 0:n.id)===e.id&&"bg-gray-500","\n          ").concat((null===n||void 0===n?void 0:n.id)===e.id?"hover:bg-gray-600":"hover:bg-gray-500"),onClick:function(){return i(e.id)},children:e.name},e.id)}))})]})}function se(){var e=x(),t=e.selectedEntity,n=e.selectedMaterial,o=Object(i.useMemo)((function(){return!!t||!!n}),[t,n]);return Object(s.jsxs)("div",{className:"w-screen h-screen overflow-hidden",children:[Object(s.jsx)(J,{}),Object(s.jsxs)("section",{className:"w-full h-full grid main-wrapper",children:[Object(s.jsxs)("div",{className:"h-full w-full grid relative",children:[Object(s.jsx)(te,{}),Object(s.jsx)(ee,{})]}),o?Object(s.jsx)("aside",{className:"grid",children:Object(s.jsx)(q,{})}):Object(s.jsxs)("aside",{className:"grid grid-rows-5",children:[Object(s.jsx)("div",{className:"row-span-3",children:Object(s.jsx)(ie,{})}),Object(s.jsx)("div",{className:"row-span-2",children:Object(s.jsx)(re,{})})]})]})]})}var ce=function(){return Object(s.jsx)(j,{children:Object(s.jsx)(f,{children:Object(s.jsx)(u,{children:Object(s.jsx)(se,{})})})})};r.a.render(Object(s.jsx)(o.a.StrictMode,{children:Object(s.jsx)(ce,{})}),document.getElementById("root"))}},[[81,1,2]]]);
//# sourceMappingURL=main.bbdaecc7.chunk.js.map