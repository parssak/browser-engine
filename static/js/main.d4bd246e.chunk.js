(this["webpackJsonpbrowser-engine"]=this["webpackJsonpbrowser-engine"]||[]).push([[0],[,,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(0),a=n(1),o=n(7),r=n(25),s=n(16),c=n(24),l=n(22),u=n(17),d=n(14),h=new(function(){function e(){Object(i.a)(this,e),this.sceneManager=void 0,this.cameraManager=void 0,this.componentManager=void 0,this.materialManager=void 0,this.geometryManager=void 0,this.controlsManager=void 0,this.time=new o.Clock,this._renderElement=void 0,this.isInitialized=!1,this.sceneManager=new d.a,this.cameraManager=new r.a,this.componentManager=new s.a,this.materialManager=new u.a,this.geometryManager=new l.a,this.controlsManager=new c.a}return Object(a.a)(e,[{key:"init",value:function(e,t){this.isInitialized||(console.log("called init"),this._renderElement=e,t&&this.updateScenePayload(t),this.runEditMode(),this.isInitialized=!0)}},{key:"runPlayMode",value:function(){this.time.elapsedTime=0,this.time.start(),this.sceneManager.runPlayScene(),this.cameraManager.setup(this._renderElement,this.sceneManager.getScene())}},{key:"runEditMode",value:function(){this.time.stop(),this.sceneManager.runEditScene(),this.cameraManager.setup(this._renderElement,this.sceneManager.getScene())}},{key:"updateScenePayload",value:function(e){console.log("updating scene payload"),this.sceneManager.setScenePayload(e)}},{key:"updateSpecificEntity",value:function(e,t){this.sceneManager.updateEntityPayload(e,t)}},{key:"addNewEntity",value:function(e){this.sceneManager.buildEntity(e)}},{key:"isPlaying",value:function(){var e;return null!==(e=d.a.isPlaying())&&void 0!==e&&e}},{key:"handleClick",value:function(e,t){this.cameraManager.handleClick(e,t)}},{key:"selectEntity",value:function(e){this.sceneManager.selectByID(e)}},{key:"getSelectedEntity",value:function(){return this.sceneManager.getSelectedEntity()}},{key:"getSelectedEntityProps",value:function(){return this.sceneManager.getSelectedEntityPayload()}}]),e}());t.a=h},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n(0),a=n(1),o=n(7),r=n(25),s=n(9),c=n(16),l=n(17),u=n(22),d=function(){function e(t){Object(i.a)(this,e),this.name="",this.mesh=void 0,this.id=void 0,this.components={},this.id=t.id,this.name=t.name,this.init(t)}return Object(a.a)(e,[{key:"init",value:function(e){this.initMesh(e),this.initComponents(e.components)}},{key:"initMesh",value:function(e){var t=l.a.instance.getMaterial(e.material),n=u.a.instance.getGeometry(e.geometry);this.mesh?(this.mesh.geometry=n,this.mesh.material=t):this.mesh=new o.Mesh(n,t),this.mesh.uuid=this.id,this.mesh.name=this.name}},{key:"initComponents",value:function(e){var t=this;this.components={},Object.entries(e).forEach((function(e){var n=Object(s.a)(e,2),i=n[0],a=n[1];c.a.instance.setComponent(t,i,a)}))}},{key:"addChild",value:function(e){}},{key:"destroy",value:function(){}},{key:"start",value:function(){h.isPlaying()&&this._startComponents()}},{key:"update",value:function(e,t){h.isPlaying()&&this._updateComponents();var n=this.mesh.material;n.uniforms&&(n.uniforms.time.value=t)}},{key:"getComponent",value:function(e){return this.components[e]}},{key:"_startComponents",value:function(){Object.values(this.components).forEach((function(e){return e.start()}))}},{key:"_updateComponents",value:function(){Object.values(this.components).forEach((function(e){return e.update()}))}}]),e}(),h=function(){function e(){var t=this;(Object(i.a)(this,e),this.isPlaying=!1,this._scene=void 0,this._entities=[],this._scenePayload=void 0,this._selectedEntityID=void 0,this._axes=new o.AxesHelper(2),this._gridHelper=new o.GridHelper(60,6),this._selectionHelper=void 0,e.instance)||(e.instance=this,this._scene=new o.Scene,this._scene.add(this._axes),this._scene.add(this._gridHelper),this._scene.add(new o.DirectionalLight(16777215,.6)),this._scene.add(new o.AmbientLight(5592405)),(new o.TextureLoader).load("/browser-engine/resources/skybox.png",(function(e){var n=new o.WebGLCubeRenderTarget(e.image.height);n.fromEquirectangularTexture(r.a.instance.renderer,e),t._scene.background=n.texture})))}return Object(a.a)(e,[{key:"getScene",value:function(){return this._scene}},{key:"setScenePayload",value:function(e){this._scenePayload=e,this._compileMaterials(),console.debug("recompiling mats")}},{key:"getSelectedEntityPayload",value:function(){var e,t=this;return null===(e=this._scenePayload)||void 0===e?void 0:e.sceneConfig.entities.find((function(e){return e.id===t._selectedEntityID}))}},{key:"updateEntityPayload",value:function(e,t){var n,i=this._entities.findIndex((function(t){return t.id===e}));-1!==i&&(this._entities[i].init(t),null===(n=this._selectionHelper)||void 0===n||n.setFromObject(this._entities[i].mesh))}},{key:"updateScene",value:function(e,t){this._entities.forEach((function(n){n.update(e,t)}))}},{key:"runPlayScene",value:function(){this.isPlaying=!0,this._resetScene(),this._scene.remove(this._axes),this._scene.remove(this._gridHelper),this._selectionHelper&&this._scene.remove(this._selectionHelper);try{this._buildEntities(),this._startEntities()}catch(e){console.error("Error whilst setting up play scene")}}},{key:"runEditScene",value:function(){this.isPlaying=!1,this._resetScene(),this._scene.add(this._axes),this._scene.add(this._gridHelper),this._selectionHelper&&this._scene.add(this._selectionHelper),this._buildEntities()}},{key:"selectByID",value:function(e){var t,n;this.select(null!==(t=null===(n=this._entities.find((function(t){return t.id===e})))||void 0===n?void 0:n.mesh)&&void 0!==t?t:void 0)}},{key:"select",value:function(e){if(!this.isPlaying){if(!e&&this._selectionHelper&&this._selectedEntityID)return this._scene.remove(this._selectionHelper),void(this._selectedEntityID=void 0);if(e){var t;if(this._selectedEntityID=e.uuid,!this._selectionHelper)return this._selectionHelper=new o.BoxHelper(e,16776960),void this._scene.add(this._selectionHelper);null===(t=this._selectionHelper)||void 0===t||t.setFromObject(e),this._scene.add(this._selectionHelper)}}}},{key:"getSelectedEntity",value:function(){return this._selectedEntityID}},{key:"buildEntity",value:function(e){var t=new d(e);return this._entities.push(t),this._scene.add(t.mesh),t}},{key:"_startEntities",value:function(){this._entities.forEach((function(e){e.start()}))}},{key:"_resetScene",value:function(){var e=this;this._entities.forEach((function(t){e._scene.remove(t.mesh),t.destroy()})),this._entities=[]}},{key:"_buildEntities",value:function(){var e,t=this;this._scenePayload&&(e=this._scenePayload,JSON.parse(JSON.stringify(e))).sceneConfig.entities.forEach((function(e){t.buildEntity(e)}))}},{key:"_compileMaterials",value:function(){var e=this;this._scenePayload&&this._scenePayload.sceneConfig.materials.forEach((function(t){var n,i,a=null===(n=e._scenePayload)||void 0===n?void 0:n.scripts.find((function(e){return e.id===t.vertexShaderID})),o=null===(i=e._scenePayload)||void 0===i?void 0:i.scripts.find((function(e){return e.id===t.fragmentShaderID}));if(a&&o){var r={material:t,vertexShader:a.content,fragmentShader:o.content};l.a.instance.addCustomMaterial(r)}}))}}],[{key:"isPlaying",value:function(){return e.instance.isPlaying}}]),e}();h.instance=void 0},,function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(9),a=n(11),o=n(0),r=n(1),s=n(7),c=n(2),l=n(3),u=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).entity=void 0,i.position=new s.Vector3(0,0,0),i.rotation=new s.Euler(0,0,0,"XYZ"),i.scale=new s.Vector3(1,1,1),i.entity=e,i}return Object(r.a)(n,[{key:"init",value:function(e){var t,n,i;this.position=null!==(t=null===e||void 0===e?void 0:e.position)&&void 0!==t?t:this.position,this.rotation=null!==(n=null===e||void 0===e?void 0:e.rotation)&&void 0!==n?n:this.rotation,this.scale=null!==(i=null===e||void 0===e?void 0:e.scale)&&void 0!==i?i:this.scale,this.applyMatrix()}},{key:"start",value:function(){this.applyMatrix()}},{key:"applyPosition",value:function(){this.entity.mesh.position.setX(this.position.x),this.entity.mesh.position.setY(this.position.y),this.entity.mesh.position.setZ(this.position.z)}},{key:"applyRotation",value:function(){this.entity.mesh.setRotationFromEuler(new s.Euler(this.rotation.x,this.rotation.y,this.rotation.z))}},{key:"applyScale",value:function(){this.entity.mesh.scale.setX(this.scale.x),this.entity.mesh.scale.setY(this.scale.y),this.entity.mesh.scale.setZ(this.scale.z)}},{key:"applyMatrix",value:function(){this.entity&&(this.applyPosition(),this.applyRotation(),this.applyScale())}},{key:"update",value:function(){this.applyMatrix()}}]),n}(n(26).a),d=function(){function e(){Object(o.a)(this,e),this.components={},e.instance||(e.instance=this,this.registerComponent("Transform",u,{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}))}return Object(r.a)(e,[{key:"getComponents",value:function(){return Object(a.a)({},this.components)}},{key:"registerComponent",value:function(e,t,n){this.components[e]={constructor:t,props:n}}},{key:"getComponentProps",value:function(e){var t,n=null!==(t=this.components[e].props)&&void 0!==t?t:null;return n||null}},{key:"getComponent",value:function(e){var t;return null!==(t=this.components[e].constructor)&&void 0!==t?t:null}},{key:"setComponent",value:function(e,t,n){var a=this.getComponent(t);if(a){Object.entries(n).forEach((function(e){var t=Object(i.a)(e,2),a=t[0],o=t[1];Array.isArray(o)&&(3===o.length?n[a]=new s.Vector3(o[0],o[1],o[2]):2===o.length&&(n[a]=new s.Vector2(o[0],o[1])))}));var o=new a(e);try{o.init(n),e.components[t]=o}catch(r){console.error("Error whilst initializing component",r)}}else console.error("Component ".concat(t," not found"))}}]),e}();d.instance=void 0},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(11),a=n(0),o=n(1),r=n(7),s=function(){function e(){Object(a.a)(this,e),this.materials={normal:new r.MeshNormalMaterial,basic:new r.MeshBasicMaterial,phong:new r.MeshPhongMaterial,lambert:new r.MeshLambertMaterial,wireframe:new r.MeshBasicMaterial({wireframe:!0})},e.instance||(e.instance=this)}return Object(o.a)(e,[{key:"getMaterial",value:function(e){var t;return null!==(t=this.materials[e])&&void 0!==t?t:this.materials.basic}},{key:"addCustomMaterial",value:function(e){var t=e.material;this.materials[t.name]=new r.ShaderMaterial({uniforms:Object(i.a)(Object(i.a)({},t.uniforms),{},{time:{value:0}}),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}]),e}();s.instance=void 0},,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"b",(function(){return d}));var i=n(9),a=n(18),o="// @defineComponent",r="class Component {\n  \n  // <public>\n\n  // </public>\n\n  ".concat(o,"\n\n  start() {\n    \n  }\n\n  update() {\n\n  }\n}"),s=function(e,t,n){var i=Object(a.v4)(),o=r;switch(n){case"component":o=r;break;case"vertex":o="uniform float time;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";break;case"fragment":o="uniform float time;\n\nvoid main() {\n  gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n}"}return{id:i,name:e,language:t,content:o,type:n}},c="// <initPropPlaceholder />",l=function(e){return"(".concat(e.content,")").replace(o,"\n          entity;\n        \n          constructor(entity) {\n            this.entity = entity;\n          }\n\n          ".concat(c,"\n        "))},u=function(e,t){var n="\n  init(props) {\n    this.transform = this.entity.getComponent('Transform');\n    ".concat(Object.entries(t).map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return"this.".concat(n," = props?.").concat(n," ?? ").concat(a,";")})).join("\n"),"\n  }");return e.replace(c,n)},d=function(e,t,n){return{id:Object(a.v4)(),name:e,vertexShaderID:t,fragmentShaderID:n,uniforms:{}}}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(0),a=n(1),o=n(7),r=function(){function e(){Object(i.a)(this,e),this.geometries={box:new o.BoxBufferGeometry,sphere:new o.SphereBufferGeometry(1,16,16),cylinder:new o.CylinderBufferGeometry(1,1,1,16,1),torus:new o.TorusBufferGeometry(6,1.1,10,32,6.3),plane:new o.PlaneBufferGeometry(1,1),tetrahedron:new o.TetrahedronBufferGeometry,octahedron:new o.OctahedronBufferGeometry,dodecahedron:new o.DodecahedronBufferGeometry,icosahedron:new o.IcosahedronBufferGeometry},e.instance||(e.instance=this)}return Object(a.a)(e,[{key:"getGeometry",value:function(e){var t;return null!==(t=this.geometries[e])&&void 0!==t?t:this.geometries.box}}]),e}();r.instance=void 0},,function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(0),a=n(1),o=n(12),r=n(2),s=n(3),c=n(7),l={type:"change"},u=function(e){Object(r.a)(n,e);var t=Object(s.a)(n);function n(e,a){var r;Object(i.a)(this,n),r=t.call(this),void 0===a&&(console.warn('THREE.FlyControls: The second parameter "domElement" is now mandatory.'),a=document),r.object=e,r.domElement=a,r.movementSpeed=1,r.rollSpeed=.005,r.dragToLook=!1,r.autoForward=!1;var s=Object(o.a)(r),u=1e-6,h=new c.Quaternion,m=new c.Vector3;r.tmpQuaternion=new c.Quaternion,r.mouseStatus=0,r.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},r.moveVector=new c.Vector3(0,0,0),r.rotationVector=new c.Vector3(0,0,0),r.keydown=function(e){if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},r.keyup=function(e){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},r.mousedown=function(e){if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},r.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}},r.mouseup=function(e){if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},r.update=function(e){var t=e*s.movementSpeed,n=e*s.rollSpeed;s.object.translateX(s.moveVector.x*t),s.object.translateY(s.moveVector.y*t),s.object.translateZ(s.moveVector.z*t),s.tmpQuaternion.set(s.rotationVector.x*n,s.rotationVector.y*n,s.rotationVector.z*n,1).normalize(),s.object.quaternion.multiply(s.tmpQuaternion),(m.distanceToSquared(s.object.position)>u||8*(1-h.dot(s.object.quaternion))>u)&&(s.dispatchEvent(l),h.copy(s.object.quaternion),m.copy(s.object.position))},r.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},r.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},r.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},r.dispose=function(){this.domElement.removeEventListener("contextmenu",d),this.domElement.removeEventListener("mousedown",f),this.domElement.removeEventListener("mousemove",p),this.domElement.removeEventListener("mouseup",v),window.removeEventListener("keydown",b),window.removeEventListener("keyup",y)};var p=r.mousemove.bind(Object(o.a)(r)),f=r.mousedown.bind(Object(o.a)(r)),v=r.mouseup.bind(Object(o.a)(r)),b=r.keydown.bind(Object(o.a)(r)),y=r.keyup.bind(Object(o.a)(r));return r.domElement.addEventListener("contextmenu",d),r.domElement.addEventListener("mousemove",p),r.domElement.addEventListener("mousedown",f),r.domElement.addEventListener("mouseup",v),window.addEventListener("keydown",b),window.addEventListener("keyup",y),r.updateMovementVector(),r.updateRotationVector(),r}return n}(c.EventDispatcher);function d(e){e.preventDefault()}var h={type:"change"},m={type:"start"},p={type:"end"},f=function(e){Object(r.a)(n,e);var t=Object(s.a)(n);function n(e,a){var r;Object(i.a)(this,n),r=t.call(this),void 0===a&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),a===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),r.object=e,r.domElement=a,r.domElement.style.touchAction="none",r.enabled=!0,r.target=new c.Vector3,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.enableDamping=!1,r.dampingFactor=.05,r.enableZoom=!0,r.zoomSpeed=1,r.enableRotate=!0,r.rotateSpeed=1,r.enablePan=!0,r.panSpeed=7,r.screenSpacePanning=!0,r.keyPanSpeed=15,r.autoRotate=!1,r.autoRotateSpeed=2,r.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},r.mouseButtons={LEFT:c.MOUSE.ROTATE,MIDDLE:c.MOUSE.DOLLY,RIGHT:c.MOUSE.PAN},r.touches={ONE:c.TOUCH.ROTATE,TWO:c.TOUCH.DOLLY_PAN},r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object.zoom,r._domElementKeyEvents=null,r.getPolarAngle=function(){return f.phi},r.getAzimuthalAngle=function(){return f.theta},r.getDistance=function(){return this.object.position.distanceTo(this.target)},r.listenToKeyEvents=function(e){e.addEventListener("keydown",J),this._domElementKeyEvents=e},r.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},r.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(h),s.update(),u=l.NONE},r.update=function(){var t=new c.Vector3,n=(new c.Quaternion).setFromUnitVectors(e.up,new c.Vector3(0,1,0)),i=n.clone().invert(),a=new c.Vector3,o=new c.Quaternion,r=2*Math.PI;return function(){var e=s.object.position;t.copy(e).sub(s.target),t.applyQuaternion(n),f.setFromVector3(t),s.autoRotate&&u===l.NONE&&N(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(f.theta+=v.theta*s.dampingFactor,f.phi+=v.phi*s.dampingFactor):(f.theta+=v.theta,f.phi+=v.phi);var c=s.minAzimuthAngle,m=s.maxAzimuthAngle;return isFinite(c)&&isFinite(m)&&(c<-Math.PI?c+=r:c>Math.PI&&(c-=r),m<-Math.PI?m+=r:m>Math.PI&&(m-=r),f.theta=c<=m?Math.max(c,Math.min(m,f.theta)):f.theta>(c+m)/2?Math.max(c,f.theta):Math.min(m,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=b,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),!0===s.enableDamping?s.target.addScaledVector(y,s.dampingFactor):s.target.add(y),t.setFromSpherical(f),t.applyQuaternion(i),e.copy(s.target).add(t),s.object.lookAt(s.target),!0===s.enableDamping?(v.theta*=1-s.dampingFactor,v.phi*=1-s.dampingFactor,y.multiplyScalar(1-s.dampingFactor)):(v.set(0,0,0),y.set(0,0,0)),b=1,!!(_||a.distanceToSquared(s.object.position)>d||8*(1-o.dot(s.object.quaternion))>d)&&(s.dispatchEvent(h),a.copy(s.object.position),o.copy(s.object.quaternion),_=!1,!0)}}(),r.dispose=function(){s.domElement.removeEventListener("contextmenu",$),s.domElement.removeEventListener("pointerdown",X),s.domElement.removeEventListener("pointercancel",q),s.domElement.removeEventListener("wheel",Q),s.domElement.removeEventListener("pointermove",Z),s.domElement.removeEventListener("pointerup",G),null!==s._domElementKeyEvents&&s._domElementKeyEvents.removeEventListener("keydown",J)};var s=Object(o.a)(r),l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},u=l.NONE,d=1e-6,f=new c.Spherical,v=new c.Spherical,b=1,y=new c.Vector3,_=!1,g=new c.Vector2,j=new c.Vector2,O=new c.Vector2,E=new c.Vector2,x=new c.Vector2,w=new c.Vector2,S=new c.Vector2,k=new c.Vector2,C=new c.Vector2,M=[],P={};function T(){return Math.pow(.95,s.zoomSpeed)}function N(e){v.theta-=e}function D(e){v.phi-=e}var L=function(){var e=new c.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),y.add(e)}}(),R=function(){var e=new c.Vector3;return function(t,n){!0===s.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),y.add(e)}}(),A=function(){var e=new c.Vector3;return function(t,n){var i=s.domElement;if(s.object.isPerspectiveCamera){var a=s.object.position;e.copy(a).sub(s.target);var o=e.length();o*=Math.tan(s.object.fov/2*Math.PI/180),L(2*t*o/i.clientHeight,s.object.matrix),R(2*n*o/i.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(L(t*(s.object.right-s.object.left)/s.object.zoom/i.clientWidth,s.object.matrix),R(n*(s.object.top-s.object.bottom)/s.object.zoom/i.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function I(e){s.object.isPerspectiveCamera?b/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),_=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function V(e){s.object.isPerspectiveCamera?b*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),_=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function z(e){g.set(e.clientX,e.clientY)}function H(e){E.set(e.clientX,e.clientY)}function U(){if(1===M.length)g.set(M[0].pageX,M[0].pageY);else{var e=.5*(M[0].pageX+M[1].pageX),t=.5*(M[0].pageY+M[1].pageY);g.set(e,t)}}function B(){if(1===M.length)E.set(M[0].pageX,M[0].pageY);else{var e=.5*(M[0].pageX+M[1].pageX),t=.5*(M[0].pageY+M[1].pageY);E.set(e,t)}}function K(){var e=M[0].pageX-M[1].pageX,t=M[0].pageY-M[1].pageY,n=Math.sqrt(e*e+t*t);S.set(0,n)}function Y(e){if(1==M.length)j.set(e.pageX,e.pageY);else{var t=ne(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);j.set(n,i)}O.subVectors(j,g).multiplyScalar(s.rotateSpeed);var a=s.domElement;N(2*Math.PI*O.x/a.clientHeight),D(2*Math.PI*O.y/a.clientHeight),g.copy(j)}function W(e){if(1===M.length)x.set(e.pageX,e.pageY);else{var t=ne(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);x.set(n,i)}w.subVectors(x,E).multiplyScalar(s.panSpeed),A(w.x,w.y),E.copy(x)}function F(e){var t=ne(e),n=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(n*n+i*i);k.set(0,a),C.set(0,Math.pow(k.y/S.y,s.zoomSpeed)),I(C.y),S.copy(k)}function X(e){!1!==s.enabled&&(0===M.length&&(s.domElement.setPointerCapture(e.pointerId),s.domElement.addEventListener("pointermove",Z),s.domElement.addEventListener("pointerup",G)),function(e){M.push(e)}(e),"touch"===e.pointerType?function(e){switch(te(e),M.length){case 1:switch(s.touches.ONE){case c.TOUCH.ROTATE:if(!1===s.enableRotate)return;U(),u=l.TOUCH_ROTATE;break;case c.TOUCH.PAN:if(!1===s.enablePan)return;B(),u=l.TOUCH_PAN;break;default:u=l.NONE}break;case 2:switch(s.touches.TWO){case c.TOUCH.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;s.enableZoom&&K(),s.enablePan&&B(),u=l.TOUCH_DOLLY_PAN;break;case c.TOUCH.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;s.enableZoom&&K(),s.enableRotate&&U(),u=l.TOUCH_DOLLY_ROTATE;break;default:u=l.NONE}break;default:u=l.NONE}u!==l.NONE&&s.dispatchEvent(m)}(e):function(e){var t;switch(e.button){case 0:t=s.mouseButtons.LEFT;break;case 1:t=s.mouseButtons.MIDDLE;break;case 2:t=s.mouseButtons.RIGHT;break;default:t=-1}switch(t){case c.MOUSE.DOLLY:if(!1===s.enableZoom)return;!function(e){S.set(e.clientX,e.clientY)}(e),u=l.DOLLY;break;case c.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;H(e),u=l.PAN}else{if(!1===s.enableRotate)return;z(e),u=l.ROTATE}break;case c.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;z(e),u=l.ROTATE}else{if(!1===s.enablePan)return;H(e),u=l.PAN}break;default:u=l.NONE}u!==l.NONE&&s.dispatchEvent(m)}(e))}function Z(e){!1!==s.enabled&&("touch"===e.pointerType?function(e){switch(te(e),u){case l.TOUCH_ROTATE:if(!1===s.enableRotate)return;Y(e),s.update();break;case l.TOUCH_PAN:if(!1===s.enablePan)return;W(e),s.update();break;case l.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&F(e),s.enablePan&&W(e)}(e),s.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&F(e),s.enableRotate&&Y(e)}(e),s.update();break;default:u=l.NONE}}(e):function(e){if(!1===s.enabled)return;switch(u){case l.ROTATE:if(!1===s.enableRotate)return;!function(e){j.set(e.clientX,e.clientY),O.subVectors(j,g).multiplyScalar(s.rotateSpeed);var t=s.domElement;N(2*Math.PI*O.x/t.clientHeight),D(2*Math.PI*O.y/t.clientHeight),g.copy(j),s.update()}(e);break;case l.DOLLY:if(!1===s.enableZoom)return;!function(e){k.set(e.clientX,e.clientY),C.subVectors(k,S),C.y>0?I(T()):C.y<0&&V(T()),S.copy(k),s.update()}(e);break;case l.PAN:if(!1===s.enablePan)return;!function(e){x.set(e.clientX,e.clientY),w.subVectors(x,E).multiplyScalar(s.panSpeed),A(w.x,w.y),E.copy(x),s.update()}(e)}}(e))}function G(e){!1!==s.enabled&&(e.pointerType,s.dispatchEvent(p),u=l.NONE,ee(e),0===M.length&&(s.domElement.releasePointerCapture(e.pointerId),s.domElement.removeEventListener("pointermove",Z),s.domElement.removeEventListener("pointerup",G)))}function q(e){ee(e)}function Q(e){!1===s.enabled||!1===s.enableZoom||u!==l.NONE&&u!==l.ROTATE||(e.preventDefault(),s.dispatchEvent(m),function(e){e.deltaY<0?V(T()):e.deltaY>0&&I(T()),s.update()}(e),s.dispatchEvent(p))}function J(e){!1!==s.enabled&&!1!==s.enablePan&&function(e){var t=!1;if("scene"===document.activeElement.id){switch(e.code){case"KeyW":V(.3),t=!0;break;case"KeyS":I(.3),t=!0;break;case s.keys.UP:case"Space":A(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:A(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:case"KeyA":A(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT||"d":case"KeyD":A(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}}(e)}function $(e){!1!==s.enabled&&e.preventDefault()}function ee(e){delete P[e.pointerId];for(var t=0;t<M.length;t++)if(M[t].pointerId==e.pointerId)return void M.splice(t,1)}function te(e){var t=P[e.pointerId];void 0===t&&(t=new c.Vector2,P[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ne(e){var t=e.pointerId===M[0].pointerId?M[1]:M[0];return P[t.pointerId]}return s.domElement.addEventListener("contextmenu",$),s.domElement.addEventListener("pointerdown",X),s.domElement.addEventListener("pointercancel",q),s.domElement.addEventListener("wheel",Q,{passive:!1}),r.update(),r}return n}(c.EventDispatcher),v=function(){function e(){Object(i.a)(this,e),this.controls=void 0,e.instance||(e.instance=this)}return Object(a.a)(e,[{key:"setControls",value:function(e,t,n){switch(e){case"fly":this._setFlyControls(t,n);break;case"orbit":this._setOrbitControls(t,n);break;default:console.warn("Control type: ".concat(e," not found"))}}},{key:"_setFlyControls",value:function(e,t){this.controls&&(this.controls.enabled=!1),this.controls=new u(e,t),this.controls.movementSpeed=33}},{key:"_setOrbitControls",value:function(e,t){this.controls&&(this.controls.enabled=!1),this.controls=new f(e,t),this.controls.listenToKeyEvents(window)}},{key:"updateControls",value:function(e){this.controls&&this.controls.update(e)}}]),e}();v.instance=void 0},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),a=n(1),o=n(7),r=n(24),s=n(14),c=function(){function e(){var t=this;if(Object(i.a)(this,e),this.renderer=new o.WebGLRenderer({antialias:!0,alpha:!0}),this.renderElement=void 0,this.raycaster=new o.Raycaster,this.fov=60,this.near=.01,this.far=2e4,this.camera=void 0,this.currentControls="orbit",this.clock=new o.Clock,e.instance)return e.instance;e.instance=this,this._setCamera(),window.addEventListener("resize",(function(){return t.handleResize()}))}return Object(a.a)(e,[{key:"setup",value:function(e,t){this.renderer.setSize(e.clientWidth,e.clientHeight),this.renderElement=e,this.renderElement.appendChild(this.renderer.domElement),this.handleResize(),this._setControls(),this._setRaycaster(),this._runSceneLoop(t)}},{key:"handleClick",value:function(e,t){var n=new o.Vector2(e,t);this.raycaster.setFromCamera(n,this.camera);var i=this.raycaster.intersectObjects(s.a.instance.getScene().children,!0).filter((function(e){return"Mesh"===e.object.type}));i.length>0?s.a.instance.select(i[0].object):s.a.instance.select()}},{key:"_setCamera",value:function(){this.renderElement||(this.camera=new o.PerspectiveCamera(this.fov,window.innerWidth/window.innerHeight,this.near,this.far),this.camera.position.y=10,this.camera.rotation.x=-.1,this.camera.position.z=50)}},{key:"_runSceneLoop",value:function(e){var t=this;this.renderer.setAnimationLoop((function(n){return t.update(e)}))}},{key:"_setRaycaster",value:function(){this.raycaster=new o.Raycaster}},{key:"_setControls",value:function(){this.renderElement&&r.a.instance.setControls(this.currentControls,this.camera,this.renderer.domElement)}},{key:"handleResize",value:function(){if(this.renderElement){var e=this.renderElement.getBoundingClientRect();this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.width,e.height),this.renderer.setPixelRatio(window.devicePixelRatio)}}},{key:"update",value:function(e){this.renderer.render(e,this.camera);var t=this.clock.getDelta(),n=this.clock.getElapsedTime();s.a.instance.updateScene(t,n),r.a.instance.updateControls(t)}}]),e}();c.instance=void 0},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(1),n(2),n(3);var i=n(0),a=function e(t){Object(i.a)(this,e),this.entity=void 0,this.entity=t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(18),a=function(){return{id:Object(i.v4)(),name:"New Entity",geometry:"box",material:"normal",children:[],components:{Transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}}}},,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ScriptCompiler}));var _Users_parssa_projects_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Users_parssa_projects_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),three__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7),_engine_core_Component__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(26),_engine_core_ComponentManager__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(16),_engine_core_EngineContext__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(13),_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(14),_entity_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(27),_script_utils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(19),ScriptCompiler=function(){function ScriptCompiler(){Object(_Users_parssa_projects_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,ScriptCompiler)}return Object(_Users_parssa_projects_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__.a)(ScriptCompiler,null,[{key:"CompileScripts",value:function(e){Object.values(e).forEach((function(e){try{"component"===e.type&&ScriptCompiler.CompileComponentScript(e)}catch(t){console.error(t)}}))}},{key:"CompileComponentScript",value:function CompileComponentScript(script){var THREE=three__WEBPACK_IMPORTED_MODULE_2__,Instantiate=_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__.a.instance.buildEntity.bind(_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__.a.instance),CreateEntity=_entity_utils__WEBPACK_IMPORTED_MODULE_7__.a,Time=_engine_core_EngineContext__WEBPACK_IMPORTED_MODULE_5__.a.time,scriptCopy="".concat(script.content),removePrefix=scriptCopy.substring(scriptCopy.indexOf("// <public>")+11),pureProps=removePrefix.substring(0,removePrefix.indexOf("// </public>"));pureProps=pureProps.replaceAll(";",","),pureProps=pureProps.replaceAll("=",":");var props={};"".concat(pureProps).replace(/\s/g,"").length&&(pureProps="{".concat(pureProps,"}"),props=eval("(".concat(pureProps,")")));var formattedScript=Object(_script_utils__WEBPACK_IMPORTED_MODULE_8__.a)(script);formattedScript=Object(_script_utils__WEBPACK_IMPORTED_MODULE_8__.d)(formattedScript,props);var NewComponent=eval("(".concat(formattedScript,")"));Object.setPrototypeOf(NewComponent,_engine_core_Component__WEBPACK_IMPORTED_MODULE_3__.a),_engine_core_ComponentManager__WEBPACK_IMPORTED_MODULE_4__.a.instance.registerComponent(script.name,NewComponent,props)}}]),ScriptCompiler}()},,,,,,function(e,t,n){},,,,,,,function(e,t,n){"use strict";n.r(t);var i=n(6),a=n.n(i),o=n(32),r=n.n(o),s=(n(39),n(4)),c={},l=Object(i.createContext)(c),u=function(e){var t=e.children,n={renderElement:Object(i.useRef)(null)};return Object(s.jsx)(l.Provider,{value:n,children:t})},d=n(9),h=n(7),m=n(18),p=n(13),f={sceneConfig:{entities:[],camera:{position:new h.Vector3,fov:70,near:.1,far:1e3,controls:"orbit"},materials:[]},selectedEntityID:null,selectedMaterialID:null,setEntities:function(e){},setSelectedEntityID:function(e){},setSelectedMaterialID:function(e){},setCameraProps:function(e){},materials:{},setMaterials:function(e){}},v=Object(i.createContext)(f),b=function(e){var t=e.children,n=Object(i.useState)({position:new h.Vector3,fov:70,near:.1,far:1e3,controls:"orbit"}),a=Object(d.a)(n,2),o=a[0],r=a[1],c=Object(i.useState)([{id:Object(m.v4)(),name:"Entity A",material:"normal",geometry:"box",children:[],components:{Transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}}]),l=Object(d.a)(c,2),u=l[0],f=l[1],b=Object(i.useState)(null),y=Object(d.a)(b,2),_=y[0],g=y[1],j=Object(i.useState)(null),O=Object(d.a)(j,2),E=O[0],x=O[1],w=Object(i.useState)({}),S=Object(d.a)(w,2),k=S[0],C=S[1],M=Object(i.useMemo)((function(){return{entities:u,camera:o,materials:Object.values(k)}}),[u,o,k]);Object(i.useEffect)((function(){if(_){var e=u.find((function(e){return e.id===_}));if(!e)return;p.a.updateSpecificEntity(_,e)}}),[M]);var P={sceneConfig:M,selectedEntityID:_,selectedMaterialID:E,setEntities:f,setCameraProps:r,setSelectedEntityID:g,setSelectedMaterialID:x,materials:k,setMaterials:C};return Object(s.jsx)(v.Provider,{value:P,children:t})},y=n(33),_={scripts:{},selectedScript:void 0,scriptBody:"",setScriptBody:function(e){},setScripts:function(e){},setSelectedScript:function(e){},compileScripts:function(){}},g=Object(i.createContext)(_),j=function(e){var t,n=e.children,a=Object(i.useState)({}),o=Object(d.a)(a,2),r=o[0],c=o[1],l=Object(i.useState)(),u=Object(d.a)(l,2),h=u[0],m=u[1],p=Object(i.useState)(null!==(t=null===h||void 0===h?void 0:h.content)&&void 0!==t?t:""),f=Object(d.a)(p,2),v=f[0],b=f[1],_=function(){y.a.CompileScripts(Object.values(r))};Object(i.useEffect)((function(){_(),console.log("SHOULD COMPILE SCRIPTS")}),[r]);var j={scripts:r,setScripts:c,scriptBody:v,setScriptBody:b,selectedScript:h,setSelectedScript:m,compileScripts:_};return Object(s.jsx)(g.Provider,{value:j,children:n})},O=n(11),E=n(29),x=n(27),w=n(19),S=function(){var e=Object(i.useContext)(v),t=e.sceneConfig,n=e.setEntities,a=e.selectedEntityID,o=e.setSelectedEntityID,r=e.materials,s=e.setMaterials,c=e.selectedMaterialID,l=e.setSelectedMaterialID,u=Object(i.useMemo)((function(){var e;return null!==(e=t.entities.find((function(e){return e.id===a})))&&void 0!==e?e:null}),[t,a]),d=Object(i.useMemo)((function(){var e;return null!==(e=t.materials.find((function(e){return e.id===c})))&&void 0!==e?e:null}),[t,c]);return{sceneConfig:t,selectedEntity:u,selectedMaterial:d,createEntity:function(){var e=Object(x.a)();n([].concat(Object(E.a)(t.entities),[e])),p.a.addNewEntity(e)},selectEntity:function(e){if(e===a)return p.a.selectEntity(""),void o("");p.a.selectEntity(e),o(e),l("")},updateEntity:function(e){var i=t.entities.findIndex((function(t){return t.id===e.id}));-1===i&&console.error("Couldn't find ".concat(e.id," in sceneConfig.entities")),t.entities[i]=e,n(Object(E.a)(t.entities))},updateEntityParent:function(e,t){},createMaterial:function(e,t,n){var i=r,a=Object(w.b)(e,t,n);i[e]=a,s(Object(O.a)({},i))},selectMaterial:function(e){e!==c?(l(e),o("")):l("")}}};function k(e){var t=e.label,n=e.bodyClass,i=e.children;return Object(s.jsxs)("div",{className:"bg-gray-800 p-1 h-full border border-gray-900 text-white",children:[Object(s.jsx)("h4",{className:"font-mono text-xs text-red-500 mb-1",children:t}),Object(s.jsx)("div",{className:"".concat(null!==n&&void 0!==n?n:""," space-y-1"),children:i})]})}var C=n(16),M=n(22),P=n(17),T=n(14),N=function(){var e=Object(i.useContext)(g),t=e.scripts,n=e.setScripts,a=e.selectedScript,o=e.setSelectedScript,r=e.compileScripts,s=e.scriptBody,c=e.setScriptBody;return{scripts:Object.values(t),scriptBody:s,setScriptBody:c,selectedScript:a,setSelectedScript:o,loadScript:function(e){var n,i,a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name";"name"===r?a=t[e]:"id"===r&&(a=Object.values(t).find((function(t){return t.id===e}))),o(a),c(null!==(n=null===(i=a)||void 0===i?void 0:i.content)&&void 0!==n?n:"")},saveScript:function(e){var n=Object.values(t).find((function(t){return t.id===e.id}));n&&(n.content=s,r())},createScript:function(e){var i=[],a=t;return e.forEach((function(e){var t=Object(w.c)(e.name,e.language,e.type);i.push(t),a[t.name]=t})),n(Object(O.a)({},a)),i}}},D=function(){var e=N().scripts,t=S(),n=t.sceneConfig,a=t.selectEntity,o=Object(i.useContext)(l).renderElement,r=Object(i.useState)(p.a.isPlaying()),s=Object(d.a)(r,2),c=s[0],u=s[1],h=Object(i.useMemo)((function(){return{sceneConfig:n,scripts:e}}),[n,e]);Object(i.useEffect)((function(){o&&o.current&&h&&p.a.init(o.current,h)}),[o]),Object(i.useEffect)((function(){console.log("scene config change")}),[n]),Object(i.useEffect)((function(){console.log("scripts change")}),[e]),Object(i.useEffect)((function(){p.a.updateScenePayload(h)}),[h]);return{renderElement:o,isRunning:c,toggleRun:function(){if(o&&o.current){if(T.a.isPlaying())return u(!1),void p.a.runEditMode();p.a.runPlayMode(),u(!0)}},handleClickScene:function(e){var t,n=e.target;n.focus();var i=n.getBoundingClientRect(),o=(e.clientX-i.x)/i.width*2-1,r=-(e.clientY-i.y)/i.height*2+1;p.a.handleClick(o,r),a(null!==(t=p.a.getSelectedEntity())&&void 0!==t?t:"")}}},L=function(e){var t=e.field,n=e.updateField;return"number"===typeof t||"string"===typeof t?Object(s.jsx)("div",{className:"bg-gray-700 text-white px-1  w-max",children:Object(s.jsx)("input",{type:"string"===typeof t?"string":"number",value:t,onChange:function(e){"number"!==typeof t?"string"===typeof t&&n(e.target.value):n(Number(e.target.value))},className:"bg-gray-700 w-16 font-mono text-xs"})}):Array.isArray(t)?Object(s.jsx)("div",{children:"array field"}):Object(s.jsxs)("div",{className:"bg-gray-700 text-white px-2 grid grid-cols-3 gap-1",children:[Object(s.jsxs)("pre",{className:"text-xs p-0 m-0",children:[Object(s.jsx)("span",{className:"pr-2 text-xs text-gray-400",children:"x:"}),Object(s.jsx)("input",{type:"string"===typeof t?"string":"number",value:t.x,onChange:function(e){var i,a;return n({x:Number(e.target.value),y:null!==(i=null===t||void 0===t?void 0:t.y)&&void 0!==i?i:0,z:null!==(a=null===t||void 0===t?void 0:t.z)&&void 0!==a?a:0})},className:"bg-gray-700 w-12 font-mono text-xs"})]}),Object(s.jsxs)("pre",{className:"text-xs p-0 m-0",children:[Object(s.jsx)("span",{className:"pr-2 text-xs text-gray-400",children:"y:"}),Object(s.jsx)("input",{type:"string"===typeof t?"string":"number",value:t.y,onChange:function(e){var i,a;return n({x:null!==(i=null===t||void 0===t?void 0:t.x)&&void 0!==i?i:0,y:Number(e.target.value),z:null!==(a=null===t||void 0===t?void 0:t.z)&&void 0!==a?a:0})},className:"bg-gray-700 w-12 font-mono text-xs"})]}),Object(s.jsxs)("pre",{className:"text-xs p-0 m-0",children:[Object(s.jsx)("span",{className:"pr-2 text-xs text-gray-400",children:"z:"}),Object(s.jsx)("input",{type:"string"===typeof t?"string":"number",value:t.z,onChange:function(e){var i,a;return n({x:null!==(i=null===t||void 0===t?void 0:t.x)&&void 0!==i?i:0,y:null!==(a=null===t||void 0===t?void 0:t.y)&&void 0!==a?a:0,z:Number(e.target.value)})},className:"bg-gray-700 w-12 font-mono text-xs"})]})]})},R=function(e){var t=e.componentType,n=e.componentProps,i=e.updateComponent,a=N().loadScript;return Object(s.jsxs)("div",{className:"bg-gray-800 text-white pb-4",children:[Object(s.jsxs)("div",{className:"flex w-full justify-between items-center mb-2",children:[Object(s.jsx)("h3",{children:t}),"Transform"!==t&&Object(s.jsx)("small",{className:"text-xs font-light underline text-gray-400 cursor-pointer hover:text-gray-300",onClick:function(){a(t)},children:"Open in editor"})]}),Object(s.jsx)("div",{className:"space-y-2",children:Object.entries(n).map((function(e){var n=Object(d.a)(e,2),a=n[0],o=n[1];return Object(s.jsxs)("div",{className:"flex space-x-2",children:[Object(s.jsx)("p",{className:"text-xs capitalize text-gray-200",style:{minWidth:"10ch"},children:a}),Object(s.jsx)(L,{field:o,updateField:function(e){return i(t,a,e)}})]},a)}))}),Object(s.jsx)("hr",{className:"mt-4"})]})};function A(e){var t=e.selectedEntity,n=S(),a=n.updateEntity,o=n.sceneConfig,r=D().isRunning,c=Object(i.useState)({}),l=Object(d.a)(c,2),u=l[0],h=l[1],m=Object(i.useState)("normal"),p=Object(d.a)(m,2),f=p[0],v=p[1],b=Object(i.useState)("box"),y=Object(d.a)(b,2),_=y[0],g=y[1];Object(i.useEffect)((function(){t&&(v(t.material),g(t.geometry))}),[t]),Object(i.useEffect)((function(){t&&function(e){var t={};Object.entries(e.components).forEach((function(e){var n=Object(d.a)(e,2),i=n[0],a=n[1];t[i]=a})),h(Object(O.a)({},t))}(t)}),[t,o,r]);var j=function(e,n,i){var o=Object(O.a)({},u);o[e][n]=i,h(o),t&&(t.components=o,a(Object(O.a)({},t)))},E=function(){var e=C.a.instance.getComponents();if(!t)return[];var n=Object.keys(null===t||void 0===t?void 0:t.components);return Object.keys(e).filter((function(e){return!n.includes(e)})).map((function(e){return{label:e,value:e}}))}(),x=Object.keys(P.a.instance.materials).map((function(e){return{label:e,value:e}})),w=Object.keys(M.a.instance.geometries).map((function(e){return{label:e,value:e}}));return Object(s.jsxs)(k,{label:"Inspector",children:[Object(s.jsx)("h1",{children:null===t||void 0===t?void 0:t.name}),Object(s.jsx)("section",{className:"space-y-2",children:Object.entries(u).map((function(e){var t=Object(d.a)(e,2),n=t[0],i=t[1];return Object(s.jsx)(R,{componentType:n,componentProps:i,componentScriptID:"",updateComponent:j},n)}))}),E.length>0&&Object(s.jsxs)("section",{children:[Object(s.jsx)("select",{onChange:function(e){return console.log(e.target.value)},children:E.map((function(e){var t=e.label,n=e.value;return Object(s.jsx)("option",{value:n,children:t},n)}))}),Object(s.jsx)("div",{className:"grid place-items-center mt-2",children:Object(s.jsx)("button",{onClick:function(){return function(e){if(t){var n=C.a.instance.getComponentProps(e);n&&(t.components[e]=n,a(t))}}(E[0].value)},children:"Add Component"})})]}),Object(s.jsx)("section",{children:Object(s.jsxs)("div",{className:"bg-gray-800 text-white",children:[Object(s.jsx)("h3",{children:"Mesh"}),Object(s.jsxs)("div",{className:"space-y-2",children:[Object(s.jsxs)("div",{className:"flex space-x-2 items-center",children:[Object(s.jsx)("p",{className:"text-xs font-mono text-gray-200",style:{minWidth:"10ch"},children:"Material"}),Object(s.jsx)("select",{onChange:function(e){return n=e.target.value,v(n),void(t&&(t.material=n,a(Object(O.a)({},t))));var n},value:f,children:x.map((function(e){return Object(s.jsx)("option",{value:e.value,children:e.label},e.value)}))})]}),Object(s.jsxs)("div",{className:"flex space-x-2 items-center",children:[Object(s.jsx)("p",{className:"text-xs font-mono text-gray-200",style:{minWidth:"10ch"},children:"Geometry"}),Object(s.jsx)("select",{onChange:function(e){return n=e.target.value,g(n),void(t&&(t.geometry=n,a(Object(O.a)({},t))));var n},value:_,children:w.map((function(e){return Object(s.jsx)("option",{value:e.value,children:e.label},e.value)}))})]})]})]})})]})}function I(e){var t=e.selectedMaterial,n=N().loadScript;return Object(s.jsxs)(k,{label:"Inspector",children:[Object(s.jsx)("h1",{children:t.name}),Object(s.jsxs)("section",{children:["Fragment shader"," ",Object(s.jsx)("small",{className:"text-xs font-light underline text-gray-400 cursor-pointer hover:text-gray-300",onClick:function(){n(t.fragmentShaderID,"id")},children:"Open in editor"})]}),Object(s.jsxs)("section",{children:["Vertex shader"," ",Object(s.jsx)("small",{className:"text-xs font-light underline text-gray-400 cursor-pointer hover:text-gray-300",onClick:function(){n(t.vertexShaderID,"id")},children:"Open in editor"})]})]})}function V(){var e=S(),t=e.selectedEntity,n=e.selectedMaterial;return n?Object(s.jsx)(I,{selectedMaterial:n}):t?Object(s.jsx)(A,{selectedEntity:t}):Object(s.jsx)(k,{label:"Inspector"})}function z(){var e=S(),t=e.createEntity,n=e.createMaterial,i=D(),a=i.toggleRun,o=i.isRunning,r=N(),c=r.createScript,l=r.selectedScript,u=r.loadScript,h=r.saveScript,m=r.scriptBody;return Object(s.jsxs)("div",{children:[Object(s.jsx)("header",{className:"h-0.5 transition bg-red-600 ".concat(o&&"bg-green-500")}),Object(s.jsxs)("nav",{className:"bg-gray-900 p-2 flex w-full",children:[Object(s.jsxs)("div",{className:"space-x-2",children:[Object(s.jsxs)("button",{onClick:a,className:"primary",children:[o?"Stop":"Run"," Scene"]}),Object(s.jsx)("button",{onClick:t,className:"secondary",children:"Add Entity"}),Object(s.jsx)("button",{onClick:function(){c([{name:"NewComponent",language:"js",type:"component"}])},className:"secondary",children:"Add Component"}),Object(s.jsx)("button",{onClick:function(){var e=c([{name:"vertex",language:"glsl",type:"vertex"},{name:"fragment",language:"glsl",type:"fragment"}]),t=Object(d.a)(e,2),i=t[0],a=t[1];n("NewMaterial",i.id,a.id)},className:"secondary",children:"Add Material"})]}),l&&Object(s.jsxs)("div",{className:"space-x-2 ml-auto",children:[Object(s.jsx)("button",{className:"secondary",onClick:function(){u("")},children:"Close Editor"}),Object(s.jsx)("button",{onClick:function(){l&&h(Object(O.a)(Object(O.a)({},l),{},{content:m}))},className:"submit",children:"Save script"})]})]})]})}var H=n(34);function U(){var e=N(),t=e.selectedScript,n=e.scriptBody,a=e.setScriptBody;Object(i.useEffect)((function(){!n&&t&&a(t.content)}),[t]);return Object(s.jsx)(s.Fragment,{children:t&&Object(s.jsx)(s.Fragment,{children:Object(s.jsx)("div",{className:"absolute h-full w-full",children:Object(s.jsx)(H.a,{height:"100%",width:"100%",defaultLanguage:function(){if(!t)return"javascript";switch(t.language){case"js":return"javascript";case"ts":return"typescript";case"glsl":return"c";default:return"cpp"}}(),defaultValue:t.content,theme:"vs-dark",onChange:function(e){a(null!==e&&void 0!==e?e:"")},defaultPath:"/src/modal"})},t.id)})})}function B(){var e=D(),t=e.renderElement,n=e.handleClickScene;return Object(s.jsx)(s.Fragment,{children:t&&Object(s.jsx)("div",{id:"scene",ref:t,tabIndex:-1,onClick:function(e){return n(e)}})})}var K=function(e){var t,n=e.entity,a=S(),o=a.selectedEntity,r=a.selectEntity,c=Object(i.useMemo)((function(){return(null===o||void 0===o?void 0:o.id)===n.id}),[o,n.id]);return Object(s.jsx)("div",{className:"\n          p-1\n          rounded-sm\n          transition\n          cursor-pointer\n          select-none\n        text-white\n          text-sm\n          ".concat(c&&"bg-gray-500","\n          ").concat(c?"hover:bg-gray-600":"hover:bg-gray-500","\n    "),onClick:function(e){e.stopPropagation(),r(n.id)},children:null!==(t=null===n||void 0===n?void 0:n.name)&&void 0!==t?t:"__ENTITY__"})};function Y(){var e=S().sceneConfig;return Object(s.jsx)(k,{label:"Hierarchy",children:Object(s.jsx)("div",{className:"space-y-1",children:e.entities.map((function(e){return Object(s.jsx)(K,{entity:e},e.id)}))})})}function W(e){var t=e.title,n=e.children;return Object(s.jsxs)("details",{children:[Object(s.jsx)("summary",{children:t}),null!==n&&void 0!==n?n:"No ".concat(t)]})}function F(){var e=S(),t=e.sceneConfig,n=e.selectedMaterial,i=e.selectMaterial,a=N(),o=a.scripts,r=a.loadScript,c=a.selectedScript;return Object(s.jsxs)(k,{label:"Project",bodyClass:"space-y-2",children:[Object(s.jsx)(W,{title:"Scripts",children:o.map((function(e){return Object(s.jsxs)("div",{className:"project-node\n          ".concat((null===c||void 0===c?void 0:c.id)===e.id&&"bg-gray-500","\n          ").concat((null===c||void 0===c?void 0:c.id)===e.id?"hover:bg-gray-600":"hover:bg-gray-500"),onClick:function(){return r(e.name)},children:[e.name,".",e.language]},e.id)}))}),Object(s.jsx)(W,{title:"Prefabs"}),Object(s.jsx)(W,{title:"Materials",children:t.materials.map((function(e){return Object(s.jsx)("div",{className:"project-node ".concat((null===n||void 0===n?void 0:n.id)===e.id&&"bg-gray-500","\n          ").concat((null===n||void 0===n?void 0:n.id)===e.id?"hover:bg-gray-600":"hover:bg-gray-500"),onClick:function(){return i(e.id)},children:e.name},e.id)}))})]})}function X(){return Object(s.jsxs)("div",{className:"w-screen h-screen overflow-hidden",children:[Object(s.jsx)(z,{}),Object(s.jsxs)("section",{className:"w-full h-full grid",style:{gridTemplateColumns:"1fr 14rem 14rem"},children:[Object(s.jsxs)("div",{className:"h-full w-full grid relative",children:[Object(s.jsx)(B,{}),Object(s.jsx)(U,{})]}),Object(s.jsxs)("aside",{className:"grid grid-rows-5",children:[Object(s.jsx)("div",{className:"row-span-3",children:Object(s.jsx)(Y,{})}),Object(s.jsx)("div",{className:"row-span-2",children:Object(s.jsx)(F,{})})]}),Object(s.jsx)("aside",{className:"grid",children:Object(s.jsx)(V,{})})]})]})}var Z=function(){return Object(s.jsx)(j,{children:Object(s.jsx)(b,{children:Object(s.jsx)(u,{children:Object(s.jsx)(X,{})})})})};r.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(Z,{})}),document.getElementById("root"))}],[[46,1,2]]]);
//# sourceMappingURL=main.d4bd246e.chunk.js.map