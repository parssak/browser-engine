(this["webpackJsonpbrowser-engine"]=this["webpackJsonpbrowser-engine"]||[]).push([[0],{14:function(e,t,n){"use strict";var i=n(1),a=n(2),r=n(7),o=n(23),c=n(19),s=n(25),l=n(29),u=n(21),d=n(16),h=new(function(){function e(){Object(i.a)(this,e),this.sceneManager=void 0,this.cameraManager=void 0,this.componentManager=void 0,this.materialManager=void 0,this.geometryManager=void 0,this.controlsManager=void 0,this.time=new r.Clock,this._renderElement=void 0,this.isInitialized=!1,this.sceneManager=new d.a,this.cameraManager=new o.a,this.componentManager=new c.a,this.materialManager=new u.a,this.geometryManager=new l.a,this.controlsManager=new s.a}return Object(a.a)(e,[{key:"init",value:function(e,t){this.isInitialized||(this._renderElement=e,t&&this.updateScenePayload(t,!0),this.runEditMode(),this.isInitialized=!0)}},{key:"runPlayMode",value:function(){this.time.elapsedTime=0,this.time.start(),this.sceneManager.runPlayScene();var e=this.sceneManager.getScene().getObjectByName("Main Camera");this.cameraManager.useSceneCamera(e),this.cameraManager.setup(this._renderElement,this.sceneManager.getScene())}},{key:"runEditMode",value:function(){this.time.stop(),this.sceneManager.runEditScene(),this.cameraManager.useEditCamera(),this.cameraManager.setup(this._renderElement,this.sceneManager.getScene())}},{key:"updateScenePayload",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.sceneManager.setScenePayload(e,t)}},{key:"updateSceneMaterials",value:function(e){this.sceneManager.setSceneMaterials(e)}},{key:"updateSpecificEntity",value:function(e,t){this.sceneManager.updateEntityPayload(e,t)}},{key:"addNewEntity",value:function(e){this.sceneManager.buildEntity(e)}},{key:"isPlaying",value:function(){var e;return null!==(e=d.a.isPlaying())&&void 0!==e&&e}},{key:"handleClick",value:function(e,t){this.cameraManager.handleClick(e,t)}},{key:"selectEntity",value:function(e){this.sceneManager.selectByID(e)}},{key:"getSelectedEntity",value:function(){return this.sceneManager.getSelectedEntity()}},{key:"getSelectedEntityProps",value:function(){return this.sceneManager.getSelectedEntityPayload()}}]),e}());t.a=h},16:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(1),a=n(2),r=n(7),o=n(23),c=n(25),s=n(6),l=n(19),u=n(21),d=n(29),h=function(){function e(t){Object(i.a)(this,e),this.id=void 0,this.name="",this.type=void 0,this.components={},this.mesh=void 0,this.light=void 0,this.camera=void 0,this.id=t.id,this.name=t.name,this.type=t.type,this.init(t)}return Object(a.a)(e,[{key:"init",value:function(e){this._initObject(e),this._appendIdentifiers(e.id,e.name),this._initComponents(e.components)}},{key:"start",value:function(){p.isPlaying()&&this._startComponents()}},{key:"update",value:function(e,t){var n;p.isPlaying()&&this._updateComponents();var i=null===this||void 0===this||null===(n=this.mesh)||void 0===n?void 0:n.material;(null===i||void 0===i?void 0:i.uniforms)&&(i.uniforms.time.value=t)}},{key:"destroy",value:function(){}},{key:"getComponent",value:function(e){return this.components[e]}},{key:"getObject",value:function(){return this.mesh||this.light||this.camera}},{key:"_startComponents",value:function(){Object.values(this.components).forEach((function(e){return e.start()}))}},{key:"_updateComponents",value:function(){Object.values(this.components).forEach((function(e){return e.update()}))}},{key:"_initComponents",value:function(e){var t=this;this.components={},Object.entries(e).forEach((function(e){var n=Object(s.a)(e,2),i=n[0],a=n[1];l.a.instance.setComponent(t,i,a)}))}},{key:"_initObject",value:function(e){"basic"===e.type&&e.geometry&&e.material?this._initMesh(e.material,e.geometry):"light"===e.type&&e.lightProps?this._initLight(e.lightProps):"camera"===e.type&&e.cameraProps&&this._initCamera(e.cameraProps);var t=this.getObject();t&&(t.visible=e.visible,t.castShadow=e.castShadow,t.receiveShadow=e.receiveShadow)}},{key:"_initMesh",value:function(e,t){var n=u.a.instance.getMaterial(e),i=d.a.instance.getGeometry(t);this.mesh?(this.mesh.geometry=i,this.mesh.material=n):this.mesh=new r.Mesh(i,n)}},{key:"_initCamera",value:function(e){if(this.camera){var t=this.camera;t.fov=e.fov,t.aspect=o.a.instance.getAspect(),t.near=e.near,t.far=e.far}else this.camera=new r.PerspectiveCamera(e.fov,o.a.instance.getAspect(),e.near,e.far)}},{key:"_initLight",value:function(e){this.light||(this.light=function(e){switch(e.type){case"ambient":return new r.AmbientLight(e.color,e.intensity);case"directional":return new r.DirectionalLight(e.color,e.intensity);case"hemisphere":return new r.HemisphereLight(e.color,e.color2,e.intensity);case"point":return new r.PointLight(e.color,e.intensity);default:return new r.AmbientLight(e.color,e.intensity)}}(e)),this.light.intensity=e.intensity;var t=this.light;t.color?t.color=new r.Color(e.color):t.groundColor&&(t.groundColor=new r.Color(e.color)),t.skyColor&&e.color2&&(t.skyColor=new r.Color(e.color2))}},{key:"_appendIdentifiers",value:function(e,t){var n=this.getObject();n&&(n.uuid=e,n.name=t)}}]),e}(),p=function(){function e(){var t=this;if(Object(i.a)(this,e),this.isPlaying=!1,this._scene=void 0,this._entities=[],this._scenePayload=void 0,this._scenePayloadInitialized=!1,this._selectedEntityID=void 0,this._axes=new r.AxesHelper(2),this._gridHelper=new r.GridHelper(1e3,200),this._cameraHelper=new r.CameraHelper(new r.PerspectiveCamera),this._selectionHelper=void 0,this._lightHelpers=[],e.instance)return e.instance;e.instance=this,this._scene=new r.Scene,this._scene.add(this._axes),this._scene.add(this._gridHelper),this._selectionHelper=new r.BoxHelper(this._gridHelper,16776960),this._scene.add(this._selectionHelper),this._selectionHelper.visible=!1,(new r.TextureLoader).load("/browser-engine/resources/skybox.png",(function(e){var n=new r.WebGLCubeRenderTarget(e.image.height);n.fromEquirectangularTexture(o.a.instance.renderer,e),t._scene.background=n.texture}))}return Object(a.a)(e,[{key:"getScene",value:function(){return this._scene}},{key:"setScenePayload",value:function(e,t){t&&this._scenePayloadInitialized||(this._scenePayload=e,this._compileMaterials(),t&&(this._scenePayloadInitialized=!0))}},{key:"setSceneMaterials",value:function(e){this._scenePayload&&(this._scenePayload.sceneConfig.materials=e,this._compileMaterials())}},{key:"getSelectedEntityPayload",value:function(){var e,t=this;return null===(e=this._scenePayload)||void 0===e?void 0:e.sceneConfig.entities.find((function(e){return e.id===t._selectedEntityID}))}},{key:"updateEntityPayload",value:function(e,t){var n=this._entities.findIndex((function(t){return t.id===e}));if(-1!==n){this._entities[n].init(t);var i,a=this._entities[n].getObject();if(a)if("Mesh"===a.type)null===(i=this._selectionHelper)||void 0===i||i.setFromObject(a);else this._lightHelpers.forEach((function(e){e.update()}))}}},{key:"updateScene",value:function(e,t){this._entities.forEach((function(n){n.update(e,t)}))}},{key:"runPlayScene",value:function(){this.isPlaying=!0,this._resetScene(),this._hideHelpers();try{this._buildScene(),this._startEntities()}catch(e){console.error("Error whilst setting up play scene")}}},{key:"runEditScene",value:function(){this.isPlaying=!1,this._resetScene(),this._showHelpers(),this._buildScene()}},{key:"selectByID",value:function(e){var t,n,i=null!==(t=null===(n=this._entities.find((function(t){return t.id===e})))||void 0===n?void 0:n.getObject())&&void 0!==t?t:void 0;i&&c.a.instance.lookAt(i.position),this.select(i)}},{key:"select",value:function(e){var t;if(!this.isPlaying)return!e&&(null===(t=this._selectionHelper)||void 0===t?void 0:t.visible)&&this._selectedEntityID?(this._selectionHelper.visible=!1,void(this._selectedEntityID=void 0)):e?(this._selectedEntityID=e.uuid,this._selectionHelper.setFromObject(e),void("Mesh"===e.type?this._selectionHelper.visible=!0:"PerspectiveCamera"===e.type&&(this._cameraHelper.visible=!0))):void(this._cameraHelper.visible=!1)}},{key:"getSelectedEntity",value:function(){return this._selectedEntityID}},{key:"buildEntity",value:function(e){var t=new h(e);this._entities.push(t);var n=t.getObject();if(n)if(this._scene.add(n),"PointLight"!==n.type||this.isPlaying)if("DirectionalLight"===n.type){var i=n;this._scene.add(i.target)}else"PerspectiveCamera"===n.type&&(this._cameraHelper=new r.CameraHelper(n),this._cameraHelper.uuid=n.uuid,this._cameraHelper.visible=!1,this._scene.add(this._cameraHelper));else if(!this._lightHelpers.some((function(t){return t.uuid===e.id}))){var a=new r.PointLightHelper(n,1);a.uuid=n.uuid,this._scene.add(a),this._lightHelpers.push(a)}return t}},{key:"_startEntities",value:function(){this._entities.forEach((function(e){e.start()}))}},{key:"_resetScene",value:function(){var e=this;this._entities.forEach((function(t){var n=t.getObject();n&&e._scene.remove(n),t.destroy()})),this._entities=[]}},{key:"_buildScene",value:function(){if(this._scenePayload){var e,t=(e=this._scenePayload,JSON.parse(JSON.stringify(e)));this._buildEntities(t.sceneConfig.entities)}}},{key:"_buildEntities",value:function(e){var t=this;e.forEach((function(e){t.buildEntity(e)}))}},{key:"_compileMaterials",value:function(){var e=this;this._scenePayload&&(console.log("Compiling materials",this._scenePayload.sceneConfig.materials),this._scenePayload.sceneConfig.materials.forEach((function(t){var n,i,a=null===(n=e._scenePayload)||void 0===n?void 0:n.scripts.find((function(e){return e.id===t.vertexShaderID})),r=null===(i=e._scenePayload)||void 0===i?void 0:i.scripts.find((function(e){return e.id===t.fragmentShaderID}));if(a&&r){var o={material:t,vertexShader:a.content,fragmentShader:r.content};u.a.instance.addCustomMaterial(o)}})))}},{key:"_hideHelpers",value:function(){var e=this;this._axes.visible=!1,this._gridHelper.visible=!1,this._cameraHelper.visible=!1,this._selectionHelper&&(this._selectionHelper.visible=!1),this._lightHelpers.forEach((function(t){t.dispose(),e._scene.remove(t)})),this._lightHelpers=[]}},{key:"_showHelpers",value:function(){this._axes.visible=!0,this._gridHelper.visible=!0,this._selectionHelper&&(this._selectionHelper.visible=!0)}}],[{key:"isPlaying",value:function(){return e.instance.isPlaying}}]),e}();p.instance=void 0},19:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(6),a=n(9),r=n(1),o=n(2),c=n(7),s=n(3),l=n(4),u=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).entity=void 0,i._object=void 0,i.position=new c.Vector3(0,0,0),i.rotation=new c.Euler(0,0,0,"XYZ"),i.scale=new c.Vector3(1,1,1),i.entity=e,i._object=i.entity.getObject(),i}return Object(o.a)(n,[{key:"init",value:function(e){var t,n,i;this.position=null!==(t=null===e||void 0===e?void 0:e.position)&&void 0!==t?t:this.position,this.rotation=null!==(n=null===e||void 0===e?void 0:e.rotation)&&void 0!==n?n:this.rotation,this.scale=null!==(i=null===e||void 0===e?void 0:e.scale)&&void 0!==i?i:this.scale,this.applyMatrix()}},{key:"start",value:function(){this.applyMatrix()}},{key:"applyPosition",value:function(){this._object.position.set(this.position.x,this.position.y,this.position.z)}},{key:"applyRotation",value:function(){this._object.setRotationFromEuler(new c.Euler(this.rotation.x,this.rotation.y,this.rotation.z))}},{key:"applyScale",value:function(){this._object.scale.set(this.scale.x,this.scale.y,this.scale.z)}},{key:"applyMatrix",value:function(){this.entity&&(this.applyPosition(),this.applyRotation(),this.applyScale())}},{key:"update",value:function(){this.applyMatrix()}}]),n}(n(37).a),d=function(){function e(){Object(r.a)(this,e),this.components={},e.instance||(e.instance=this,this.registerComponent("Transform",u,{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}))}return Object(o.a)(e,[{key:"getComponents",value:function(){return Object(a.a)({},this.components)}},{key:"registerComponent",value:function(e,t,n){this.components[e]={constructor:t,props:n}}},{key:"getComponentProps",value:function(e){var t,n=null!==(t=this.components[e].props)&&void 0!==t?t:null;return n||null}},{key:"getComponent",value:function(e){var t;return null!==(t=this.components[e].constructor)&&void 0!==t?t:null}},{key:"setComponent",value:function(e,t,n){var a=this.getComponent(t);if(a){Object.entries(n).forEach((function(e){var t=Object(i.a)(e,2),a=t[0],r=t[1];Array.isArray(r)&&(3===r.length?n[a]=new c.Vector3(r[0],r[1],r[2]):2===r.length&&(n[a]=new c.Vector2(r[0],r[1])))}));var r=new a(e);try{r.init(n),e.components[t]=r}catch(o){console.error("Error whilst initializing component",o)}}else console.error("Component ".concat(t," not found"))}}]),e}();d.instance=void 0},21:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(9),a=n(1),r=n(2),o=n(7),c=function(){function e(){Object(a.a)(this,e),this.materials={normal:new o.MeshNormalMaterial,basic:new o.MeshBasicMaterial,phong:new o.MeshPhongMaterial,lambert:new o.MeshLambertMaterial,wireframe:new o.MeshBasicMaterial({wireframe:!0})},e.instance||(e.instance=this)}return Object(r.a)(e,[{key:"getMaterial",value:function(e){var t;return null!==(t=this.materials[e])&&void 0!==t?t:this.materials.basic}},{key:"addCustomMaterial",value:function(e){console.log("adding custom material",e);var t=e.material;this.materials[t.name]=new o.ShaderMaterial({uniforms:Object(i.a)(Object(i.a)({},t.uniforms),{},{time:{value:0}}),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})}}]),e}();c.instance=void 0},23:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(1),a=n(2),r=n(7),o=n(25),c=n(16),s=function(){function e(){var t=this;if(Object(i.a)(this,e),this.renderer=new r.WebGLRenderer({antialias:!0,alpha:!0}),this.renderElement=void 0,this.raycaster=new r.Raycaster,this.fov=60,this.near=.01,this.far=2e4,this.camera=void 0,this.editCamera=void 0,this.sceneCamera=void 0,this.currentControls="orbit",this.clock=new r.Clock,e.instance)return e.instance;e.instance=this,this.editCamera=new r.PerspectiveCamera(this.fov,window.innerWidth/window.innerHeight,this.near,this.far),this._setCamera(this.editCamera),window.addEventListener("resize",(function(){return t.handleResize()}))}return Object(a.a)(e,[{key:"setup",value:function(e,t){this.renderElement=e,this.renderElement.appendChild(this.renderer.domElement),this._setRenderer(),this._setControls(),this._setRaycaster(),this._runSceneLoop(t),this.handleResize()}},{key:"useSceneCamera",value:function(e){this.sceneCamera=e,this._setCamera(this.sceneCamera)}},{key:"useEditCamera",value:function(){this._setCamera(this.editCamera)}},{key:"handleClick",value:function(e,t){var n=new r.Vector2(e,t);this.raycaster.setFromCamera(n,this.camera);var i=this.raycaster.intersectObjects(c.a.instance.getScene().children,!0).filter((function(e){return"Mesh"===e.object.type||"PointLightHelper"===e.object.type}));if(i.length>0){var a=i[0].object;"Mesh"===a.type?c.a.instance.select(a):"PointLightHelper"===a.type&&c.a.instance.selectByID(a.uuid)}else c.a.instance.select()}},{key:"_setCamera",value:function(e){this.camera=e,this.camera.position.y=10,this.camera.rotation.x=-.1,this.camera.position.z=50}},{key:"_runSceneLoop",value:function(e){var t=this;this.renderer.setAnimationLoop((function(n){return t.update(e)}))}},{key:"_setRaycaster",value:function(){this.raycaster=new r.Raycaster}},{key:"_setControls",value:function(){this.renderElement&&o.a.instance.setControls(this.currentControls,this.camera,this.renderer.domElement)}},{key:"_setRenderer",value:function(){this.renderElement&&(this.renderer.setSize(this.renderElement.clientWidth,this.renderElement.clientHeight),this.renderer.toneMapping=r.ReinhardToneMapping,this.renderer.toneMappingExposure=2,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=r.BasicShadowMap,this.renderer.shadowMap.type=r.PCFSoftShadowMap)}},{key:"getAspect",value:function(){return this.camera.aspect}},{key:"handleResize",value:function(){var e,t,n,i,a,r;if(this.renderElement){var o=this.renderElement.getBoundingClientRect(),c=null!==(e=null===(t=this.renderElement)||void 0===t||null===(n=t.offsetParent)||void 0===n?void 0:n.clientWidth)&&void 0!==e?e:o.width,s=null!==(i=null===(a=this.renderElement)||void 0===a||null===(r=a.offsetParent)||void 0===r?void 0:r.clientHeight)&&void 0!==i?i:o.height;this.camera.aspect=c/s,this.camera.updateProjectionMatrix(),this.renderer.setSize(c,s),this.renderer.setPixelRatio(window.devicePixelRatio)}}},{key:"update",value:function(e){this.renderer.render(e,this.camera);var t=this.clock.getDelta(),n=this.clock.getElapsedTime();c.a.instance.updateScene(t,n),o.a.instance.updateControls(t)}}]),e}();s.instance=void 0},24:function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"b",(function(){return d}));var i=n(6),a=n(18),r="// @defineComponent",o="class Component {\n  \n  // <public>\n\n  // </public>\n\n  ".concat(r,"\n\n  start() {\n    \n  }\n\n  update() {\n\n  }\n}"),c=function(e,t,n){var i=Object(a.v4)(),r=o;switch(n){case"component":r=o;break;case"vertex":r="uniform float time;\nuniform mat4 modelMatrix; // object.matrixWorld\nuniform mat4 modelViewMatrix; // camera.matrixWorld * object.matrixWorld\nuniform mat4 projectionMatrix; // camera.projectionMatrix\nuniform mat4 viewMatrix; // camera.matrixWorld\nuniform mat3 normalMatrix; // camera.matrixWorldInverse.transpose()\nuniform vec3 cameraPosition; // camera.position\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";break;case"fragment":r="uniform float time;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nvoid main() {\n  gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n}"}return{id:i,name:e,language:t,content:r,type:n}},s="// <initPropPlaceholder />",l=function(e){return"(".concat(e.content,")").replace(r,"\n          entity;\n        \n          constructor(entity) {\n            this.entity = entity;\n          }\n\n          ".concat(s,"\n        "))},u=function(e,t){var n="\n  init(props) {\n    this.transform = this.entity.getComponent('Transform');\n    ".concat(Object.entries(t).map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return"this.".concat(n," = props?.").concat(n," ?? ").concat(a,";")})).join("\n"),"\n  }");return e.replace(s,n)},d=function(e,t,n){return{id:Object(a.v4)(),name:e,vertexShaderID:t,fragmentShaderID:n,uniforms:{}}}},25:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i=n(1),a=n(2),r=n(12),o=n(3),c=n(4),s=n(7),l={type:"change"},u=function(e){Object(o.a)(n,e);var t=Object(c.a)(n);function n(e,a){var o;Object(i.a)(this,n),o=t.call(this),void 0===a&&(console.warn('THREE.FlyControls: The second parameter "domElement" is now mandatory.'),a=document),o.object=e,o.domElement=a,o.movementSpeed=1,o.rollSpeed=.005,o.dragToLook=!1,o.autoForward=!1;var c=Object(r.a)(o),u=1e-6,h=new s.Quaternion,p=new s.Vector3;o.tmpQuaternion=new s.Quaternion,o.mouseStatus=0,o.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},o.moveVector=new s.Vector3(0,0,0),o.rotationVector=new s.Vector3(0,0,0),o.keydown=function(e){if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},o.keyup=function(e){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},o.mousedown=function(e){if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},o.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}},o.mouseup=function(e){if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},o.update=function(e){var t=e*c.movementSpeed,n=e*c.rollSpeed;c.object.translateX(c.moveVector.x*t),c.object.translateY(c.moveVector.y*t),c.object.translateZ(c.moveVector.z*t),c.tmpQuaternion.set(c.rotationVector.x*n,c.rotationVector.y*n,c.rotationVector.z*n,1).normalize(),c.object.quaternion.multiply(c.tmpQuaternion),(p.distanceToSquared(c.object.position)>u||8*(1-h.dot(c.object.quaternion))>u)&&(c.dispatchEvent(l),h.copy(c.object.quaternion),p.copy(c.object.position))},o.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},o.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},o.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},o.dispose=function(){this.domElement.removeEventListener("contextmenu",d),this.domElement.removeEventListener("mousedown",v),this.domElement.removeEventListener("mousemove",m),this.domElement.removeEventListener("mouseup",f),window.removeEventListener("keydown",b),window.removeEventListener("keyup",y)};var m=o.mousemove.bind(Object(r.a)(o)),v=o.mousedown.bind(Object(r.a)(o)),f=o.mouseup.bind(Object(r.a)(o)),b=o.keydown.bind(Object(r.a)(o)),y=o.keyup.bind(Object(r.a)(o));return o.domElement.addEventListener("contextmenu",d),o.domElement.addEventListener("mousemove",m),o.domElement.addEventListener("mousedown",v),o.domElement.addEventListener("mouseup",f),window.addEventListener("keydown",b),window.addEventListener("keyup",y),o.updateMovementVector(),o.updateRotationVector(),o}return n}(s.EventDispatcher);function d(e){e.preventDefault()}var h={type:"change"},p={type:"start"},m={type:"end"},v=function(e){Object(o.a)(n,e);var t=Object(c.a)(n);function n(e,a){var o;Object(i.a)(this,n),o=t.call(this),void 0===a&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),a===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),o.object=e,o.domElement=a,o.domElement.style.touchAction="none",o.enabled=!0,o.target=new s.Vector3,o.minDistance=0,o.maxDistance=1/0,o.minZoom=0,o.maxZoom=1/0,o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minAzimuthAngle=-1/0,o.maxAzimuthAngle=1/0,o.enableDamping=!1,o.dampingFactor=.05,o.enableZoom=!0,o.zoomSpeed=1,o.enableRotate=!0,o.rotateSpeed=1,o.enablePan=!0,o.panSpeed=7,o.screenSpacePanning=!0,o.keyPanSpeed=15,o.autoRotate=!1,o.autoRotateSpeed=2,o.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},o.mouseButtons={LEFT:s.MOUSE.ROTATE,MIDDLE:s.MOUSE.DOLLY,RIGHT:s.MOUSE.PAN},o.touches={ONE:s.TOUCH.ROTATE,TWO:s.TOUCH.DOLLY_PAN},o.target0=o.target.clone(),o.position0=o.object.position.clone(),o.zoom0=o.object.zoom,o._domElementKeyEvents=null,o.getPolarAngle=function(){return v.phi},o.getAzimuthalAngle=function(){return v.theta},o.getDistance=function(){return this.object.position.distanceTo(this.target)},o.listenToKeyEvents=function(e){e.addEventListener("keydown",J),this._domElementKeyEvents=e},o.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},o.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(h),c.update(),u=l.NONE},o.update=function(){var t=new s.Vector3,n=(new s.Quaternion).setFromUnitVectors(e.up,new s.Vector3(0,1,0)),i=n.clone().invert(),a=new s.Vector3,r=new s.Quaternion,o=2*Math.PI;return function(){var e=c.object.position;t.copy(e).sub(c.target),t.applyQuaternion(n),v.setFromVector3(t),c.autoRotate&&u===l.NONE&&T(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(v.theta+=f.theta*c.dampingFactor,v.phi+=f.phi*c.dampingFactor):(v.theta+=f.theta,v.phi+=f.phi);var s=c.minAzimuthAngle,p=c.maxAzimuthAngle;return isFinite(s)&&isFinite(p)&&(s<-Math.PI?s+=o:s>Math.PI&&(s-=o),p<-Math.PI?p+=o:p>Math.PI&&(p-=o),v.theta=s<=p?Math.max(s,Math.min(p,v.theta)):v.theta>(s+p)/2?Math.max(s,v.theta):Math.min(p,v.theta)),v.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,v.phi)),v.makeSafe(),v.radius*=b,v.radius=Math.max(c.minDistance,Math.min(c.maxDistance,v.radius)),!0===c.enableDamping?c.target.addScaledVector(y,c.dampingFactor):c.target.add(y),t.setFromSpherical(v),t.applyQuaternion(i),e.copy(c.target).add(t),c.object.lookAt(c.target),!0===c.enableDamping?(f.theta*=1-c.dampingFactor,f.phi*=1-c.dampingFactor,y.multiplyScalar(1-c.dampingFactor)):(f.set(0,0,0),y.set(0,0,0)),b=1,!!(_||a.distanceToSquared(c.object.position)>d||8*(1-r.dot(c.object.quaternion))>d)&&(c.dispatchEvent(h),a.copy(c.object.position),r.copy(c.object.quaternion),_=!1,!0)}}(),o.dispose=function(){c.domElement.removeEventListener("contextmenu",$),c.domElement.removeEventListener("pointerdown",X),c.domElement.removeEventListener("pointercancel",Z),c.domElement.removeEventListener("wheel",Q),c.domElement.removeEventListener("pointermove",q),c.domElement.removeEventListener("pointerup",G),null!==c._domElementKeyEvents&&c._domElementKeyEvents.removeEventListener("keydown",J)};var c=Object(r.a)(o),l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},u=l.NONE,d=1e-6,v=new s.Spherical,f=new s.Spherical,b=1,y=new s.Vector3,_=!1,g=new s.Vector2,j=new s.Vector2,O=new s.Vector2,E=new s.Vector2,w=new s.Vector2,S=new s.Vector2,x=new s.Vector2,C=new s.Vector2,k=new s.Vector2,P=[],M={};function L(){return Math.pow(.95,c.zoomSpeed)}function T(e){f.theta-=e}function D(e){f.phi-=e}var N=function(){var e=new s.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),y.add(e)}}(),R=function(){var e=new s.Vector3;return function(t,n){!0===c.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(c.object.up,e)),e.multiplyScalar(t),y.add(e)}}(),A=function(){var e=new s.Vector3;return function(t,n){var i=c.domElement;if(c.object.isPerspectiveCamera){var a=c.object.position;e.copy(a).sub(c.target);var r=e.length();r*=Math.tan(c.object.fov/2*Math.PI/180),N(2*t*r/i.clientHeight,c.object.matrix),R(2*n*r/i.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(N(t*(c.object.right-c.object.left)/c.object.zoom/i.clientWidth,c.object.matrix),R(n*(c.object.top-c.object.bottom)/c.object.zoom/i.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function I(e){c.object.isPerspectiveCamera?b/=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),_=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function H(e){c.object.isPerspectiveCamera?b*=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),_=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function z(e){g.set(e.clientX,e.clientY)}function V(e){E.set(e.clientX,e.clientY)}function U(){if(1===P.length)g.set(P[0].pageX,P[0].pageY);else{var e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);g.set(e,t)}}function B(){if(1===P.length)E.set(P[0].pageX,P[0].pageY);else{var e=.5*(P[0].pageX+P[1].pageX),t=.5*(P[0].pageY+P[1].pageY);E.set(e,t)}}function K(){var e=P[0].pageX-P[1].pageX,t=P[0].pageY-P[1].pageY,n=Math.sqrt(e*e+t*t);x.set(0,n)}function F(e){if(1==P.length)j.set(e.pageX,e.pageY);else{var t=ne(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);j.set(n,i)}O.subVectors(j,g).multiplyScalar(c.rotateSpeed);var a=c.domElement;T(2*Math.PI*O.x/a.clientHeight),D(2*Math.PI*O.y/a.clientHeight),g.copy(j)}function Y(e){if(1===P.length)w.set(e.pageX,e.pageY);else{var t=ne(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);w.set(n,i)}S.subVectors(w,E).multiplyScalar(c.panSpeed),A(S.x,S.y),E.copy(w)}function W(e){var t=ne(e),n=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(n*n+i*i);C.set(0,a),k.set(0,Math.pow(C.y/x.y,c.zoomSpeed)),I(k.y),x.copy(C)}function X(e){!1!==c.enabled&&(0===P.length&&(c.domElement.setPointerCapture(e.pointerId),c.domElement.addEventListener("pointermove",q),c.domElement.addEventListener("pointerup",G)),function(e){P.push(e)}(e),"touch"===e.pointerType?function(e){switch(te(e),P.length){case 1:switch(c.touches.ONE){case s.TOUCH.ROTATE:if(!1===c.enableRotate)return;U(),u=l.TOUCH_ROTATE;break;case s.TOUCH.PAN:if(!1===c.enablePan)return;B(),u=l.TOUCH_PAN;break;default:u=l.NONE}break;case 2:switch(c.touches.TWO){case s.TOUCH.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;c.enableZoom&&K(),c.enablePan&&B(),u=l.TOUCH_DOLLY_PAN;break;case s.TOUCH.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;c.enableZoom&&K(),c.enableRotate&&U(),u=l.TOUCH_DOLLY_ROTATE;break;default:u=l.NONE}break;default:u=l.NONE}u!==l.NONE&&c.dispatchEvent(p)}(e):function(e){var t;switch(e.button){case 0:t=c.mouseButtons.LEFT;break;case 1:t=c.mouseButtons.MIDDLE;break;case 2:t=c.mouseButtons.RIGHT;break;default:t=-1}switch(t){case s.MOUSE.DOLLY:if(!1===c.enableZoom)return;!function(e){x.set(e.clientX,e.clientY)}(e),u=l.DOLLY;break;case s.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enablePan)return;V(e),u=l.PAN}else{if(!1===c.enableRotate)return;z(e),u=l.ROTATE}break;case s.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enableRotate)return;z(e),u=l.ROTATE}else{if(!1===c.enablePan)return;V(e),u=l.PAN}break;default:u=l.NONE}u!==l.NONE&&c.dispatchEvent(p)}(e))}function q(e){!1!==c.enabled&&("touch"===e.pointerType?function(e){switch(te(e),u){case l.TOUCH_ROTATE:if(!1===c.enableRotate)return;F(e),c.update();break;case l.TOUCH_PAN:if(!1===c.enablePan)return;Y(e),c.update();break;case l.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&W(e),c.enablePan&&Y(e)}(e),c.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&W(e),c.enableRotate&&F(e)}(e),c.update();break;default:u=l.NONE}}(e):function(e){if(!1===c.enabled)return;switch(u){case l.ROTATE:if(!1===c.enableRotate)return;!function(e){j.set(e.clientX,e.clientY),O.subVectors(j,g).multiplyScalar(c.rotateSpeed);var t=c.domElement;T(2*Math.PI*O.x/t.clientHeight),D(2*Math.PI*O.y/t.clientHeight),g.copy(j),c.update()}(e);break;case l.DOLLY:if(!1===c.enableZoom)return;!function(e){C.set(e.clientX,e.clientY),k.subVectors(C,x),k.y>0?I(L()):k.y<0&&H(L()),x.copy(C),c.update()}(e);break;case l.PAN:if(!1===c.enablePan)return;!function(e){w.set(e.clientX,e.clientY),S.subVectors(w,E).multiplyScalar(c.panSpeed),A(S.x,S.y),E.copy(w),c.update()}(e)}}(e))}function G(e){!1!==c.enabled&&(e.pointerType,c.dispatchEvent(m),u=l.NONE,ee(e),0===P.length&&(c.domElement.releasePointerCapture(e.pointerId),c.domElement.removeEventListener("pointermove",q),c.domElement.removeEventListener("pointerup",G)))}function Z(e){ee(e)}function Q(e){!1===c.enabled||!1===c.enableZoom||u!==l.NONE&&u!==l.ROTATE||(e.preventDefault(),c.dispatchEvent(p),function(e){e.deltaY<0?H(L()):e.deltaY>0&&I(L()),c.update()}(e),c.dispatchEvent(m))}function J(e){!1!==c.enabled&&!1!==c.enablePan&&function(e){var t=!1;if("scene"===document.activeElement.id){switch(e.code){case"KeyW":H(.3),t=!0;break;case"KeyS":I(.3),t=!0;break;case c.keys.UP:case"Space":A(0,c.keyPanSpeed),t=!0;break;case c.keys.BOTTOM:A(0,-c.keyPanSpeed),t=!0;break;case c.keys.LEFT:case"KeyA":A(c.keyPanSpeed,0),t=!0;break;case c.keys.RIGHT||"d":case"KeyD":A(-c.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),c.update())}}(e)}function $(e){!1!==c.enabled&&e.preventDefault()}function ee(e){delete M[e.pointerId];for(var t=0;t<P.length;t++)if(P[t].pointerId==e.pointerId)return void P.splice(t,1)}function te(e){var t=M[e.pointerId];void 0===t&&(t=new s.Vector2,M[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ne(e){var t=e.pointerId===P[0].pointerId?P[1]:P[0];return M[t.pointerId]}return c.domElement.addEventListener("contextmenu",$),c.domElement.addEventListener("pointerdown",X),c.domElement.addEventListener("pointercancel",Z),c.domElement.addEventListener("wheel",Q,{passive:!1}),o.update(),o}return n}(s.EventDispatcher),f=function(){function e(){Object(i.a)(this,e),this.controls=void 0,e.instance||(e.instance=this)}return Object(a.a)(e,[{key:"setControls",value:function(e,t,n){if(!this.controls)switch(e){case"fly":this._setFlyControls(t,n);break;case"orbit":this._setOrbitControls(t,n);break;default:console.warn("Control type: ".concat(e," not found"))}}},{key:"lookAt",value:function(e){this.controls}},{key:"enableControls",value:function(){this.controls&&(this.controls.enabled=!0)}},{key:"disableControls",value:function(){this.controls&&(this.controls.enabled=!1)}},{key:"_setFlyControls",value:function(e,t){this.controls&&(this.controls.enabled=!1),this.controls=new u(e,t),this.controls.movementSpeed=33}},{key:"_setOrbitControls",value:function(e,t){this.controls&&(this.controls.enabled=!1),this.controls=new v(e,t),this.controls.listenToKeyEvents(window)}},{key:"updateControls",value:function(e){this.controls&&this.controls.update(e)}}]),e}();f.instance=void 0},29:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(1),a=n(2),r=n(7),o=new r.PlaneBufferGeometry(5,5);o.rotateX(-Math.PI/2),o.scale(5,1,5);var c=function(){function e(){Object(i.a)(this,e),this.geometries={box:new r.BoxBufferGeometry,sphere:new r.SphereBufferGeometry(1,16,16),cylinder:new r.CylinderBufferGeometry(1,1,1,16,1),torus:new r.TorusBufferGeometry(6,1.1,10,32,6.3),plane:o,tetrahedron:new r.TetrahedronBufferGeometry,octahedron:new r.OctahedronBufferGeometry,dodecahedron:new r.DodecahedronBufferGeometry,icosahedron:new r.IcosahedronBufferGeometry},e.instance||(e.instance=this)}return Object(a.a)(e,[{key:"getGeometry",value:function(e){var t;return null!==(t=this.geometries[e])&&void 0!==t?t:this.geometries.box}}]),e}();c.instance=void 0},32:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var i=n(18),a=function(){return{id:Object(i.v4)(),name:"New Entity",type:"basic",visible:!0,castShadow:!0,receiveShadow:!0,geometry:"box",material:"phong",children:[],components:{Transform:{position:{x:0,y:.5,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}}},r=function(){return{id:Object(i.v4)(),name:"New Light",type:"light",visible:!0,castShadow:!0,receiveShadow:!0,children:[],components:{Transform:{position:{x:0,y:1,z:0},rotation:{x:0,y:0,z:0},scale:{x:.5,y:.5,z:.5}}},lightProps:{intensity:.7,type:"point",color:"rgb(255,255,0)"}}}},37:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(2),n(3),n(4);var i=n(1),a=function e(t){Object(i.a)(this,e),this.entity=void 0,this.entity=t}},38:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ScriptCompiler}));var _Users_parssa_projects_personal_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_Users_parssa_projects_personal_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),three__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7),_engine_core_Component__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(37),_engine_core_ComponentManager__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(19),_engine_core_EngineContext__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(14),_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(16),_entity_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(32),_script_utils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(24),ScriptCompiler=function(){function ScriptCompiler(){Object(_Users_parssa_projects_personal_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,ScriptCompiler)}return Object(_Users_parssa_projects_personal_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__.a)(ScriptCompiler,null,[{key:"CompileScripts",value:function(e){Object.values(e).forEach((function(e){try{"component"===e.type&&ScriptCompiler.CompileComponentScript(e)}catch(t){console.error(t)}}))}},{key:"CompileComponentScript",value:function CompileComponentScript(script){var THREE=three__WEBPACK_IMPORTED_MODULE_2__,Instantiate=_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__.a.instance.buildEntity.bind(_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_6__.a.instance),CreateEntity=_entity_utils__WEBPACK_IMPORTED_MODULE_7__.a,Time=_engine_core_EngineContext__WEBPACK_IMPORTED_MODULE_5__.a.time,scriptCopy="".concat(script.content),removePrefix=scriptCopy.substring(scriptCopy.indexOf("// <public>")+11),pureProps=removePrefix.substring(0,removePrefix.indexOf("// </public>"));pureProps=pureProps.replaceAll(";",","),pureProps=pureProps.replaceAll("=",":");var props={};"".concat(pureProps).replace(/\s/g,"").length&&(pureProps="{".concat(pureProps,"}"),props=eval("(".concat(pureProps,")")));var formattedScript=Object(_script_utils__WEBPACK_IMPORTED_MODULE_8__.a)(script);formattedScript=Object(_script_utils__WEBPACK_IMPORTED_MODULE_8__.d)(formattedScript,props);var NewComponent=eval("(".concat(formattedScript,")"));Object.setPrototypeOf(NewComponent,_engine_core_Component__WEBPACK_IMPORTED_MODULE_3__.a),_engine_core_ComponentManager__WEBPACK_IMPORTED_MODULE_4__.a.instance.registerComponent(script.name,NewComponent,props)}}]),ScriptCompiler}()},53:function(e,t,n){},79:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(28),o=n.n(r),c=(n(53),n(5)),s={localScenePayload:null},l=Object(i.createContext)(s),u=function(e){var t=e.children,n={renderElement:Object(i.useRef)(null),localScenePayload:Object(i.useMemo)((function(){var e=localStorage.getItem("scenePayload");return e?JSON.parse(e):null}),[])};return Object(c.jsx)(l.Provider,{value:n,children:t})},d=n(6),h=n(7),p=n(18),m=n(14),v={sceneConfig:{entities:[],camera:{position:new h.Vector3,fov:70,near:.1,far:1e3,controls:"orbit"},materials:[]},selectedEntityID:null,selectedMaterialID:null,setEntities:function(e){},setSelectedEntityID:function(e){},setSelectedMaterialID:function(e){},setCameraProps:function(e){},materials:{},setMaterials:function(e){}},f=Object(i.createContext)(v),b=function(e){var t=e.children,n=Object(i.useState)([{id:Object(p.v4)(),name:"Main Camera",type:"camera",visible:!0,castShadow:!1,receiveShadow:!1,children:[],components:{Transform:{position:{x:0,y:5,z:-5},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}},cameraProps:{fov:70,near:.1,far:1e3}},{id:Object(p.v4)(),name:"Ambient Light",type:"light",visible:!0,castShadow:!1,receiveShadow:!1,children:[],components:{Transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:6,y:6,z:6}}},lightProps:{type:"ambient",color:"#ffffff",intensity:.4}},{id:Object(p.v4)(),name:"Directional Light",type:"light",visible:!0,castShadow:!0,receiveShadow:!0,children:[],components:{Transform:{position:{x:0,y:10,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}},lightProps:{type:"directional",color:"#ffffff",intensity:.1}},{id:Object(p.v4)(),name:"Plane",type:"basic",visible:!0,castShadow:!0,receiveShadow:!0,material:"phong",geometry:"plane",children:[],components:{Transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}}]),a=Object(d.a)(n,2),r=a[0],o=a[1],s=Object(i.useState)(null),l=Object(d.a)(s,2),u=l[0],h=l[1],v=Object(i.useState)(null),b=Object(d.a)(v,2),y=b[0],_=b[1],g=Object(i.useState)({}),j=Object(d.a)(g,2),O=j[0],E=j[1],w=Object(i.useMemo)((function(){return{entities:r,materials:Object.values(O)}}),[r,O]);Object(i.useEffect)((function(){if(u){var e=r.find((function(e){return e.id===u}));if(!e)return;m.a.updateSpecificEntity(u,e)}}),[w]);var S={sceneConfig:w,selectedEntityID:u,selectedMaterialID:y,setEntities:o,setSelectedEntityID:h,setSelectedMaterialID:_,materials:O,setMaterials:E};return Object(c.jsx)(f.Provider,{value:S,children:t})},y=n(38),_={scripts:{},selectedScript:void 0,scriptBody:"",setScriptBody:function(e){},setScripts:function(e){},setSelectedScript:function(e){},compileScripts:function(){}},g=Object(i.createContext)(_),j="",O=function(e){j=e},E=function(e){var t=e.children,n=Object(i.useState)({}),a=Object(d.a)(n,2),r=a[0],o=a[1],s=Object(i.useState)(),l=Object(d.a)(s,2),u=l[0],h=l[1],p=function(){y.a.CompileScripts(Object.values(r))};Object(i.useEffect)((function(){p()}),[r]);var m={scripts:r,setScripts:o,scriptBody:j,setScriptBody:O,selectedScript:u,setSelectedScript:h,compileScripts:p};return Object(c.jsx)(g.Provider,{value:m,children:t})},w=n(9),S=n(15),x=n(24),C=function(){var e=Object(i.useContext)(f),t=e.sceneConfig,n=e.setEntities,a=e.selectedEntityID,r=e.setSelectedEntityID,o=e.materials,c=e.setMaterials,s=e.selectedMaterialID,l=e.setSelectedMaterialID,u=Object(i.useMemo)((function(){var e;return null!==(e=t.entities.find((function(e){return e.id===a})))&&void 0!==e?e:null}),[t,a]),d=Object(i.useMemo)((function(){var e;return null!==(e=t.materials.find((function(e){return e.id===s})))&&void 0!==e?e:null}),[t,s]);return{sceneConfig:t,selectedEntity:u,selectedMaterial:d,createEntity:function(e){n([].concat(Object(S.a)(t.entities),[e])),m.a.addNewEntity(e)},selectEntity:function(e){if(e===a)return m.a.selectEntity(""),void r("");m.a.selectEntity(e),l(""),r(e)},updateEntity:function(e){var i=t.entities.findIndex((function(t){return t.id===e.id}));-1===i&&console.error("Couldn't find ".concat(e.id," in sceneConfig.entities")),t.entities[i]=e,n(Object(S.a)(t.entities))},updateEntityParent:function(e,t){},createMaterial:function(e,t,n){var i=o,a=Object(x.b)(e,t,n);i[e]=a,c(Object(w.a)({},i))},selectMaterial:function(e){e!==s?(l(e),r("")):l("")},_setEntities:n,_setMaterials:c}},k=n(33),P=n(19),M=n(29),L=n(21),T=n(16),D=n(1),N=n(2),R=n(46),A=n.n(R),I=n(47),H=function(){function e(){Object(D.a)(this,e)}return Object(N.a)(e,null,[{key:"Export",value:function(t){var n=new A.a,i=n.folder("project");null===i||void 0===i||i.file("scene.json",JSON.stringify(t)),null===i||void 0===i||i.file("index.html",e.generateHtmlFile(t)),null===i||void 0===i||i.file("index.js",e.generateJsFile(t)),n.generateAsync({type:"blob"}).then((function(e){Object(I.saveAs)(e,"example.zip")}))}},{key:"generateHtmlFile",value:function(e){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="X-UA-Compatible" content="ie=edge">\n    <title>Document</title>\n</head>\n<body>\n    <div id="app"></div>\n    <script src="index.js"><\/script>\n</body>\n</html>'}},{key:"generateJsFile",value:function(e){return"// import threejs from cdn\n//import * as THREE from 'three'\n\n"}}]),e}(),z=function(){var e=Object(i.useContext)(g),t=e.scripts,n=e.setScripts,a=e.selectedScript,r=e.setSelectedScript,o=e.compileScripts;return{scripts:Object.values(t),_setScripts:n,scriptBody:j,setScriptBody:O,selectedScript:a,setSelectedScript:r,loadScript:function(e){var n,i,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";console.debug("loading script",e,o,t),"id"===o?a=t[e]:"name"===o&&(a=Object.values(t).find((function(t){return t.name===e}))),r(a),O(null!==(n=null===(i=a)||void 0===i?void 0:i.content)&&void 0!==n?n:"")},saveScript:function(e){var n=Object.values(t).find((function(t){return t.id===e.id}));n&&(n.content=j,o())},createScript:function(e){var i=[],a=t;return e.forEach((function(e){var t=Object(x.c)(e.name,e.language,e.type);i.push(t),a[t.id]=t})),n(Object(w.a)({},a)),i},_compileScripts:o}},V=function(e){var t=z(),n=t.scripts,a=t._setScripts,r=C(),o=r.sceneConfig,c=r.selectEntity,s=r._setEntities,u=r._setMaterials,h=Object(i.useContext)(l),p=h.renderElement,v=h.localScenePayload,f=Object(i.useState)(m.a.isPlaying()),b=Object(d.a)(f,2),_=b[0],g=b[1];Object(i.useEffect)((function(){if(v&&e){var t=Object.fromEntries(v.scripts.map((function(e){return[e.id,e]})));a(t),y.a.CompileScripts(v.scripts),s(v.sceneConfig.entities);var n=Object.fromEntries(v.sceneConfig.materials.map((function(e){return[e.id,e]})));u(n),m.a.updateScenePayload(v,!0)}}),[s,u,a,v,e]);var j=Object(i.useMemo)((function(){return{sceneConfig:o,scripts:n}}),[o,n]);Object(i.useEffect)((function(){p&&p.current&&j&&e&&m.a.init(p.current,j)}),[p,e]);return{renderElement:p,isRunning:_,toggleRun:function(){if(p&&p.current){if(T.a.isPlaying())return g(!1),void m.a.runEditMode();m.a.updateScenePayload(j),m.a.runPlayMode(),g(!0)}},handleClickScene:function(e){var t,n=e.target;n.focus();var i=n.getBoundingClientRect(),a=(e.clientX-i.x)/i.width*2-1,r=-(e.clientY-i.y)/i.height*2+1;m.a.handleClick(a,r),c(null!==(t=m.a.getSelectedEntity())&&void 0!==t?t:"")},saveScene:function(){localStorage.setItem("scenePayload",JSON.stringify(j))},exportScene:function(){H.Export(j)}}};function U(e){var t=e.label,n=e.bodyClass,i=e.children;return Object(c.jsxs)("div",{className:"bg-gray-800 p-1 h-full border border-gray-900 text-white",children:[Object(c.jsx)("h4",{className:"font-mono text-xs text-red-500 mb-1",children:t}),Object(c.jsx)("div",{className:"".concat(null!==n&&void 0!==n?n:""," space-y-1"),children:i})]})}var B=n(11),K="",F=function(e,t,n){Object(k.c)((function(){var i=Object.entries(t).map((function(e){var t=Object(d.a)(e,2),i=t[0],a=t[1],r=Object(p.v4)();return[r,{value:a,label:i,onEditStart:function(){K=r},onChange:function(e){K===r&&n(e,i)},onEditEnd:function(){K=""}}]})),a=Object.fromEntries(i);return Object(B.a)({},e,Object(k.b)(a))}))};function Y(e){var t=e.cameraProps,n=e.updateCameraProps;return F("Camera",t,(function(e,i){var a=Object(w.a)({},t);a[i]=e,n(a)})),Object(c.jsx)(c.Fragment,{})}var W=function(e){var t=e.componentType,n=e.componentProps,i=e.updateComponent;return F(t,n,(function(e,n){i(t,n,e)})),Object(c.jsx)(c.Fragment,{})};function X(e){var t=e.lightProps,n=e.updateLightProps;return F("Light",t,(function(e,i){var a=Object(w.a)({},t);a[i]=e,n(a)})),Object(c.jsx)(c.Fragment,{})}function q(e){var t,n=e.selectedEntity,a=C(),r=a.updateEntity,o=a.sceneConfig,s=V().isRunning,l=Object(i.useState)({}),u=Object(d.a)(l,2),h=u[0],p=u[1],m=Object(i.useState)("normal"),v=Object(d.a)(m,2),f=v[0],b=v[1],y=Object(i.useState)("box"),_=Object(d.a)(y,2),g=_[0],j=_[1];Object(i.useEffect)((function(){var e,t;n&&(b(null!==(e=n.material)&&void 0!==e?e:""),j(null!==(t=n.geometry)&&void 0!==t?t:""))}),[n]),Object(i.useEffect)((function(){n&&function(e){var t={};Object.entries(e.components).forEach((function(e){var n=Object(d.a)(e,2),i=n[0],a=n[1];t[i]=a})),p(Object(w.a)({},t))}(n)}),[n,o,s]);var O=function(e,t,i){var a=Object(w.a)({},h);a[e][t]=i,p(a),n&&(n.components=a,r(Object(w.a)({},n)))},E=function(){var e=P.a.instance.getComponents();if(!n)return[];var t=Object.keys(null===n||void 0===n?void 0:n.components);return Object.keys(e).filter((function(e){return!t.includes(e)})).map((function(e){return{label:e,value:e}}))}(),S=Object.keys(L.a.instance.materials).map((function(e){return{label:e,value:e}})),x=Object.keys(M.a.instance.geometries).map((function(e){return{label:e,value:e}}));return Object(c.jsxs)(U,{label:"Inspector",children:[Object(c.jsx)("h1",{children:Object(c.jsx)("input",{className:"transition bg-gray-800 hover:bg-gray-700 focus:bg-gray-900",type:"text",defaultValue:null===n||void 0===n?void 0:n.name,onBlur:function(e){return t=e.target.value,void(n&&"camera"!==n.type&&r(Object(w.a)(Object(w.a)({},n),{},{name:t})));var t},disabled:"camera"===(null===n||void 0===n?void 0:n.type),onKeyDown:function(e){return"Enter"===e.key&&e.target.blur()}},null!==(t=null===n||void 0===n?void 0:n.id)&&void 0!==t?t:"")}),Object(c.jsxs)("section",{className:"space-y-2 py-2",children:[Object(c.jsxs)("div",{className:"flex space-x-2",children:[Object(c.jsx)("p",{className:"inspector-field-label",children:"Visible"}),Object(c.jsx)("input",{type:"checkbox",checked:n.visible,onChange:function(e){return r(Object(w.a)(Object(w.a)({},n),{},{visible:e.target.checked}))}})]}),!("light"===n.type&&n.lightProps&&"ambient"===n.lightProps.type)&&Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)("div",{className:"flex space-x-2",children:[Object(c.jsx)("p",{className:"inspector-field-label",children:"Cast shadow"}),Object(c.jsx)("input",{type:"checkbox",checked:n.castShadow,onChange:function(e){return r(Object(w.a)(Object(w.a)({},n),{},{castShadow:e.target.checked}))}})]}),Object(c.jsxs)("div",{className:"flex space-x-2",children:[Object(c.jsx)("p",{className:"inspector-field-label",children:"Receive shadow"}),Object(c.jsx)("input",{type:"checkbox",checked:n.receiveShadow,onChange:function(e){return r(Object(w.a)(Object(w.a)({},n),{},{castShadow:e.target.checked}))}})]})]})]}),"light"===n.type&&n.lightProps&&Object(c.jsx)(X,{lightProps:n.lightProps,updateLightProps:function(e){n&&(n.lightProps=e,r(Object(w.a)({},n)))}},n.id),"camera"===n.type&&n.cameraProps&&Object(c.jsx)(Y,{cameraProps:n.cameraProps,updateCameraProps:function(e){n&&(n.cameraProps=e,r(Object(w.a)({},n)))}}),Object(c.jsxs)("section",{className:"space-y-2",children:[Object.entries(h).map((function(e){var t=Object(d.a)(e,2),i=t[0],a=t[1];return Object(c.jsx)(W,{componentType:i,componentProps:a,componentScriptID:"",updateComponent:O},"".concat(i,"--").concat(n.id))})),Object(c.jsx)(k.a,{fill:!0,flat:!0,titleBar:!1})]}),E.length>0&&Object(c.jsxs)("section",{children:[Object(c.jsx)("select",{onChange:function(e){return console.log(e.target.value)},children:E.map((function(e){var t=e.label,n=e.value;return Object(c.jsx)("option",{value:n,children:t},n)}))}),Object(c.jsx)("div",{className:"grid place-items-center mt-2",children:Object(c.jsx)("button",{onClick:function(){return function(e){if(n){var t=P.a.instance.getComponentProps(e);t&&(n.components[e]=t,r(n))}}(E[0].value)},children:"Add Component"})})]}),"basic"===n.type&&Object(c.jsx)("section",{children:Object(c.jsxs)("div",{className:"bg-gray-800 text-white",children:[Object(c.jsx)("h3",{children:"Mesh"}),Object(c.jsxs)("div",{className:"space-y-2",children:[Object(c.jsxs)("div",{className:"flex space-x-2 items-center",children:[Object(c.jsx)("p",{className:"inspector-field-label",children:"Material"}),Object(c.jsx)("select",{onChange:function(e){return t=e.target.value,b(t),void(n&&(n.material=t,r(Object(w.a)({},n))));var t},value:f,children:S.map((function(e){return Object(c.jsx)("option",{value:e.value,children:e.label},e.value)}))})]}),Object(c.jsxs)("div",{className:"flex space-x-2 items-center",children:[Object(c.jsx)("p",{className:"inspector-field-label",children:"Geometry"}),Object(c.jsx)("select",{onChange:function(e){return t=e.target.value,j(t),void(n&&(n.geometry=t,r(Object(w.a)({},n))));var t},value:g,children:x.map((function(e){return Object(c.jsx)("option",{value:e.value,children:e.label},e.value)}))})]})]})]})})]})}function G(e){var t=e.selectedMaterial,n=z().loadScript;return Object(c.jsxs)(U,{label:"Inspector",children:[Object(c.jsx)("h1",{children:t.name}),Object(c.jsxs)("section",{children:["Fragment shader"," ",Object(c.jsx)("small",{className:"text-xs font-light underline text-gray-400 cursor-pointer hover:text-gray-300",onClick:function(){n(t.fragmentShaderID)},children:"Open in editor"})]}),Object(c.jsxs)("section",{children:["Vertex shader"," ",Object(c.jsx)("small",{className:"text-xs font-light underline text-gray-400 cursor-pointer hover:text-gray-300",onClick:function(){n(t.vertexShaderID)},children:"Open in editor"})]})]})}function Z(){var e=C(),t=e.selectedEntity,n=e.selectedMaterial;return n?Object(c.jsx)(G,{selectedMaterial:n}):t?Object(c.jsx)(q,{selectedEntity:t}):Object(c.jsx)(c.Fragment,{})}var Q=n(32);function J(){var e=C(),t=e.createEntity,n=e.createMaterial,i=V(!0),a=i.toggleRun,r=i.isRunning,o=i.saveScene,s=i.exportScene,l=z(),u=l.createScript,h=l.selectedScript,p=l.loadScript,m=l.saveScript,v=l.scriptBody;return Object(c.jsxs)("div",{children:[Object(c.jsx)("header",{className:"h-0.5 transition bg-red-600 ".concat(r&&"bg-green-500")}),Object(c.jsxs)("nav",{className:"bg-gray-900 p-2 flex w-full shadow-sm",children:[Object(c.jsxs)("div",{className:"space-x-2",children:[Object(c.jsxs)("button",{onClick:a,className:"primary",children:[r?"Stop":"Run"," Scene"]}),Object(c.jsx)("button",{onClick:function(){var e=Object(Q.a)();t(e)},className:"secondary",children:"Add Entity"}),Object(c.jsx)("button",{onClick:function(){var e=Object(Q.b)();t(e)},className:"secondary",children:"Add Light"}),Object(c.jsx)("button",{onClick:function(){u([{name:"NewComponent",language:"js",type:"component"}])},className:"secondary",children:"Add Component"}),Object(c.jsx)("button",{onClick:function(){var e=u([{name:"vertex",language:"glsl",type:"vertex"},{name:"fragment",language:"glsl",type:"fragment"}]),t=Object(d.a)(e,2),i=t[0],a=t[1];n("NewMaterial",i.id,a.id)},className:"secondary",children:"Add Material"}),Object(c.jsx)("button",{onClick:function(){o()},className:"secondary",children:"Save Scene"}),Object(c.jsx)("button",{onClick:function(){s()},className:"secondary",children:"Export Scene"})]}),h&&Object(c.jsxs)("div",{className:"space-x-2 ml-auto",children:[Object(c.jsx)("button",{className:"secondary",onClick:function(){p("")},children:"Close Editor"}),Object(c.jsx)("button",{onClick:function(){h&&m(Object(w.a)(Object(w.a)({},h),{},{content:v}))},className:"submit",children:"Save script"})]})]})]})}var $=n(48);function ee(){var e=z(),t=e.selectedScript,n=e.scriptBody,a=e.setScriptBody;Object(i.useEffect)((function(){!n&&t&&a(t.content)}),[t]);return Object(c.jsx)(c.Fragment,{children:t&&Object(c.jsx)(c.Fragment,{children:Object(c.jsx)("div",{className:"absolute h-full w-full",children:Object(c.jsx)($.a,{height:"100%",width:"100%",defaultLanguage:function(){if(!t)return"javascript";switch(t.language){case"js":return"javascript";case"ts":return"typescript";case"glsl":return"c";default:return"cpp"}}(),defaultValue:t.content,theme:"vs-dark",onChange:function(e){a(null!==e&&void 0!==e?e:"")},defaultPath:"/src/modal"})},t.id)})})}function te(){var e=V(),t=e.renderElement,n=e.handleClickScene;return Object(c.jsx)(c.Fragment,{children:t&&Object(c.jsx)("div",{id:"scene",ref:t,tabIndex:-1,onMouseDown:function(e){return n(e)}})})}var ne=function(e){var t,n=e.entity,a=C(),r=a.selectedEntity,o=a.selectEntity,s=Object(i.useMemo)((function(){return(null===r||void 0===r?void 0:r.id)===n.id}),[r,n.id]),l=Object(i.useMemo)((function(){return!n.visible}),[n]);return Object(c.jsx)("div",{className:"\n          p-1\n          rounded-sm\n          transition\n          cursor-pointer\n          select-none\n        text-white\n          text-sm\n          ".concat(s&&"bg-gray-500","\n          ").concat(s?"hover:bg-gray-600":"hover:bg-gray-500","\n          ").concat(l&&"opacity-50","\n\n    "),onMouseDown:function(e){e.stopPropagation(),o(n.id)},children:null!==(t=null===n||void 0===n?void 0:n.name)&&void 0!==t?t:"__ENTITY__"})};function ie(){var e=C().sceneConfig;return Object(c.jsx)(U,{label:"Hierarchy",children:Object(c.jsx)("div",{className:"space-y-1",children:e.entities.map((function(e){return Object(c.jsx)(ne,{entity:e},e.id)}))})})}function ae(e){var t=e.title,n=e.children;return Object(c.jsxs)("details",{children:[Object(c.jsx)("summary",{children:t}),null!==n&&void 0!==n?n:"No ".concat(t)]})}function re(){var e=C(),t=e.sceneConfig,n=e.selectedMaterial,i=e.selectMaterial,a=z(),r=a.scripts,o=a.loadScript,s=a.selectedScript;return Object(c.jsxs)(U,{label:"Project",bodyClass:"space-y-2",children:[Object(c.jsx)(ae,{title:"Scripts",children:r.map((function(e){return Object(c.jsxs)("div",{className:"project-node\n          ".concat((null===s||void 0===s?void 0:s.id)===e.id&&"bg-gray-500","\n          ").concat((null===s||void 0===s?void 0:s.id)===e.id?"hover:bg-gray-600":"hover:bg-gray-500"),onClick:function(){return o(e.id)},children:[e.name,".",e.language]},e.id)}))}),Object(c.jsx)(ae,{title:"Prefabs"}),Object(c.jsx)(ae,{title:"Materials",children:t.materials.map((function(e){return Object(c.jsx)("div",{className:"project-node ".concat((null===n||void 0===n?void 0:n.id)===e.id&&"bg-gray-500","\n          ").concat((null===n||void 0===n?void 0:n.id)===e.id?"hover:bg-gray-600":"hover:bg-gray-500"),onClick:function(){return i(e.id)},children:e.name},e.id)}))})]})}function oe(){var e=C(),t=e.selectedEntity,n=e.selectedMaterial,a=Object(i.useMemo)((function(){return!!t||!!n}),[t,n]);return Object(c.jsxs)("div",{className:"w-screen h-screen overflow-hidden",children:[Object(c.jsx)(J,{}),Object(c.jsxs)("section",{className:"w-full h-full grid",style:{gridTemplateColumns:"80vw 1fr"},children:[Object(c.jsxs)("div",{className:"h-full w-full grid relative",children:[Object(c.jsx)(te,{}),Object(c.jsx)(ee,{})]}),a?Object(c.jsx)("aside",{className:"grid",children:Object(c.jsx)(Z,{})}):Object(c.jsxs)("aside",{className:"grid grid-rows-5",children:[Object(c.jsx)("div",{className:"row-span-3",children:Object(c.jsx)(ie,{})}),Object(c.jsx)("div",{className:"row-span-2",children:Object(c.jsx)(re,{})})]})]})]})}var ce=function(){return Object(c.jsx)(E,{children:Object(c.jsx)(b,{children:Object(c.jsx)(u,{children:Object(c.jsx)(oe,{})})})})};o.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(ce,{})}),document.getElementById("root"))}},[[79,1,2]]]);
//# sourceMappingURL=main.177e81c7.chunk.js.map