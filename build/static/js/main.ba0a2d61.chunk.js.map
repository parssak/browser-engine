{"version":3,"sources":["engine/core/Entity.ts","engine/core/SceneManager.ts","utils/index.ts","engine/core/Component.ts","engine/core/Transform.ts","engine/core/ComponentManager.ts","utils/script.utils.ts","engine/core/MaterialManager.ts","engine/core/GeometryManager.ts","state/scripts/ScriptContext.tsx","utils/entity.utils.ts","state/editor/EditorContext.tsx","engine/core/CameraManager.ts","engine/core/EngineContext.ts","state/scene/SceneContext.tsx","state/scene/useScene.tsx","state/scripts/useScripts.tsx","state/editor/useEditor.tsx","ui/components/Controls.tsx","ui/components/TreeViewPanel.tsx","ui/components/ScriptPanel.tsx","ui/base/BrowserEngine.tsx","App.tsx","index.tsx"],"names":["Entity","props","name","mesh","id","components","this","init","initMesh","initComponents","mat","MaterialManager","instance","getMaterial","material","geometry","GeometryManager","getGeometry","THREE","uuid","Object","entries","forEach","type","ComponentManager","setComponent","child","SceneManager","isPlaying","_startComponents","_updateComponents","componentName","values","component","start","update","_scene","_entities","_scenePayload","_selectedEntityID","_axes","_gridHelper","_selectionHelper","add","payload","sceneConfig","entities","find","e","entityID","entityProps","updateIndex","findIndex","setFromObject","entity","_resetScene","remove","_buildEntities","_startEntities","error","console","select","undefined","object","push","destroy","input","JSON","parse","stringify","buildEntity","Component","Transform","position","rotation","scale","applyMatrix","setX","x","setY","y","setZ","z","setRotationFromEuler","applyPosition","applyRotation","applyScale","registerComponent","constructor","componentProps","componentType","getComponent","prop","Array","isArray","length","componentInstance","COMPONENT_DEF","baseScriptContent","generateNewScript","uuidv4","language","content","initPropPlaceholder","formatScriptString","script","replace","injectInitSection","scriptBody","actualInitSection","map","key","value","join","wireframe","initialValue","scripts","selectedScript","setScripts","setSelectedScript","compileScripts","ScriptContext","createContext","ScriptProvider","children","useState","three","Instantiate","bind","CreateEntity","generateNewEntity","scriptCopy","removePrefix","substring","indexOf","pureProps","replaceAll","eval","formattedScript","NewComponent","setPrototypeOf","err","useEffect","contextValue","Provider","EditorContext","EditorProvider","renderElement","useRef","CameraManager","renderer","antialias","raycaster","fov","near","far","camera","controls","_setCamera","window","addEventListener","handleResize","scene","setSize","clientWidth","clientHeight","appendChild","domElement","_setControls","_setRaycaster","_runSceneLoop","setAnimationLoop","mouseX","mouseY","pointer","setFromCamera","intersects","intersectObjects","getScene","filter","innerWidth","innerHeight","time","dimensions","getBoundingClientRect","aspect","width","height","updateProjectionMatrix","setPixelRatio","devicePixelRatio","render","updateScene","context","sceneManager","cameraManager","componentManager","materialManager","geometryManager","_renderElement","isInitialized","updateScenePayload","runEditMode","runPlayScene","setup","runEditScene","setScenePayload","updateEntityPayload","handleClick","selectByID","getSelectedEntity","getSelectedEntityPayload","selectedEntityID","setEntities","setSelectedEntityID","setCameraProps","cameraProps","SceneContext","SceneProvider","useMemo","updateSpecificEntity","useScene","useContext","selectedEntity","createEntity","newEntity","addNewEntity","selectEntity","updateEntity","index","updateEntityParent","newParent","useScripts","loadScript","scriptID","s","saveScript","foundScript","createScript","newScript","useEditor","isRunning","setIsRunning","scenePayload","current","toggleRun","runPlayMode","handleClickScene","domRect","target","clientX","clientY","ComponentFieldValue","field","updateField","className","onChange","Number","ComponentNode","updateComponent","fieldName","fieldValue","style","minWidth","Controls","setControls","materialType","setMaterialType","geometryType","setGeometryType","propFields","updateComponentFields","newControls","componentOptions","getComponents","keys","label","getComponentOptions","onClick","getComponentProps","addComponent","newMaterial","defaultValue","option","newGeometry","TreeNode","isSelected","stopPropagation","TreeViewPanel","ScriptPanel","BrowserEngine","setScriptBody","gridTemplateColumns","ref","defaultLanguage","theme","newValue","App","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ba0a2d61.chunk.js","sourcesContent":["import * as THREE from 'three';\nimport Component from './Component';\nimport ComponentManager from './ComponentManager';\nimport MaterialManager from './MaterialManager';\nimport GeometryManager from './GeometryManager';\nimport SceneManager from './SceneManager';\n\nexport default class Entity {\n  public name: string = \"\";\n  public mesh!: THREE.Mesh;\n  public readonly id: Engine.EntityID;\n  public components: Record<Engine.ComponentType, Component> = {};\n\n  constructor(props: Engine.EntityProps) {\n    this.id = props.id;\n    this.name = props.name;\n    this.init(props);\n  }\n\n  init(props: Engine.EntityProps) {\n    this.initMesh(props);\n    this.initComponents(props.components);\n  }\n\n  initMesh(props: Engine.EntityProps) {\n    const mat = MaterialManager.instance.getMaterial(props.material);\n    const geometry = GeometryManager.instance.getGeometry(props.geometry);\n    if (!this.mesh) {\n      this.mesh = new THREE.Mesh(geometry, mat);\n    }\n    else {\n      this.mesh.geometry = geometry;\n      this.mesh.material = mat;\n    }\n    this.mesh.uuid = this.id;\n    this.mesh.name = this.name;\n  }\n\n  initComponents(components: Record<Engine.ComponentType, Engine.ComponentProps>) {\n    this.components = {};\n    Object.entries(components).forEach(([type, props]) => {\n      ComponentManager.instance.setComponent(this, type, props);\n    })\n  }\n\n  // TODO: Implement\n  addChild(child: Entity) { }\n\n  // TODO: Implement\n  destroy() { }\n\n  start() {\n    if (SceneManager.isPlaying()) {\n      this._startComponents();\n    }\n  }\n\n  update() {\n    if (SceneManager.isPlaying()) {\n      this._updateComponents();\n    }\n  }\n\n  getComponent(componentName: string): Component | undefined {\n    return this.components[componentName];\n  }\n\n  private _startComponents() {\n    Object.values(this.components).forEach((component) => component.start())\n  }\n\n  private _updateComponents() {\n    Object.values(this.components).forEach((component) => component.update())\n  }\n}","import * as THREE from 'three';\nimport { deepClone } from '../../utils';\nimport Entity from \"./Entity\";\n\nexport default class SceneManager {\n  public static instance: SceneManager;\n  private isPlaying: boolean = false; // If true, in play mode, else in edit mode\n  private _scene!: THREE.Scene;\n  private _entities: Entity[] = [];\n  private _scenePayload: Engine.ScenePayload | undefined;\n\n  // Selection\n  private _selectedEntityID: Engine.EntityID | undefined;\n  \n  // Helpers\n  private _axes = new THREE.AxesHelper(2);\n  private _gridHelper = new THREE.GridHelper(60, 6);\n  private _selectionHelper: THREE.BoxHelper | undefined;\n\n  constructor() {\n    if (SceneManager.instance) { return; }\n    SceneManager.instance = this;\n    this._scene = new THREE.Scene();\n    this._scene?.add(this._axes);\n    this._scene?.add(this._gridHelper);\n    this._scene?.add(new THREE.DirectionalLight(0xffffff, 0.6));\n    this._scene?.add(new THREE.AmbientLight(0x555555));\n  }\n\n  static isPlaying() {\n    return SceneManager.instance.isPlaying;\n  }\n\n  getScene(): THREE.Scene {\n    return this._scene;\n  }\n\n  setScenePayload(payload: Engine.ScenePayload) {\n    this._scenePayload = payload;\n  }\n\n  getSelectedEntityPayload(): Engine.EntityProps | undefined {\n    return this._scenePayload?.sceneConfig.entities.find(e => e.id === this._selectedEntityID);\n  }\n\n  updateEntityPayload(entityID: Engine.EntityID, entityProps: Engine.EntityProps) {\n    const updateIndex = this._entities.findIndex(e => e.id === entityID);\n    if (updateIndex === -1) return;\n    this._entities[updateIndex].init(entityProps);\n    this._selectionHelper?.setFromObject(this._entities[updateIndex].mesh);\n  }\n\n  updateScene() {\n    this._entities.forEach(entity => {\n      entity.update();\n    });\n  }\n\n  /** Runs scene in play mode.\n   * \n   *  In play mode, the components in all \n   *  entities are updated each frame.\n   */\n  runPlayScene() {\n    this.isPlaying = true;\n    this._resetScene();\n    this._scene.remove(this._axes);\n    this._scene.remove(this._gridHelper);\n    if (this._selectionHelper) this._scene.remove(this._selectionHelper);\n    try {\n      this._buildEntities();\n      this._startEntities();\n    } catch (error) {\n      console.error('Error whilst setting up play scene');\n    }\n  }\n\n  /** Runs scene in edit mode\n   * \n   *  In edit mode, the scene is reset and all\n   *  entities are reverted to their initial states, \n   *  based on the scenePayload.\n   */\n  runEditScene() {\n    this.isPlaying = false;\n    this._resetScene();\n    this._scene.add(this._axes);\n    this._scene.add(this._gridHelper);\n    if (this._selectionHelper) this._scene.add(this._selectionHelper);\n    this._buildEntities();\n  }\n\n  /** Select an entity by ID */\n  selectByID(entityID: Engine.EntityID) {\n    this.select(this._entities.find(e => e.id === entityID)?.mesh ?? undefined);\n  }\n\n  /** Sets Entity with corresponding object as selected,\n   *  if no object is passed, deselects any selected entity\n   * @param object THREE.Object3D\n   */\n  select(object?: THREE.Object3D) {\n    if (this.isPlaying) return;\n    if (!object && this._selectionHelper && this._selectedEntityID) {\n      this._scene.remove(this._selectionHelper);\n      this._selectedEntityID = undefined;\n      return;\n    }\n    \n    if (object) {\n      this._selectedEntityID = object.uuid;\n      if (!this._selectionHelper) {\n        this._selectionHelper = new THREE.BoxHelper(object, 0xffff00);\n        this._scene.add(this._selectionHelper);\n        return;\n      }\n      \n      this._selectionHelper?.setFromObject(object);\n      this._scene.add(this._selectionHelper);\n    }\n  }\n\n  getSelectedEntity(): Engine.EntityID | undefined {\n    return this._selectedEntityID;\n  }\n\n  buildEntity(props: Engine.EntityProps): Entity {\n    const entity = new Entity(props);\n    this._entities.push(entity);\n    this._scene.add(entity.mesh);\n    return entity;\n  }\n\n  private _startEntities() {\n    this._entities.forEach(entity => {\n      entity.start();\n    });\n  }\n\n  private _resetScene() {\n    this._entities.forEach(entity => {\n      this._scene.remove(entity.mesh);\n      entity.destroy();\n    });\n    this._entities = [];\n  }\n\n  private _buildEntities() {\n    if (!this._scenePayload) return;\n    // This prevents all of the strange object mutation\n    const localPayloadCopy = deepClone<Engine.ScenePayload>(this._scenePayload);\n    localPayloadCopy.sceneConfig.entities.forEach(entityProps => {\n      this.buildEntity(entityProps);\n    });\n  }\n}","export const deepClone = <T>(input: T): T => {\n  return JSON.parse(JSON.stringify(input)) as T\n}","import Entity from \"./Entity\";\n\nexport default abstract class Component {\n  entity: Entity;\n\n  constructor(entity: Entity) {\n    this.entity = entity;\n  }\n\n  abstract init(props: Engine.ComponentProps): void;\n\n  abstract start(): void;\n\n  abstract update(): void;\n}\n\n// This is only used for generating the BaseComponentType for internal use, \n// when creating Components, extend the abstract Component class instead.\nclass BaseComponent extends Component {\n  entity!: Entity;\n\n  init(props: Engine.ComponentProps) { }\n\n  start() { }\n\n  update() { }\n}\n\nexport type BaseComponentType = typeof BaseComponent;","import * as THREE from 'three';\nimport Component from './Component';\nimport Entity from './Entity';\ninterface ITransformProps {\n  position?: THREE.Vector3;\n  rotation?: THREE.Euler;\n  scale?: THREE.Vector3;\n}\n\nexport default class Transform extends Component {\n  entity: Entity;\n\n  // <@public>\n  public position: THREE.Vector3 = new THREE.Vector3(0, 0, 0);\n  public rotation: THREE.Euler = new THREE.Euler(0, 0, 0, 'XYZ');\n  public scale: THREE.Vector3 = new THREE.Vector3(1, 1, 1);\n  // </@public>\n\n  constructor(entity: Entity) {\n    super(entity);\n    this.entity = entity;\n  }\n\n  init(props?: ITransformProps) {\n    this.position = props?.position ?? this.position;\n    this.rotation = props?.rotation ?? this.rotation;\n    this.scale = props?.scale ?? this.scale;\n    this.applyMatrix();\n  }\n\n  start() {\n    this.applyMatrix();\n  }\n\n  private applyPosition() {\n    this.entity.mesh.position.setX(this.position.x);\n    this.entity.mesh.position.setY(this.position.y);\n    this.entity.mesh.position.setZ(this.position.z);\n  }\n\n  private applyRotation() {\n    this.entity.mesh.setRotationFromEuler(new THREE.Euler(this.rotation.x, this.rotation.y, this.rotation.z));\n  }\n\n  private applyScale() {\n    this.entity.mesh.scale.setX(this.scale.x);\n    this.entity.mesh.scale.setY(this.scale.y);\n    this.entity.mesh.scale.setZ(this.scale.z);\n  }\n\n  private applyMatrix() {\n    if (!this.entity) { return; }\n    this.applyPosition();\n    this.applyRotation();\n    this.applyScale();\n  }\n\n  update() {\n    this.applyMatrix();\n  }\n}\n","import * as THREE from 'three';\nimport Transform from \"./Transform\";\nimport { BaseComponentType } from \"./Component\";\nimport Entity from \"./Entity\";\nexport default class ComponentManager {\n  public static instance: ComponentManager;\n  private components: { [key: string]: { constructor: BaseComponentType, props: Engine.ComponentProps } } = {};\n\n  constructor() {\n    if (ComponentManager.instance) return;\n    ComponentManager.instance = this;\n\n    this.registerComponent(\"Transform\", Transform, {\n      position: { x: 0, y: 0, z: 0 },\n      rotation: { x: 0, y: 0, z: 0 },\n      scale: { x: 1, y: 1, z: 1 },\n    });\n  }\n\n  public getComponents() {\n    return { ...this.components };\n  };\n\n  public registerComponent(componentName: string, component: BaseComponentType, props: Engine.ComponentProps): void {\n    this.components[componentName] = { constructor: component, props };\n  };\n\n  public getComponentProps(name: Engine.ComponentType): Engine.ComponentProps | null {\n    const componentProps = this.components[name].props ?? null;\n    if (!componentProps) {\n      return null;\n    }\n    return componentProps;\n  }\n\n  private getComponent(name: Engine.ComponentType): BaseComponentType | null {\n    return this.components[name].constructor ?? null;\n  }\n\n  public setComponent(entity: Entity, componentType: Engine.ComponentType, componentProps: Engine.ComponentProps): void {\n    \n    const component = this.getComponent(componentType);\n    if (!component) {\n      console.error(`Component ${componentType} not found`);\n      return;\n    }\n\n    // Translate vector props \n    Object.entries(componentProps).forEach(([name, prop]) => {\n      if (Array.isArray(prop)) {\n        if (prop.length === 3) {\n          componentProps[name] = new THREE.Vector3(prop[0], prop[1], prop[2]) as any;\n        }\n        else if (prop.length === 2) {\n          componentProps[name] = new THREE.Vector2(prop[0], prop[1]) as any;\n        }\n      }\n    });\n    const componentInstance = new component(entity);\n    try {\n      componentInstance.init(componentProps);\n      entity.components[componentType] = componentInstance;\n    } catch (e) {\n      console.error('Error whilst initializing component', e);\n    }\n  }\n}","import { v4 as uuidv4 } from 'uuid';\n\nconst COMPONENT_DEF = `// @defineComponent`;\nconst baseScriptContent = `class Name {\n  \n  // <public>\n\n  // </public>\n\n  ${COMPONENT_DEF}\n\n  start() {\n    \n  }\n\n  update() {\n\n  }\n}`\n\nexport const generateNewScript = (name: string): Engine.Script => {\n  const id = uuidv4();\n  return {\n    id,\n    name,\n    language: 'js',\n    content: baseScriptContent,\n    type: 'component'\n  }\n};\n\nconst initPropPlaceholder = '// <initPropPlaceholder />';\n\nexport const formatScriptString = (script: Engine.Script): string => {\n  const formatted = `(${script.content})`;\n  return formatted.replace(COMPONENT_DEF, `\n          entity;\n        \n          constructor(entity) {\n            this.entity = entity;\n          }\n\n          ${initPropPlaceholder}\n        `);\n};\n\nexport const injectInitSection = (scriptBody: string, props: Record<string, Engine.ComponentPropType>): string => {\n  const actualInitSection = `\n  init(props) {\n    this.transform = this.entity.getComponent('Transform');\n    ${Object.entries(props).map(([key, value]) => `this.${key} = props?.${key} ?? ${value};`).join('\\n')}\n  }`;\n  return scriptBody.replace(initPropPlaceholder, actualInitSection);\n}","import * as THREE from 'three';\n\nexport default class MaterialManager {\n  public static instance: MaterialManager;\n\n  constructor() {\n    if (MaterialManager.instance) return;\n    MaterialManager.instance = this;\n  }\n\n  getMaterial(type: Engine.MaterialType): THREE.Material {\n    switch (type) {\n      case 'normal':\n        return new THREE.MeshNormalMaterial();\n      case 'basic':\n        return new THREE.MeshBasicMaterial();\n      case 'phong':\n        return new THREE.MeshPhongMaterial();\n      case 'lambert':\n        return new THREE.MeshLambertMaterial();\n      case 'wireframe':\n        return new THREE.MeshBasicMaterial({ wireframe: true });\n      default:\n        return new THREE.MeshBasicMaterial();\n    }\n  }\n}\n","import * as THREE from 'three';\n\nexport default class GeometryManager {\n  public static instance: GeometryManager;\n\n  constructor() {\n    if (GeometryManager.instance) return;\n    GeometryManager.instance = this;\n  }\n\n  getGeometry(type: Engine.MaterialType): THREE.BufferGeometry {\n    switch (type) {\n      case 'box':\n        return new THREE.BoxBufferGeometry();\n      case 'sphere':\n        return new THREE.SphereBufferGeometry(1, 16, 8);\n      case 'cylinder':\n        return new THREE.CylinderBufferGeometry(1, 1, 1, 16, 1);\n      case 'torus':\n        return new THREE.TorusBufferGeometry(6, 1.1, 10, 32, 6.3);\n      case 'plane':\n        return new THREE.PlaneBufferGeometry(1, 1);\n      case 'tetrahedron':\n        return new THREE.TetrahedronBufferGeometry();\n      case 'octahedron':\n        return new THREE.OctahedronBufferGeometry();\n      case 'dodecahedron':\n        return new THREE.DodecahedronBufferGeometry();\n      case 'icosahedron':\n        return new THREE.IcosahedronBufferGeometry();\n      default:\n        return new THREE.SphereBufferGeometry();\n    }\n  }\n}","import * as three from 'three';\nimport { Component, ReactElement, useEffect, useState } from 'react';\nimport { createContext } from 'react';\nimport ComponentManager from '../../engine/core/ComponentManager';\nimport { formatScriptString, injectInitSection } from '../../utils/script.utils';\nimport context from '../../engine/core/EngineContext';\nimport SceneManager from '../../engine/core/SceneManager';\nimport { generateNewEntity } from '../../utils/entity.utils';\n\ninterface IScriptContext {\n  scripts: Engine.Script[];\n  selectedScript: Engine.Script | undefined;\n  setScripts: (scripts: Engine.Script[]) => void;\n  setSelectedScript: (script: Engine.Script | undefined) => void;\n  compileScripts: () => void;\n};\n\nconst initialValue: IScriptContext = {\n  scripts: [],\n  selectedScript: undefined,\n  setScripts: (scripts: Engine.Script[]) => { },\n  setSelectedScript: (script: Engine.Script | undefined) => { },\n  compileScripts: () => { }\n}\n\nexport const ScriptContext = createContext<IScriptContext>(initialValue);\n\nexport const ScriptProvider = ({ children }: { children: ReactElement | ReactElement[] }) => {\n  const [scripts, setScripts] = useState<Engine.Script[]>([]);\n  const [selectedScript, setSelectedScript] = useState<Engine.Script | undefined>()\n\n  const compileScripts = () => {\n    const THREE = three;\n    const Instantiate = SceneManager.instance.buildEntity.bind(SceneManager.instance);\n    const CreateEntity = generateNewEntity;\n    \n    scripts.forEach(script => {\n      try {\n        const scriptCopy = `${script.content}`;\n        const removePrefix = scriptCopy.substring(scriptCopy.indexOf(\"// <public>\") + 11);\n        let pureProps = removePrefix.substring(0, removePrefix.indexOf(\"// </public>\"));\n        pureProps = pureProps.replaceAll(';', ',');\n        pureProps = pureProps.replaceAll('=', ':');\n        let props: Record<string, Engine.ComponentType> = {};\n        if (`${pureProps}`.replace(/\\s/g, \"\").length) {\n          pureProps = `{${pureProps}}`\n          props = eval(`(${pureProps})`); // ! <-- dangerous usage of eval pt. 2 ;)\n        }\n        let formattedScript = formatScriptString(script);\n        formattedScript = injectInitSection(formattedScript, props);\n        const NewComponent: any = eval(`(${formattedScript})`); // ! <-- dangerous usage of eval ;)\n        Object.setPrototypeOf(NewComponent, Component); // ! <-- lol\n        ComponentManager.instance.registerComponent(script.name, NewComponent, props);\n      } catch (err) {\n        console.error(err);\n      }\n    }\n    )\n  }\n\n  useEffect(() => {\n    compileScripts();\n  }, [scripts])\n\n  const contextValue = { scripts, setScripts, selectedScript, setSelectedScript, compileScripts };\n\n  return (\n    <ScriptContext.Provider value={contextValue}>\n      {children}\n    </ScriptContext.Provider>\n  );\n};","import { v4 as uuidv4 } from 'uuid';\nexport const generateNewEntity = (): Engine.EntityProps => {\n  const id = uuidv4();\n  return {\n    id,\n    name: \"New Entity\",\n    geometry: 'box',\n    material: 'normal',\n    children: [],\n    components: {\n      Transform: {\n        position: { x: 0, y: 0, z: 0 },\n        rotation: { x: 0, y: 0, z: 0 },\n        scale: { x: 1, y: 1, z: 1 },\n      }\n    },\n  };\n}","import { ReactElement, useEffect, useRef } from 'react';\nimport { createContext } from 'react';\n\ninterface IEditorContext {\n  renderElement?: React.MutableRefObject<HTMLDivElement | null>;\n};\n\nconst initialValue: IEditorContext = {}\n\nexport const EditorContext = createContext<IEditorContext>(initialValue);\n\nexport const EditorProvider = ({ children }: { children: ReactElement | ReactElement[] }) => {\n  const renderElement = useRef<HTMLDivElement>(null)\n  const contextValue = { renderElement };\n\n\n  return (\n    <EditorContext.Provider value={contextValue}>\n      {children}\n    </EditorContext.Provider>\n  );\n};","import * as THREE from 'three';\nimport SceneManager from './SceneManager';\n\nexport default class CameraManager {\n  public static instance: CameraManager;\n  private renderer = new THREE.WebGLRenderer({ antialias: true });\n  private renderElement: HTMLElement | undefined;\n  private raycaster: THREE.Raycaster = new THREE.Raycaster();\n  private fov = 60;\n  private near = 0.01;\n  private far = 20000;\n  private camera!: THREE.PerspectiveCamera;\n  private controls: any;\n\n\n  constructor() {\n    if (CameraManager.instance) return CameraManager.instance;\n    CameraManager.instance = this;\n    this._setCamera();\n    window.addEventListener('resize', () => this.handleResize());\n  }\n\n  setup(renderElement: HTMLElement, scene: THREE.Scene) {\n    this.renderer.setSize(renderElement.clientWidth, renderElement.clientHeight);\n    this.renderElement = renderElement;\n    this.renderElement.appendChild(this.renderer.domElement);\n    this.handleResize();\n    this._setControls();\n    this._setRaycaster();\n    this._runSceneLoop(scene);\n  }\n\n  resetCamera() {\n    this.renderer.setAnimationLoop(null);\n  }\n\n  handleClick(mouseX: number, mouseY: number) {\n    const pointer = new THREE.Vector2(mouseX, mouseY);\n    this.raycaster.setFromCamera(pointer, this.camera);\n    const intersects = this.raycaster.intersectObjects(SceneManager.instance.getScene().children, true).filter(e => e.object.type === 'Mesh');\n    \n    if (intersects.length > 0) {\n      SceneManager.instance.select(intersects[0].object);\n    }\n    else {\n      SceneManager.instance.select();\n    }\n  }\n\n  private _setCamera() {\n    if (!this.renderElement) {\n      this.camera = new THREE.PerspectiveCamera(this.fov, window.innerWidth / window.innerHeight, this.near, this.far);\n      this.camera.position.y = 10;\n      this.camera.rotation.x = -0.1;\n    }\n  }\n\n  private _runSceneLoop(scene: THREE.Scene) {\n    this.renderer.setAnimationLoop((time: number) => this.update(scene));\n  }\n\n  private _setRaycaster() {\n    this.raycaster = new THREE.Raycaster();\n  }\n\n  private _setControls() {\n    this.camera.position.z = 50;\n  }\n\n  handleResize() {\n    if (!this.renderElement) return;\n    const dimensions = this.renderElement.getBoundingClientRect();\n    this.camera.aspect = dimensions.width / dimensions.height;\n    this.camera.updateProjectionMatrix();\n    this.renderer.setSize(this.renderElement.clientWidth, this.renderElement.clientHeight);\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n  }\n\n  update(scene: THREE.Scene) {\n    this.renderer.render(scene, this.camera);\n    SceneManager.instance.updateScene();\n  }\n}","import CameraManager from \"./CameraManager\";\nimport ComponentManager from \"./ComponentManager\";\nimport GeometryManager from \"./GeometryManager\";\nimport MaterialManager from \"./MaterialManager\";\nimport SceneManager from \"./SceneManager\";\n\nclass EngineContext {\n  sceneManager: SceneManager;\n  cameraManager: CameraManager;\n  componentManager: ComponentManager;\n  materialManager: MaterialManager;\n  geometryManager: GeometryManager;\n  private _renderElement!: HTMLElement;\n  private isInitialized = false;\n\n  constructor() {\n    this.sceneManager = new SceneManager();\n    this.cameraManager = new CameraManager();\n    this.componentManager = new ComponentManager();\n    this.materialManager = new MaterialManager();\n    this.geometryManager = new GeometryManager();\n  }\n\n  init(renderElement: HTMLElement, payload?: Engine.ScenePayload) {\n    if (this.isInitialized) return;\n    this._renderElement = renderElement;\n    if (payload) this.updateScenePayload(payload);\n    this.runEditMode();\n    this.isInitialized = true;\n  }\n\n  runPlayMode() {\n    this.sceneManager.runPlayScene();\n    this.cameraManager.setup(this._renderElement, this.sceneManager.getScene());\n  }\n\n  runEditMode() {\n    this.sceneManager.runEditScene();\n    this.cameraManager.setup(this._renderElement, this.sceneManager.getScene());\n  }\n\n  updateScenePayload(payload: Engine.ScenePayload) {\n    this.sceneManager.setScenePayload(payload);\n  }\n\n  updateSpecificEntity(entityID: Engine.EntityID, entityProps: Engine.EntityProps) {\n    this.sceneManager.updateEntityPayload(entityID, entityProps);\n  }\n\n  addNewEntity(entity: Engine.EntityProps) {\n    this.sceneManager.buildEntity(entity);\n\n  }\n\n  isPlaying(): boolean {\n    return SceneManager.isPlaying() ?? false\n  }\n\n  handleClick(mouseX: number, mouseY: number) {\n    this.cameraManager.handleClick(mouseX, mouseY);\n  }\n\n  selectEntity(entityID: Engine.EntityID) {\n    this.sceneManager.selectByID(entityID);\n  }\n\n  getSelectedEntity(): Engine.EntityID | undefined {\n    return this.sceneManager.getSelectedEntity();\n  }\n\n  getSelectedEntityProps(): Engine.EntityProps | undefined {\n    return this.sceneManager.getSelectedEntityPayload();\n  }\n}\n\nconst context = new EngineContext();\n\nexport default context;","import * as THREE from 'three';\nimport { ReactElement, useEffect, useMemo } from 'react';\nimport { createContext } from 'react';\nimport { useState } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport context from '../../engine/core/EngineContext';\n\ninterface ISceneContext {\n  sceneConfig: Engine.SceneConfig;\n  setEntities: (props: Engine.EntityProps[]) => void;\n  selectedEntityID: string | null;\n  setSelectedEntityID: (entityID: string | null) => void;\n  setCameraProps: (cameraProps: Engine.CameraProps) => void;\n};\n\nconst initialValue = {\n  sceneConfig: {\n    entities: [] as Engine.EntityProps[],\n    camera: {\n      position: new THREE.Vector3(),\n      fov: 70,\n      near: 0.1,\n      far: 1000,\n      controls: \"orbit\" as Engine.ControlType\n    }\n  },\n  selectedEntityID: null,\n  setEntities: (entities: Engine.EntityProps[]) => { },\n  setSelectedEntityID: (entityID: string | null) => { },\n  setCameraProps: (cameraProps: Engine.CameraProps) => { }\n};\n\nexport const SceneContext = createContext<ISceneContext>(initialValue);\n\nexport const SceneProvider = ({ children }: { children: ReactElement | ReactElement[] }) => {\n  const [cameraProps, setCameraProps] = useState<Engine.CameraProps>({\n    position: new THREE.Vector3(),\n    fov: 70,\n    near: 0.1,\n    far: 1000,\n    controls: \"orbit\" as Engine.ControlType\n  });\n\n  const [entities, setEntities] = useState<Engine.EntityProps[]>([\n    {\n      id: uuidv4(),\n      name: \"Entity A\",\n      material: 'normal',\n      geometry: 'box',\n      children: [],\n      components: {\n        \"Transform\": {\n          position: {x: 0, y: 0, z: 0},\n          rotation: { x: 0, y: 0, z: 0 },\n          scale: {x: 1, y: 1, z: 1},\n        },\n      }\n    },\n  ])\n  const [selectedEntityID, setSelectedEntityID] = useState<string | null>(null);\n\n  const sceneConfig = useMemo(() => (\n    {\n      entities,\n      camera: cameraProps\n    }\n  ), [entities, cameraProps]);\n\n  useEffect(() => {\n    if (selectedEntityID) {\n      const entityProps = entities.find(e => e.id === selectedEntityID);\n      if (!entityProps) return;\n      context.updateSpecificEntity(selectedEntityID, entityProps);\n    }\n  }, [sceneConfig])\n\n  const contextValue = {\n    sceneConfig,\n    selectedEntityID,\n    setEntities,\n    setCameraProps,\n    setSelectedEntityID\n  }\n  return (\n    <SceneContext.Provider value={contextValue}>\n      {children}\n    </SceneContext.Provider>\n  );\n}","import { useContext, useMemo} from \"react\";\nimport { SceneContext } from \"./SceneContext\";\nimport context from \"../../engine/core/EngineContext\";\nimport { generateNewEntity } from \"../../utils/entity.utils\";\n\nconst useScene = () => {\n  const { sceneConfig, setEntities, selectedEntityID, setSelectedEntityID } = useContext(SceneContext);\n\n\n  const selectEntity = (id: Engine.EntityID) => {\n    if (id === selectedEntityID) {\n      context.selectEntity('')\n      setSelectedEntityID('')\n      return;\n    }\n    context.selectEntity(id);\n    setSelectedEntityID(id);\n  };\n\n  const selectedEntity: Engine.EntityProps | null = useMemo(() => {\n    return sceneConfig.entities.find(e => e.id === selectedEntityID) ?? null;\n  }, [sceneConfig, selectedEntityID]);\n\n\n  const updateEntity = (entity: Engine.EntityProps) => {\n    const index = sceneConfig.entities.findIndex(e => e.id === entity.id);\n    if (index === -1) {\n      console.error(`Couldn't find ${entity.id} in sceneConfig.entities`);\n    };\n    sceneConfig.entities[index] = entity;\n    setEntities([...sceneConfig.entities]);\n  }\n\n  const updateEntityParent = (child: Engine.EntityID, newParent: Engine.EntityID | null) => {\n    // TODO: Implement this\n  }\n\n  const createEntity = () => {\n    const newEntity: Engine.EntityProps = generateNewEntity();\n    setEntities([...sceneConfig.entities, newEntity]);\n    context.addNewEntity(newEntity);\n  }\n\n  return {\n    sceneConfig,\n    selectedEntity, \n    createEntity, \n    selectEntity,\n    updateEntity,\n    updateEntityParent,\n  };\n}\n\nexport default useScene;","\nimport { useContext, } from \"react\";\nimport { generateNewScript } from \"../../utils/script.utils\";\nimport { ScriptContext } from \"./ScriptContext\";\n\nconst useScripts = () => {\n  const { scripts, setScripts, selectedScript, setSelectedScript, compileScripts } = useContext(ScriptContext);\n\n  const loadScript = (scriptID: string) => {\n    const script = scripts.find(s => s.id === scriptID);\n    setSelectedScript(script);\n  };\n  \n  const saveScript = (script: Engine.Script) => {\n    const foundScript = scripts.find(s => s.id === script.id);\n    if (!foundScript) return;\n    foundScript.content = script.content;\n    compileScripts();\n  };\n  \n  const createScript = (name: string) => {\n    const newScript = generateNewScript(name);\n    setScripts([...scripts, newScript]);\n  };\n\n\n  return {\n    scripts,\n    setScripts,\n    selectedScript,\n    setSelectedScript,\n    loadScript,\n    saveScript,\n    createScript,\n  };\n}\n\nexport default useScripts;","import { useCallback, useContext, useEffect, useMemo, useState } from \"react\";\nimport context from \"../../engine/core/EngineContext\";\nimport SceneManager from \"../../engine/core/SceneManager\";\nimport useScene from \"../scene/useScene\";\nimport useScripts from \"../scripts/useScripts\";\nimport { EditorContext } from \"./EditorContext\";\n\nconst useEditor = () => {\n  const { scripts } = useScripts();\n  const { sceneConfig, selectEntity } = useScene();\n  const { renderElement } = useContext(EditorContext);\n  const [isRunning, setIsRunning] = useState(context.isPlaying());\n\n  const scenePayload = useMemo(() => ({ sceneConfig, scripts }), [sceneConfig, scripts]);\n\n  useEffect(() => {\n    const init = () => {\n      if (!renderElement || !renderElement.current || !scenePayload) { return; }\n      context.init(renderElement.current, scenePayload);\n    };\n    init();\n  }, [renderElement]);\n\n  useEffect(() => {\n    context.updateScenePayload(scenePayload);\n  }, [scenePayload])\n\n  const toggleRun = () => {\n    if (!renderElement || !renderElement.current) { return; }\n    if (SceneManager.isPlaying()) {\n      setIsRunning(false);\n      context.runEditMode();\n      return;\n    }\n    context.runPlayMode();\n    setIsRunning(true);\n  };\n\n  const handleClickScene = (e: React.MouseEvent) => {\n    const canvas: HTMLCanvasElement = e.target as unknown as HTMLCanvasElement;\n    const domRect: DOMRect = canvas.getBoundingClientRect();\n    const [mouseX, mouseY]: [number, number] = [((e.clientX - domRect.x) / domRect.width) * 2 - 1, -((e.clientY - domRect.y) / domRect.height) * 2 + 1];\n    context.handleClick(mouseX, mouseY);\n    selectEntity(context.getSelectedEntity() ?? '');\n  }\n\n  return {\n    renderElement,\n    isRunning,\n    toggleRun,\n    handleClickScene\n  };\n}\n\nexport default useEditor;","import { useState } from 'react';\nimport { useEffect } from 'react';\nimport ComponentManager from '../../engine/core/ComponentManager';\nimport useEditor from '../../state/editor/useEditor';\nimport useScene from '../../state/scene/useScene';\n\ninterface ComponentFieldValueProps {\n  field: Engine.ComponentPropType;\n  updateField: (field: Engine.ComponentPropType) => void;\n}\n\nconst ComponentFieldValue = ({ field, updateField }: ComponentFieldValueProps): React.ReactElement => {\n\n  const handleUpdateField = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (typeof field === 'number') {\n      updateField(Number(e.target.value));\n      return;\n    }\n\n    if (typeof field === 'string') {\n      updateField(e.target.value);\n    }\n  }\n\n  if (typeof field === 'number' || typeof field === 'string') return (\n    <div className=\"bg-gray-700 text-white px-1  w-max\">\n      <input\n        type={typeof field === 'string' ? 'string' : 'number'}\n        value={typeof field === 'number' ? field : field}\n        onChange={handleUpdateField}\n        className=\"bg-gray-700 w-16 font-mono text-xs\"\n      />\n    </div>\n  );\n\n  if (Array.isArray(field)) return (\n    <div>array field</div>\n  );\n\n  return (\n    <div className=\"bg-gray-700 text-white px-2 grid grid-cols-3 gap-1\">\n      <pre className=\"text-xs p-0 m-0\">\n        <span className=\"pr-2 text-xs text-gray-400\">x:</span>\n        <input\n          type={typeof field === 'string' ? 'string' : 'number'}\n          value={field.x}\n          onChange={e => updateField({ x: Number(e.target.value), y: field?.y ?? 0, z: field?.z ?? 0 })}\n          className=\"bg-gray-700 w-12 font-mono text-xs\"\n        />\n      </pre>\n      <pre className=\"text-xs p-0 m-0\">\n        <span className=\"pr-2 text-xs text-gray-400\">y:</span>\n        <input\n          type={typeof field === 'string' ? 'string' : 'number'}\n          value={field.y}\n          onChange={e => updateField({ x: field?.x ?? 0, y: Number(e.target.value), z: field?.z ?? 0 })}\n          className=\"bg-gray-700 w-12 font-mono text-xs\"\n        />\n      </pre>\n      <pre className=\"text-xs p-0 m-0\">\n        <span className=\"pr-2 text-xs text-gray-400\">z:</span>\n        <input\n          type={typeof field === 'string' ? 'string' : 'number'}\n          value={field.z}\n          onChange={e => updateField({ x: field?.x ?? 0, y: field?.y ?? 0, z: Number(e.target.value) })}\n          className=\"bg-gray-700 w-12 font-mono text-xs\"\n        />\n      </pre>\n    </div>\n  )\n}\n\ninterface ComponentNodeProps {\n  componentType: Engine.ComponentType;\n  componentProps: Engine.ComponentProps;\n  updateComponent: (type: Engine.ComponentType, field: string, value: Engine.ComponentPropType) => void;\n}\n\nconst ComponentNode = ({\n  componentType,\n  componentProps,\n  updateComponent\n}: ComponentNodeProps): React.ReactElement => {\n\n  return (\n    <div className=\"bg-gray-800 text-white p-2\">\n      <h3 className=\"mb-2\">{componentType}</h3>\n      <div className=\"space-y-2\">\n        {\n          Object.entries(componentProps).map(([fieldName, fieldValue]) => (\n            <div key={fieldName} className=\"flex space-x-2\">\n              <p className=\"text-xs font-mono text-gray-200\" style={{ minWidth: '10ch' }}>{fieldName}</p>\n              <ComponentFieldValue field={fieldValue} updateField={e => updateComponent(componentType, fieldName, e)} />\n            </div>\n          ))\n        }\n      </div>\n    </div>\n  )\n}\n\nexport default function Controls() {\n  const { isRunning } = useEditor()\n  const { selectedEntity, updateEntity, sceneConfig, } = useScene();\n\n  const [controls, setControls] = useState<Record<Engine.ComponentType, Engine.ComponentProps>>({});\n  const [materialType, setMaterialType] = useState<Engine.MaterialType>('normal');\n  const [geometryType, setGeometryType] = useState<Engine.GeometryType>('box');\n\n  useEffect(() => {\n    if (!selectedEntity) return;\n    setMaterialType(selectedEntity.material);\n    setGeometryType(selectedEntity.geometry);\n  }, [selectedEntity])\n\n  // * Handles populating all correct value fields when selecting entity */\n  useEffect(() => {\n    const updateComponentFields = (entity: Engine.EntityProps) => {\n      const propFields: Record<Engine.ComponentType, Engine.ComponentProps> = {};\n      Object.entries(entity.components).forEach(([type, props]) => {\n        propFields[type] = props;\n      });\n      setControls({ ...propFields } as any);\n    }\n    if (selectedEntity) updateComponentFields(selectedEntity);\n  }, [selectedEntity, sceneConfig, isRunning]);\n\n  const addComponent = (componentName: Engine.ComponentType) => {\n    if (!selectedEntity) return;\n    const componentProps = ComponentManager.instance.getComponentProps(componentName);\n    if (!componentProps) return;\n    selectedEntity.components[componentName] = componentProps;\n    updateEntity(selectedEntity);\n  }\n\n  const updateComponent = (type: Engine.ComponentType, field: string, value: Engine.ComponentPropType) => {\n    const newControls = { ...controls };\n    newControls[type][field] = value;\n    setControls(newControls);\n    if (selectedEntity) {\n      selectedEntity.components = newControls;\n      updateEntity({ ...selectedEntity });\n    }\n  }\n\n  const updateMaterial = (newMaterial: Engine.MaterialType) => {\n    setMaterialType(newMaterial);\n    if (selectedEntity) {\n      selectedEntity.material = newMaterial;\n      updateEntity({ ...selectedEntity });\n    }\n  }\n\n  const updateGeometry = (newGeometry: Engine.GeometryType) => {\n    setGeometryType(newGeometry);\n    if (selectedEntity) {\n      selectedEntity.geometry = newGeometry;\n      updateEntity({ ...selectedEntity });\n    }\n  }\n\n  // todo: context.sceneManager.getSelectedEntityPayload()?.components?.transform.rotation\n\n  if (!selectedEntity) return (<div className=\"bg-gray-900 h-full flex flex-col space-y-1\"></div>)\n\n  const getComponentOptions = (): { label: string, value: string }[] => {\n    const components = ComponentManager.instance.getComponents();\n    return Object.keys(components).map(component => ({ label: component, value: component }));\n  }\n\n  const componentOptions = getComponentOptions();\n\n  const materialOptions: { label: string, value: string }[] = [\n    {\n      label: 'Normal',\n      value: 'normal',\n    },\n    {\n      label: 'Basic',\n      value: 'basic',\n    },\n    {\n      label: 'Lambert',\n      value: 'lambert',\n    },\n    {\n      label: 'Phong',\n      value: 'phong'\n    }\n  ]\n\n  const geometryOptions: { label: string, value: string }[] = [\n    {\n      label: 'Box',\n      value: 'box'\n    },\n    {\n      label: 'Sphere',\n      value: 'sphere',\n    },\n    {\n      label: 'Torus',\n      value: 'torus',\n    },\n  ]\n\n  return (\n    <div className=\"bg-gray-900 h-full flex flex-col space-y-1\">\n      <section className=\"space-y-2\">\n        {\n          Object.entries(controls).map(([type, props]) =>\n            <ComponentNode\n              componentType={type}\n              componentProps={props}\n              key={type}\n              updateComponent={updateComponent}\n            />\n          )\n        }\n      </section>\n      <section>\n        {\n          componentOptions.map(({ label, value }) => (\n            <button\n              className=\"block mx-auto mt-2\"\n              onClick={() => addComponent(value)}\n              key={value}>Add {label}</button>\n          ))\n        }\n      </section>\n      <section>\n        <div className=\"bg-gray-800 text-white p-2\">\n          <h3>Mesh</h3>\n          <div className=\"space-y-2\">\n            <div className=\"flex space-x-2 items-center\">\n              <p className=\"text-xs font-mono text-gray-200\" style={{ minWidth: '10ch' }}>Material</p>\n              <select onChange={e => updateMaterial(e.target.value)} defaultValue={materialType}>\n                {\n                  materialOptions.map(option => <option key={option.value} value={option.value}>{option.label}</option>)\n                }\n              </select>\n            </div>\n            <div className=\"flex space-x-2 items-center\">\n              <p className=\"text-xs font-mono text-gray-200\" style={{ minWidth: '10ch' }}>Geometry</p>\n              <select onChange={e => updateGeometry(e.target.value)} value={geometryType}>\n                {\n                  geometryOptions.map(option => <option key={option.value} value={option.value}>{option.label}</option>)\n                }\n              </select>\n            </div>\n          </div>\n        </div>\n      </section>\n    </div >\n  )\n}","import React, { useMemo, ReactElement } from 'react';\nimport useScene from '../../state/scene/useScene';\n\ninterface Props {\n  entity: Engine.EntityProps;\n}\n\nfunction TreeNode({ entity }: Props): ReactElement {\n  const { selectedEntity, selectEntity } = useScene();\n\n  const isSelected = useMemo(() => selectedEntity?.id === entity.id, [selectedEntity, entity.id]);\n  \n  const handleClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    selectEntity(entity.id);\n  }\n\n  return (\n    <div\n      className={`\n    p-2\n    rounded-md\n    transition\n    cursor-pointer\n    select-none\n    ${isSelected ? 'hover:bg-indigo-500' : 'hover:bg-indigo-400'}\n    ${isSelected && 'bg-indigo-300'}`} onClick={handleClick}>\n      <h1>{entity?.name ?? '__ENTITY__'}</h1>\n    </div>\n  )\n\n}\n\nexport default function TreeViewPanel(): ReactElement {\n  const { sceneConfig } = useScene();\n  return (\n    <div className=\"bg-indigo-200 p-1.5 space-y-1\">\n      {\n        sceneConfig.entities.map(entity =>\n          <TreeNode\n            key={entity.id}\n            entity={entity}\n          />\n        )\n      }\n    </div>\n  )\n}\n","import { ReactElement } from 'react'\nimport useScripts from '../../state/scripts/useScripts'\n\nexport default function ScriptPanel(): ReactElement {\n  const { scripts, loadScript } = useScripts()\n\n  return (\n    <div className=\"bg-indigo-400 h-full p-2\">\n      {\n        scripts.map(s => (\n          <div\n            className=\"transition hover:bg-indigo-500 p-0.5 rounded-md font-mono text-sm\"\n            onClick={() => loadScript(s.id)} key={s.id}>\n            {s.name}.{s.language}\n          </div>)\n        )\n      }\n    </div>\n  )\n}\n","import React, { ReactElement, useEffect, useState } from 'react'\nimport useEditor from '../../state/editor/useEditor'\nimport useScene from '../../state/scene/useScene'\nimport useScripts from '../../state/scripts/useScripts'\nimport Controls from '../components/Controls'\nimport TreeViewPanel from '../components/TreeViewPanel'\nimport Editor from \"@monaco-editor/react\";\nimport ScriptPanel from '../components/ScriptPanel'\n\nexport default function BrowserEngine(): ReactElement {\n  const { createEntity, selectedEntity } = useScene()\n  const { renderElement, toggleRun, isRunning, handleClickScene } = useEditor()\n  const { createScript, selectedScript, loadScript, saveScript } = useScripts();\n\n  const [scriptBody, setScriptBody] = useState(selectedScript?.content ?? '');\n\n  useEffect(() => {\n    if (!scriptBody && selectedScript) {\n      setScriptBody(selectedScript.content);\n    }\n  }, [selectedScript]);\n\n  const handleEditorChange = (newValue: string | undefined) => {\n    setScriptBody(newValue ?? '')\n  }\n\n  const handleCreateScript = () => {\n    createScript('Component')\n  }\n\n  const handleSaveScript = () => {\n    if (selectedScript) {\n      saveScript({ ...selectedScript, content: scriptBody })\n    }\n  }\n\n  const handleCloseScript = () => {\n    loadScript('');\n  }\n\n  return (\n    <main className=\"w-screen h-screen overflow-hidden\">\n      <div className={`h-0.5 transition bg-red-600 ${isRunning && 'bg-green-500'}`}></div>\n      <nav className=\"bg-gray-900 p-2 flex w-full\">\n        <div className=\"space-x-2\">\n          <button onClick={toggleRun} className=\"primary\">{isRunning ? 'Stop' : 'Run'} Scene</button>\n          <button onClick={createEntity} className=\"secondary\">Add Entity</button>\n          <button onClick={handleCreateScript} className=\"secondary\">Add Script</button>\n        </div>\n        {\n          selectedScript &&\n          (\n            <div className=\"space-x-2 ml-auto\">\n              <button\n                className=\"secondary\"\n                onClick={handleCloseScript}\n              >Close Editor</button>\n              <button\n                onClick={handleSaveScript}\n                className=\"submit\">Save script</button>\n            </div>\n          )\n        }\n      </nav>\n      <section className=\"w-full h-full grid\" style={{ gridTemplateColumns: '1fr 17rem' }}>\n        <div className=\"h-full w-full grid relative\">\n          {renderElement && (<div className=\"bg-gray-600\" id=\"scene\" ref={renderElement} onClick={(e) => handleClickScene(e)} />)}\n          {\n            selectedScript && (\n              <>\n                <div className=\"absolute h-full w-full\" key={selectedScript.id}>\n                  <Editor\n                    height=\"100%\"\n                    width=\"100%\"\n                    defaultLanguage=\"javascript\"\n                    defaultValue={selectedScript.content}\n                    theme=\"vs-dark\"\n                    onChange={handleEditorChange} />\n                </div>\n              </>\n            )\n          }\n        </div>\n        <div className=\"grid grid-rows-5 gap-0 5\">\n          <TreeViewPanel />\n          <div className=\"row-span-2\">\n            <Controls />\n          </div>\n          <div className=\"row-span-2\">\n            <ScriptPanel />\n          </div>\n        </div>\n      </section>\n      {/* {selectedScript && (<section className=\"fixed inset-0 grid place-items-center\" onClick={() => loadScript('')}>\n        <div\n          onClick={e => {\n            e.stopPropagation();\n            saveScript({ ...selectedScript, content: scriptBody });\n          }}\n          className=\"absolute top-10 right-10 py-2 px-4 cursor-pointer rounded-md bg-green-600 text-white\">\n          Save\n        </div>\n        <div className=\"bg-black monaco-editor\" style={{ width: '60vw' }} onClick={e => e.stopPropagation()}>\n          <Editor\n            height=\"90vh\"\n            defaultLanguage=\"javascript\"\n            defaultValue={selectedScript.content}\n            theme=\"vs-dark\"\n            onChange={handleEditorChange} />\n        </div>\n      </section>)} */}\n    </main>\n  )\n}\n","import { EditorProvider } from \"./state/editor/EditorContext\";\nimport { SceneProvider } from \"./state/scene/SceneContext\";\nimport { ScriptProvider } from \"./state/scripts/ScriptContext\";\nimport BrowserEngine from \"./ui/base/BrowserEngine\";\n\nfunction App() {\n  return (\n    <SceneProvider>\n      <ScriptProvider>\n        <EditorProvider>\n          <BrowserEngine />\n        </EditorProvider>\n      </ScriptProvider>\n    </SceneProvider>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}