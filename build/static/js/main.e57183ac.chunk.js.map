{"version":3,"sources":["state/editor/EditorContext.tsx","engine/core/Component.ts","engine/components/Mover.ts","engine/components/Transform.ts","engine/core/ComponentManager.ts","engine/core/MaterialManager.ts","engine/core/GeometryManager.ts","engine/core/Entity.ts","engine/core/SceneManager.ts","engine/core/CameraManager.ts","engine/core/EngineContext.ts","state/scene/SceneContext.tsx","state/scripts/ScriptContext.tsx","state/scene/useScene.tsx","state/scripts/useScripts.tsx","state/editor/useEditor.tsx","ui/components/Controls.tsx","ui/components/TreeViewPanel.tsx","ui/base/BrowserEngine.tsx","App.tsx","index.tsx"],"names":["initialValue","EditorContext","createContext","EditorProvider","children","contextValue","renderElement","useRef","Provider","value","Component","entity","_entity","this","props","Mover","name","speed","transform","components","position","x","Transform","THREE","rotation","scale","console","debug","applyMatrix","mesh","setX","setY","y","setZ","z","setRotationFromEuler","applyPosition","applyRotation","applyScale","ComponentManager","instance","registerComponent","component","componentType","componentProps","getComponent","Object","entries","forEach","prop","Array","isArray","length","componentInstance","init","error","MaterialManager","type","GeometryManager","Entity","id","mat","getMaterial","material","geometry","getGeometry","initComponents","setComponent","child","SceneManager","isPlaying","_updateComponents","values","update","_scene","_entities","_scenePayload","payload","entityID","entityProps","updateIndex","findIndex","e","resetScene","buildEntities","destroy","remove","sceneConfig","entities","buildEntity","push","add","oc","CameraManager","renderer","antialias","fov","near","far","camera","controls","_setCamera","window","addEventListener","handleResize","scene","setSize","clientWidth","clientHeight","appendChild","domElement","_setControls","_runSceneLoop","setAnimationLoop","innerWidth","innerHeight","time","Update","aspect","updateProjectionMatrix","setPixelRatio","devicePixelRatio","render","updateScene","context","sceneManager","cameraManager","componentManager","materialManager","geometryManager","_renderElement","updateScenePayload","runEditMode","runPlayScene","setup","getScene","runEditScene","setScenePayload","updateEntityPayload","selectedEntityID","setEntities","setSelectedEntityID","setCameraProps","cameraProps","SceneContext","SceneProvider","useState","uuidv4","useMemo","useEffect","find","updateSpecificEntity","scripts","setScripts","ScriptContext","ScriptProvider","useScene","useContext","selectedEntity","createEntity","newEntity","addNewEntity","selectEntity","updateEntity","index","updateEntityParent","newParent","useScripts","loadScript","saveScript","script","createScript","useEditor","isRunning","setIsRunning","scenePayload","useCallback","current","toggleRun","runPlayMode","ComponentFieldValue","field","updateField","className","onChange","target","Number","ComponentNode","updateComponent","map","fieldName","fieldValue","style","minWidth","Controls","setControls","propFields","updateComponentFields","newControls","onClick","TreeNode","isSelected","stopPropagation","TreeViewPanel","BrowserEngine","gridTemplateColumns","ref","App","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e57183ac.chunk.js","sourcesContent":["import { ReactElement, useRef } from 'react';\nimport { createContext } from 'react';\n\ninterface IEditorContext {\n  renderElement?: React.MutableRefObject<HTMLDivElement | null>;\n};\n\nconst initialValue: IEditorContext = {}\n\nexport const EditorContext = createContext<IEditorContext>(initialValue);\n\nexport const EditorProvider = ({ children }: { children: ReactElement | ReactElement[] }) => {\n  const renderElement = useRef<HTMLDivElement>(null)\n  const contextValue = { renderElement };\n\n  return (\n    <EditorContext.Provider value={contextValue}>\n      {children}\n    </EditorContext.Provider>\n  );\n};","import Entity from \"./Entity\";\n\nexport default abstract class Component {\n  _entity: Entity;\n\n  constructor(entity: Entity) {\n    this._entity = entity;\n  }\n\n  init(props: Engine.ComponentProps) {\n  }\n\n  abstract update(): void;\n}\n\n// This is only used for generating the BaseComponentType for internal use, \n// when creating Components, extend the abstract Component class instead.\nclass BaseComponent extends Component {\n  _entity!: Entity;\n\n  init(props: Engine.ComponentProps) { }\n\n  update() { }\n}\n\nexport type BaseComponentType = typeof BaseComponent;","import * as THREE from 'three';\nimport Component from '../core/Component';\nimport Entity from '../core/Entity';\nimport Transform from './Transform';\n\ninterface IMoverProps {\n  speed?: number;\n}\nexport default class Mover extends Component {\n  name = \"mover\";\n  _entity!: Entity;\n  speed: number = 0.1;\n  transform!: Transform;\n\n  constructor(entity: Entity) {\n    super(entity);\n    this._entity = entity;\n  }\n\n  init(props: IMoverProps) {\n    this.speed = props?.speed ?? 0.1;\n    this.transform = this._entity.components['transform'] as Transform;\n  }\n\n  update() {\n    this.transform.position.x += this.speed;\n  }\n}","import * as THREE from 'three';\nimport Component from '../core/Component';\nimport Entity from '../core/Entity';\ninterface ITransformProps {\n  position?: THREE.Vector3;\n  rotation?: THREE.Euler;\n  scale?: THREE.Vector3;\n}\n\nexport default class Transform extends Component {\n  name = \"transform\";\n  _entity!: Entity;\n\n  public position: THREE.Vector3 = new THREE.Vector3(0, 0, 0);\n  public rotation: THREE.Euler = new THREE.Euler(0, 0, 0, 'XYZ');\n  public scale: THREE.Vector3 = new THREE.Vector3(1, 1, 1);\n\n  constructor(entity: Entity) {\n    super(entity);\n    this._entity = entity;\n  }\n\n  init(props?: ITransformProps) {\n    console.debug('called init on transform');\n    this.position = props?.position ?? this.position;\n    this.rotation = props?.rotation ?? this.rotation;\n    this.scale = props?.scale ?? this.scale;\n    this.applyMatrix();\n  }\n\n  private applyPosition() {\n    this._entity.mesh.position.setX(this.position.x);\n    this._entity.mesh.position.setY(this.position.y);\n    this._entity.mesh.position.setZ(this.position.z);\n  }\n\n  private applyRotation() {\n    this._entity.mesh.setRotationFromEuler(new THREE.Euler(this.rotation.x, this.rotation.y, this.rotation.z));\n  }\n\n  private applyScale() {\n    this._entity.mesh.scale.setX(this.scale.x);\n    this._entity.mesh.scale.setY(this.scale.y);\n    this._entity.mesh.scale.setZ(this.scale.z);\n  }\n\n  private applyMatrix() {\n    console.debug('applying matrix');\n    if (!this._entity){ return; }\n    this.applyPosition();\n    this.applyRotation();\n    this.applyScale();\n  }\n\n  update() {\n    // if (this.scale.x >= 2) {\n    //   this.dir = -1;\n    // } else if (this.scale.x <= 0.2) {\n    //   this.dir = 1;\n    // }\n    // this.scale.x += 0.1 * this.dir;\n    this.applyMatrix();\n  }\n}\n","import * as THREE from 'three';\nimport Mover from '../components/Mover';\nimport Transform from \"../components/Transform\";\nimport Component, { BaseComponentType } from \"./Component\";\nimport Entity from \"./Entity\";\nexport default class ComponentManager {\n  public static instance: ComponentManager;\n  private components: { [key: string]: BaseComponentType } = {};\n  \n  constructor() {\n    if (ComponentManager.instance) return;\n    ComponentManager.instance = this;\n    this.registerComponent('transform', Transform);\n    this.registerComponent('mover', Mover);\n  }\n\n  public registerComponent(name: Engine.ComponentType, component: BaseComponentType): void {\n    this.components[name] = component;\n  };\n\n  private getComponent(name: Engine.ComponentType): BaseComponentType | null {\n    return this.components[name] ?? null;\n  }\n\n  public setComponent(entity: Entity, componentType: Engine.ComponentType, componentProps: Engine.ComponentProps): void {\n    const component = this.getComponent(componentType);\n    if (!component) {\n      console.error(`Component ${componentType} not found`);\n      return;\n    }\n  \n    // Translate vector props \n    Object.entries(componentProps).forEach(([name, prop]) => {\n      if (Array.isArray(prop)) {\n        if (prop.length === 3) {\n          componentProps[name] = new THREE.Vector3(prop[0], prop[1], prop[2]) as any;\n        }\n        else if (prop.length === 2) {\n          componentProps[name] = new THREE.Vector2(prop[0], prop[1]) as any;\n        }\n      }\n    });\n    const componentInstance = new component(entity);\n    componentInstance.init(componentProps);\n    entity.components[componentType] = componentInstance;\n  }\n}","import * as THREE from 'three';\n\nexport default class MaterialManager {\n  public static instance: MaterialManager;\n\n  constructor() {\n    if (MaterialManager.instance) return;\n    MaterialManager.instance = this;\n  }\n\n  getMaterial(type: Engine.MaterialType): THREE.Material {\n    switch (type) {\n      case 'normal':\n        return new THREE.MeshNormalMaterial();\n      case 'basic':\n        return new THREE.MeshBasicMaterial();\n      default:\n        return new THREE.MeshBasicMaterial();\n    }\n  }\n}\n","import * as THREE from 'three';\n\nexport default class GeometryManager {\n  public static instance: GeometryManager;\n\n  constructor() {\n    if (GeometryManager.instance) return;\n    GeometryManager.instance = this;\n  }\n\n  getGeometry(type: Engine.MaterialType): THREE.BufferGeometry {\n    switch (type) {\n      case 'box':\n        return new THREE.BoxBufferGeometry();\n      case 'sphere':\n      default:\n        return new THREE.SphereBufferGeometry();\n    }\n  }\n}","import * as THREE from 'three';\nimport Component from './Component';\nimport ComponentManager from './ComponentManager';\nimport MaterialManager from './MaterialManager';\nimport GeometryManager from './GeometryManager';\nimport SceneManager from './SceneManager';\n\nexport default class Entity {\n  public name: string = \"\";\n  public mesh!: THREE.Mesh;\n  public readonly id: Engine.EntityID;\n  private children: Entity[] = [];\n  components: Record<Engine.ComponentType, Component> = {};\n\n  constructor(props: Engine.EntityProps) {\n    this.id = props.id;\n    this.init(props);\n  }\n\n  init(props: Engine.EntityProps) {\n    const mat = MaterialManager.instance.getMaterial(props.material);\n    const geometry = GeometryManager.instance.getGeometry(props.geometry);\n    this.mesh = new THREE.Mesh(geometry, mat);\n    console.debug('called init');\n    // TODO: New approach to creating children in SceneManager.\n    // props.children.forEach(entityProps => {\n    //   const child: Entity = SceneManager.CreateEntity(entityProps, this);\n    //   this.addChild(child);\n    // });\n\n    // TODO: build components\n    this.initComponents(props.components);\n  }\n\n  initComponents(components: Record<Engine.ComponentType, Engine.ComponentProps>) {\n    Object.entries(components).forEach(([type, props]) => {\n      ComponentManager.instance.setComponent(this, type, props);\n    })\n  }\n\n  addChild(child: Entity) {\n    // TODO: Implement\n  }\n\n  addComponent(type: Engine.ComponentType, componentProps: Engine.ComponentProps) {\n    // TODO: Implement\n  }\n\n  getProps(): Record<Engine.ComponentType, Engine.ComponentProps> {\n    // TODO: Implement\n    return {};\n  }\n\n  destroy() {\n    // TODO: Implement\n\n    // todo: do i need to be doing this?\n    // this.mesh.geometry.dispose();\n  }\n\n  update() {\n    if (SceneManager.isPlaying()) {\n      this._updateComponents();\n    }\n  }\n\n  private _updateComponents() {\n    Object.values(this.components).forEach((component) => component.update())\n  }\n}","import * as THREE from 'three';\nimport Entity from \"./Entity\";\n\nexport default class SceneManager {\n  public static instance: SceneManager;\n  private isPlaying: boolean = false; // If true, in play mode, else in edit mode\n  private _scene = new THREE.Scene();\n  private _entities: Entity[] = [];\n  private _scenePayload: Engine.ScenePayload | undefined;\n\n  constructor() {\n    if (SceneManager.instance) { return; }\n    SceneManager.instance = this;\n  }\n\n  static isPlaying() {\n    return SceneManager.instance.isPlaying;\n  }\n\n  getScene(): THREE.Scene {\n    return this._scene;\n  }\n\n  setScenePayload(payload: Engine.ScenePayload) {\n    this._scenePayload = payload;\n  }\n\n  updateEntityPayload(entityID: Engine.EntityID, entityProps: Engine.EntityProps) {\n    const updateIndex = this._entities.findIndex(e => e.id === entityID);\n    if (updateIndex === -1) return;\n    this._entities[updateIndex].initComponents(entityProps.components);\n  }\n\n  updateScene() {\n    this._entities.forEach(entity => {\n      entity.update();\n    });\n  }\n\n  runPlayScene() {\n    this.isPlaying = true;\n    this.resetScene();\n    this.buildEntities();\n  }\n  \n  runEditScene() {\n    this.isPlaying = false;\n    this.resetScene();\n    this.buildEntities();\n  }\n\n  private resetScene() {\n    this._entities.forEach(entity => {\n      entity.destroy();\n      this._scene.remove(entity.mesh);\n    });\n    // this._scene = new THREE.Scene();\n    this._entities = [];\n  }\n\n  private buildEntities() {\n    if (!this._scenePayload) return;\n    this._scenePayload.sceneConfig.entities.forEach(entityProps => {\n      this.buildEntity(entityProps);\n    });\n  }\n\n  buildEntity(props: Engine.EntityProps): Entity {\n    const entity = new Entity(props);\n    this._entities.push(entity);\n    this._scene.add(entity.mesh);\n    return entity;\n  }\n}","import * as THREE from 'three';\nimport oc from 'three-orbit-controls';\nimport SceneManager from './SceneManager';\nconst OrbitControls = oc(THREE);\n\nexport default class CameraManager {\n  public static instance: CameraManager;\n  private renderer = new THREE.WebGLRenderer({ antialias: true });\n  private renderElement: HTMLElement | undefined;\n  private fov = 45;\n  private near = 0.01;\n  private far = 20000;\n  private camera!: THREE.PerspectiveCamera;\n  private controls: any;\n\n  constructor() {\n    if (CameraManager.instance) return CameraManager.instance;\n    CameraManager.instance = this;\n    this._setCamera();\n    window.addEventListener('resize', () => this.handleResize());\n  }\n\n  setup(renderElement: HTMLElement, scene: THREE.Scene) {\n    this.renderer.setSize(renderElement.clientWidth, renderElement.clientHeight);\n    this.renderElement = renderElement;\n    this.renderElement.appendChild(this.renderer.domElement);\n    this.handleResize();\n    this._setControls();\n    this._runSceneLoop(scene);\n  }\n\n  resetCamera() {\n    this.renderer.setAnimationLoop(null);\n  }\n\n  private _setCamera() {\n    if (!this.renderElement) {\n      this.camera = new THREE.PerspectiveCamera(this.fov, window.innerWidth / window.innerHeight, this.near, this.far);\n      return;\n    }\n  }\n\n  private _runSceneLoop(scene: THREE.Scene) {\n    this.renderer.setAnimationLoop((time: number) => this.Update(scene));\n  }\n\n  private _setControls() {\n    // this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n    // this.controls.autoRotate = false;\n    // this.controls.enableDamping = true;\n    // this.controls.dampingFactor = 0.39;\n\n    this.camera.position.z = 50;\n\n    // this.controls.update();\n  }\n\n  handleResize() {\n    if (!this.renderElement) return;\n    this.camera.aspect = this.renderElement.clientWidth / this.renderElement.clientHeight;\n    this.camera.updateProjectionMatrix();\n    this.renderer.setSize(this.renderElement.clientWidth, this.renderElement.clientHeight);\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n  }\n\n  Update(scene: THREE.Scene) {\n    // this.controls.update();\n    this.renderer.render(scene, this.camera);\n    SceneManager.instance.updateScene();\n  }\n}","import CameraManager from \"./CameraManager\";\nimport ComponentManager from \"./ComponentManager\";\nimport GeometryManager from \"./GeometryManager\";\nimport MaterialManager from \"./MaterialManager\";\nimport SceneManager from \"./SceneManager\";\n\nclass EngineContext {\n  sceneManager: SceneManager;\n  cameraManager: CameraManager;\n  componentManager: ComponentManager;\n  materialManager: MaterialManager;\n  geometryManager: GeometryManager;\n  private _renderElement!: HTMLElement;\n\n  constructor() {\n    this.sceneManager = new SceneManager();\n    this.cameraManager = new CameraManager();\n    this.componentManager = new ComponentManager();\n    this.materialManager = new MaterialManager();\n    this.geometryManager = new GeometryManager();\n  }\n\n  init(renderElement: HTMLElement, payload?: Engine.ScenePayload) {\n    this._renderElement = renderElement;\n    if (payload) this.updateScenePayload(payload);\n    this.runEditMode();\n  }\n\n  runPlayMode() {\n    this.sceneManager.runPlayScene();\n    this.cameraManager.setup(this._renderElement, this.sceneManager.getScene());\n  }\n\n  runEditMode() {\n    this.sceneManager.runEditScene();\n    this.cameraManager.setup(this._renderElement, this.sceneManager.getScene());\n  }\n\n  updateScenePayload(payload: Engine.ScenePayload) {\n    this.sceneManager.setScenePayload(payload);\n  }\n\n  updateSpecificEntity(entityID: Engine.EntityID, entityProps: Engine.EntityProps) {\n    this.sceneManager.updateEntityPayload(entityID, entityProps);\n  }\n\n  addNewEntity(entity: Engine.EntityProps) {\n    this.sceneManager.buildEntity(entity);\n\n  }\n\n  isPlaying(): boolean {\n    return SceneManager.isPlaying() ?? false\n  }\n}\n\nconst context = new EngineContext();\n\nexport default context;","import * as THREE from 'three';\nimport { ReactElement, useEffect, useMemo } from 'react';\nimport { createContext } from 'react';\nimport { useState } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport context from '../../engine/core/EngineContext';\n\ninterface ISceneContext {\n  sceneConfig: Engine.SceneConfig;\n  setEntities: (props: Engine.EntityProps[]) => void;\n  selectedEntityID: string | null;\n  setSelectedEntityID: (entityID: string | null) => void;\n  setCameraProps: (cameraProps: Engine.CameraProps) => void;\n};\n\nconst initialValue = {\n  sceneConfig: {\n    entities: [] as Engine.EntityProps[],\n    camera: {\n      position: new THREE.Vector3(),\n      fov: 70,\n      near: 0.1,\n      far: 1000,\n      controls: \"orbit\" as Engine.ControlType\n    }\n  },\n  selectedEntityID: null,\n  setEntities: (entities: Engine.EntityProps[]) => { },\n  setSelectedEntityID: (entityID: string | null) => { },\n  setCameraProps: (cameraProps: Engine.CameraProps) => { }\n};\n\nexport const SceneContext = createContext<ISceneContext>(initialValue);\n\nexport const SceneProvider = ({ children }: { children: ReactElement | ReactElement[] }) => {\n  const [cameraProps, setCameraProps] = useState<Engine.CameraProps>({\n    position: new THREE.Vector3(),\n    fov: 70,\n    near: 0.1,\n    far: 1000,\n    controls: \"orbit\" as Engine.ControlType\n  });\n\n  const [entities, setEntities] = useState<Engine.EntityProps[]>([\n    {\n      id: uuidv4(),\n      name: \"Entity A\",\n      material: 'normal',\n      geometry: 'box',\n      children: [],\n      components: {\n        \"transform\": {\n          position: {x: 3, y: 0.2, z: 1},\n          rotation: {x: 3, y: 3, z: 3},\n          scale: {x: 2, y: 1, z: 1},\n        },\n      }\n    },\n  ])\n  const [selectedEntityID, setSelectedEntityID] = useState<string | null>(null);\n\n  const sceneConfig = useMemo(() => (\n    {\n      entities,\n      camera: cameraProps\n    }\n  ), [entities, cameraProps]);\n\n  useEffect(() => {\n    if (selectedEntityID) {\n      const entityProps = entities.find(e => e.id === selectedEntityID);\n      if (!entityProps) return;\n      context.updateSpecificEntity(selectedEntityID, entityProps);\n    }\n  }, [sceneConfig])\n\n  const contextValue = {\n    sceneConfig,\n    selectedEntityID,\n    setEntities,\n    setCameraProps,\n    setSelectedEntityID\n  }\n  return (\n    <SceneContext.Provider value={contextValue}>\n      {children}\n    </SceneContext.Provider>\n  );\n}","import { ReactElement, useState } from 'react';\nimport { createContext } from 'react';\n\ninterface IScriptContext {\n  scripts: Engine.Script[];\n  setScripts: (scripts: Engine.Script[]) => void;\n};\n\nconst initialValue: IScriptContext = {\n  scripts: [],\n  setScripts: (scripts: Engine.Script[]) => { }\n}\n\nexport const ScriptContext = createContext<IScriptContext>(initialValue);\n\nexport const ScriptProvider = ({ children }: { children: ReactElement | ReactElement[] }) => {\n  const [scripts, setScripts] = useState<Engine.Script[]>([]);\n  const contextValue = { scripts, setScripts };\n  \n  return (\n    <ScriptContext.Provider value={contextValue}>\n      {children}\n    </ScriptContext.Provider>\n  );\n};","import { useContext, useEffect, useMemo} from \"react\";\nimport { SceneContext } from \"./SceneContext\";\nimport { v4 as uuidv4 } from 'uuid'\nimport context from \"../../engine/core/EngineContext\";\n\nconst useScene = () => {\n  const { sceneConfig, setEntities, selectedEntityID, setSelectedEntityID } = useContext(SceneContext);\n\n\n  const selectEntity = (id: Engine.EntityID) => {\n    if (id === selectedEntityID) {\n      setSelectedEntityID('')\n      return;\n    }\n    setSelectedEntityID(id);\n  };\n\n  const selectedEntity: Engine.EntityProps | null = useMemo(() => {\n    return sceneConfig.entities.find(e => e.id === selectedEntityID) ?? null;\n  }, [sceneConfig, selectedEntityID]);\n\n\n  const updateEntity = (entity: Engine.EntityProps) => {\n    const index = sceneConfig.entities.findIndex(e => e.id === entity.id);\n    if (index === -1) {\n      console.error(`Couldn't find ${entity.id} in sceneConfig.entities`);\n    };\n    sceneConfig.entities[index] = entity;\n    setEntities([...sceneConfig.entities]);\n  }\n\n  const updateEntityParent = (child: Engine.EntityID, newParent: Engine.EntityID | null) => {\n    // TODO: Implement this\n  }\n\n  const createEntity = () => {\n    const newEntity: Engine.EntityProps = {\n      id: uuidv4(),\n      name: \"New Entity\",\n      geometry: 'box',\n      material: 'normal',\n      children: [],\n      components: {\n        transform: {\n          position: {x: 0, y: 0, z: 0},\n          rotation: { x: 0, y: 0, z: 0 },\n          scale: { x: 1, y: 1, z: 1 },\n        }\n      },\n    }\n    setEntities([...sceneConfig.entities, newEntity]);\n    context.addNewEntity(newEntity);\n  }\n\n  return {\n    sceneConfig,\n    selectedEntity, \n    createEntity, \n    selectEntity,\n    updateEntity,\n    updateEntityParent,\n  };\n}\n\nexport default useScene;","import { useContext } from \"react\";\nimport { ScriptContext } from \"./ScriptContext\";\n\nconst useScripts = () => {\n  const { scripts, setScripts } = useContext(ScriptContext);\n\n  const loadScript = (name: string) => {\n    // TODO: implement this\n  };\n  const saveScript = (script: Engine.Script) => {\n    // TODO: implement this\n  };\n  const createScript = (name: string) => {\n    // TODO: implement this\n  };\n\n  return {\n    scripts,\n    setScripts,\n    loadScript,\n    saveScript,\n    createScript\n  };\n}\n\nexport default useScripts;","import { useCallback, useContext, useEffect, useMemo, useState } from \"react\";\nimport context from \"../../engine/core/EngineContext\";\nimport SceneManager from \"../../engine/core/SceneManager\";\nimport useScene from \"../scene/useScene\";\nimport useScripts from \"../scripts/useScripts\";\nimport { EditorContext } from \"./EditorContext\";\n\nconst useEditor = () => {\n  const { scripts } = useScripts();\n  const { sceneConfig } = useScene();\n  const { renderElement } = useContext(EditorContext);\n  const [isRunning, setIsRunning] = useState(context.isPlaying());\n\n  const scenePayload = useMemo(() => ({ sceneConfig, scripts }), [sceneConfig, scripts]);\n\n  const init = useCallback(() => {\n    if (!renderElement || !renderElement.current || !scenePayload) { return; }\n    context.init(renderElement.current, scenePayload);\n  }, [renderElement, scenePayload]);\n\n\n  useEffect(() => init(), [renderElement, init]);\n\n  useEffect(() => {\n    context.updateScenePayload(scenePayload);\n  }, [scenePayload])\n\n  const toggleRun = () => {\n    if (!renderElement || !renderElement.current) { return; }\n    if (SceneManager.isPlaying()) {\n      setIsRunning(false);\n      context.runEditMode();\n      return;\n    }\n    context.runPlayMode();\n    setIsRunning(true);\n  };\n\n  return {\n    renderElement,\n    isRunning,\n    toggleRun\n  };\n}\n\nexport default useEditor;","import { useState } from 'react';\nimport { useEffect } from 'react';\nimport { generateComponentObjectFromValues } from '../../state/scene/scene.utils';\nimport useScene from '../../state/scene/useScene';\n\ninterface ComponentFieldValueProps {\n  field: Engine.ComponentPropType;\n  updateField: (field: Engine.ComponentPropType) => void;\n}\n\nconst ComponentFieldValue = ({ field, updateField }: ComponentFieldValueProps): React.ReactElement => {\n\n  const handleUpdateField = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (typeof field === 'number') {\n      // if (Number.isNaN(Number(e.target.value))) {\n      // return;\n      // }\n      updateField(Number(e.target.value));\n      // todo\n      return;\n    }\n\n    if (typeof field === 'string') {\n      updateField(e.target.value);\n    }\n\n  }\n\n\n  if (typeof field === 'number' || typeof field === 'string') return (\n    <div className=\"bg-gray-700 text-white px-1  w-max\">\n      <input\n        type={typeof field === 'string' ? 'string' : 'number'}\n        value={typeof field === 'number' ? field : field}\n        onChange={handleUpdateField}\n        className=\"bg-gray-700 w-min font-mono text-xs\"\n      />\n    </div>\n  );\n\n  if (Array.isArray(field)) return (<div>array field</div>);\n\n  return (\n    <div className=\"bg-gray-700 text-white px-2 grid grid-cols-3 gap-5\">\n      <pre className=\"text-xs p-0 m-0\">\n        <span className=\"pr-2 text-xs text-gray-400\">x:</span>\n        <input\n          type={typeof field === 'string' ? 'string' : 'number'}\n          value={field.x}\n          onChange={e => updateField({ x: Number(e.target.value), y: field?.y ?? 0, z: field?.z ?? 0 })}\n          className=\"bg-gray-700 w-min font-mono text-xs\"\n        />\n      </pre>\n      <pre className=\"text-xs p-0 m-0\">\n        <span className=\"pr-2 text-xs text-gray-400\">y:</span>\n        <input\n          type={typeof field === 'string' ? 'string' : 'number'}\n          value={field.y}\n          onChange={e => updateField({ x: field?.x ?? 0, y: Number(e.target.value), z: field?.z ?? 0 })}\n          className=\"bg-gray-700 w-min font-mono text-xs\"\n        />\n      </pre>\n      <pre className=\"text-xs p-0 m-0\">\n        <span className=\"pr-2 text-xs text-gray-400\">z:</span>\n        <input\n          type={typeof field === 'string' ? 'string' : 'number'}\n          value={field.z}\n          onChange={e => updateField({ x: field?.x ?? 0, y: field?.y ?? 0, z: Number(e.target.value) })}\n          className=\"bg-gray-700 w-min font-mono text-xs\"\n        />\n      </pre>\n    </div>\n  )\n}\n\ninterface ComponentNodeProps {\n  componentType: Engine.ComponentType;\n  componentProps: Engine.ComponentProps;\n  updateComponent: (type: Engine.ComponentType, field: string, value: Engine.ComponentPropType) => void;\n}\n\nconst ComponentNode = ({\n  componentType,\n  componentProps,\n  updateComponent\n}: ComponentNodeProps): React.ReactElement => {\n\n  return (\n    <div className=\"bg-gray-800 text-white p-2\">\n      <h3 className=\"font-semibold text-gray-300 text-sm mb-2\">{componentType}</h3>\n      {\n        Object.entries(componentProps).map(([fieldName, fieldValue]) => (\n          <div key={fieldName} className=\"flex space-x-2\">\n            <p className=\"text-xs font-mono text-gray-200\" style={{ minWidth: '10ch' }}>{fieldName}</p>\n            <ComponentFieldValue field={fieldValue} updateField={e => updateComponent(componentType, fieldName, e)} />\n          </div>\n        ))\n      }\n    </div>\n  )\n}\n\nexport default function Controls() {\n  const { selectedEntity, updateEntity, sceneConfig } = useScene();\n\n  // utils\n  // const getComponentPropName = (type: Engine.ComponentType, propName: string): Engine.CombinedComponentPropName => `${type}--${propName}`\n\n  // const getControls = () => {\n  //   console.debug('getControls()');\n  //   if (!selectedEntity) return {};\n\n  //   const { components } = selectedEntity;\n\n  //   const componentControls = Object.entries(components).map(([type, props]) => {\n  //     const folderValue =\n  //       Object.fromEntries(\n  //         Object.entries(props)\n  //           .map(([propName, propValue]) => [propName, { value: propValue }]\n  //           )\n  //       );\n  //     return [type, folder(folderValue as any)]\n  //   });\n  //   return Object.fromEntries(componentControls);\n  // }\n\n  const [controls, setControls] = useState<Record<Engine.ComponentType, Engine.ComponentProps>>({});\n\n  useEffect(() => {\n    // * Handles populating all correct value fields when selecting entity\n    const updateComponentFields = (entity: Engine.EntityProps) => {\n      const propFields: Record<Engine.ComponentType, Engine.ComponentProps> = {};\n      Object.entries(entity.components).forEach(([type, props]) => {\n        propFields[type] = props;\n      });\n      console.debug('setting', propFields);\n      setControls({ ...propFields } as any);\n    }\n\n    if (selectedEntity) updateComponentFields(selectedEntity);\n  }, [selectedEntity, sceneConfig]);\n\n  // Handles updating the entity when pressing save\n  // const saveEntityChanges = () => {\n  //   if (!selectedEntity) return;\n  //   const updatedComponents = generateComponentObjectFromValues(controls);\n  //   selectedEntity.components = updatedComponents;\n  //   updateEntity({ ...selectedEntity });\n  // }\n\n  const addComponent = () => {\n    if (!selectedEntity) return;\n    // TODO: make this feature fledged later\n    const newComponentName = 'mover';\n    const newComponentProps: Engine.ComponentProps = {\n      'speed': 0.2\n    }\n    selectedEntity.components[newComponentName] = newComponentProps;\n    updateEntity(selectedEntity);\n  }\n\n  const updateComponent = (type: Engine.ComponentType, field: string, value: Engine.ComponentPropType) => {\n    console.debug(type, field, value, controls);\n    const newControls = { ...controls };\n    newControls[type][field] = value;\n    console.debug('new controls', newControls);\n    setControls(newControls);\n    if (selectedEntity) {\n      selectedEntity.components = newControls;\n      updateEntity({ ...selectedEntity });\n    }\n  }\n\n  return (\n    <div className=\"bg-gray-900 h-full flex flex-col space-y-1\">\n      {\n        Object.entries(controls).map(([type, props]) =>\n          <ComponentNode\n            componentType={type}\n            componentProps={props}\n            key={type}\n            updateComponent={updateComponent}\n          />\n        )\n      }\n      {\n        selectedEntity && (\n          <div className=\"space-y-1\">\n            <button\n              className=\"block mx-auto mt-12 py-2 px-4 md:w-48  rounded-md bg-indigo-100 opacity-60 transition hover:opacity-100 hover:bg-indigo-200 capitalize\"\n              onClick={addComponent}>Add component\n            </button>\n            {/* <button\n              className=\"block mx-auto mt-12 py-2 px-4 md:w-48 rounded-md bg-indigo-100 opacity-60 transition hover:opacity-100 hover:bg-indigo-200 capitalize\"\n              onClick={saveEntityChanges}>Save Changes\n            </button> */}\n          </div>\n        )\n      }\n    </div>\n  );\n}\n","import React, { useMemo, ReactElement } from 'react';\nimport useScene from '../../state/scene/useScene';\n\n// TODO: Render children\ninterface Props {\n  entity: Engine.EntityProps;\n}\n\nfunction TreeNode({ entity }: Props): ReactElement {\n  const { selectedEntity, selectEntity } = useScene();\n\n  const isSelected = useMemo(() => selectedEntity?.id === entity.id, [selectedEntity, entity.id]);\n  \n  const handleClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    selectEntity(entity.id);\n  }\n\n  return (\n    <div\n      className={`\n    p-2\n    rounded-md\n    transition\n    cursor-pointer\n    select-none\n    ${isSelected ? 'hover:bg-indigo-500' : 'hover:bg-indigo-400'}\n    ${isSelected && 'bg-indigo-300'}`} onClick={handleClick}>\n      <h1>{entity?.name ?? '__ENTITY__'}</h1>\n      {/* {entity.children.map(child => <TreeNode key={child.id} entity={child}/>)} */}\n    </div>\n  )\n\n}\n\nexport default function TreeViewPanel(): ReactElement {\n  const { sceneConfig } = useScene();\n  return (\n    <div className=\"bg-indigo-200 p-1.5 space-y-1\">\n      {\n        sceneConfig.entities.map(entity =>\n          <TreeNode\n            key={entity.id}\n            entity={entity}\n          />\n        )\n      }\n    </div>\n  )\n}\n","import { ReactElement } from 'react'\nimport useEditor from '../../state/editor/useEditor'\nimport useScene from '../../state/scene/useScene'\nimport Controls from '../components/Controls'\nimport TreeViewPanel from '../components/TreeViewPanel'\n\nexport default function BrowserEngine(): ReactElement {\n  const { createEntity, selectedEntity } = useScene()\n  const { renderElement, toggleRun, isRunning } = useEditor()\n\n  return (\n    <main className=\"w-screen h-screen overflow-hidden\">\n      <div className={`h-2 transition bg-red-400 ${isRunning && 'bg-green-400'}`}></div>\n      <nav className=\"bg-gray-900 p-2 space-x-2\">\n        <button onClick={toggleRun} className=\"p-2 bg-gray-700 rounded-md px-3 transition hover:bg-gray-600\">{isRunning ? 'Stop' : 'Run'} Scene</button>\n        <button onClick={createEntity} className=\"p-2 bg-gray-700 rounded-md px-3 transition hover:bg-gray-600\">Add Entity</button>\n      </nav>\n      <section className=\"w-full h-full grid\" style={{ gridTemplateColumns: '1fr 17rem' }}>\n        {renderElement && (<div className=\"bg-gray-600\" id=\"scene\" ref={renderElement} />)}\n        <div className=\"grid grid-rows-3 gap-0 5\">\n          <TreeViewPanel />\n          <div className=\"row-span-2\">\n            <Controls key={selectedEntity?.id ?? 'controls'} />\n          </div>\n        </div>\n      </section>\n    </main>\n  )\n}\n","import { EditorProvider } from \"./state/editor/EditorContext\";\nimport { SceneProvider } from \"./state/scene/SceneContext\";\nimport { ScriptProvider } from \"./state/scripts/ScriptContext\";\nimport BrowserEngine from \"./ui/base/BrowserEngine\";\n\nfunction App() {\n  return (\n    <SceneProvider>\n      <ScriptProvider>\n        <EditorProvider>\n          <BrowserEngine />\n        </EditorProvider>\n      </ScriptProvider>\n    </SceneProvider>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}