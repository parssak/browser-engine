(this["webpackJsonpbrowser-engine"]=this["webpackJsonpbrowser-engine"]||[]).push([[0],{13:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(0),r=n(1),s=n(8),c=n(10),a=n(16),o=n(21),l=n(22),u=function(){function e(t){Object(i.a)(this,e),this.name="",this.mesh=void 0,this.id=void 0,this.components={},this.id=t.id,this.name=t.name,this.init(t)}return Object(r.a)(e,[{key:"init",value:function(e){this.initMesh(e),this.initComponents(e.components)}},{key:"initMesh",value:function(e){var t=o.a.instance.getMaterial(e.material),n=l.a.instance.getGeometry(e.geometry);this.mesh?(this.mesh.geometry=n,this.mesh.material=t):this.mesh=new s.Mesh(n,t),this.mesh.uuid=this.id,this.mesh.name=this.name}},{key:"initComponents",value:function(e){var t=this;this.components={},Object.entries(e).forEach((function(e){var n=Object(c.a)(e,2),i=n[0],r=n[1];a.a.instance.setComponent(t,i,r)}))}},{key:"addChild",value:function(e){}},{key:"destroy",value:function(){}},{key:"start",value:function(){d.isPlaying()&&this._startComponents()}},{key:"update",value:function(){d.isPlaying()&&this._updateComponents()}},{key:"getComponent",value:function(e){return this.components[e]}},{key:"_startComponents",value:function(){Object.values(this.components).forEach((function(e){return e.start()}))}},{key:"_updateComponents",value:function(){Object.values(this.components).forEach((function(e){return e.update()}))}}]),e}(),d=function(){function e(){var t,n,r,c;if(Object(i.a)(this,e),this.isPlaying=!1,this._scene=void 0,this._entities=[],this._scenePayload=void 0,this._selectedEntityID=void 0,this._axes=new s.AxesHelper(2),this._gridHelper=new s.GridHelper(60,6),this._selectionHelper=void 0,!e.instance){e.instance=this,this._scene=new s.Scene,null===(t=this._scene)||void 0===t||t.add(this._axes),null===(n=this._scene)||void 0===n||n.add(this._gridHelper),null===(r=this._scene)||void 0===r||r.add(new s.DirectionalLight(16777215,.6)),null===(c=this._scene)||void 0===c||c.add(new s.AmbientLight(5592405));(new s.CubeTextureLoader).load(["resources/images/cubemaps/computer-history-museum/pos-x.jpg","resources/images/cubemaps/computer-history-museum/neg-x.jpg","resources/images/cubemaps/computer-history-museum/pos-y.jpg","resources/images/cubemaps/computer-history-museum/neg-y.jpg","resources/images/cubemaps/computer-history-museum/pos-z.jpg","resources/images/cubemaps/computer-history-museum/neg-z.jpg"])}}return Object(r.a)(e,[{key:"getScene",value:function(){return this._scene}},{key:"setScenePayload",value:function(e){this._scenePayload=e}},{key:"getSelectedEntityPayload",value:function(){var e,t=this;return null===(e=this._scenePayload)||void 0===e?void 0:e.sceneConfig.entities.find((function(e){return e.id===t._selectedEntityID}))}},{key:"updateEntityPayload",value:function(e,t){var n,i=this._entities.findIndex((function(t){return t.id===e}));-1!==i&&(this._entities[i].init(t),null===(n=this._selectionHelper)||void 0===n||n.setFromObject(this._entities[i].mesh))}},{key:"updateScene",value:function(){this._entities.forEach((function(e){e.update()}))}},{key:"runPlayScene",value:function(){this.isPlaying=!0,this._resetScene(),this._scene.remove(this._axes),this._scene.remove(this._gridHelper),this._scene.background=new s.Color("rgb(0,0,0)"),this._selectionHelper&&this._scene.remove(this._selectionHelper);try{this._buildEntities(),this._startEntities()}catch(e){console.error("Error whilst setting up play scene")}}},{key:"runEditScene",value:function(){this.isPlaying=!1,this._resetScene(),this._scene.background=new s.Color("rgb(0,2,60)"),this._scene.add(this._axes),this._scene.add(this._gridHelper),this._selectionHelper&&this._scene.add(this._selectionHelper),this._buildEntities()}},{key:"selectByID",value:function(e){var t,n;this.select(null!==(t=null===(n=this._entities.find((function(t){return t.id===e})))||void 0===n?void 0:n.mesh)&&void 0!==t?t:void 0)}},{key:"select",value:function(e){if(!this.isPlaying){if(!e&&this._selectionHelper&&this._selectedEntityID)return this._scene.remove(this._selectionHelper),void(this._selectedEntityID=void 0);if(e){var t;if(this._selectedEntityID=e.uuid,!this._selectionHelper)return this._selectionHelper=new s.BoxHelper(e,16776960),void this._scene.add(this._selectionHelper);null===(t=this._selectionHelper)||void 0===t||t.setFromObject(e),this._scene.add(this._selectionHelper)}}}},{key:"getSelectedEntity",value:function(){return this._selectedEntityID}},{key:"buildEntity",value:function(e){var t=new u(e);return this._entities.push(t),this._scene.add(t.mesh),t}},{key:"_startEntities",value:function(){this._entities.forEach((function(e){e.start()}))}},{key:"_resetScene",value:function(){var e=this;this._entities.forEach((function(t){e._scene.remove(t.mesh),t.destroy()})),this._entities=[]}},{key:"_buildEntities",value:function(){var e,t=this;this._scenePayload&&(e=this._scenePayload,JSON.parse(JSON.stringify(e))).sceneConfig.entities.forEach((function(e){t.buildEntity(e)}))}}],[{key:"isPlaying",value:function(){return e.instance.isPlaying}}]),e}();d.instance=void 0},15:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"b",(function(){return d}));var i=n(10),r=n(17),s="// @defineComponent",c="class Component {\n  \n  // <public>\n\n  // </public>\n\n  ".concat(s,"\n\n  start() {\n    \n  }\n\n  update() {\n\n  }\n}"),a=function(e){return{id:Object(r.v4)(),name:e,language:"js",content:c,type:"component"}},o="// <initPropPlaceholder />",l=function(e){return"(".concat(e.content,")").replace(s,"\n          entity;\n        \n          constructor(entity) {\n            this.entity = entity;\n          }\n\n          ".concat(o,"\n        "))},u=function(e,t){var n="\n  init(props) {\n    this.transform = this.entity.getComponent('Transform');\n    ".concat(Object.entries(t).map((function(e){var t=Object(i.a)(e,2),n=t[0],r=t[1];return"this.".concat(n," = props?.").concat(n," ?? ").concat(r,";")})).join("\n"),"\n  }");return e.replace(o,n)},d=function(e){return{id:Object(r.v4)(),name:e,vertexShader:"".concat("\nvarying vec3 vColor;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"),fragmentShader:"".concat("\nvoid main() {\n  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}"),uniforms:{}}}},16:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var i=n(10),r=n(11),s=n(0),c=n(1),a=n(8),o=n(2),l=n(3),u=function e(t){Object(s.a)(this,e),this.entity=void 0,this.entity=t},d=function(e){Object(o.a)(n,e);var t=Object(l.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).entity=void 0,i.position=new a.Vector3(0,0,0),i.rotation=new a.Euler(0,0,0,"XYZ"),i.scale=new a.Vector3(1,1,1),i.entity=e,i}return Object(c.a)(n,[{key:"init",value:function(e){var t,n,i;this.position=null!==(t=null===e||void 0===e?void 0:e.position)&&void 0!==t?t:this.position,this.rotation=null!==(n=null===e||void 0===e?void 0:e.rotation)&&void 0!==n?n:this.rotation,this.scale=null!==(i=null===e||void 0===e?void 0:e.scale)&&void 0!==i?i:this.scale,this.applyMatrix()}},{key:"start",value:function(){this.applyMatrix()}},{key:"applyPosition",value:function(){this.entity.mesh.position.setX(this.position.x),this.entity.mesh.position.setY(this.position.y),this.entity.mesh.position.setZ(this.position.z)}},{key:"applyRotation",value:function(){this.entity.mesh.setRotationFromEuler(new a.Euler(this.rotation.x,this.rotation.y,this.rotation.z))}},{key:"applyScale",value:function(){this.entity.mesh.scale.setX(this.scale.x),this.entity.mesh.scale.setY(this.scale.y),this.entity.mesh.scale.setZ(this.scale.z)}},{key:"applyMatrix",value:function(){this.entity&&(this.applyPosition(),this.applyRotation(),this.applyScale())}},{key:"update",value:function(){this.applyMatrix()}}]),n}(u),_=function(){function e(){Object(s.a)(this,e),this.components={},e.instance||(e.instance=this,this.registerComponent("Transform",d,{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}))}return Object(c.a)(e,[{key:"getComponents",value:function(){return Object(r.a)({},this.components)}},{key:"registerComponent",value:function(e,t,n){this.components[e]={constructor:t,props:n}}},{key:"getComponentProps",value:function(e){var t,n=null!==(t=this.components[e].props)&&void 0!==t?t:null;return n||null}},{key:"getComponent",value:function(e){var t;return null!==(t=this.components[e].constructor)&&void 0!==t?t:null}},{key:"setComponent",value:function(e,t,n){var r=this.getComponent(t);if(r){Object.entries(n).forEach((function(e){var t=Object(i.a)(e,2),r=t[0],s=t[1];Array.isArray(s)&&(3===s.length?n[r]=new a.Vector3(s[0],s[1],s[2]):2===s.length&&(n[r]=new a.Vector2(s[0],s[1])))}));var s=new r(e);try{s.init(n),e.components[t]=s}catch(c){console.error("Error whilst initializing component",c)}}else console.error("Component ".concat(t," not found"))}}]),e}();_.instance=void 0},21:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(0),r=n(1),s=n(8),c=n(15),a=function(){function e(){Object(i.a)(this,e),e.instance||(e.instance=this)}return Object(r.a)(e,[{key:"getMaterial",value:function(e){var t=Object(c.b)("coolMat");switch(console.debug(e),e){case"normal":return new s.MeshNormalMaterial;case"basic":return new s.MeshBasicMaterial;case"phong":return new s.MeshPhongMaterial;case"lambert":return new s.MeshLambertMaterial;case"wireframe":return new s.MeshBasicMaterial({wireframe:!0});case"coolMat":return console.debug("cool mat>"),new s.ShaderMaterial({uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader});default:return new s.MeshBasicMaterial}}}]),e}();a.instance=void 0},22:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),r=n(1),s=n(8),c=function(){function e(){Object(i.a)(this,e),e.instance||(e.instance=this)}return Object(r.a)(e,[{key:"getGeometry",value:function(e){switch(e){case"box":return new s.BoxBufferGeometry;case"sphere":return new s.SphereBufferGeometry(1,16,8);case"cylinder":return new s.CylinderBufferGeometry(1,1,1,16,1);case"torus":return new s.TorusBufferGeometry(6,1.1,10,32,6.3);case"plane":return new s.PlaneBufferGeometry(1,1);case"tetrahedron":return new s.TetrahedronBufferGeometry;case"octahedron":return new s.OctahedronBufferGeometry;case"dodecahedron":return new s.DodecahedronBufferGeometry;case"icosahedron":return new s.IcosahedronBufferGeometry;default:return new s.SphereBufferGeometry}}}]),e}();c.instance=void 0},23:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ScriptContext})),__webpack_require__.d(__webpack_exports__,"b",(function(){return ScriptProvider}));var _Users_parssa_projects_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10),three__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6),react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_2__),_engine_core_ComponentManager__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(16),_utils_script_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(15),_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(13),_utils_entity_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(24),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(4),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__),initialValue={scripts:{},selectedScript:void 0,scriptBody:"",setScriptBody:function(e){},setScripts:function(e){},setSelectedScript:function(e){},compileScripts:function(){}},ScriptContext=Object(react__WEBPACK_IMPORTED_MODULE_2__.createContext)(initialValue),ScriptProvider=function ScriptProvider(_ref){var _selectedScript$conte,children=_ref.children,_useState=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)({}),_useState2=Object(_Users_parssa_projects_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(_useState,2),scripts=_useState2[0],setScripts=_useState2[1],_useState3=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(),_useState4=Object(_Users_parssa_projects_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(_useState3,2),selectedScript=_useState4[0],setSelectedScript=_useState4[1],_useState5=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_selectedScript$conte=null===selectedScript||void 0===selectedScript?void 0:selectedScript.content)&&void 0!==_selectedScript$conte?_selectedScript$conte:""),_useState6=Object(_Users_parssa_projects_browser_engine_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__.a)(_useState5,2),scriptBody=_useState6[0],setScriptBody=_useState6[1],compileScripts=function compileScripts(){var THREE=three__WEBPACK_IMPORTED_MODULE_1__,Instantiate=_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_5__.a.instance.buildEntity.bind(_engine_core_SceneManager__WEBPACK_IMPORTED_MODULE_5__.a.instance),CreateEntity=_utils_entity_utils__WEBPACK_IMPORTED_MODULE_6__.a;Object.values(scripts).forEach((function(script){try{var scriptCopy="".concat(script.content),removePrefix=scriptCopy.substring(scriptCopy.indexOf("// <public>")+11),pureProps=removePrefix.substring(0,removePrefix.indexOf("// </public>"));pureProps=pureProps.replaceAll(";",","),pureProps=pureProps.replaceAll("=",":");var props={};"".concat(pureProps).replace(/\s/g,"").length&&(pureProps="{".concat(pureProps,"}"),props=eval("(".concat(pureProps,")")));var formattedScript=Object(_utils_script_utils__WEBPACK_IMPORTED_MODULE_4__.a)(script);formattedScript=Object(_utils_script_utils__WEBPACK_IMPORTED_MODULE_4__.d)(formattedScript,props);var NewComponent=eval("(".concat(formattedScript,")"));Object.setPrototypeOf(NewComponent,react__WEBPACK_IMPORTED_MODULE_2__.Component),_engine_core_ComponentManager__WEBPACK_IMPORTED_MODULE_3__.a.instance.registerComponent(script.name,NewComponent,props)}catch(err){console.error(err)}}))};Object(react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((function(){compileScripts()}),[scripts]);var contextValue={scripts:scripts,setScripts:setScripts,scriptBody:scriptBody,setScriptBody:setScriptBody,selectedScript:selectedScript,setSelectedScript:setSelectedScript,compileScripts:compileScripts};return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(ScriptContext.Provider,{value:contextValue,children:children})}},24:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(17),r=function(){return{id:Object(i.v4)(),name:"New Entity",geometry:"box",material:"normal",children:[],components:{Transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}}}},35:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var i=n(6),r=n.n(i),s=n(29),c=n.n(s),a=(n(35),n(4)),o={},l=Object(i.createContext)(o),u=function(e){var t=e.children,n={renderElement:Object(i.useRef)(null)};return Object(a.jsx)(l.Provider,{value:n,children:t})},d=n(10),_=n(8),h=n(17),p=n(0),m=n(1),f=n(13),v=function(){function e(){var t=this;if(Object(p.a)(this,e),this.renderer=new _.WebGLRenderer({antialias:!0,alpha:!0}),this.renderElement=void 0,this.raycaster=new _.Raycaster,this.fov=60,this.near=.01,this.far=2e4,this.camera=void 0,this.controls=void 0,e.instance)return e.instance;e.instance=this,this._setCamera(),window.addEventListener("resize",(function(){return t.handleResize()}))}return Object(m.a)(e,[{key:"setup",value:function(e,t){this.renderer.setSize(e.clientWidth,e.clientHeight),this.renderElement=e,this.renderElement.appendChild(this.renderer.domElement),this.handleResize(),this._setControls(),this._setRaycaster(),this._runSceneLoop(t)}},{key:"resetCamera",value:function(){this.renderer.setAnimationLoop(null)}},{key:"handleClick",value:function(e,t){var n=new _.Vector2(e,t);this.raycaster.setFromCamera(n,this.camera);var i=this.raycaster.intersectObjects(f.a.instance.getScene().children,!0).filter((function(e){return"Mesh"===e.object.type}));i.length>0?f.a.instance.select(i[0].object):f.a.instance.select()}},{key:"_setCamera",value:function(){this.renderElement||(this.camera=new _.PerspectiveCamera(this.fov,window.innerWidth/window.innerHeight,this.near,this.far),this.camera.position.y=10,this.camera.rotation.x=-.1)}},{key:"_runSceneLoop",value:function(e){var t=this;this.renderer.setAnimationLoop((function(n){return t.update(e)}))}},{key:"_setRaycaster",value:function(){this.raycaster=new _.Raycaster}},{key:"_setControls",value:function(){this.camera.position.z=50}},{key:"handleResize",value:function(){if(this.renderElement){var e=this.renderElement.getBoundingClientRect();this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.renderElement.clientWidth,this.renderElement.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio)}}},{key:"update",value:function(e){this.renderer.render(e,this.camera),f.a.instance.updateScene()}}]),e}();v.instance=void 0;var b=n(16),y=n(22),j=n(21),O=new(function(){function e(){Object(p.a)(this,e),this.sceneManager=void 0,this.cameraManager=void 0,this.componentManager=void 0,this.materialManager=void 0,this.geometryManager=void 0,this._renderElement=void 0,this.isInitialized=!1,this.sceneManager=new f.a,this.cameraManager=new v,this.componentManager=new b.a,this.materialManager=new j.a,this.geometryManager=new y.a}return Object(m.a)(e,[{key:"init",value:function(e,t){this.isInitialized||(this._renderElement=e,t&&this.updateScenePayload(t),this.runEditMode(),this.isInitialized=!0)}},{key:"runPlayMode",value:function(){this.sceneManager.runPlayScene(),this.cameraManager.setup(this._renderElement,this.sceneManager.getScene())}},{key:"runEditMode",value:function(){this.sceneManager.runEditScene(),this.cameraManager.setup(this._renderElement,this.sceneManager.getScene())}},{key:"updateScenePayload",value:function(e){this.sceneManager.setScenePayload(e)}},{key:"updateSpecificEntity",value:function(e,t){this.sceneManager.updateEntityPayload(e,t)}},{key:"addNewEntity",value:function(e){this.sceneManager.buildEntity(e)}},{key:"isPlaying",value:function(){var e;return null!==(e=f.a.isPlaying())&&void 0!==e&&e}},{key:"handleClick",value:function(e,t){this.cameraManager.handleClick(e,t)}},{key:"selectEntity",value:function(e){this.sceneManager.selectByID(e)}},{key:"getSelectedEntity",value:function(){return this.sceneManager.getSelectedEntity()}},{key:"getSelectedEntityProps",value:function(){return this.sceneManager.getSelectedEntityPayload()}}]),e}()),g={sceneConfig:{entities:[],camera:{position:new _.Vector3,fov:70,near:.1,far:1e3,controls:"orbit"}},selectedEntityID:null,setEntities:function(e){},setSelectedEntityID:function(e){},setCameraProps:function(e){}},x=Object(i.createContext)(g),E=function(e){var t=e.children,n=Object(i.useState)({position:new _.Vector3,fov:70,near:.1,far:1e3,controls:"orbit"}),r=Object(d.a)(n,2),s=r[0],c=r[1],o=Object(i.useState)([{id:Object(h.v4)(),name:"Entity A",material:"normal",geometry:"box",children:[],components:{Transform:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}}]),l=Object(d.a)(o,2),u=l[0],p=l[1],m=Object(i.useState)(null),f=Object(d.a)(m,2),v=f[0],b=f[1],y=Object(i.useMemo)((function(){return{entities:u,camera:s}}),[u,s]);Object(i.useEffect)((function(){if(v){var e=u.find((function(e){return e.id===v}));if(!e)return;O.updateSpecificEntity(v,e)}}),[y]);var j={sceneConfig:y,selectedEntityID:v,setEntities:p,setCameraProps:c,setSelectedEntityID:b};return Object(a.jsx)(x.Provider,{value:j,children:t})},S=n(23),C=n(11),M=n(15),P=n(26),w=n(24),k=function(){var e=Object(i.useContext)(x),t=e.sceneConfig,n=e.setEntities,r=e.selectedEntityID,s=e.setSelectedEntityID,c=Object(i.useMemo)((function(){var e;return null!==(e=t.entities.find((function(e){return e.id===r})))&&void 0!==e?e:null}),[t,r]);return{sceneConfig:t,selectedEntity:c,createEntity:function(){var e=Object(w.a)();n([].concat(Object(P.a)(t.entities),[e])),O.addNewEntity(e)},selectEntity:function(e){if(e===r)return O.selectEntity(""),void s("");O.selectEntity(e),s(e)},updateEntity:function(e){var i=t.entities.findIndex((function(t){return t.id===e.id}));-1===i&&console.error("Couldn't find ".concat(e.id," in sceneConfig.entities")),t.entities[i]=e,n(Object(P.a)(t.entities))},updateEntityParent:function(e,t){}}},D=n(9),B=function(){var e=Object(i.useContext)(S.a),t=e.scripts,n=e.setScripts,r=e.selectedScript,s=e.setSelectedScript,c=e.compileScripts,a=e.scriptBody,o=e.setScriptBody;return{scripts:Object.values(t),setScripts:n,scriptBody:a,setScriptBody:o,selectedScript:r,setSelectedScript:s,loadScript:function(e){var n,i=t[e];s(i),o(null!==(n=null===i||void 0===i?void 0:i.content)&&void 0!==n?n:"")},saveScript:function(e){var n=Object.values(t).find((function(t){return t.id===e.id}));n&&(n.content=a,c())},createScript:function(e){var i=Object(M.c)(e);n(Object(C.a)(Object(C.a)({},t),{},Object(D.a)({},i.name,i)))}}},N=function(){var e=B().scripts,t=k(),n=t.sceneConfig,r=t.selectEntity,s=Object(i.useContext)(l).renderElement,c=Object(i.useState)(O.isPlaying()),a=Object(d.a)(c,2),o=a[0],u=a[1],_=Object(i.useMemo)((function(){return{sceneConfig:n,scripts:e,materials:[Object(M.b)("coolMat")]}}),[n,e]);Object(i.useEffect)((function(){s&&s.current&&_&&O.init(s.current,_)}),[s]),Object(i.useEffect)((function(){O.updateScenePayload(_)}),[_]);return{renderElement:s,isRunning:o,toggleRun:function(){if(s&&s.current){if(f.a.isPlaying())return u(!1),void O.runEditMode();O.runPlayMode(),u(!0)}},handleClickScene:function(e){var t,n=e.target.getBoundingClientRect(),i=(e.clientX-n.x)/n.width*2-1,s=-(e.clientY-n.y)/n.height*2+1;O.handleClick(i,s),r(null!==(t=O.getSelectedEntity())&&void 0!==t?t:"")}}};function I(e){var t=e.label,n=e.bodyClass,i=e.children;return Object(a.jsxs)("div",{className:"bg-gray-800 p-1 h-full border border-gray-900 text-white",children:[Object(a.jsx)("h4",{className:"font-mono text-xs text-red-500 mb-1",children:t}),Object(a.jsx)("div",{className:"".concat(null!==n&&void 0!==n?n:""," space-y-1"),children:i})]})}var R=function(e){var t=e.field,n=e.updateField;return"number"===typeof t||"string"===typeof t?Object(a.jsx)("div",{className:"bg-gray-700 text-white px-1  w-max",children:Object(a.jsx)("input",{type:"string"===typeof t?"string":"number",value:t,onChange:function(e){"number"!==typeof t?"string"===typeof t&&n(e.target.value):n(Number(e.target.value))},className:"bg-gray-700 w-16 font-mono text-xs"})}):Array.isArray(t)?Object(a.jsx)("div",{children:"array field"}):Object(a.jsxs)("div",{className:"bg-gray-700 text-white px-2 grid grid-cols-3 gap-1",children:[Object(a.jsxs)("pre",{className:"text-xs p-0 m-0",children:[Object(a.jsx)("span",{className:"pr-2 text-xs text-gray-400",children:"x:"}),Object(a.jsx)("input",{type:"string"===typeof t?"string":"number",value:t.x,onChange:function(e){var i,r;return n({x:Number(e.target.value),y:null!==(i=null===t||void 0===t?void 0:t.y)&&void 0!==i?i:0,z:null!==(r=null===t||void 0===t?void 0:t.z)&&void 0!==r?r:0})},className:"bg-gray-700 w-12 font-mono text-xs"})]}),Object(a.jsxs)("pre",{className:"text-xs p-0 m-0",children:[Object(a.jsx)("span",{className:"pr-2 text-xs text-gray-400",children:"y:"}),Object(a.jsx)("input",{type:"string"===typeof t?"string":"number",value:t.y,onChange:function(e){var i,r;return n({x:null!==(i=null===t||void 0===t?void 0:t.x)&&void 0!==i?i:0,y:Number(e.target.value),z:null!==(r=null===t||void 0===t?void 0:t.z)&&void 0!==r?r:0})},className:"bg-gray-700 w-12 font-mono text-xs"})]}),Object(a.jsxs)("pre",{className:"text-xs p-0 m-0",children:[Object(a.jsx)("span",{className:"pr-2 text-xs text-gray-400",children:"z:"}),Object(a.jsx)("input",{type:"string"===typeof t?"string":"number",value:t.z,onChange:function(e){var i,r;return n({x:null!==(i=null===t||void 0===t?void 0:t.x)&&void 0!==i?i:0,y:null!==(r=null===t||void 0===t?void 0:t.y)&&void 0!==r?r:0,z:Number(e.target.value)})},className:"bg-gray-700 w-12 font-mono text-xs"})]})]})},T=function(e){var t=e.componentType,n=e.componentProps,i=e.updateComponent,r=B().loadScript;return Object(a.jsxs)("div",{className:"bg-gray-800 text-white pb-4",children:[Object(a.jsxs)("div",{className:"flex w-full justify-between items-center mb-2",children:[Object(a.jsx)("h3",{children:t}),"Transform"!==t&&Object(a.jsx)("small",{className:"text-xs font-light underline text-gray-400 cursor-pointer hover:text-gray-300",onClick:function(){r(t)},children:"Open in editor"})]}),Object(a.jsx)("div",{className:"space-y-2",children:Object.entries(n).map((function(e){var n=Object(d.a)(e,2),r=n[0],s=n[1];return Object(a.jsxs)("div",{className:"flex space-x-2",children:[Object(a.jsx)("p",{className:"text-xs capitalize text-gray-200",style:{minWidth:"10ch"},children:r}),Object(a.jsx)(R,{field:s,updateField:function(e){return i(t,r,e)}})]},r)}))}),Object(a.jsx)("hr",{className:"mt-4"})]})};function A(){var e=N().isRunning,t=k(),n=t.selectedEntity,r=t.updateEntity,s=t.sceneConfig,c=Object(i.useState)({}),o=Object(d.a)(c,2),l=o[0],u=o[1],_=Object(i.useState)("normal"),h=Object(d.a)(_,2),p=h[0],m=h[1],f=Object(i.useState)("box"),v=Object(d.a)(f,2),y=v[0],j=v[1];Object(i.useEffect)((function(){n&&(m(n.material),j(n.geometry))}),[n]),Object(i.useEffect)((function(){n&&function(e){var t={};Object.entries(e.components).forEach((function(e){var n=Object(d.a)(e,2),i=n[0],r=n[1];t[i]=r})),u(Object(C.a)({},t))}(n)}),[n,s,e]);var O=function(e,t,i){var s=Object(C.a)({},l);s[e][t]=i,u(s),n&&(n.components=s,r(Object(C.a)({},n)))},g=function(){var e=b.a.instance.getComponents();if(!n)return[];var t=Object.keys(null===n||void 0===n?void 0:n.components);return Object.keys(e).filter((function(e){return!t.includes(e)})).map((function(e){return{label:e,value:e}}))}();return n?Object(a.jsxs)(I,{label:"Inspector",children:[Object(a.jsx)("section",{className:"space-y-2",children:Object.entries(l).map((function(e){var t=Object(d.a)(e,2),n=t[0],i=t[1];return Object(a.jsx)(T,{componentType:n,componentProps:i,updateComponent:O},n)}))}),g.length>0&&Object(a.jsxs)("section",{children:[Object(a.jsx)("select",{onChange:function(e){return console.log(e.target.value)},children:g.map((function(e){var t=e.label,n=e.value;return Object(a.jsx)("option",{value:n,children:t},n)}))}),Object(a.jsx)("div",{className:"grid place-items-center mt-2",children:Object(a.jsx)("button",{onClick:function(){return function(e){if(n){var t=b.a.instance.getComponentProps(e);t&&(n.components[e]=t,r(n))}}(g[0].value)},children:"Add Component"})})]}),Object(a.jsx)("section",{children:Object(a.jsxs)("div",{className:"bg-gray-800 text-white",children:[Object(a.jsx)("h3",{children:"Mesh"}),Object(a.jsxs)("div",{className:"space-y-2",children:[Object(a.jsxs)("div",{className:"flex space-x-2 items-center",children:[Object(a.jsx)("p",{className:"text-xs font-mono text-gray-200",style:{minWidth:"10ch"},children:"Material"}),Object(a.jsx)("select",{onChange:function(e){return t=e.target.value,m(t),void(n&&(n.material=t,r(Object(C.a)({},n))));var t},defaultValue:p,children:[{label:"Normal",value:"normal"},{label:"Basic",value:"basic"},{label:"Lambert",value:"lambert"},{label:"Phong",value:"phong"},{label:"Cool Material",value:"coolMat"}].map((function(e){return Object(a.jsx)("option",{value:e.value,children:e.label},e.value)}))})]}),Object(a.jsxs)("div",{className:"flex space-x-2 items-center",children:[Object(a.jsx)("p",{className:"text-xs font-mono text-gray-200",style:{minWidth:"10ch"},children:"Geometry"}),Object(a.jsx)("select",{onChange:function(e){return t=e.target.value,j(t),void(n&&(n.geometry=t,r(Object(C.a)({},n))));var t},value:y,children:[{label:"Box",value:"box"},{label:"Sphere",value:"sphere"},{label:"Torus",value:"torus"}].map((function(e){return Object(a.jsx)("option",{value:e.value,children:e.label},e.value)}))})]})]})]})})]}):Object(a.jsx)(I,{label:"Inspector"})}function L(){var e=k().createEntity,t=N(),n=t.toggleRun,i=t.isRunning,r=B(),s=r.createScript,c=r.selectedScript,o=r.loadScript,l=r.saveScript,u=r.scriptBody;return Object(a.jsxs)("div",{children:[Object(a.jsx)("header",{className:"h-0.5 transition bg-red-600 ".concat(i&&"bg-green-500")}),Object(a.jsxs)("nav",{className:"bg-gray-900 p-2 flex w-full",children:[Object(a.jsxs)("div",{className:"space-x-2",children:[Object(a.jsxs)("button",{onClick:n,className:"primary",children:[i?"Stop":"Run"," Scene"]}),Object(a.jsx)("button",{onClick:e,className:"secondary",children:"Add Entity"}),Object(a.jsx)("button",{onClick:function(){s("Component")},className:"secondary",children:"Add Script"})]}),c&&Object(a.jsxs)("div",{className:"space-x-2 ml-auto",children:[Object(a.jsx)("button",{className:"secondary",onClick:function(){o("")},children:"Close Editor"}),Object(a.jsx)("button",{onClick:function(){c&&l(Object(C.a)(Object(C.a)({},c),{},{content:u}))},className:"submit",children:"Save script"})]})]})]})}var W=n(30);function z(){var e=B(),t=e.selectedScript,n=e.scriptBody,r=e.setScriptBody;Object(i.useEffect)((function(){!n&&t&&r(t.content)}),[t]);return Object(a.jsx)(a.Fragment,{children:t&&Object(a.jsx)(a.Fragment,{children:Object(a.jsx)("div",{className:"absolute h-full w-full",children:Object(a.jsx)(W.a,{height:"100%",width:"100%",defaultLanguage:"javascript",defaultValue:t.content,theme:"vs-dark",onChange:function(e){r(null!==e&&void 0!==e?e:"")}})},t.id)})})}function U(){var e=N(),t=e.renderElement,n=e.handleClickScene;return Object(a.jsx)(a.Fragment,{children:t&&Object(a.jsx)("div",{id:"scene",ref:t,onClick:function(e){return n(e)}})})}var K=function(e){var t,n=e.entity,r=k(),s=r.selectedEntity,c=r.selectEntity,o=Object(i.useMemo)((function(){return(null===s||void 0===s?void 0:s.id)===n.id}),[s,n.id]);return Object(a.jsx)("div",{className:"\n          p-1\n          rounded-sm\n          transition\n          cursor-pointer\n          select-none\n        text-white\n          text-sm\n          ".concat(o&&"bg-gray-500","\n          ").concat(o?"hover:bg-gray-600":"hover:bg-gray-500","\n    "),onClick:function(e){e.stopPropagation(),c(n.id)},children:null!==(t=null===n||void 0===n?void 0:n.name)&&void 0!==t?t:"__ENTITY__"})};function H(){var e=k().sceneConfig;return Object(a.jsx)(I,{label:"Hierarchy",children:Object(a.jsx)("div",{className:"space-y-1",children:e.entities.map((function(e){return Object(a.jsx)(K,{entity:e},e.id)}))})})}function G(e){var t=e.title,n=e.children;return Object(a.jsxs)("details",{children:[Object(a.jsx)("summary",{children:t}),null!==n&&void 0!==n?n:"No ".concat(t)]})}function V(){var e=B(),t=e.scripts,n=e.loadScript,i=e.selectedScript;return Object(a.jsxs)(I,{label:"Project",bodyClass:"space-y-2",children:[Object(a.jsx)(G,{title:"Scripts",children:t.map((function(e){return Object(a.jsxs)("div",{className:"project-node\n          ".concat((null===i||void 0===i?void 0:i.id)===e.id&&"bg-gray-500","\n          ").concat((null===i||void 0===i?void 0:i.id)===e.id?"hover:bg-gray-600":"hover:bg-gray-500"),onClick:function(){return n(e.name)},children:[e.name,".",e.language]},e.id)}))}),Object(a.jsx)(G,{title:"Prefabs"}),Object(a.jsx)(G,{title:"Materials"})]})}function q(){return Object(a.jsxs)("div",{className:"w-screen h-screen overflow-hidden",children:[Object(a.jsx)(L,{}),Object(a.jsxs)("section",{className:"w-full h-full grid",style:{gridTemplateColumns:"1fr 14rem 14rem"},children:[Object(a.jsxs)("div",{className:"h-full w-full grid relative",children:[Object(a.jsx)(U,{}),Object(a.jsx)(z,{})]}),Object(a.jsxs)("aside",{className:"grid grid-rows-5",children:[Object(a.jsx)("div",{className:"row-span-3",children:Object(a.jsx)(H,{})}),Object(a.jsx)("div",{className:"row-span-2",children:Object(a.jsx)(V,{})})]}),Object(a.jsx)("aside",{className:"grid",children:Object(a.jsx)(A,{})})]})]})}var F=function(){return Object(a.jsx)(E,{children:Object(a.jsx)(S.b,{children:Object(a.jsx)(u,{children:Object(a.jsx)(q,{})})})})};c.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(F,{})}),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.ce6e0fc3.chunk.js.map